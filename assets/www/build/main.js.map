{"version":3,"sources":["../../src/lib/services/socket.service.ts","../../src/lib/services/blobService.ts","../../src/lib/asset/blobCache.ts","../../src/lib/messages/messageService.ts","../../src/lib/crypto/helper.js","../../src/lib/users/profile.ts","../../node_modules/@angular/core/@angular lazy","../../src/lib/services/requestKey.service.ts","../../src/lib/asset/observer.ts","../../src/lib/crypto/minimalHelper.js","../../src/lib/asset/enum.ts","../../src/lib/services/trust.service.ts","../../src/lib/migrations/00001-regenerateFriendsKeys.js","../../src/lib/validation/validator.js","../../src/lib/circles/circleService.js","../../src/lib/migrations/00002-fixBrokenSettings.js","../../src/lib/migrations/migrationExample.js","../../src/lib/services/session.service.ts","../../src/lib/services/initService.js","../../src lazy","../../src/lib/services/Cache.ts","../../src/lib/crypto/keyStore.js","../../src/lib/asset/Queue.ts","../../src/lib/services/featureToggles.ts","../../src/lib/messages/burst.ts","../../src/lib/asset/state.ts","../../src/pages/messages/messages.ts","../../src/app/tutorial.ts","../../src/app/main.ts","../../src/lib/services/error.service.ts","../../src/app/app.module.ts","../../src/lib/interceptors/addKeysInterceptor.js","../../src/lib/services/keyStore.service.ts","../../src/lib/asset/securedDataWithMetaData.js","../../ws (ignored)","../../src/lib/conf/base.config.json","../../src/lib/conf/production.config.json","../../src/lib/services/blobUploader.service.ts","../../src/lib/services/Storage.ts","../../src/lib/crypto/waitForReady.js","../../src/lib/crypto/sjclWorkerInclude.js","../../src/lib/worker/worker-pool.js","../../src/lib/worker/worker-loader.js","../../src/lib/crypto/objectHasher.js","../../src/lib/interceptors/sessionServiceInterceptor.js","../../src/lib/services/migrationService.js","../../src/lib/migrations ^/.//.*$","../../src/lib/users/user.ts","../../src/lib/services/blobDownloader.service.ts","../../src/lib/validation/validations/profileV.js","../../src/lib/validation/validations/profileEncryptedV.js","../../src/lib/validation/validations/messageV.js","../../src/lib/validation/validations/topicV.js","../../src/lib/validation/validations/topicCreateV.js","../../src/lib/validation/validations/circleV.js","../../src/lib/validation/validations/postV.js","../../src/lib/crypto/encryptedData.js","../../src/lib/services/filter.service.ts","../../src/lib/i18n/localizationConfig.js","../../src/lib/users/signedKeys.ts","../../node_modules/moment/locale //de|//en","../../src/lib/messages/chatTitleUpdate.ts","../../src/lib/messages/chatList.ts","../../src/app/app.component.ts","../../src/lib/services/push.service.ts","../../src/lib/services/settings.service.ts","../../src/lib/asset/errors.js","../../src/lib/services/location.manager.ts","../../src/lib/config.js","../../src/lib/helper/helper.ts","../../src/lib/crypto/trustManager.js","../../src/lib/crypto/signatureCache.js","../../src/lib/services/cachedObjectLoader.ts","../../src/lib/services/friendsService.js","../../src/lib/messages/chat.ts","../../src/lib/asset/Progress.ts","../../src/lib/messages/chatChunk.ts","../../src/lib/messages/message.ts","../../src/lib/services/storage.service.ts","../../src/lib/users/userService.ts","../../src/lib/services/mutableObjectLoader.ts"],"names":["sjcl","require","h","default","errors","helper","hash","text","bits2hex","sha256","hashPW","pw","salt","getCurveName","curve","curcurve","ecc","curves","hasOwnProperty","Error","getCurve","curveName","substr","hex2bits","t","Array","isHex","codec","hex","toBits","InvalidHexError","fromBits","sjclPacket2Object","decoded","result","ct","iv","Object2sjclPacket","data","json","encode","module","exports","chelper","match","Bluebird","friendsService","keyStore","fixInvalidKey","invalidKey","userid","try","getUserForKey","removeFriend","then","friendship","console","log","friendsKeys","awaitLoading","getAllFriendShipKeys","upload","preLoadMultiple","invalidKeys","filter","realid","isKeyLoaded","length","reduce","previous","resolve","amanda","jsonSchemaValidator","validations","doValidate","ref","theError","validate","err","validator","addAttribute","name","cb","register","obj","error","amandaLoaded","am","profileV","profileEncryptedV","postV","messageV","topicV","topicCreateV","circleV","hexAttribute","property","propertyValue","attributeValue","propertyAttributes","callback","addError","doLoad","exported","define","apply","arguments","load","modules","i","push","Observer","SecuredData","socket","initService","settingsService","circles","circleArray","circleData","encryptKeyForUsers","key","users","map","parseDecimal","userID","getUserFriendShipKey","friendKey","sym","symEncryptKey","thenReturn","nodeify","generateNewKey","generateKey","userService","mainKey","getOwn","getMainKey","Circle","id","theCircle","persons","circleSec","content","meta","type","circleUsers","metaAttr","getID","getIDF","getUserIDs","hasUser","uid","indexOf","getKey","remove","removeCircle","emit","circleid","circle","removeArray","setUser","uids","newKey","oldKey","removing","friendKeys","arraySubtract","_newKey","_friendKeys","metaSet","circleKey","getUpdatedData","getSignKey","newData","update","decryptors","getDecryptors","user","userids","ownUser","uploadChangedProfile","loadPersons","removePersons","e","addPersons","bind","concat","all","decrypt","verify","undefined","spread","security","addEncryptionIdentifier","limit","Math","min","loadedIDs","p","loadableUsers","getMultiple","slice","loadBasicData","image","extend","loadingPromise","makeCircle","circleService","loaded","loading","get","inWhichCircles","create","symKey","own","createAsync","keyData","circleResponse","created","reset","loadAll","definitlyEmit","fromCallback","notify","settings","removePadding","val","isNumber","InvalidDataError","paddingIndex","unpadded","checkAndFixString","lastIndexOf","checkAndFixObject","objectEach","value","getContent","setContent","uploadChangedData","$injector","warn","Date","now","time","errorService","errorServiceInstance","socketService","CacheService","debug","sessionService","debugName","initServiceDebug","enabled","timeEnd","initRequestsList","initCallbacks","initCacheCallbacks","getCache","initRequest","domain","getUserID","cache","catch","setCache","initResponse","transformedData","store","getServerData","initRequests","request","requestObject","responseKey","_signature","cacheSignature","response","runCacheCallbacks","options","cacheCallback","runCallbacks","initResponses","runFunction","func","runInitCacheCallbacks","loadData","blockPrivateActions","runningInitCallbacks","promise","customCacheResults","simpleCacheResults","and","criticalError","allowPrivateActions","migrationService","awaitLogin","registerCacheCallback","registerCallback","waitForReady","sjclWorkerInclude","ObjectHasher","keyStoreDebug","keyGetFunction","firstVerify","improvementListener","makeKey","recovery","sjclWarning","dirtyKeys","newKeys","symKeys","cryptKeys","signKeys","password","keyGenIdentifier","keysUsableForEncryption","privateActionsBlocked","Key","SymKey","CryptKey","SignKey","random","startCollectors","MAXSPEED","SPEEDS","unloaded","cryptKey","localStorage","getItem","bufferToHex","buffer","hexCodes","view","DataView","byteLength","getUint32","stringValue","toString","padding","paddedValue","join","fingerPrintData","fingerPrintPublicKey","publicKey","_point","fingerPrintSymKey","getSubtle","window","msCrypto","subtle","crypto","webkitSubtle","makeKeyUsableForEncryption","fp","split","isKeyUsableForEncryption","toPrivateKey","secret","exponent","bn","secretKey","determineLength","object","Object","keys","prev","cur","stringifyObject","version","stringify","_type","removeExpectedPrefix","bitArray","prefix","len","part","utf8String","ArrayBuffer","buf8","Uint8Array","arrayBuffer","subarray","equal","bitSlice","DecryptionError","generateid","base","SecurityError","correctKeyIdentifier","parts","encryptPW","_encrypt","internalDecrypt","decryptorid","decryptortype","ctext","theKey","decryptKey","decryptedData","unkem","jsonData","raw","getDecryptor","decryptorData","keyConstructor","superKey","optionals","decryptKeyPromise","dirtyDecryptors","internalSecret","preSecret","pastProcessor","decrypted","decryptedF","isFulfilled","usedDecryptor","getFastestDecryptor","decryptor","d","callEach","getRealID","pastProcessedSecret","globalErrors","getRealIDF","getRealidFingerPrint","getDecryptorsF","tempR","k","getFastestDecryptorF","level","decryptorIndex","smallest","subKeyData","speed","curSpeeds","addAsymDecryptorF","tag","dirty","addSymDecryptorF","cryptorKey","encryptWithPrefix","addPWDecryptorF","addAsymDecryptor","addSymDecryptor","addPWDecryptor","getDecryptorDataF","includeAllDecryptors","decryptorArray","getDecryptorData","isDirtyF","isDirty","removeDirtyF","remaining","j","isRemaining","curD","curK","splice","removeDirty","getSecret","intKey","comment","randomWords","ValidationError","getAccessCount","accessCount","getUploadData","setComment","setCommentF","theComment","progressCallback","noDecode","l","concatBuffers","encrypt","_decrypt","makeSymKey","realKeyID","symKeyGenerate","generate","x","y","point","isPrivateKey","field","elGamal","_curve","getFingerPrintF","getFingerPrint","kem","resultKey","makeCryptKey","async","curveO","rawKey","generateKeys","pub","sec","_exponent","ecdsa","getJWKPublicKey","format","base64ToUrl","base64","getSubtlePublicKey","_getSubtlePublicKeyPromise","importKey","namedCurve","subtleVerify","signatureBuf","buf","sign","trustManager","signatureCache","isLoaded","listenPromise","hasKeyData","alert","signature","addValidSignature","verifySjcl","asym","verifySubtle","TextEncoder","valid","subtleToHex","digest","isValidSignatureInCache","finally","makeSignKey","signKeyGet","makeKeyF","verifyAllAttributesAreHashes","attr","ObjectPadder","minLength","_obj","_minLength","prototype","_padObject","props","objectMap","padder","pad","_padArray","_padString","rand","_padNumber","padded","_padAttribute","_unpadObject","unpad","_unpadString","parseFloat","_unpadArray","_unpadAttribute","ObjectCryptor","depth","_key","_depth","_object","_encryptAttr","_encryptObject","_encryptJSON","JSON","decryptCorrectObject","parse","_decryptEndAttribute","_decryptPartialObjects","setKeyGenIdentifier","identifier","getKeyGenIdentifier","correctKeyIdentifierF","addImprovementListener","listener","arePrivateActionsBlocked","setPassword","verifyWithPW","expectedResult","deepEqual","makePWVerifiable","paddedData","urlToBase64","str","replace","base64ToBits","bitsToBase64","bits","fingerPrint","keyID","base32","toUpperCase","unBase32","unformat","start","addPaddingToObject","removePaddingFromObject","padLength","hashArrayBuffer","bufHash","hashObjectOrValueHexAsync","hashObjectOrValueHex","realids","addKey","isRealID","getKeyAccessCount","keyrealid","setKeyGet","_keyGetFunction","getExistingKey","keyid","getKeys","addKeys","allowed","allowedEncryptors","addKeyDecryptors","forEach","uploaded","remainedKeys","res","ceil","words","number","registerMainKey","_mainKey","generateKeyF","createBackupKey","realID","backupKey","outerBackupKey","toBackupKey","_toBackupKey","decryptorsAdded","backupKeyData","innerKey","outerKey","loadBackupKey","symEncryptKeyF","parentKeyID","asymEncryptKey","asymEncryptKeyF","parentRealID","pwEncryptKey","pwEncryptKeyF","encryptText","encryptObject","decryptObject","cobject","decryptText","encryptArrayBuffer","ciphertext_buffer","decryptArrayBuffer","buf32","Uint32Array","decr","decryptBigBase64","bin","fingerPrintKey","signObject","verifyObject","objectString","interceptor","transformResponse","addInterceptor","config","attributesNeverVerified","SecuredDataWithMetaData","isDecrypted","_alternativeType","alternativeType","_removeEmpty","removeEmpty","_encryptDepth","encryptDepth","_attributesNotVerified","attributesNotVerified","_decrypted","_hasContent","_original","encryptedContent","_updated","deepCopyObj","_isKeyVerified","_blockDisallowedAttributes","_contentHash","_version","hasContent","getHash","_ownHash","signKey","that","toSign","hashVersion","_hashVersion","paddedContent","hashContent","contentHash","ownHash","_signAndEncrypt","cryptedData","signAndEncrypt","hasType","verifyAsync","metaCopy","_v2","correctSignature","_verifyContentHash","updated","_changed","_decryptionPromise","isChanged","isEncrypted","contentGet","metaGet","metaHasAttr","metaKeys","contentSet","newContent","contentSetAttr","contentRemoveAttr","newMetaData","metaRemoveAttr","metaSetAttr","metaAdd","attrs","deepSetCreate","setParent","parentSecuredData","_parent","checkParent","expectedParent","getRelationshipCounter","_sortCounter","setAfterRelationShip","afterSecuredData","checkAfter","securedData","checkBefore","api","createPromisified","securedDataPromise","secured","createRaw","delay","isReady","waiting","addEventListener","ready","promisify","WorkerPool","bluebird","getEntropy","ab","getRandomValues","addEntropy","theWorker","entropy","runTask","randomNumber","workerCount","navigator","hardwareConcurrency","max","workers","setupMethod","workerScriptOverride","workerScript","sjclWorker","toHash","schedule","isHash","generateCryptKey","crypt","generateSignKey","action","privateKey","message","progressListener","Worker","Promise","numberOfWorkers","_Promise","_numberOfWorkers","_numberOfRunningWorkers","_options","_queue","_workers","_setupMethod","_setupDone","_setupRunning","_createNewWorker","newWorker","onFree","_onFree","worker","_runFromQueue","isBusy","current","shift","runIfFree","task","metaListener","reject","_saveCallBack","waitPromise","drain","setNumberOfWorkers","PromiseWorker","_busy","_worker","_taskQueue","_freeListener","_taskCallback","_metaListener","onmessage","_workerMessage","postMessage","event","_free","_lockFree","_checkQueues","_run","_saveCallbacks","_data","parseInt","sjclHash","_hashProperty","_doHashNewObject","hasher","_doHash","allowedTypes","_stringifyArray","_jsonifyUnique","sortation","sort","_stringifyObject","hashObj","_stringifyObjectOrArray","handleVal","hashBits","getType","transformVal","mapToArray","sid","logedin","logout","transformRequest","getSID","migrations","runMigration","migrationState","migration","success","setMigrationState","doMigration","getMigrationState","state","profileJSON","profileEncryptedJSON","messageJSON","topicJSON","circleJSON","postJSON","encryptedDataObject","encryptedData","decryptedObj","getLocalizedString","extendError","ParentErrorClass","F","CustomError","_this","tmp","stack","SubClass","constructor","InvalidFilter","AccessViolation","LoginError","baseConfig","Enum","database","sortedTrustStates","trustStates","trustLevel","fromString","serializeTrust","unserializeTrust","KeyTrustData","trustSymbol","trust","getAddedTime","added","getNickname","nickname","getTrust","isUntrusted","UNTRUSTED","isTimeTrusted","TIMETRUSTED","isWhispeerVerified","WHISPEERVERIFIED","isNetworkVerified","NETWORKVERIFIED","isVerified","VERIFIED","isOwn","OWN","setTrust","setKeyTrustLevel","userToDataSet","getTime","fakeKeyExistence","ownKey","specialKeys","allow","count","disallow","createDatabase","nicknames","ids","me","setOwnSignKey","_ownKey","addDataSet","dataSet","idKey","nicknameKey","updateDatabase","givenDatabase","oldKeys","changed","userDataSet","oldValue","newValue","oldTrust","newTrust","loadDatabase","getKeyData","addUser","userInfo","getUpdatedVersion","promiseResolve","dataSetToHash","signatureHash","types","maxCount","saveID","topic","post","cacheTypes","signedFriendList","topicUpdate","postPrivate","profile","signedKeys","friendShip","Database","_maxCount","_saveID","_signatures","getCacheEntry","entry","date","allEntries","allSignatures","getEntry","joinEntries","entries","deleteByID","deleteEntry","addSignature","isSignature","sHash","cleanUp","hasEntry","hasSignature","a","b","allDatabases","resetChanged","signatureCacheData","internalHashVersion","initialize","databases","db","reducedType","friends","requests","requested","ignored","removed","deleted","signedList","onlineFriends","friendsServiceLoaded","friendsData","requestsCount","friendsCount","requestedCount","updateCounters","userOnline","status","createBasicData","otherUser","friendShipKey","getFriendsKey","getCryptKey","_friendShipKey","generateRemovalData","signedRemovalPromise","initial","signedListPromise","signedRemoval","updatedSignedList","generateNewFriendsKey","updatedSignedKeys","newFriendsKey","addAsFriend","u","friendsKey","setFriendShipKey","channel","requestData","containsOr","checkAndRemove","signedData","removeUnfriendedPersons","removedFriends","previousPromise","friend","ensureIsLoaded","method","getUserFriends","userCircles","rebuildProfiles","ignoreFriendShip","acceptFriendShip","didIRequest","didOtherRequest","areFriends","noRequests","getRequestStatus","getRequests","getFriends","getRequested","isInt","requestedOrFriends","arrayEqual","getOwnAsync","onlineStatus","online"],"mappings":"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","file":"main.js","sourcesContent":["const APIVERSION = \"0.0.3\";\n\nconst debug = require(\"debug\");\nimport h from \"../helper/helper\";\nimport { connect } from \"socket.io-client\";\n\nconst config = require('../config.js');\nimport * as Bluebird from \"bluebird\";\nimport Observer from \"../asset/observer\";\nimport BlobUploader from \"./blobUploader.service\"\n\nimport { goToBusinessVersion, isBusinessVersion } from \"./location.manager\";\n\nconst socketDebug = debug(\"whispeer:socket\");\nconst socketError = debug(\"whispeer:socket:error\");\n\nexport const DisconnectError = h.createErrorType(\"disconnectedError\");\nexport const ServerError = h.createErrorType(\"serverError\");\n\nconst SOCKET_TIMEOUT = 60000;\n\ninterface Interceptor {\n\ttransformRequest?: (request: any) => void\n\ttransformResponse?: (request: any, response: any) => void\n}\n\nconst log = {\n\ttimer: function (name: string) {\n\t\tvar message = new Date().toLocaleTimeString() + \":\" + name + \"(\" + Math.random() + \")\";\n\t\tif (debug.enabled(\"whispeer:socket\")) {\n\t\t\tconsole.time(message);\n\t\t}\n\t\treturn message;\n\t},\n\ttimerEnd: function (message: string) {\n\t\tif (debug.enabled(\"whispeer:socket\")) {\n\t\t\tconsole.timeEnd(message);\n\t\t}\n\t}\n};\n\nclass SocketService extends Observer {\n\n\tprivate _interceptors: Interceptor[] = [];\n\n\t_domain = (config.https ? \"https://\" : \"http://\") + config.ws + \":\" + config.wsPort;\n\t_autoReconnect = config.socket.autoReconnect;\n\t_autoConnect: boolean = config.socket.autoConnect;\n\n\t_socket: SocketIOClient.Socket;\n\n\t_lastRequestTime = 0;\n\t_loading = 0;\n\n\tuploadObserver = new Observer();\n\t_uploadingCounter = 0;\n\n\tstatic errors = {\n\t\tDisconnect: DisconnectError,\n\t\tServer: ServerError\n\t};\n\n\terrors = {\n\t\tDisconnect: DisconnectError,\n\t\tServer: ServerError\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tif (this._autoConnect) {\n\t\t\tthis._connect();\n\t\t}\n\n\t\tif (this._autoConnect && this._autoReconnect) {\n\t\t\twindow.setInterval(() => {\n\t\t\t\ttry {\n\t\t\t\t\tif (!this._socket.connected) {\n\t\t\t\t\t\tthis._socket.connect();\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tsocketError(e);\n\t\t\t\t}\n\t\t\t}, 10000);\n\t\t}\n\t}\n\n\tprivate _connect () {\n\t\tthis._socket = connect(this._domain, config.socket.options);\n\n\t\tthis._socket.on(\"disconnect\", () => {\n\t\t\tsocketDebug(\"socket disconnected\");\n\t\t\tthis._loading = 0;\n\t\t\tthis._uploadingCounter = 0;\n\t\t});\n\n\t\tthis._socket.on(\"connect\", () => {\n\t\t\tsocketDebug(\"socket connected\");\n\t\t\tthis.emit(\"whispeerPing\", {});\n\n\t\t\t(<any>this._socket.io).engine.on(\"heartbeat\", () => {\n\t\t\t\tthis.notify(null, \"heartbeat\")\n\t\t\t})\n\t\t});\n\t}\n\n\tprivate _emit (channel: string, request: Object) {\n\t\treturn new Bluebird<any>((resolve, reject) => {\n\t\t\tvar onDisconnect = function () {\n\t\t\t\treject(new DisconnectError(\"Disconnected while sending\"));\n\t\t\t};\n\t\t\tthis._socket.once(\"disconnect\", onDisconnect);\n\t\t\tthis._socket.emit(channel, request, (response: any) => {\n\t\t\t\tthis._socket.off(\"disconnect\", onDisconnect);\n\t\t\t\tresolve(response);\n\t\t\t});\n\t\t});\n\t}\n\n\tgetLoadingCount () {\n\t\treturn this._loading;\n\t};\n\n\tlastRequestTime () {\n\t\treturn this._lastRequestTime;\n\t};\n\n\tsend (data: Object) {\n\t\tthis._socket.send(data);\n\t}\n\n\taddInterceptor (interceptor: Interceptor) {\n\t\tthis._interceptors.push(interceptor);\n\t}\n\n\tuploadBlob = (blob: Blob, blobid: string, progress: any, cb?: Function) => {\n\t\tif (this._uploadingCounter > 3) {\n\t\t\tthis.uploadObserver.listenOnce(() => {\n\t\t\t\tthis.uploadBlob(blob, blobid, progress, cb);\n\t\t\t}, \"uploadFinished\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis._uploadingCounter++;\n\t\tvar uploader = new BlobUploader(this, blob, blobid);\n\n\t\tuploader.listen(function (doneBytes: number) {\n\t\t\tprogress.progress(doneBytes);\n\t\t}, \"progress\");\n\n\t\tvar uploadPromise = uploader.upload().then(() => {\n\t\t\tthis._uploadingCounter--;\n\n\t\t\tthis.uploadObserver.notify(blobid, \"uploadFinished\");\n\t\t\tthis.uploadObserver.notify(blobid, \"uploadFinished:\" + blobid);\n\t\t});\n\n\t\treturn uploadPromise.nodeify(cb);\n\t}\n\n\tisConnected () {\n\t\treturn this._socket.connected;\n\t}\n\n\temit (channel: string, request: any, cb?: Function) {\n\t\tif (!this.isConnected()) {\n\t\t\tthrow new DisconnectError(\"no connection\");\n\t\t}\n\n\t\tvar timer = log.timer(\"request on \" + channel);\n\n\t\trequest.version = APIVERSION;\n\t\trequest.clientInfo = CLIENT_INFO;\n\n\t\tsocketDebug(\"Request on \" + channel, request);\n\n\t\tthis._interceptors.forEach(function (interceptor) {\n\t\t\tif (interceptor.transformRequest) {\n\t\t\t\trequest = interceptor.transformRequest(request);\n\t\t\t}\n\t\t});\n\n\t\tthis._loading++;\n\t\tthis.notify(null, \"request\");\n\n\t\treturn this._emit(channel, request).timeout(SOCKET_TIMEOUT).then((response) => {\n\t\t\tsocketDebug(\"Answer on \" + channel, response);\n\t\t\tlog.timerEnd(timer);\n\n\t\t\tif (response.alert) {\n\t\t\t\talert(response.alert)\n\t\t\t}\n\n\t\t\tthis._lastRequestTime = response.serverTime;\n\n\t\t\tthis._interceptors.forEach((interceptor) => {\n\t\t\t\tif (interceptor.transformResponse) {\n\t\t\t\t\tresponse = interceptor.transformResponse(response, request);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (response.error) {\n\t\t\t\tsocketError(response);\n\t\t\t\tthrow new ServerError(\"server returned an error!\", { response });\n\t\t\t}\n\n\t\t\tif (!isBusinessVersion()) {\n\t\t\t\tif (response.isBusiness) {\n\t\t\t\t\tgoToBusinessVersion()\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn response;\n\t\t}).finally(() => {\n\t\t\tthis._loading--;\n\t\t\tthis.notify(null, \"response\");\n\t\t}).nodeify(cb)\n\t}\n\n\tawaitNoRequests() {\n\t\tif (this._loading === 0) {\n\t\t\treturn Bluebird.resolve();\n\t\t}\n\n\t\treturn new Bluebird<void>((resolve) => {\n\t\t\tthis.listen(() => {\n\t\t\t\tif (this._loading === 0) {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t}, \"response\");\n\t\t});\n\t}\n\n\tawaitConnection() {\n\t\treturn new Bluebird<void>((resolve) => {\n\t\t\tif (this.isConnected()) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tthis.once(\"connect\", resolve);\n\t\t\t}\n\t\t});\n\t}\n\n\ton(eventName: string, callback: Function) {\n\t\treturn this._socket.on(eventName, callback);\n\t}\n\n\tonce(eventName: string, callback: Function) {\n\t\treturn this._socket.once(eventName, callback);\n\t}\n\n\t/** definitly emits the request. might emit it multiple times! **/\n\tdefinitlyEmit (channel: string, request: any) : Bluebird<any> {\n\t\tvar SOCKET_TIMEOUT = 10000;\n\n\t\treturn this.awaitConnection().then(() => {\n\t\t\treturn this.emit(channel, request).timeout(SOCKET_TIMEOUT);\n\t\t}).catch((e) => {\n\t\t\tconsole.error(e);\n\t\t\treturn Bluebird.delay(500).then(() => {\n\t\t\t\treturn this.definitlyEmit(channel, request);\n\t\t\t});\n\t\t})\n\t}\n\n\tchannel (channel: string, callback: Function) {\n\t\tthis._socket.on(channel, (data: any) => {\n\t\t\tsocketDebug(\"received data on \" + channel);\n\t\t\tsocketDebug(data);\n\t\t\tcallback(null, data);\n\t\t});\n\t}\n\n}\n\nexport default new SocketService();\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/socket.service.ts","interface MyWindow extends Window {\n\twebkitURL\n}\n\ninterface deviceBlob extends Blob {\n\tlocalURL?: string,\n\toriginalUrl?: string\n}\n\ndeclare var window: MyWindow\ndeclare var webkitURL\n\nimport * as Bluebird from \"bluebird\"\nconst debug = require(\"debug\")\n\nimport h from \"../helper/helper\"\nimport Progress from \"../asset/Progress\"\n\nimport blobCache, { fixFileReader } from \"../asset/blobCache\"\n\nimport socketService from \"./socket.service\"\nimport BlobDownloader from \"./blobDownloader.service\"\nimport Queue from '../asset/Queue'\n\nconst initService = require(\"services/initService\");\nconst keyStore = require(\"crypto/keyStore\");\n\nconst knownBlobURLs = {};\nconst downloadBlobQueue = new Queue(5);\ndownloadBlobQueue.start();\n\nconst debugName = \"whispeer:blobService\";\nconst blobServiceDebug = debug(debugName);\n\nconst time = (name) => {\n\tif (debug.enabled(debugName)) {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.time(name);\n\t}\n}\n\nconst timeEnd = (name) => {\n\tif (debug.enabled(debugName)) {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.timeEnd(name);\n\t}\n}\n\nexport const unpath = (path: string): { name: string, directory: string } => {\n\tconst index = Math.max(path.lastIndexOf(\"/\"), path.lastIndexOf(\"\\\\\")) + 1\n\n\treturn {\n\t\tdirectory: path.substr(0, index),\n\t\tname: path.substr(index)\n\t}\n}\n\nclass MyBlob {\n\tprivate blobData: deviceBlob\n\tprivate blobID: string\n\tprivate uploaded: boolean\n\tprivate meta\n\tprivate key\n\tprivate decrypted: boolean\n\tprivate preReservedID: string\n\n\tpublic uploadProgress\n\tpublic encryptProgress\n\tpublic decryptProgress\n\n\tconstructor(blobData, blobID?, options?: { meta?, decrypted? }) {\n\t\tthis.blobData = blobData;\n\t\toptions = options || {};\n\n\t\tif (blobID) {\n\t\t\tthis.blobID = blobID;\n\t\t\tthis.uploaded = true;\n\t\t} else {\n\t\t\tthis.uploaded = false;\n\t\t}\n\n\t\tthis.meta = options.meta || {};\n\t\tthis.key = this.meta._key || this.meta.key;\n\t\tthis.decrypted = options.decrypted || !this.key;\n\n\t\tthis.uploadProgress = new Progress({ total: this.getSize() });\n\t\tthis.encryptProgress = new Progress({ total: this.getSize() });\n\t\tthis.decryptProgress = new Progress({ total: this.getSize() });\n\t}\n\n\tisDecrypted() {\n\t\treturn this.decrypted\n\t}\n\n\tisUploaded() {\n\t\treturn this.uploaded;\n\t}\n\n\tgetSize() {\n\t\treturn this.blobData.size;\n\t}\n\n\tgetMeta() {\n\t\treturn this.meta;\n\t}\n\n\tprivate getArrayBuffer() {\n\t\tfixFileReader()\n\n\t\tif (this.blobData.originalUrl) {\n\t\t\tconst { directory, name } = unpath(this.blobData.originalUrl)\n\n\t\t\treturn blobCache.readFileAsArrayBuffer(directory, name).timeout(2 * 60 * 1000)\n\t\t}\n\n\t\treturn new Bluebird((resolve) => {\n\t\t\tconst reader = new FileReader();\n\n\t\t\tif (reader.addEventListener) {\n\t\t\t\treader.addEventListener(\"loadend\", resolve);\n\t\t\t} else {\n\t\t\t\treader.onloadend = resolve;\n\t\t\t}\n\n\t\t\treader.readAsArrayBuffer(this.blobData);\n\t\t}).then((event: any) => {\n\t\t\tconst target = event.currentTarget || event.target;\n\n\t\t\tif (target.error) {\n\t\t\t\treturn Bluebird.reject(target.error)\n\t\t\t}\n\n\t\t\treturn target.result;\n\t\t}).timeout(2 * 60 * 1000)\n\t}\n\n\tencryptAndUpload (key) {\n\t\treturn Bluebird.try(async () => {\n\t\t\tconst blobKey = await this.encrypt();\n\t\t\tawait keyStore.sym.symEncryptKey(blobKey, key);\n\t\t\tawait this.upload();\n\n\t\t\treturn blobKey;\n\t\t})\n\t}\n\n\tencrypt () {\n\t\treturn Bluebird.resolve().then(() => {\n\t\t\tif (this.uploaded || !this.decrypted) {\n\t\t\t\tthrow new Error(\"trying to encrypt an already encrypted or public blob. add a key decryptor if you want to give users access\");\n\t\t\t}\n\n\t\t\treturn Bluebird.all([\n\t\t\t\tkeyStore.sym.generateKey(null, \"blob key\"),\n\t\t\t\tthis.getArrayBuffer()\n\t\t\t]);\n\t\t}).spread((key, buf) => {\n\t\t\tthis.key = key;\n\n\t\t\ttime(\"blobencrypt\" + (this.blobID || this.preReservedID));\n\t\t\treturn keyStore.sym.encryptArrayBuffer(buf, this.key, (progress) => {\n\t\t\t\tthis.encryptProgress.progress(this.getSize() * progress);\n\t\t\t});\n\t\t}).then((encryptedData) => {\n\t\t\tthis.encryptProgress.progress(this.getSize());\n\t\t\ttimeEnd(\"blobencrypt\" + (this.blobID || this.preReservedID));\n\t\t\tblobServiceDebug(encryptedData.byteLength);\n\t\t\tthis.decrypted = false;\n\n\t\t\tthis.blobData = new Blob([encryptedData], {type: this.blobData.type});\n\n\t\t\treturn this.key;\n\t\t})\n\t}\n\n\tdecrypt () {\n\t\tif (this.decrypted) {\n\t\t\treturn Bluebird.resolve()\n\t\t}\n\n\t\treturn Bluebird.try(() => {\n\t\t\treturn this.getArrayBuffer();\n\t\t}).then((encryptedData) => {\n\t\t\ttime(\"blobdecrypt\" + this.blobID);\n\t\t\treturn keyStore.sym.decryptArrayBuffer(encryptedData, this.key, (progress) => {\n\t\t\t\tthis.decryptProgress.progress(this.getSize() * progress)\n\t\t\t})\n\t\t}).then((decryptedData) => {\n\t\t\tthis.decryptProgress.progress(this.getSize())\n\t\t\ttimeEnd(\"blobdecrypt\" + this.blobID);\n\n\t\t\tthis.decrypted = true;\n\n\t\t\tthis.blobData = new Blob([decryptedData], {type: this.blobData.type});\n\n\t\t\treturn blobCache.store(this).catch((e) => {\n\t\t\t\tconsole.log(\"Could not store blob\")\n\t\t\t\treturn this.toURL()\n\t\t\t})\n\t\t})\n\t}\n\n\ttoURL() {\n\t\treturn Bluebird.try(() => {\n\t\t\tif (this.blobData.localURL) {\n\t\t\t\treturn this.blobData.localURL;\n\t\t\t}\n\n\t\t\tif (typeof window.URL !== \"undefined\") {\n\t\t\t\treturn window.URL.createObjectURL(this.blobData);\n\t\t\t}\n\n\t\t\tif (typeof webkitURL !== \"undefined\") {\n\t\t\t\treturn window.webkitURL.createObjectURL(this.blobData);\n\t\t\t}\n\n\t\t\treturn Bluebird.fromCallback((cb) => {\n\t\t\t\th.blobToDataURI(this.blobData, cb)\n\t\t\t})\n\t\t}).catch(() => {\n\t\t\treturn \"\";\n\t\t})\n\t}\n\n\n\tupload () {\n\t\treturn Bluebird.try(() => {\n\t\t\tif (this.uploaded) {\n\t\t\t\treturn this.blobID;\n\t\t\t}\n\n\t\t\treturn this.reserveID();\n\t\t}).then((blobid) => {\n\t\t\treturn socketService.uploadBlob(this.blobData, blobid, this.uploadProgress);\n\t\t}).then(() => {\n\t\t\tthis.uploaded = true;\n\n\t\t\treturn this.blobID;\n\t\t})\n\t}\n\n\tgetBlobID() {\n\t\treturn this.blobID\n\t}\n\n\tgetBlobData() {\n\t\treturn this.blobData\n\t}\n\n\tprivate reserveID () {\n\t\treturn Bluebird.try(() => {\n\t\t\tconst meta = this.meta;\n\t\t\tmeta._key = this.key;\n\t\t\tmeta.one = 1;\n\n\t\t\tif (this.preReservedID) {\n\t\t\t\treturn socketService.emit(\"blob.fullyReserveID\", {\n\t\t\t\t\tblobid: this.preReservedID,\n\t\t\t\t\tmeta: meta\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn socketService.emit(\"blob.reserveBlobID\", {\n\t\t\t\tmeta: meta\n\t\t\t});\n\t\t}).then((data) => {\n\t\t\tif (data.blobid) {\n\t\t\t\tthis.blobID = data.blobid;\n\n\t\t\t\treturn this.blobID;\n\t\t\t}\n\t\t})\n\t}\n\n\tpreReserveID () {\n\t\treturn Bluebird.try(() => {\n\t\t\treturn socketService.emit(\"blob.preReserveID\", {});\n\t\t}).then((data) => {\n\t\t\tif (data.blobid) {\n\t\t\t\tthis.preReservedID = data.blobid;\n\t\t\t\treturn data.blobid;\n\t\t\t}\n\n\t\t\tthrow new Error(\"got no blobid\");\n\t\t})\n\t}\n\n\tgetHash() {\n\t\treturn this.getArrayBuffer().then((buf) => {\n\t\t\treturn keyStore.hash.hashArrayBuffer(buf)\n\t\t})\n\t}\n}\n\nconst loadBlob = (blobID, progress, estimatedSize) => {\n\tconst decryptProgressStub = new Progress({ total: estimatedSize })\n\tconst downloadProgress = new Progress({ total: estimatedSize })\n\n\tprogress.addDepend(downloadProgress)\n\tprogress.addDepend(decryptProgressStub)\n\n\treturn downloadBlobQueue.enqueue(1, () => Bluebird.try(async () => {\n\t\tawait initService.awaitLoading()\n\t\tconst data = await new BlobDownloader(socketService, blobID, downloadProgress).download()\n\n\t\tconst blob = new MyBlob(data.blob, blobID, { meta: data.meta });\n\n\t\tif (blob.isDecrypted()) {\n\t\t\treturn blobCache.store(blob).catch(() => blob.toURL())\n\t\t}\n\n\t\tdownloadProgress.progress(downloadProgress.getTotal())\n\n\t\tprogress.removeDepend(decryptProgressStub)\n\t\tprogress.addDepend(blob.decryptProgress)\n\n\t\treturn blob.decrypt()\n\t}))\n}\n\nconst getBlob = (blobID, downloadProgress: Progress, estimatedSize: number) => {\n\tif (!knownBlobURLs[blobID]) {\n\t\tknownBlobURLs[blobID] = loadBlob(blobID, downloadProgress, estimatedSize)\n\t}\n\n\treturn knownBlobURLs[blobID]\n}\n\nconst blobService = {\n\tcreateBlob: (blob) => {\n\t\treturn new MyBlob(blob);\n\t},\n\tisBlobLoaded: (blobID) => {\n\t\treturn blobCache.isLoaded(blobID)\n\t},\n\tgetBlobUrl: (blobID, progress: Progress = new Progress(), estimatedSize = 0): Bluebird<string> => {\n\t\treturn blobCache.getBlobUrl(blobID).catch(() => {\n\t\t\treturn getBlob(blobID, progress, estimatedSize)\n\t\t})\n\t},\n}\n\nexport type BlobType = MyBlob\n\nexport default blobService\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/blobService.ts","import * as Bluebird from \"bluebird\"\nimport { File, FileEntry } from '@ionic-native/file'\n\nimport Cache from \"../services/Cache\"\nimport h from \"../helper/helper\" // tslint:disable-line:no-unused-variable\n\nconst BLOB_CACHE_DIR = \"blobCache\"\nconst LOCK_TIMEOUT = 30 * 1000\nconst FILE = new File()\n\nconst isAndroid = () => window.device && window.device.platform === \"Android\"\n\nexport const fixFileReader = () => {\n\tconst win: any = window\n\tconst delegateName = win.Zone.__symbol__('OriginalDelegate')\n\tif (win.FileReader[delegateName]) {\n\t\tconsole.warn(\"Fixing file reader!\")\n\t\twin.FileReader = win.FileReader[delegateName]\n\t}\n}\n\nlet cacheDirectoryPromise:Bluebird<string> = null\nconst getCacheDirectory = () => {\n\tif (!cacheDirectoryPromise) {\n\t\tconst basePath = FILE.cacheDirectory\n\t\tconst desiredPath = `${basePath}${BLOB_CACHE_DIR}/`\n\t\tcacheDirectoryPromise = Bluebird.resolve(FILE.checkDir(basePath, BLOB_CACHE_DIR)).then(success => {\n\t\t\treturn desiredPath\n\t\t}).catch(error => {\n\t\t\treturn FILE.createDir(basePath, BLOB_CACHE_DIR, true).then(dirEntry => {\n\t\t\t\treturn desiredPath\n\t\t\t}).catch(error => {\n\t\t\t\tthrow new Error('Could not create blob cache directory.')\n\t\t\t})\n\t\t})\n\t}\n\n\treturn cacheDirectoryPromise\n}\n\nconst readFileAsBlob = (path, filename, type) => {\n\tfixFileReader()\n\treturn FILE.readAsArrayBuffer(path, filename).then((buf) => new Blob([buf], { type }))\n}\nconst writeToFile = (path, filename, data: Blob | string) => {\n\tfixFileReader()\n\treturn FILE.writeFile(path, filename, data)\n}\nconst existsFile = (path, filename) =>\n\tFILE.checkFile(path, filename).catch((e) => {\n\t\tif (e.code === 1) {\n\t\t\treturn false\n\t\t}\n\t\treturn Bluebird.reject(e)\n\t})\n\nconst idToFileName = (blobID) => `${blobID}.blob`\n\nlet clearing = false\nlet storing = 0\nconst noPendingStorageOperations = () => {\n\treturn new Bluebird((resolve) => {\n\t\tconst busyWait = setInterval(() => {\n\t\t\tif (storing === 0) {\n\t\t\t\tresolve()\n\t\t\t\tclearInterval(busyWait)\n\t\t\t}\n\t\t}, 10)\n\t}).timeout(LOCK_TIMEOUT).catch(Bluebird.TimeoutError, () => {})\n}\n\nconst blobCache = {\n\n\tclear: () => {\n\t\treturn Bluebird.try(async () => {\n\t\t\tclearing = true\n\t\t\tawait noPendingStorageOperations()\n\t\t\tawait FILE.removeRecursively(FILE.cacheDirectory, BLOB_CACHE_DIR)\n\t\t\t\t.catch(error => {\n\t\t\t\t\t// There really is little we can do here, but logouts, e.g., should not\n\t\t\t\t\t// fail because we failed to clear.\n\t\t\t\t\tconsole.warn('Cannot remove cache, resolving promise anyway.')\n\t\t\t\t\treturn true\n\t\t\t\t})\n\t\t}).finally(() => clearing = false)\n\t},\n\n\tmoveFileToBlob: (currentDirectory, currentFilename, blobID) => {\n\t\treturn Bluebird.try(async () => {\n\t\t\tif (clearing) throw new Error('Cannot get blob, currently clearing cache.')\n\t\t\tconst path = await getCacheDirectory()\n\t\t\tconst filename = idToFileName(blobID)\n\t\t\treturn FILE.moveFile(currentDirectory, currentFilename, path, filename)\n\t\t})\n\t},\n\n\treadFileAsArrayBuffer: (directory: string, name: string) =>\n\t\tBluebird.resolve(FILE.readAsArrayBuffer(directory, name)),\n\n\tstore: (blob) => {\n\t\treturn Bluebird.try(async () => {\n\t\t\tif (clearing) throw new Error('Cannot store blob, currently clearing cache.')\n\t\t\tstoring++\n\t\t\tconsole.warn(`storing++ ${storing-1} -> ${storing}, blob: ${blob.getBlobID()}`)\n\t\t\tconst blobID = blob.getBlobID()\n\n\t\t\tif (!blob.isDecrypted()) {\n\t\t\t\tthrow new Error(\"trying to store an undecrypted blob\")\n\t\t\t}\n\n\t\t\tconst path = await getCacheDirectory()\n\t\t\tconst filename = idToFileName(blobID)\n\t\t\tconst exists = await existsFile(path, filename)\n\n\t\t\tif (!exists) {\n\t\t\t\tawait writeToFile(path, filename, blob.getBlobData())\n\t\t\t}\n\n\t\t\treturn `${path}${filename}`\n\t\t}).catch((e) => {\n\t\t\tconsole.warn(\"Storing blob failed\")\n\t\t\treturn Bluebird.reject(e)\n\t\t}).finally(() => {\n\t\t\tstoring--\n\t\t\tconsole.warn(`storing-- ${storing+1} -> ${storing}, blob: ${blob.getBlobID()}`)\n\t\t})\n\t},\n\n\tgetBlobUrl: (blobID) => {\n\t\treturn Bluebird.try(async () => {\n\t\t\tif (clearing) throw new Error('Cannot get blob URL, currently clearing cache.')\n\t\t\tconst path = await getCacheDirectory()\n\t\t\tconst filename = idToFileName(blobID)\n\t\t\tconst exists = await existsFile(path, filename)\n\n\t\t\tif (!exists) {\n\t\t\t\tthrow new Error(`cannot get blob url, blob does not exist: ${filename}`)\n\t\t\t}\n\n\t\t\treturn `${path}${filename}`\n\t\t})\n\t},\n\n\tcopyBlobToDownloads: (blobID, filename: string) => {\n\t\treturn Bluebird.try(async () => {\n\t\t\tconst cacheDir = await getCacheDirectory()\n\t\t\tconst blobFile = idToFileName(blobID)\n\t\t\tconst path = isAndroid() ? `${FILE.externalRootDirectory}Download/` : `${FILE.documentsDirectory}`\n\t\t\tconst existsSource = await existsFile(cacheDir, blobFile)\n\t\t\tconst existsDestination = await existsFile(path, filename)\n\n\t\t\tif (!existsSource) {\n\t\t\t\tthrow new Error(`cannot copy blob, blob does not exist: ${filename}`)\n\t\t\t}\n\n\t\t\tif (existsDestination) {\n\t\t\t\tawait FILE.removeFile(path, filename)\n\t\t\t}\n\n\t\t\tawait FILE.copyFile(cacheDir, blobFile, path, filename)\n\n\t\t\treturn `${path}${filename}`\n\t\t})\n\t},\n\n\tgetFileMimeType: (url) => Bluebird.resolve(FILE.resolveLocalFilesystemUrl(url))\n\t\t.then((file: FileEntry) => new Bluebird<any>((resolve, reject) => file.file(resolve, reject))\n\t\t.then((file) => file.type)),\n\n\tisLoaded: (blobID) => blobCache.getBlobUrl(blobID).then(() => true).catch(() => false),\n\n\tget: (blobID) => {\n\t\treturn Bluebird.try(async () => {\n\t\t\tif (clearing) throw new Error('Cannot get blob, currently clearing cache.')\n\t\t\tconst path = await getCacheDirectory()\n\t\t\tconst filename = idToFileName(blobID)\n\t\t\tconst blob = await readFileAsBlob(path, filename, \"\")\n\t\t\treturn { blob, blobID, decrypted: true, meta: {} }\n\t\t})\n\t}\n}\n\nexport default blobCache\n\n// delete previous cache\n;(new Cache(\"blobs\")).deleteAll().catch(() => console.warn(\"Could not delete legacy blobs from idb cache\"))\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/asset/blobCache.ts","import h from \"../helper/helper\";\nimport Observer from \"../asset/observer\"\nimport * as Bluebird from \"bluebird\";\n\nimport errorService from \"../services/error.service\"\nimport socket from \"../services/socket.service\"\nimport Cache from \"../services/Cache\"\n\nimport sessionService from \"../services/session.service\"\nvar initService = require(\"services/initService\");\n\nimport ChunkLoader from \"../messages/chatChunk\"\nimport ChatLoader from \"../messages/chat\"\nimport MessageLoader from \"../messages/message\"\nimport ChatListLoader from \"../messages/chatList\"\n\nnew Cache(\"messageSend\").deleteAll()\n\nvar messageService;\n\nlet activeChat = 0\n\nmessageService = {\n\tprependChatID: function (chatID) {\n\t\tif (!ChatListLoader.isLoaded(sessionService.getUserID())) {\n\t\t\treturn\n\t\t}\n\n\t\tconst chatList = ChatListLoader.getLoaded(sessionService.getUserID())\n\t\tconst chatIDs = chatList.get()\n\t\tchatList.set([\n\t\t\tchatID,\n\t\t\t...chatIDs.filter((id) => id !== chatID)\n\t\t])\n\t},\n\taddSocketData: function (data) {\n\t\tif (!data) {\n\t\t\treturn Bluebird.resolve()\n\t\t}\n\n\t\treturn Bluebird.try(async () => {\n\t\t\tif (data.chat) {\n\t\t\t\tconsole.warn(\"Add chat\")\n\n\t\t\t\tconst chat = await ChatLoader.load(data.chat)\n\t\t\t\tmessageService.prependChatID(chat.getID())\n\t\t\t}\n\n\t\t\tif (data.chunk) {\n\t\t\t\tconsole.warn(\"Add chunk\")\n\n\t\t\t\tconst chunk = await ChunkLoader.load(data.chunk)\n\t\t\t\tconst chat = await ChatLoader.get(chunk.getChatID())\n\n\t\t\t\tchat.addChunkID(chunk.getID())\n\t\t\t\tmessageService.prependChatID(chat.getID())\n\t\t\t}\n\n\t\t\tif (data.message) {\n\t\t\t\tconsole.warn(\"Add message\")\n\n\t\t\t\tconst chunk = await ChunkLoader.get(data.message.server.chunkID)\n\t\t\t\tconst chat = await ChatLoader.get(chunk.getChatID())\n\t\t\t\tconst message = await MessageLoader.load(data.message)\n\n\t\t\t\tchat.addMessage(message)\n\n\t\t\t\tif (!message.isOwn()) {\n\t\t\t\t\tchat.addUnreadMessage(message.getServerID())\n\t\t\t\t} else if (chat.getLatestMessage() === message.getClientID()) {\n\t\t\t\t\tchat.localMarkRead()\n\t\t\t\t}\n\n\t\t\t\tmessageService.prependChatID(chat.getID())\n\t\t\t\tmessageService.notify({ message, chat, chunk }, \"message\")\n\t\t\t}\n\n\t\t\tawait Bluebird.resolve()\n\t\t})\n\t},\n\tgetChatIDs: function () {\n\t\tconst myID = sessionService.getUserID()\n\n\t\tif (!ChatListLoader.isLoaded(myID)) {\n\t\t\treturn []\n\t\t}\n\n\t\treturn ChatListLoader.getLoaded(myID).get()\n\t},\n\tsetActiveChat: (_activeChat) => {\n\t\tactiveChat = _activeChat\n\t},\n\tisActiveChat: (chatID) => {\n\t\treturn chatID === activeChat\n\t},\n\tloadMoreChats: h.cacheUntilSettled((count = 20) => {\n\t\treturn initService.awaitLoading().then(function () {\n\t\t\treturn ChatListLoader.get(sessionService.getUserID())\n\t\t}).then(function () {\n\t\t\tconst unloadedChatIDs = messageService.getChatIDs().filter(function (chatID) {\n\t\t\t\treturn !ChatLoader.isLoaded(chatID)\n\t\t\t})\n\n\t\t\tif (unloadedChatIDs.length === 0) {\n\t\t\t\tmessageService.allChatsLoaded = true\n\t\t\t}\n\n\t\t\treturn unloadedChatIDs.slice(0, count)\n\t\t}).map((chatID) =>\n\t\t\tChatLoader.get(chatID)\n\t\t)\n\t}),\n\tsendUnsentMessages: function () {\n\t\tvar unsentMessages = new Cache(\"unsentMessages\", { maxEntries: -1, maxBlobSize: -1 });\n\n\t\treturn unsentMessages.all().map(function (unsentMessage: any) {\n\t\t\tvar data = JSON.parse(unsentMessage.data);\n\n\t\t\treturn messageService.getChat(data.chatID).then(function (chat) {\n\t\t\t\treturn chat.sendUnsentMessage(data, unsentMessage.blobs);\n\t\t\t});\n\t\t});\n\t},\n\tgetChat: function (chatID, cb) {\n\t\treturn Bluebird.try(function () {\n\t\t\treturn ChatLoader.get(chatID);\n\t\t}).nodeify(cb);\n\t},\n\tgetUserChat: function (uid, cb) {\n\t\treturn initService.awaitLoading().then(function () {\n\t\t\treturn socket.definitlyEmit(\"chat.getChatWithUser\", {\n\t\t\t\tuserID: uid\n\t\t\t});\n\t\t}).then(function (data) {\n\t\t\tif (data.chatID) {\n\t\t\t\treturn data.chatID;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}).nodeify(cb);\n\t}\n};\n\nObserver.extend(messageService);\n\nsocket.channel(\"notify.chat\", function (e, data) {\n\tif (!e) {\n\t\tmessageService.addSocketData(data)\n\t} else {\n\t\terrorService.criticalError(e);\n\t}\n});\n\ninitService.awaitLoading().then(() => {\n\tmessageService.sendUnsentMessages()\n})\n\nexport default messageService\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/messages/messageService.ts","\"use strict\";\nconst sjcl = require('sjcl');\nconst h = require(\"../helper/helper\").default\nconst errors = require('asset/errors');\nvar helper = {\n    hash: function (text) {\n        return helper.bits2hex(sjcl.hash.sha256.hash(text));\n    },\n    hashPW: function (pw, salt) {\n        return helper.bits2hex(sjcl.hash.sha256.hash(pw + salt));\n    },\n    getCurveName: function (curve) {\n        var curcurve;\n        for (curcurve in sjcl.ecc.curves) {\n            if (sjcl.ecc.curves.hasOwnProperty(curcurve)) {\n                if (sjcl.ecc.curves[curcurve] === curve) {\n                    return curcurve;\n                }\n            }\n        }\n\n        throw new Error(\"curve not existing\");\n    },\n    getCurve: function (curveName) {\n        if (typeof curveName !== \"string\" || curveName.substr(0, 1) !== \"c\") {\n            curveName = \"c\" + curveName;\n        }\n\n        if (sjcl.ecc.curves[curveName]) {\n            return sjcl.ecc.curves[curveName];\n        }\n\n        throw new Error(\"invalidCurve\");\n    },\n    hex2bits: function (t) {\n        if (t instanceof Array) {\n            return t;\n        }\n\n        if (h.isHex(t)) {\n            return sjcl.codec.hex.toBits(t);\n        }\n\n        //TODO\n        throw new errors.InvalidHexError();\n    },\n    bits2hex: function (t) {\n        if (typeof t === \"string\") {\n            return t;\n        }\n\n        return sjcl.codec.hex.fromBits(t);\n    },\n    sjclPacket2Object: function (decoded) {\n        var result = {\n            ct: helper.bits2hex(decoded.ct),\n            iv: helper.bits2hex(decoded.iv)\n        };\n\n        if (decoded.salt) {\n            result.salt = helper.bits2hex(decoded.salt);\n        }\n\n        return result;\n    },\n    Object2sjclPacket: function (data) {\n        if (typeof data.salt === \"string\") {\n            data.salt = helper.hex2bits(data.salt);\n        }\n\n        if (typeof data.iv === \"string\") {\n            data.iv = helper.hex2bits(data.iv);\n        }\n\n        if (typeof data.ct === \"string\") {\n            data.ct = helper.hex2bits(data.ct);\n        }\n\n        return sjcl.json.encode(data);\n    }\n};\n\nmodule.exports = helper;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/crypto/helper.js","import h from \"../helper/helper\";\nconst validator = require(\"validation/validator\");\nconst SecuredData = require(\"asset/securedDataWithMetaData\")\n\nimport * as Bluebird from \"bluebird\"\nimport ObjectLoader from \"../services/cachedObjectLoader\"\n\nimport Observer from '../asset/observer';\n\ninterface ProfileOptions {\n\tisPublicProfile?: boolean,\n\tsignKey?: string\n}\n\nconst PROFILE_SECUREDDATA_OPTIONS = {\n\ttype: \"profile\",\n\tremoveEmpty: true,\n\tencryptDepth: 1\n}\n\nexport default class Profile extends Observer {\n\tprivate securedData: any;\n\tprivate isPublicProfile: boolean;\n\tprivate id: String | number;\n\n\tconstructor(data: any, options?: ProfileOptions) {\n\t\tsuper();\n\n\t\toptions = options || {};\n\n\t\tthis.isPublicProfile = options.isPublicProfile === true;\n\n\t\tthis.securedData = SecuredData.createRaw(data.content, data.meta, PROFILE_SECUREDDATA_OPTIONS);\n\n\t\tthis.checkProfile();\n\n\t\tif (data.profileid) {\n\t\t\tthis.id = data.profileid;\n\t\t}\n\t}\n\n\tcheckProfile = () => {\n\t\tconst err = validator.validate(\"profile\", this.securedData.contentGet());\n\n\t\tif (err) {\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\tgetID = () => {\n\t\tif (!this.id) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.isPublicProfile ? \"public-\" + this.id : \"private-\" + this.id;\n\t};\n\n\tgetUpdatedData = (signKey: string) => {\n\t\t//pad updated profile\n\t\t//merge paddedProfile and updatedPaddedProfile\n\t\t//sign/hash merge\n\t\t//encrypt merge\n\n\t\tif (this.isPublicProfile) {\n\t\t\treturn this.sign(signKey);\n\t\t}\n\n\t\treturn this.securedData.getUpdatedData(signKey);\n\t};\n\n\tsign = (signKey: string, cb?: Function) => {\n\t\tif (!this.isPublicProfile) {\n\t\t\tthrow new Error(\"please encrypt private profiles!\");\n\t\t}\n\n\t\treturn this.securedData.sign(signKey).then((signedMeta: any) => {\n\t\t\treturn {\n\t\t\t\tcontent: this.securedData.contentGet(),\n\t\t\t\tmeta: signedMeta\n\t\t\t};\n\t\t}).nodeify(cb);\n\t};\n\n\tsignAndEncrypt = (signKey: string, cryptKey: string) => {\n\t\tif (this.isPublicProfile) {\n\t\t\tthrow new Error(\"no encrypt for public profiles!\");\n\t\t}\n\n\t\treturn this.securedData._signAndEncrypt(signKey, cryptKey)\n\t};\n\n\tupdated = () => {\n\t\treturn this.securedData.updated();\n\t};\n\n\tchanged = () => {\n\t\treturn this.securedData.isChanged();\n\t};\n\n\tsetFullProfile = (data: any) => {\n\t\tthis.securedData.contentSet(data)\n\t};\n\n\tsetAttribute = (attr: string, value: any) => {\n\t\tthis.securedData.contentSetAttr(attr, value);\n\t\treturn Bluebird.resolve()\n\t};\n\n\tremoveAttribute = (attr: string) => {\n\t\tthis.securedData.contentRemoveAttr(attr);\n\t}\n\n\tgetFull = () => {\n\t\treturn this.securedData.contentGet()\n\t};\n\n\tgetAttribute = (attrs: any) => {\n\t\treturn h.deepGet(this.securedData.contentGet(), attrs)\n\t};\n}\n\ntype ProfileCache = {\n\tprofile: {\n\t\tcontent: any,\n\t\tmeta: any,\n\t},\n\toptions: {\n\t\tsignKey: string,\n\t\tisPublic: boolean\n\t}\n}\n\nexport class ProfileLoader extends ObjectLoader<Profile, ProfileCache>({\n\tcacheName: \"profile\",\n\tgetID: ({ meta, signKey }) => `${signKey}-${meta._signature}`,\n\tdownload: id => { throw new Error(\"profile get by id is not implemented\") },\n\tload: ({ content, meta, isPublic, signKey }): Bluebird<ProfileCache> => {\n\n\t\tconst securedData = isPublic ?\n\t\t\tSecuredData.createRaw(content, meta, PROFILE_SECUREDDATA_OPTIONS) :\n\t\t\tSecuredData.load(content, meta, PROFILE_SECUREDDATA_OPTIONS)\n\n\t\treturn Bluebird.all([\n\t\t\tsecuredData.verifyAsync(signKey),\n\t\t\tisPublic ? null : securedData.decrypt()\n\t\t]).then(() => ({\n\t\t\tprofile: {\n\t\t\t\tcontent: securedData.contentGet(),\n\t\t\t\tmeta: securedData.metaGet(),\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tsignKey,\n\t\t\t\tisPublic\n\t\t\t}\n\t\t}))\n\t},\n\trestore: ({ profile, options }: ProfileCache) => new Profile(profile, options)\n}) {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/users/profile.ts","function webpackEmptyAsyncContext(req) {\n\treturn new Promise(function(resolve, reject) { reject(new Error(\"Cannot find module '\" + req + \"'.\")); });\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 161;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/@angular/core/@angular lazy\n// module id = 161\n// module chunks = 12","import * as Bluebird from 'bluebird';\n\nimport socketService from './socket.service';\nimport CacheService from './Cache';\n\nimport h from \"../helper/helper\";\nconst debug = require(\"debug\");\nconst keyStore = require(\"crypto/keyStore\");\n\nconst MAXCACHETIME  = 7 * 24 * 60 * 60 * 1000;\n\nconst keyStoreDebug = debug(\"whispeer:keyStore\");\n\nconst THROTTLE = 20;\n\nclass RequestKeyService {\n\tkeyCache: CacheService;\n\tdelay: any;\n\tdelayAsync: (keyID: string) => Bluebird<any>;\n\tMAXCACHETIME = MAXCACHETIME;\n\n\tconstructor() {\n\t\twindow.setTimeout(this.cleanCache, 30 * 1000);\n\t\twindow.setInterval(this.cleanCache, 10 * 60 * 1000);\n\n\t\tthis.keyCache = new CacheService(\"keys\");\n\n\t\tthis.delay = h.delayMultiple(THROTTLE, this.loadKeys);\n\t\tthis.delayAsync = Bluebird.promisify(this.delay);\n\t}\n\n\tprivate idTransform(ID: any) {\n\t\treturn ID;\n\t}\n\n\tprivate cleanCache = () => {\n\t\treturn this.keyCache.all().each((cacheEntry: any) => {\n\t\t\tvar data = JSON.parse(cacheEntry.data);\n\t\t\tif (data.removeAfter < new Date().getTime()) {\n\t\t\t\tkeyStoreDebug(\"remove by time: \" + data.removeAfter);\n\t\t\t\tthis.keyCache.delete(cacheEntry.id.split(\"/\")[1]);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate removeByObjectId = (keyID: string, objectID: string) => {\n\t\t//remove keys with same objectID\n\t\treturn this.keyCache.all().each((cacheEntry: any) => {\n\t\t\tvar data = JSON.parse(cacheEntry.data);\n\n\t\t\tif (objectID === data.objectID && keyID !== data.key.realid) {\n\t\t\t\tkeyStoreDebug(\"remove by object id: \" + objectID);\n\t\t\t\treturn this.keyCache.delete(this.idTransform(keyID));\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate loadKeys = (identifiers: string[], cb: Function) => {\n\t\treturn Bluebird.try(() => {\n\t\t\tvar toLoadIdentifiers = identifiers.filter(function (e) {\n\t\t\t\treturn !keyStore.upload.isKeyLoaded(e);\n\t\t\t});\n\n\t\t\tif (toLoadIdentifiers.length === 0) {\n\t\t\t\treturn identifiers;\n\t\t\t}\n\n\t\t\treturn socketService.definitlyEmit(\"key.getMultiple\", {\n\t\t\t\tloaded: [],\n\t\t\t\trealids: identifiers\n\t\t\t}).thenReturn(identifiers);\n\t\t}).nodeify(cb);\n\t}\n\n\tgetKey = (keyID: string, cb?: Function) => {\n\t\tif (typeof keyID !== \"string\") {\n\t\t\tthrow new Error(\"not a valid key realid: \" + keyID);\n\t\t}\n\n\t\tif (keyStore.upload.isKeyLoaded(keyID)) {\n\t\t\treturn Bluebird.resolve().nodeify(cb);\n\t\t}\n\n\t\tkeyStoreDebug(\"loading key: \" + keyID);\n\n\t\treturn this.keyCache.get(this.idTransform(keyID)).then((cacheEntry) => {\n\t\t\tif (cacheEntry.data.removeAfter < new Date().getTime()) {\n\t\t\t\tkeyStoreDebug(\"Remove Key from Cache \" + keyID);\n\t\t\t\tthis.keyCache.delete(keyID);\n\t\t\t}\n\n\t\t\tkeyStore.upload.addKey(cacheEntry.data.key);\n\t\t}).catch(() => {\n\t\t\tkeyStoreDebug(\"key cache miss: \" + keyID);\n\n\t\t\treturn this.delayAsync(keyID);\n\t\t}).nodeify(cb);\n\t}\n\n\tcacheKey = (realID: string, objectID: string, time: number) => {\n\t\ttime = Math.min(time, MAXCACHETIME);\n\n\t\treturn this.removeByObjectId(realID, objectID).then(() => {\n\t\t\tvar keyData = keyStore.upload.getExistingKey(realID);\n\n\t\t\tif (!keyData) {\n\t\t\t\tkeyStoreDebug(\"Could not cache key yet \" + realID);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn this.keyCache.store(this.idTransform(realID), {\n\t\t\t\tkey: keyData,\n\t\t\t\tobjectID: objectID,\n\t\t\t\tremoveAfter: new Date().getTime() + time\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport default new RequestKeyService();\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/requestKey.service.ts","import * as Bluebird from \"bluebird\";\nimport h from \"../helper/helper\";\n\nconst afterHooks: Function[] = [];\n\nexport default class Observer {\n\t_listeners: any;\n\t_listenersOnce: any;\n\n\tstatic addAfterHook(listener: Function) {\n\t\tafterHooks.push(listener);\n\t}\n\n\tconstructor () {\n\t\tthis._listeners = {};\n\t\tthis._listenersOnce = {};\n\t};\n\n\tlistenOnce(fn: Function, type: string) {\n\t\ttype = type || \"any\";\n\n\t\tif (typeof this._listenersOnce[type] === \"undefined\") {\n\t\t\t\tthis._listenersOnce[type] = [];\n\t\t}\n\t\tthis._listenersOnce[type].push(fn);\n\t}\n\n\tlistenPromise(type: string) {\n\t\t\tvar that = this;\n\t\t\treturn new Bluebird(function (resolve) {\n\t\t\t\t\tthat.listenOnce(resolve, type);\n\t\t\t});\n\t}\n\n\tlisten(fn: Function, type: string) {\n\t\t\ttype = type || \"any\";\n\t\t\tif (typeof this._listeners[type] === \"undefined\") {\n\t\t\t\t\tthis._listeners[type] = [];\n\t\t\t}\n\t\t\tthis._listeners[type].push(fn);\n\t}\n\n\tnotify(data: any, type?: string, returnF?: Function) {\n\t\t\ttype = type || \"any\";\n\n\t\t\tif (!returnF) {\n\t\t\t\t\treturnF = function () {};\n\t\t\t}\n\n\t\t\tvar listeners = this._listeners[type] || [];\n\t\t\tvar listenersOnce = this._listenersOnce[type] || [];\n\n\t\t\tvar subscribers = (listeners).concat(listenersOnce);\n\n\t\t\tthis._listenersOnce[type] = [];\n\n\t\t\tvar result = h.callEach(subscribers, [data], returnF);\n\n\t\t\tif (type !== \"any\") {\n\t\t\t\t\tresult = returnF(this.notify(data), result);\n\t\t\t}\n\n\t\t\th.callEach(afterHooks);\n\n\t\t\treturn result;\n\t}\n\n\tstatic extend(obj: any) {\n\t\tconst internalObserver = new Observer();\n\n\t\tobj.notify = internalObserver.notify.bind(internalObserver);\n\t\tobj.listenOnce = internalObserver.listenOnce.bind(internalObserver);\n\t\tobj.listenPromise = internalObserver.listenPromise.bind(internalObserver);\n\t\tobj.listen = internalObserver.listen.bind(internalObserver);\n\t}\n}\n\nexport const extend = function (obj: any) {\n\tObserver.extend(obj)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/asset/observer.ts","\"use strict\";\nconst sjcl = require(\"sjcl\");\nvar chelper = {\n\tgetCurveName: function (curve) {\n\t\tvar curcurve;\n\t\tfor (curcurve in sjcl.ecc.curves) {\n\t\t\tif (sjcl.ecc.curves.hasOwnProperty(curcurve)) {\n\t\t\t\tif (sjcl.ecc.curves[curcurve] === curve) {\n\t\t\t\t\treturn curcurve;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthrow \"curve not existing\";\n\t},\n\tgetCurve: function (curveName) {\n\t\tif (typeof curveName !== \"string\" || curveName.substr(0, 1) !== \"c\") {\n\t\t\tcurveName = \"c\" + curveName;\n\t\t}\n\n\t\tif (sjcl.ecc.curves[curveName]) {\n\t\t\treturn sjcl.ecc.curves[curveName];\n\t\t}\n\n\t\tthrow new Error(\"invalid curve\");\n\t},\n\tisHex: function (data) {\n\t\treturn (data && typeof data === \"string\" && !!data.match(/^[A-Fa-f0-9]*$/));\n\t},\n\thex2bits: function (t) {\n\t\tif (t instanceof Array) {\n\t\t\treturn t;\n\t\t}\n\n\t\treturn sjcl.codec.hex.toBits(t);\n\t},\n\tbits2hex: function (t) {\n\t\tif (typeof t === \"string\") {\n\t\t\treturn t;\n\t\t}\n\n\t\treturn sjcl.codec.hex.fromBits(t);\n\t}\n};\n\nmodule.exports = chelper;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/crypto/minimalHelper.js","function copyOwnFrom(target : any, source : any) {\n    Object.getOwnPropertyNames(source).forEach(function (propName) {\n        Object.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\n    });\n    return target;\n}\n\nexport class InternalSymbol {\n  name : string;\n\n  constructor(name : string, props? : any) {\n    this.name = name;\n    if (props) {\n        copyOwnFrom(this, props);\n    }\n    if (Object.freeze) {\n        Object.freeze(this);\n    }\n  }\n\n  toString() {\n    return \"|\" + this.name + \"|\";\n  }\n}\n\nexport default class Enum {\n  _symbols: InternalSymbol[] = [];\n\n  constructor(obj: any) {\n    if (Array.isArray(obj)) {\n        obj.forEach(function (name : string) {\n            this[name] = new InternalSymbol(name);\n            this._symbols.push(this[name]);\n        }, this);\n    }\n    else {\n        Object.keys(obj).forEach(function (name) {\n            this[name] = new InternalSymbol(name, obj[name]);\n            this._symbols.push(this[name]);\n        }, this);\n    }\n  }\n\n  toString (symbol : InternalSymbol) : string {\n      if (this.contains(symbol)) {\n          return symbol.toString();\n      }\n\n      throw new Error(\"symbol not part of this enum\");\n  };\n\n  fromString (name : string) : InternalSymbol {\n      if (name.substr(0, 1) === \"|\" && name.substr(-1, 1) === \"|\") {\n          return this[name.substring(1, name.length - 1)];\n      }\n\n      return null;\n  };\n\n  symbols () : InternalSymbol[] {\n      return this._symbols;\n  };\n\n  symbolPosition (symbol : InternalSymbol) : number {\n      return this._symbols.indexOf(symbol);\n  };\n\n  contains (sym : InternalSymbol) : boolean {\n      return this[sym.name] === sym;\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/asset/enum.ts","import * as Bluebird from \"bluebird\";\n\nimport CacheServiceType from \"./Cache\";\nimport socketService from \"./socket.service\";\n\nimport CacheService from './Cache';\n\nimport { errorServiceInstance } from \"./error.service\";\nimport sessionService from \"./session.service\";\n\nconst initService = require(\"services/initService\");\n\nimport h from \"../helper/helper\";\nconst trustManager = require(\"crypto/trustManager\");\nconst signatureCache = require(\"crypto/signatureCache\");\n\nconst debug = require(\"debug\");\n\nconst THROTTLE = 20, STORESIGNATURECACHEINTERVAL = 30000;\n\nconst debugName = \"whispeer:trustService\";\nconst trustServiceDebug = debug(debugName);\n\nfunction time(name: string) {\n\tif (debug.enabled(debugName)) {\n\t\tconsole.time(name);\n\t}\n}\n\nfunction timeEnd(name: string) {\n\tif (debug.enabled(debugName)) {\n\t\tconsole.timeEnd(name);\n\t}\n}\n\nlet resolveOwnKeys, resolveOwnUser\n\nconst ownKeysPromise = new Bluebird((resolve) => resolveOwnKeys = resolve)\nconst ownUserPromise = new Bluebird<any>((resolve) => resolveOwnUser = resolve)\n\nclass TrustService {\n\tprivate signatureCacheObject: CacheServiceType;\n\tprivate trustManagerCache: CacheServiceType;\n\n\tprivate delay: any;\n\n\tprivate loadCachePromise = Bluebird.resolve();\n\n\tconstructor() {\n\t\tthis.signatureCacheObject = new CacheService(\"signatureCache\");\n\t\tthis.trustManagerCache = new CacheService(\"trustManager.get\");\n\n\t\tthis.delay = h.aggregateOnce(THROTTLE, this.uploadDatabase);\n\t\twindow.setInterval(this.storeSignatureCache, STORESIGNATURECACHEINTERVAL);\n\n\t\tinitService.get(\"trustManager.get\", this.onInit, {\n\t\t\tcacheCallback: this.loadFromCache,\n\t\t\tcache: true\n\t\t});\n\n\t\tsocketService.channel(\"notify.trustManager\", function (_e: any, data: any) {\n\t\t\ttrustManager.updateDatabase(data, errorServiceInstance.criticalError);\n\t\t});\n\n\t\tthis.waitForLogin();\n\t}\n\n\townKeysLoaded() {\n\t\tresolveOwnKeys()\n\t}\n\n\townUserLoaded(user) {\n\t\tresolveOwnUser(user)\n\t}\n\n\tprivate waitForLogin() {\n\t\tsessionService.awaitLogin().then(() => {\n\t\t\ttime(\"getSignatureCache\");\n\t\t\treturn this.signatureCacheObject.get(sessionService.getUserID().toString()).catch(function () {\n\t\t\t\treturn;\n\t\t\t});\n\t\t}).then((signatureCacheData: any) => {\n\t\t\ttimeEnd(\"getSignatureCache\");\n\n\t\t\tif (signatureCacheData) {\n\t\t\t\tsignatureCache.load(signatureCacheData.data);\n\t\t\t} else {\n\t\t\t\tsignatureCache.initialize();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate onInit = (data: any) => {\n\t\ttrustServiceDebug(\"trustManager.get finished unchanged: \" + data.unChanged);\n\t\treturn this.loadCachePromise.catch(function (e: any) {\n\t\t\ttrustServiceDebug(\"Could not load trust service from cache!\");\n\t\t\tconsole.error(e);\n\t\t}).then(() => ownKeysPromise).then(() => {\n\t\t\tif (data.unChanged) {\n\t\t\t\tif (!trustManager.isLoaded()) {\n\t\t\t\t\tthrow new Error(\"cache loading seems to have failed but server is unchanged!\");\n\t\t\t\t}\n\n\t\t\t\ttrustServiceDebug(\"trustManager unChanged\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttrustServiceDebug(\"trustManager get loading\");\n\n\t\t\tif (trustManager.isLoaded()) {\n\t\t\t\ttrustServiceDebug(\"trustManager cache exists updating\");\n\n\t\t\t\treturn trustManager.updateDatabase(data.content).then(function () {\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (data.content) {\n\t\t\t\ttrustServiceDebug(\"load content\");\n\t\t\t\treturn this.loadDatabase(data.content);\n\t\t\t}\n\n\t\t\ttrustServiceDebug(\"create new trust database!\");\n\t\t\treturn this.createTrustDatabase();\n\t\t});\n\t}\n\n\tprivate uploadDatabase = (cb?: Function) => {\n\t\treturn initService.awaitLoading().then(() => {\n\t\t\treturn trustManager.getUpdatedVersion();\n\t\t}).then((newTrustContent: any) => {\n\t\t\tthis.trustManagerCache.store(sessionService.getUserID().toString(), newTrustContent);\n\n\t\t\treturn socketService.emit(\"trustManager.set\", {\n\t\t\t\tcontent: newTrustContent\n\t\t\t});\n\t\t}).then((response: any) => {\n\t\t\tif (!response.success) {\n\t\t\t\terrorServiceInstance.criticalError(response.error);\n\t\t\t}\n\t\t}).nodeify(cb);\n\t}\n\n\tprivate storeSignatureCache = () => {\n\t\tif (signatureCache.isChanged()) {\n\t\t\ttrustServiceDebug(\"Storing signature cache!\");\n\t\t\ttime(\"storedSignatureCache\");\n\n\t\t\tsignatureCache.resetChanged();\n\n\t\t\tsignatureCache.getUpdatedVersion().then((updatedVersion: any) => {\n\t\t\t\treturn this.signatureCacheObject.store(sessionService.getUserID().toString(), updatedVersion);\n\t\t\t}).then(function () {\n\t\t\t\ttimeEnd(\"storedSignatureCache\");\n\t\t\t});\n\t\t}\n\t}\n\n\taddNewUsers = (userInfo) => {\n\t\tif (trustManager.isLoaded() && !trustManager.hasKeyData(userInfo.key)) {\n\t\t\ttrustManager.addUser(userInfo);\n\t\t\tthis.delay();\n\t\t}\n\t}\n\n\tprivate loadDatabase = (database: any, cb?: Function) => {\n\t\treturn trustManager.loadDatabase(database).thenReturn(database).nodeify(cb);\n\t}\n\n\tprivate createTrustDatabase = () => {\n\t\townUserPromise.then((ownUser) => {\n\t\t\tconst key = ownUser.getSignKey()\n\t\t\tconst userid = ownUser.getID()\n\t\t\tconst nickname = ownUser.getNickname()\n\n\t\t\ttrustManager.createDatabase({ key, userid, nickname });\n\n\t\t\tthis.uploadDatabase().catch(errorServiceInstance.criticalError);\n\n\t\t\treturn null;\n\t\t})\n\t}\n\n\tprivate loadFromCache = (cacheEntry: any) => {\n\t\ttrustServiceDebug(\"trustManager cache get done\");\n\t\tthis.loadCachePromise = ownKeysPromise.then(() => {\n\t\t\ttrustServiceDebug(\"trustManager cache loading\");\n\t\t\treturn this.loadDatabase(cacheEntry.data);\n\t\t});\n\n\t\treturn this.loadCachePromise;\n\t}\n\n\thasKey = (keyid: string) => {\n\t\treturn trustManager.hasKeyData(keyid);\n\t};\n\n\tgetKey = (keyid: string) => {\n\t\treturn trustManager.getKeyData(keyid);\n\t};\n\n\tverifyUser = (user: any, cb?: Function) => {\n\t\treturn Bluebird.try(() => {\n\t\t\tvar keyData = trustManager.getKeyData(user.getSignKey());\n\t\t\tkeyData.setTrust(trustManager.trustStates.VERIFIED);\n\t\t\treturn this.uploadDatabase();\n\t\t}).nodeify(cb);\n\t};\n}\n\nexport default new TrustService();\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/trust.service.ts","var Bluebird = require(\"bluebird\");\n\nvar friendsService = require(\"services/friendsService\");\nvar keyStore = require(\"services/keyStore.service\").default;\n\nfunction fixInvalidKey(invalidKey, friendsService) {\n\tvar userid;\n\n\treturn Bluebird.try(function () {\n\t\tuserid = friendsService.getUserForKey(invalidKey);\n\t\treturn friendsService.removeFriend(userid);\n\t}).then(function () {\n\t\treturn friendsService.friendship(userid);\n\t}).then(function () {\n\t\tconsole.log(\"fixed invalid key: \" + invalidKey);\n\t});\n}\n\nmodule.exports = function () {\n\tvar friendsKeys;\n\n\treturn friendsService.awaitLoading().then(function () {\n\t\tfriendsKeys = friendsService.getAllFriendShipKeys();\n\t\treturn keyStore.upload.preLoadMultiple(friendsKeys);\n\t}).then(function () {\n\t\tvar invalidKeys = friendsKeys.filter(function (realid) {\n\t\t\treturn !keyStore.upload.isKeyLoaded(realid);\n\t\t});\n\n\t\tif (invalidKeys.length === 0) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn invalidKeys.reduce(function (previous, invalidKey) {\n\t\t\t\treturn previous.then(function () {\n\t\t\t\t\treturn fixInvalidKey(invalidKey, friendsService);\n\t\t\t\t});\n\t\t\t}, Bluebird.resolve());\n\t\t}\n\t}).then(function () {\n\t\treturn true;\n\t});\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/migrations/00001-regenerateFriendsKeys.js","(function () {\n\t\"use strict\";\n\tvar amanda, h, jsonSchemaValidator;\n\n\tvar validations = {};\n\n\tfunction doValidate(ref, data) {\n\t\tif (ref) {\n\t\t\tvar theError;\n\t\t\tamanda.validate(data, ref, function (err) {\n\t\t\t\ttheError = err;\n\t\t\t});\n\n\t\t\treturn theError;\n\t\t} else {\n\t\t\tthrow new Error(\"unregistered validation\");\n\t\t}\n\t}\n\n\tvar validator = {\n\t\taddAttribute: function (name, cb) {\n\t\t\tjsonSchemaValidator.addAttribute(name, cb);\n\t\t},\n\t\tregister: function (name, obj) {\n\t\t\tif (validations[name]) {\n\t\t\t\tthrow new Error(\"double registered validations: \" + name);\n\t\t\t}\n\n\t\t\tvalidations[name] = obj;\n\t\t},\n\t\tvalidate: function (name, data) {\n\t\t\treturn false;\n\n\t\t\tif (validations[name]) {\n\t\t\t\tvar result = doValidate(validations[name], data);\n\t\t\t\tif (result) {\n\t\t\t\t\tconsole.error(result);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"unregistered validation: \" + name);\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction amandaLoaded(am, helper, profileV, profileEncryptedV, postV, messageV, topicV, topicCreateV, circleV) {\n\t\tamanda = am;\n\t\th = helper;\n\n\t\tvalidator.register(\"profile\", profileV);\n\t\tvalidator.register(\"profileEncrypted\", profileEncryptedV);\n\t\tvalidator.register(\"post\", postV);\n\t\tvalidator.register(\"message\", messageV);\n\t\tvalidator.register(\"topic\", topicV);\n\t\tvalidator.register(\"topicCreate\", topicCreateV);\n\t\tvalidator.register(\"circle\", circleV);\n\n\t\t/**\n\t\t * EvenAttribute\n\t\t *\n\t\t * @param {string} property\n\t\t * @param {any} propertyValue\n\t\t * @param {any} attributeValue\n\t\t * @param {object} propertyAttributes\n\t\t * @param {function} callback\n\t\t */\n\t\tvar hexAttribute = function(property, propertyValue, attributeValue, propertyAttributes, callback) {\n\n\t\t\t// If ‘even: true’\n\t\t\tif (attributeValue) {\n\t\t\t\tif (!h.isHex(propertyValue)) {\n\t\t\t\t\tthis.addError();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Continue...\n\t\t\treturn callback();\n\n\t\t};\n\n\t\t// Add a new validator\n\t\tjsonSchemaValidator = amanda(\"json\");\n\t\tjsonSchemaValidator.addAttribute(\"hex\", hexAttribute);\n\t}\n\n\tfunction doLoad(cb, exported) {\n\t\tif (typeof define !== \"undefined\") {\n\t\t\tdefine([\n\t\t\t\t\"amanda\",\n\t\t\t\t\"whispeerHelper\",\n\t\t\t\t\"./validations/profileV\",\n\t\t\t\t\"./validations/profileEncryptedV\",\n\t\t\t\t\"./validations/postV\",\n\t\t\t\t\"./validations/messageV\",\n\t\t\t\t\"./validations/topicV\",\n\t\t\t\t\"./validations/topicCreateV\",\n\t\t\t\t\"./validations/circleV\"\n\t\t\t], function() {\n\t\t\t\tcb.apply(null, arguments);\n\n\t\t\t\treturn exported;\n\t\t\t});\n\t\t} else if (typeof module !== \"undefined\" && module.exports && typeof require !== \"undefined\") {\n\t\t\tvar load = [\n\t\t\t\t\"amanda\",\n\t\t\t\t\"whispeerHelper\",\n\t\t\t\t\"./validations/profileV\",\n\t\t\t\t\"./validations/profileEncryptedV\",\n\t\t\t\t\"./validations/postV\",\n\t\t\t\t\"./validations/messageV\",\n\t\t\t\t\"./validations/topicV\",\n\t\t\t\t\"./validations/topicCreateV\",\n\t\t\t\t\"./validations/circleV\"\n\t\t\t];\n\n\t\t\tvar modules = [], i;\n\t\t\tfor (i = 0; i < load.length; i += 1) {\n\t\t\t\tmodules.push(require(load[i]));\n\t\t\t}\n\n\t\t\tcb.apply(null, modules);\n\n\t\t\tmodule.exports = exported;\n\t\t}\n\t}\n\n\tdoLoad(amandaLoaded, validator);\n})();\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/validation/validator.js","/**.\n* MessageService\n**/\n\nconst h = require(\"../helper/helper\").default;\nconst Observer = require(\"asset/observer\");\nconst SecuredData = require(\"asset/securedDataWithMetaData\");\nconst Bluebird = require(\"bluebird\");\n\nconst socket = require(\"services/socket.service\").default;\nconst keyStore = require(\"services/keyStore.service\").default;\nconst initService = require(\"services/initService\");\n\nconst settingsService = require(\"services/settings.service\").default;\n\nconst friendsService = require(\"services/friendsService\");\n\nvar circles = {};\nvar circleArray = [];\nvar circleData = [];\n\nfunction encryptKeyForUsers(key, users, cb) {\n\treturn Bluebird.resolve(users).map(h.parseDecimal).map(function (userID) {\n\t\tif (!friendsService.getUserFriendShipKey(userID)) {\n\t\t\tthrow new Error(\"no friend key for user: \" + userID);\n\t\t}\n\n\t\treturn friendsService.getUserFriendShipKey(userID);\n\t}).map(function (friendKey) {\n\t\treturn keyStore.sym.symEncryptKey(key, friendKey).thenReturn(friendKey);\n\t}).nodeify(cb);\n}\n\nfunction generateNewKey(cb) {\n\treturn keyStore.sym.generateKey(null, \"CircleKey\").then(function (key) {\n\t\tconst userService = require(\"users/userService\").default;\n\t\tconst mainKey = userService.getOwn().getMainKey();\n\n\t\treturn keyStore.sym.symEncryptKey(key, mainKey).thenReturn(key);\n\t}).nodeify(cb);\n}\n\nvar Circle = function (data) {\n\tvar id = data.id, theCircle = this, persons = [];\n\n\tvar circleSec = SecuredData.load(data.content, data.meta, { type: \"circle\" });\n\tvar circleUsers = circleSec.metaAttr(\"users\").map(h.parseDecimal);\n\n\tthis.getID = function getIDF() {\n\t\treturn id;\n\t};\n\n\tthis.getUserIDs = function () {\n\t\treturn circleUsers;\n\t};\n\n\tthis.hasUser = function (uid) {\n\t\treturn circleUsers.indexOf(h.parseDecimal(uid)) !== -1;\n\t};\n\n\tthis.getKey = function () {\n\t\treturn circleSec.metaAttr(\"circleKey\");\n\t};\n\n\tthis.remove = function (cb) {\n\t\treturn settingsService.removeCircle().then(function () {\n\t\t\treturn socket.emit(\"circle.delete\", {\n\t\t\t\tremove: {\n\t\t\t\t\tcircleid: id\n\t\t\t\t}\n\t\t\t});\n\t\t}).then(function () {\n\t\t\tvar circle = circles[id];\n\t\t\tdelete circles[id];\n\t\t\th.removeArray(circleArray, circle);\n\t\t\th.removeArray(circleData, circle.data);\n\t\t}).nodeify(cb);\n\t};\n\n\tthis.setUser = function (uids, cb) {\n\t\tvar newKey, oldKey = circleSec.metaAttr(\"circleKey\"), removing = false, friendKeys;\n\n\t\treturn Bluebird.try(function () {\n\t\t\tuids = uids.map(h.parseDecimal);\n\t\t\tremoving = h.arraySubtract(circleUsers, uids).length > 0;\n\n\t\t\tif (removing) {\n\t\t\t\treturn generateNewKey();\n\t\t\t}\n\n\t\t\treturn oldKey;\n\t\t}).then(function (_newKey) {\n\t\t\tnewKey = _newKey;\n\n\t\t\tif (removing) {\n\t\t\t\treturn keyStore.sym.symEncryptKey(oldKey, newKey).thenReturn(newKey);\n\t\t\t}\n\n\t\t\treturn newKey;\n\t\t}).then(function (newKey) {\n\t\t\tif (removing) {\n\t\t\t\treturn encryptKeyForUsers(newKey, uids);\n\t\t\t} else {\n\t\t\t\treturn encryptKeyForUsers(newKey, h.arraySubtract(uids, circleUsers));\n\t\t\t}\n\t\t}).then(function (_friendKeys) {\n\t\t\tfriendKeys = _friendKeys;\n\t\t\tcircleSec.metaSet({\n\t\t\t\tusers: uids,\n\t\t\t\tcircleKey: newKey\n\t\t\t});\n\n\t\t\tconst userService = require(\"users/userService\").default;\n\t\t\treturn circleSec.getUpdatedData(userService.getOwn().getSignKey());\n\t\t}).then(function (newData) {\n\t\t\tvar update = {\n\t\t\t\tid: id,\n\t\t\t\tcontent: newData.content,\n\t\t\t\tmeta: newData.meta\n\t\t\t};\n\n\t\t\tif (removing) {\n\t\t\t\tupdate.decryptors = keyStore.upload.getDecryptors([oldKey], [newKey]);\n\t\t\t\tupdate.key = keyStore.upload.getKey(newKey);\n\t\t\t} else {\n\t\t\t\tupdate.decryptors = keyStore.upload.getDecryptors([newKey], friendKeys);\n\t\t\t}\n\n\t\t\treturn socket.emit(\"circle.update\", { update: update });\n\t\t}).then(function () {\n\t\t\t//emit\n\t\t\tcircleUsers = uids;\n\t\t\tpersons = persons.filter(function (user) {\n\t\t\t\treturn uids.indexOf(user.id) > -1;\n\t\t\t});\n\t\t\ttheCircle.data.persons = persons;\n\t\t\ttheCircle.data.userids = circleUsers;\n\n\t\t\tif (removing) {\n\t\t\t\tconst userService = require(\"users/userService\").default;\n\t\t\t\tvar ownUser = userService.getOwn();\n\n\t\t\t\t//rebuild profiles\n\t\t\t\treturn ownUser.uploadChangedProfile();\n\t\t\t}\n\t\t}).then(function () {\n\t\t\treturn theCircle.loadPersons();\n\t\t}).nodeify(cb);\n\t};\n\n\tthis.removePersons = function (uids, cb) {\n\t\tuids = uids.map(h.parseDecimal).filter(function (e) {\n\t\t\treturn circleUsers.indexOf(e) > -1;\n\t\t});\n\n\t\tvar users = circleUsers.filter(function (e) {\n\t\t\treturn uids.indexOf(e) === -1;\n\t\t});\n\n\t\tthis.setUser(users, cb);\n\t};\n\n\tthis.addPersons = function (uids, cb) {\n\t\treturn Bluebird.resolve(uids).bind(this).filter(function(uid) {\n\t\t\treturn circleUsers.indexOf(uid) === -1;\n\t\t}).then(function(uids) {\n\t\t\tthis.setUser(uids.concat(circleUsers), cb);\n\t\t});\n\t};\n\n\tthis.load = function (cb) {\n\t\tconst userService = require(\"users/userService\").default;\n\t\treturn Bluebird.all([\n\t\t\tcircleSec.decrypt(),\n\t\t\tcircleSec.verify(userService.getOwn().getSignKey(), undefined, id)\n\t\t]).spread(function (content) {\n\t\t\tkeyStore.security.addEncryptionIdentifier(circleSec.metaAttr(\"circleKey\"));\n\t\t\ttheCircle.data.name = content.name;\n\t\t}).nodeify(cb);\n\t};\n\n\tthis.loadPersons = function (cb, limit) {\n\t\tlimit = limit || 20;\n\t\tlimit = Math.min(h.parseDecimal(limit), 20);\n\n\t\tif (persons.length >= circleUsers.length) {\n\t\t\treturn Bluebird.resolve().nodeify(cb);\n\t\t}\n\n\t\treturn Bluebird.try(function () {\n\t\t\tvar loadedIDs = persons.map(function (p) { return p.id; });\n\t\t\tvar loadableUsers = circleUsers.filter(function (user) {\n\t\t\t\treturn loadedIDs.indexOf(user) === -1;\n\t\t\t});\n\n\t\t\tconst userService = require(\"users/userService\").default;\n\n\t\t\treturn userService.getMultiple(loadableUsers.slice(0, limit));\n\t\t}).map(function (user) {\n\t\t\tpersons.push(user.data);\n\n\t\t\treturn user.loadBasicData().thenReturn(user)\n\t\t}).nodeify(cb);\n\t};\n\n\tthis.data = {\n\t\tid: id,\n\t\tuserids: circleUsers,\n\t\tname: \"\",\n\t\timage: \"assets/img/circle.png\",\n\t\tpersons: persons\n\t};\n\n\tObserver.extend(this);\n};\n\nvar loadingPromise;\n\nfunction makeCircle(data) {\n\tvar circle = new Circle(data);\n\tvar id = circle.getID();\n\n\tif (circles[id]) {\n\t\treturn;\n\t}\n\n\tcircles[id] = circle;\n\tcircleArray.push(circle);\n\tcircleData.push(circle.data);\n\n\treturn circle;\n}\n\nvar circleService = {\n\tdata: {\n\t\tloaded: false,\n\t\tloading: false,\n\t\tcircles: circleData\n\t},\n\tget: function (id) {\n\t\treturn circles[id];\n\t},\n\tinWhichCircles: function (uid) {\n\t\tuid = h.parseDecimal(uid);\n\n\t\treturn circleArray.filter(function (circle) {\n\t\t\treturn circle.hasUser(uid);\n\t\t});\n\t},\n\tcreate: function (name, users) {\n\t\tusers = (users || []).map(h.parseDecimal);\n\n\t\treturn generateNewKey().then(function (symKey) {\n\t\t\treturn encryptKeyForUsers(symKey, users).then(function () {\n\t\t\t\tconst userService = require(\"users/userService\").default;\n\t\t\t\tvar own = userService.getOwn();\n\t\t\t\tvar mainKey = own.getMainKey();\n\n\t\t\t\treturn SecuredData.createAsync({ name: name }, {\n\t\t\t\t\tusers: users,\n\t\t\t\t\tcircleKey: symKey\n\t\t\t\t}, { type: \"circle\" }, own.getSignKey(), mainKey);\n\t\t\t}).then(function (circleData) {\n\t\t\t\tvar keyData = keyStore.upload.getKey(symKey);\n\n\t\t\t\treturn socket.emit(\"circle.create\", {\n\t\t\t\t\tcircle: {\n\t\t\t\t\t\tkey: keyData,\n\t\t\t\t\t\tcontent: circleData.content,\n\t\t\t\t\t\tmeta: circleData.meta\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).then(function (circleResponse) {\n\t\t\t\tvar theCircle = makeCircle(circleResponse.created);\n\t\t\t\treturn theCircle.load().thenReturn(theCircle);\n\t\t\t});\n\t\t});\n\t},\n\treset: function () {\n\t\tcircles = {};\n\t\tcircleArray = [];\n\t\tcircleData = [];\n\n\t\tcircleService.data.circles = circleData;\n\n\t\tcircleService.data.loading = false;\n\t\tcircleService.data.loaded = false;\n\t},\n\tloadAll: function (cb) {\n\t\tif (!loadingPromise) {\n\t\t\tloadingPromise = Bluebird.try(function () {\n\t\t\t\tcircleService.data.loading = false;\n\n\t\t\t\treturn initService.awaitLoading();\n\t\t\t}).then(function () {\n\t\t\t\treturn socket.definitlyEmit(\"circle.all\", {});\n\t\t\t}).then(function (data) {\n\t\t\t\tif (data.circles) {\n\t\t\t\t\treturn data.circles;\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(\"server did not return circles\");\n\t\t\t\t}\n\t\t\t}).map(function (circleData) {\n\t\t\t\tvar circle = makeCircle(circleData);\n\t\t\t\treturn Bluebird.fromCallback(function (cb) {\n\t\t\t\t\tcircle.load(cb);\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\tcircleService.data.loading = false;\n\t\t\t\tcircleService.data.loaded = true;\n\t\t\t\tcircleService.notify(\"\", \"loaded\");\n\t\t\t});\n\t\t}\n\n\t\treturn loadingPromise.nodeify(cb);\n\t}\n};\n\nObserver.extend(circleService);\n\nmodule.exports = circleService;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/circles/circleService.js","var settings = require(\"services/settings.service\").default;\n\nvar Bluebird = require(\"bluebird\");\nvar h = require(\"../helper/helper\").default;\nvar errors = require(\"asset/errors\");\n\n\n\n\nfunction removePadding(val) {\n\tvar isNumber = false;\n\n\tif (val.indexOf(\"num::\") === 0) {\n\t\tisNumber = true;\n\n\t\tval = val.substr(5);\n\t}\n\n\tif (val.length % 128 !== 2) {\n\t\tthrow new errors.InvalidDataError(\"padding size invalid\");\n\t}\n\n\tvar paddingIndex = val.indexOf(\"::\");\n\n\tif (paddingIndex === -1) {\n\t\tthrow new errors.InvalidDataError(\"no padding seperator found\");\n\t}\n\n\tvar unpadded = val.substr(paddingIndex + 2);\n\n\tif (isNumber) {\n\t\treturn h.parseDecimal(unpadded);\n\t}\n\n\treturn unpadded;\n}\n\nfunction checkAndFixString(val) {\n\twhile (typeof val === \"string\" && val.lastIndexOf(\"::\") > -1) {\n\t\tval = removePadding(val);\n\t}\n\n\treturn val;\n}\n\nfunction checkAndFixObject(content) {\n\th.objectEach(content, function (key, value) {\n\t\tif (typeof value === \"object\") {\n\t\t\tcheckAndFixObject(value);\n\t\t} else if (typeof value === \"string\") {\n\t\t\tcontent[key] = checkAndFixString(value);\n\t\t}\n\t});\n}\n\nmodule.exports = function () {\n\treturn Bluebird.try(function() {\n\t\tvar content = settings.getContent();\n\n\t\tcheckAndFixObject(content);\n\n\t\tsettings.setContent(content);\n\t\treturn settings.uploadChangedData().thenReturn(true);\n\t});\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/migrations/00002-fixBrokenSettings.js","\"use strict\";\nconst Bluebird = require(\"bluebird\");\n\nmodule.exports = function ($injector, cb) {\n\treturn Bluebird.try(function() {\n\t\treturn;\n\t}).then(function() {\n\t\treturn true;\n\t}).nodeify(cb);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/migrations/migrationExample.js","import * as Bluebird from \"bluebird\"\n\nimport Storage from \"./Storage\";\nimport blobCache from \"../asset/blobCache\"\nimport Cache from \"../services/Cache\"\nimport keyStore from \"./keyStore.service\";\nimport { landingPage } from \"./location.manager\";\nimport { withPrefix } from \"./storage.service\";\nimport h from \"../helper/helper\"\n\nexport class SessionService {\n\tsid: string = \"\";\n\tloggedin: boolean = false;\n\tuserid: any;\n\tsessionStorage: Storage = withPrefix(\"whispeer.session\");\n\n\tkeyStore: any; // This has to change as soon as we port crypto/keyStore\n\n\tprivate loginResolve\n\tprivate loginPromise = new Bluebird((loginResolve) => {\n\t\tthis.loginResolve = loginResolve\n\t})\n\n\tsaveSession = () => {\n\t\tthis.sessionStorage.set(\"sid\", this.sid);\n\t\tthis.sessionStorage.set(\"userid\", this.userid);\n\t\tthis.sessionStorage.set(\"loggedin\", true);\n\t}\n\n\tsetLoginData = (_sid: string, _userid: any) => {\n\t\tthis.sid = _sid;\n\t\tthis.userid = parseInt(_userid, 10)\n\t\tthis.loggedin = true;\n\n\t\tthis.loginResolve()\n\t}\n\n\tawaitLogin = () => {\n\t\treturn this.loginPromise\n\t}\n\n\tsetPassword = (password: string) => {\n\t\tkeyStore.security.setPassword(password);\n\t\tthis.sessionStorage.set(\"password\", password);\n\t}\n\n\tbootLogin = h.cacheResult<Bluebird<boolean>>(() => this.loadLogin())\n\n\tloadLogin = () => {\n\t\treturn this.sessionStorage.awaitLoading().then(() => {\n\t\t\tconst loggedin = this.sessionStorage.get(\"loggedin\") === \"true\" && this.sessionStorage.get(\"password\");\n\t\t\tif (!loggedin) {\n\t\t\t\treturn this.clear().thenReturn(false);\n\t\t\t}\n\n\t\t\tthis.setPassword(this.sessionStorage.get(\"password\"));\n\t\t\tthis.setLoginData(this.sessionStorage.get(\"sid\"), this.sessionStorage.get(\"userid\"));\n\n\t\t\treturn true;\n\t\t})\n\t}\n\n\tgetSID = () => {\n\t\treturn this.sid;\n\t}\n\n\tgetUserID = () => this.userid\n\n\tisOwnUserID = (id) => parseInt(id, 10) === this.userid\n\n\tclear = () => {\n\t\treturn Bluebird.all([\n\t\t\tblobCache.clear(),\n\t\t\tthis.sessionStorage.clear(),\n\t\t\tBluebird.resolve(Cache.deleteDatabase()),\n\t\t].map(p => p.reflect()))\n\t}\n\n\tlogout = () => {\n\t\tthis.clear().finally(landingPage)\n\t}\n\n\tisLoggedin = () => {\n\t\treturn this.loggedin;\n\t}\n}\n\nexport default new SessionService();\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/session.service.ts","console.warn(`Whispeer startup at ${Date.now()}`)\nconsole.time(\"Spinner on Home\")\n\nvar errorService = require(\"./error.service\").errorServiceInstance;\nvar keyStore = require(\"crypto/keyStore\");\nvar socketService = require(\"services/socket.service\").default;\nvar CacheService = require(\"./Cache\").default;\n\nvar h = require(\"../helper/helper\").default;\nvar debug = require(\"debug\");\nvar Observer = require(\"asset/observer\");\nvar Bluebird = require(\"bluebird\");\n\nvar sessionService = require(\"services/session.service\").default;\n\nvar debugName = \"whispeer:initService\";\nvar initServiceDebug = debug(debugName);\n\nfunction time(name) {\n\tif (debug.enabled(debugName)) {\n\t\tconsole.time(\"init: \" + name);\n\t}\n}\n\nfunction timeEnd(name) {\n\tif (debug.enabled(debugName)) {\n\t\tconsole.timeEnd(\"init: \" + name);\n\t}\n}\n\nvar initRequestsList = [], initCallbacks = [], initCacheCallbacks = [], initService;\n\nfunction getCache(initRequest) {\n\treturn new CacheService(initRequest.domain).get(initRequest.id || sessionService.getUserID()).then(function (cache) {\n\t\tinitRequest.cache = cache;\n\n\t\treturn initRequest;\n\t}).catch(function () {\n\t\treturn initRequest;\n\t});\n}\n\nfunction setCache(initResponse, transformedData) {\n\tif (!transformedData) {\n\t\treturn Bluebird.resolve(initResponse);\n\t}\n\n\n\treturn new CacheService(initResponse.domain)\n\t.store(initResponse.id || sessionService.getUserID(), transformedData)\n\t.then(function () {\n\t\treturn initResponse;\n\t})\n\t.catch(function () {\n\t\treturn initResponse;\n\t});\n}\n\nfunction getServerData(initRequests) {\n\treturn Bluebird.resolve(initRequests).map(function (request) {\n\t\tvar requestObject = {\n\t\t\tresponseKey: \"content\"\n\t\t};\n\n\t\tvar id = request.id;\n\n\t\tif (typeof id === \"function\") {\n\t\t\tid = id();\n\t\t}\n\n\t\tif (typeof id !== \"undefined\") {\n\t\t\trequestObject.id = id;\n\t\t}\n\n\t\tif (request.cache && request.cache.data) {\n\t\t\tif (request.cache.data._signature) {\n\t\t\t\trequestObject.cacheSignature = request.cache.data._signature;\n\t\t\t} else if (request.cache.data.meta && request.cache.data.meta._signature) {\n\t\t\t\trequestObject.cacheSignature = request.cache.data.meta._signature;\n\t\t\t}\n\t\t}\n\n\t\treturn socketService.definitlyEmit(request.domain, requestObject).then(function (response) {\n\t\t\trequest.data = response;\n\n\t\t\treturn request;\n\t\t});\n\t});\n}\n\nfunction runCacheCallbacks(initRequests) {\n\treturn Bluebird.all(initRequests).map(function (request) {\n\t\tif (!request.cache || !request.options.cacheCallback) {\n\t\t\treturn !request.options.cache;\n\t\t}\n\n\t\treturn request.options.cacheCallback(request.cache).thenReturn(true);\n\t});\n}\n\nfunction runCallbacks(initResponses) {\n\treturn Bluebird.all(initResponses).map(function (response) {\n\t\tvar callback = response.callback;\n\n\t\tif (response.options.cache) {\n\t\t\treturn callback(response.data.content).then(function (transformedData) {\n\t\t\t\tinitServiceDebug(\"Callback done:\" + response.domain);\n\t\t\t\tif (!transformedData) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn setCache(response, transformedData);\n\t\t\t});\n\t\t}\n\n\t\treturn callback(response.data.content);\n\t});\n}\n\nfunction runFunction(func) {\n\treturn func();\n}\n\nfunction runInitCacheCallbacks() {\n\treturn Bluebird.all(initCacheCallbacks.map(runFunction));\n}\n\nfunction loadData() {\n\tkeyStore.security.blockPrivateActions();\n\n\tvar runningInitCallbacks;\n\tvar promise = Bluebird.resolve().then(function () {\n\n\t\ttime(\"getCache\");\n\t\treturn initRequestsList;\n\t}).map(function (initRequest) {\n\t\tif (initRequest.options.cache) {\n\t\t\treturn getCache(initRequest);\n\t\t} else {\n\t\t\treturn initRequest;\n\t\t}\n\t}).then(function (initRequests) {\n\t\ttimeEnd(\"getCache\");\n\t\ttime(\"runCacheCallbacks\")\n\n\t\treturn Bluebird.all([\n\t\t\trunInitCacheCallbacks(),\n\t\t\trunCacheCallbacks(initRequests)\n\t\t]).spread(function (customCacheResults, simpleCacheResults) {\n\t\t\tif (simpleCacheResults.reduce(h.and, true)) {\n\t\t\t\tinitService.notify(\"\", \"initCacheDone\");\n\t\t\t} else {\n\t\t\t\tinitServiceDebug(\"Could not load cache!\");\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}).catch(errorService.criticalError).thenReturn(initRequests);\n\t}).then(function (initRequests) {\n\t\ttimeEnd(\"runCacheCallbacks\")\n\t\trunningInitCallbacks = initCallbacks.map(runFunction);\n\n\t\ttime(\"getServer\");\n\t\treturn getServerData(initRequests);\n\t}).then(function (initResponses) {\n\t\ttimeEnd(\"getServer\");\n\t\ttime(\"runMainCallbacks\");\n\t\treturn runCallbacks(initResponses);\n\t}).then(function () {\n\t\tinitServiceDebug(\"Callbacks done!\");\n\t\treturn Bluebird.all(runningInitCallbacks);\n\t}).then(function () {\n\t\ttimeEnd(\"runMainCallbacks\");\n\t\tkeyStore.security.allowPrivateActions();\n\n\t\tvar migrationService = require(\"services/migrationService\");\n\t\tmigrationService();\n\t\tinitService.notify(\"\", \"initDone\");\n\t\treturn null;\n\t});\n\n\tpromise.catch(errorService.criticalError);\n\n\treturn promise;\n}\n\nvar loadingPromise = sessionService.awaitLogin().then(function () {\n\treturn loadData();\n});\n\ninitService = {\n\t/** get via api, also check cache in before!\n\t* @param domain: domain to get from\n\t*/\n\tawaitLoading: function () {\n\t\treturn loadingPromise\n\t},\n\tget: function (domain, cb, options) {\n\t\tinitRequestsList.push({\n\t\t\tdomain: domain,\n\t\t\tcallback: cb,\n\t\t\toptions: options || {}\n\t\t});\n\t},\n\tregisterCacheCallback: function (cb) {\n\t\tinitCacheCallbacks.push(cb);\n\t},\n\tregisterCallback: function (cb) {\n\t\tinitCallbacks.push(cb);\n\t}\n};\n\nObserver.extend(initService);\n\nmodule.exports = initService;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/initService.js","var map = {\n\t\"../pages/blocked-users/blockedUsers.module\": [\n\t\t433,\n\t\t6\n\t],\n\t\"../pages/contact-requests/contact-requests.module\": [\n\t\t434,\n\t\t11\n\t],\n\t\"../pages/contacts/contacts.module\": [\n\t\t435,\n\t\t5\n\t],\n\t\"../pages/home/home.module\": [\n\t\t436,\n\t\t8\n\t],\n\t\"../pages/login/login.module\": [\n\t\t437,\n\t\t3\n\t],\n\t\"../pages/messages/add/add.module\": [\n\t\t438,\n\t\t4\n\t],\n\t\"../pages/messages/details/details.module\": [\n\t\t439,\n\t\t7\n\t],\n\t\"../pages/messages/messages.module\": [\n\t\t432,\n\t\t1\n\t],\n\t\"../pages/new-message/new-message.module\": [\n\t\t440,\n\t\t0\n\t],\n\t\"../pages/profile/profile.module\": [\n\t\t441,\n\t\t2\n\t],\n\t\"../pages/sales/sales.module\": [\n\t\t442,\n\t\t10\n\t],\n\t\"../pages/settings/settings.module\": [\n\t\t443,\n\t\t9\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tvar ids = map[req];\n\tif(!ids)\n\t\treturn Promise.reject(new Error(\"Cannot find module '\" + req + \"'.\"));\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(ids[0]);\n\t});\n};\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nmodule.exports = webpackAsyncContext;\nwebpackAsyncContext.id = 234;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src lazy\n// module id = 234\n// module chunks = 12","import { errorServiceInstance } from \"./error.service\";\nimport * as Bluebird from \"bluebird\";\nimport h from \"../helper/helper\"\nimport idb, { Cursor, DB } from \"idb\" // tslint:disable-line:no-unused-variable\n\nconst REINIT_CACHE_TIMEOUT = 2000\nlet dbPromise: Promise<DB>, cachesDisabled\n\nconst initCache = () => {\n\tcachesDisabled = false\n\n\tdbPromise = idb.open(\"whispeerCache\", 10, upgradeDB => {\n\t\tconst objectStore = upgradeDB.createObjectStore('cache', { keyPath: \"id\" });\n\n\t\tobjectStore.createIndex(\"created\", \"created\", { unique: false });\n\t\tobjectStore.createIndex(\"used\", \"used\", { unique: false });\n\t\tobjectStore.createIndex(\"type\", \"type\", { unique: false });\n\t\tobjectStore.createIndex(\"size\", \"size\", { unique: false });\n\t})\n\n\tdbPromise.catch((e) => {\n\t\tconsole.warn(\"Disabling indexedDB caching due to error\", e)\n\n\t\tcachesDisabled = true\n\t})\n}\n\ninitCache()\n\ntry {\n\tindexedDB.deleteDatabase(\"whispeer\");\n} catch (e) {}\n\nconst followCursorUntilDone = (cursorPromise: Promise<Cursor>, action) => {\n\treturn Bluebird.try(async () => {\n\t\tlet cursor = await cursorPromise\n\n\t\twhile (cursor) {\n\t\t\taction(cursor)\n\n\t\t\tcursor = await cursor.continue()\n\t\t}\n\t})\n}\n\nexport default class Cache {\n\tprivate options: any\n\tprivate cacheDisabled: boolean = false\n\n\tstatic deleteDatabase() {\n\t\tcachesDisabled = true\n\n\t\treturn dbPromise.then((db) =>\n\t\t\tdb.close()\n\t\t).then(() =>\n\t\t\tidb.delete(\"whispeerCache\")\n\t\t).then(() => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tinitCache()\n\t\t\t}, REINIT_CACHE_TIMEOUT)\n\t\t})\n\t}\n\n\tconstructor(private name : string, options?: any) {\n\t\tthis.options = options || {};\n\t\tthis.options.maxEntries = this.options.maxEntries || 100;\n\t\tthis.options.maxBlobSize = this.options.maxBlobSize || 1*1024*1024;\n\t}\n\n\tstatic sumSize (arr: any[]) {\n\t\treturn arr.reduce(function (prev, cur) {\n\t\t\treturn prev + cur.size;\n\t\t}, 0);\n\t}\n\n\tstore(id: string, data: any, blobs?: any): Bluebird<any> {\n\t\tif (this.isDisabled()) {\n\t\t\treturn Bluebird.resolve();\n\t\t}\n\n\t\tif (blobs && !h.array.isArray(blobs)) {\n\t\t\tblobs = [blobs];\n\t\t}\n\n\t\tif (blobs && this.options.maxBlobSize !== -1 && Cache.sumSize(blobs) > this.options.maxBlobSize) {\n\t\t\treturn Bluebird.resolve();\n\t\t}\n\n\t\tvar cacheEntry = {\n\t\t\tdata: JSON.stringify(data),\n\t\t\tcreated: new Date().getTime(),\n\t\t\tused: new Date().getTime(),\n\t\t\tid: this.getID(id),\n\t\t\ttype: this.name,\n\t\t\tsize: 0,\n\t\t\tblobs: <any>[]\n\t\t};\n\n\t\tif (blobs) {\n\t\t\tcacheEntry.blobs = blobs;\n\t\t\tcacheEntry.size = Cache.sumSize(blobs);\n\t\t}\n\n\t\treturn Bluebird.try(async () => {\n\t\t\tconst db = await dbPromise\n\n\t\t\tconsole.info(`Storing in indexeddb ${this.getID(id)}`)\n\n\t\t\tconst tx = db.transaction('cache', 'readwrite')\n\t\t\ttx.objectStore('cache').put(cacheEntry)\n\n\t\t\tawait tx.complete\n\t\t}).catch(errorServiceInstance.criticalError);\n\t}\n\n\tcontains(id: string): Bluebird<boolean> {\n\t\tif (this.isDisabled()) {\n\t\t\treturn Bluebird.resolve(false)\n\t\t}\n\n\t\treturn Bluebird.try(async () => {\n\t\t\tconst db = await dbPromise\n\t\t\tconst tx = db.transaction(\"cache\", \"readonly\")\n\t\t\tconst count = await tx.objectStore(\"cache\").count(`${this.name}/${id}`)\n\n\t\t\treturn count > 0\n\t\t})\n\t}\n\n\tget(id: string): Bluebird<any> {\n\t\tif (this.isDisabled()) {\n\t\t\treturn Bluebird.reject(new Error(`Cache is disabled ${this.name}`));\n\t\t}\n\n\t\t/*\n\t\tvar cacheResult = this._db.cache.where(\"id\").equals(this.name + \"/\" + id);\n\n\t\tthis._db.cache.where(\"id\").equals(this.name + \"/\" + id).modify({ used: new Date().getTime() });\n\t\t*/\n\n\t\treturn Bluebird.try(async () => {\n\t\t\tconst db = await dbPromise\n\t\t\tconst tx = db.transaction(\"cache\", \"readonly\")\n\t\t\tconst data = await tx.objectStore(\"cache\").get(`${this.name}/${id}`)\n\n\t\t\tif (typeof data === \"undefined\") {\n\t\t\t\tthrow new Error(`cache miss for ${this.getID(id)}`);\n\t\t\t}\n\n\t\t\tdata.data = JSON.parse(data.data);\n\n\t\t\tdata.blobs = data.blobs || [];\n\n\t\t\tdata.blobs = data.blobs.map((blob: any) => {\n\t\t\t\tif (typeof blob === \"string\") {\n\t\t\t\t\treturn h.dataURItoBlob(blob);\n\t\t\t\t}\n\n\t\t\t\treturn blob;\n\t\t\t});\n\n\t\t\tif (data.blobs.length === 1) {\n\t\t\t\tdata.blob = data.blobs[0];\n\t\t\t}\n\n\t\t\treturn data;\n\t\t})\n\t}\n\n\t/**\n\t * get all cache entries as a dexie collection.<\n\t * @return {Bluebird<any>} Promise containing all cache entries as a dexie collection.\n\t */\n\tall(): Bluebird<any> {\n\t\tif (this.isDisabled()) {\n\t\t\treturn Bluebird.resolve([]);\n\t\t}\n\n\t\tconst entries = []\n\n\t\treturn this.cursorEach((cursor) => entries.push(cursor.value), \"readonly\").then(() => entries)\n\t}\n\n\tgetID(id) {\n\t\treturn `${this.name}/${id}`\n\t}\n\n\t/**\n\t * delete a certain cache entry.\n\t * @param  {string}        id id of the entry\n\t * @return {Bluebird<any>}    [description]\n\t */\n\tdelete(id: string): Bluebird<any> {\n\t\tif (this.isDisabled()) {\n\t\t\treturn Bluebird.resolve();\n\t\t}\n\n\t\treturn Bluebird.try(async () => {\n\t\t\tconst db = await dbPromise\n\n\t\t\tconst tx = db.transaction(\"cache\", \"readwrite\")\n\n\t\t\tawait tx.objectStore(\"cache\").delete(this.getID(id))\n\t\t})\n\t}\n\n\tdeleteAll(): Bluebird<any> {\n\t\tif (this.isDisabled()) {\n\t\t\treturn Bluebird.resolve();\n\t\t}\n\n\t\tconst deleteRequests = []\n\n\t\treturn this.cursorEach((cursor) => deleteRequests.push(cursor.delete()), \"readwrite\").then(() => Bluebird.all(deleteRequests))\n\t}\n\n\tprivate cursorEach(action, transactionType: \"readonly\" | \"readwrite\") {\n\t\treturn Bluebird.try(async () => {\n\t\t\tconst db = await dbPromise\n\n\t\t\tconst tx = db.transaction(\"cache\", transactionType)\n\t\t\tconst cursorPromise = tx.objectStore(\"cache\").index(\"type\").openCursor(this.name)\n\n\t\t\tawait followCursorUntilDone(cursorPromise, action)\n\t\t})\n\t}\n\n\tprivate isDisabled() {\n\t\treturn cachesDisabled || this.cacheDisabled\n\t}\n\n\tdisable() {\n\t\tthis.cacheDisabled = true;\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/Cache.ts","/** our keystore.\n\thandles all the keys, passwords, etc.\n\tkeys are a little difficult because some keys look different but are the same because they are encrypted differently\n\talso keys always have a decryptor because the are never distributed alone.\n\n\tuploading:\n\t\tkey -> addSymDecryptor/addAsymDecryptor/addPWDecryptor -> intKey\n\t\tkey -> getUploadData() -> intKey\n\t\tdo for multiple keys, concat, submit.\n\n\tthe key should cache which of its data is dirty and which is not.\n\tremoving decryptors (later) should update directly if the key as such is already saved.\n\n\tkeyid: identifier@timestamp\n**/\n/*\n{\n\t\"crv\":\"P-256\",\n\t\"ext\":true,\n\t\"key_ops\":[\"verify\"],\n\t\"kty\":\"EC\",\n\t\"x\":\"_u7VBNaYjLEcaj2Vw1t-CiH_or3xPudekyW4iJrjwgs\",\n\t\"y\":\"YMv7KmTnxpU16ytQrAYgcw4bpoQuPZwLSwvM_imsqxA\"\n}\n*/\n\nvar h = require(\"helper/helper\").default;\nvar chelper = require(\"crypto/helper\");\nvar sjcl = require(\"sjcl\");\nvar waitForReady = require(\"crypto/waitForReady\");\nvar sjclWorkerInclude = require(\"crypto/sjclWorkerInclude\");\nvar ObjectHasher = require(\"crypto/objectHasher\");\nvar errors = require(\"asset/errors\");\nvar Bluebird = require(\"bluebird\");\nvar debug = require(\"debug\");\n\nvar keyStoreDebug = debug(\"whispeer:keyStore\");\n\nvar keyGetFunction, firstVerify = true, improvementListener = [], makeKey, keyStore, recovery = false, sjclWarning = true;\n\n/** dirty and new keys to upload. */\nvar dirtyKeys = [], newKeys = [];\n\n/** cache for keys */\nvar symKeys = {}, cryptKeys = {}, signKeys = {};\nvar password = \"\",  keyGenIdentifier = \"\", mainKey;\n\n/** identifier list of keys we can use for encryption. this is mainly a safeguard for coding bugs. */\nvar keysUsableForEncryption = [];\n\nvar privateActionsBlocked = false;\n\n/** our classes */\nvar Key, SymKey, CryptKey, SignKey;\n\nsjcl.random.startCollectors();\n\nvar MAXSPEED = 99999999999, SPEEDS = {\n\t\tsymKey: {\n\t\t\tloaded: 3,\n\t\t\tunloaded: 50\n\t\t},\n\t\tcryptKey: {\n\t\t\tloaded: 100,\n\t\t\tunloaded: 150\n\t\t},\n\t\tpw: 3\n\t};\n\ntry {\n\tif (localStorage) {\n\t\tvar pw = localStorage.getItem(\"whispeer.session.password\");\n\t\tif (pw && typeof pw === \"string\") {\n\t\t\tpassword = pw;\n\t\t}\n\t}\n} catch (e) {\n\tkeyStoreDebug(e);\n}\n\nfunction bufferToHex(buffer) {\n\tvar hexCodes = [];\n\tvar view = new DataView(buffer);\n\tfor (var i = 0; i < view.byteLength; i += 4) {\n\t\t// Using getUint32 reduces the number of iterations needed (we process 4 bytes each time)\n\t\tvar value = view.getUint32(i)\n\t\t// toString(16) will give the hex representation of the number without padding\n\t\tvar stringValue = value.toString(16)\n\t\t// We use concatenation and slice for padding\n\t\tvar padding = \"00000000\"\n\t\tvar paddedValue = (padding + stringValue).slice(-padding.length)\n\t\thexCodes.push(paddedValue);\n\t}\n\n\t// Join all the hex strings into one\n\treturn hexCodes.join(\"\");\n}\n\nfunction fingerPrintData(data) {\n\treturn sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(data));\n}\n\nfunction fingerPrintPublicKey(publicKey) {\n\t//should we add the type and curve here too?\n\t//as the curve is fixed for now it should not be a problem\n\treturn fingerPrintData(publicKey._point.toBits());\n}\n\nfunction fingerPrintSymKey(keyData) {\n\tif (keyData instanceof Array) {\n\t\treturn fingerPrintData(keyData);\n\t} else {\n\t\tthrow new errors.InvalidDataError(\"invalid key data\");\n\t}\n}\n\nfunction getSubtle() {\n\tif (window.msCrypto && window.msCrypto.subtle) {\n\t\treturn window.msCrypto.subtle;\n\t}\n\n\tif (!window.crypto) {\n\t\treturn false;\n\t}\n\n\tif (window.crypto.subtle) {\n\t\treturn window.crypto.subtle;\n\t}\n\n\tif (window.crypto.webkitSubtle) {\n\t\treturn window.crypto.webkitSubtle;\n\t}\n\n\treturn false;\n}\n\nfunction makeKeyUsableForEncryption(realid) {\n\tvar fp = realid.split(\":\")[1];\n\tkeysUsableForEncryption.push(fp);\n}\n\nfunction isKeyUsableForEncryption(realid) {\n\tvar fp = realid.split(\":\")[1];\n\treturn keysUsableForEncryption.indexOf(fp) > -1;\n}\n\nfunction toPrivateKey(type, curve) {\n\treturn function (secret) {\n\t\tvar exponent = new sjcl.bn(chelper.bits2hex(secret));\n\n\t\treturn new type.secretKey(curve, exponent);\n\t};\n}\n\nfunction determineLength(object) {\n\tif (typeof object !== \"object\") {\n\t\treturn 0;\n\t}\n\n\treturn Object.keys(object).reduce(function (prev, cur) {\n\t\treturn prev + 1 + determineLength(object[cur]);\n\t}, 0);\n}\n\nfunction stringifyObject(object, version) {\n\tvar length = determineLength(object);\n\n\tif (length < 50) {\n\t\treturn new ObjectHasher(object, version).stringify();\n\t}\n\n\tconsole.warn(\"Length too long for stringify \", object._type, version, length)\n\n\treturn sjclWorkerInclude.stringify(object, version);\n}\n\nfunction removeExpectedPrefix(bitArray, prefix) {\n\tvar len = prefix.length, part;\n\tprefix = sjcl.codec.utf8String.toBits(prefix);\n\n\tif (bitArray instanceof ArrayBuffer) {\n\t\tvar buf8 = new Uint8Array(bitArray);\n\t\tpart = sjcl.codec.arrayBuffer.toBits(new Uint8Array(buf8.subarray(0, len)).buffer);\n\t\tif (sjcl.bitArray.equal(prefix, part)) {\n\t\t\treturn new Uint8Array(buf8.subarray(len)).buffer;\n\t\t}\n\t} else {\n\t\tpart = sjcl.bitArray.bitSlice(bitArray, 0, 8*len);\n\t\tif (sjcl.bitArray.equal(prefix, part)) {\n\t\t\treturn sjcl.bitArray.bitSlice(bitArray, 8*len);\n\t\t}\n\t}\n\n\tthrow new errors.DecryptionError(\"invalid prefix (should be: \" + prefix + \")\");\n}\n\n//TODO: webworkers:\n//var webWorker = Modernizr.webworkers;\n\n/** generate an id */\nfunction generateid(base) {\n\tvar id = keyGenIdentifier + \":\" + chelper.bits2hex(base);\n\n\tif (symKeys[id] || cryptKeys[id] || signKeys[id]) {\n\t\tthrow new errors.SecurityError(\"key already existing with same content ... this should never happen!\");\n\t}\n\n\treturn id;\n}\n\nfunction correctKeyIdentifier(realid) {\n\tvar parts = realid.split(\":\");\n\n\tif (parts.length !== 2) {\n\t\tthrow new errors.InvalidDataError(\"Key id does not match format!\");\n\t}\n\n\tif (parts[0].length === 0) {\n\t\treturn keyGenIdentifier + \":\" + parts[1];\n\t}\n\n\treturn realid;\n}\n\n/** encrypt with password\n* @param pw password to encrypt\n* @param text text to encrypt\n* @param callback callback\n*/\nfunction encryptPW(pw, text) {\n\treturn Bluebird.try(function () {\n\t\tvar result = sjcl.json._encrypt(pw, text);\n\t\treturn chelper.sjclPacket2Object(result);\n\t});\n}\n\n/** our internal decryption function.\n* @param decryptorid id of decryptor\n* @param decryptortype decryptor type\n* @param ctext crypted text\n* @param callback called with results\n* @param iv necessary for symkey/pw encrypted data\n* @param salt necessary for pw encrypted data\n*/\nfunction internalDecrypt(decryptorid, decryptortype, ctext, iv, salt) {\n\treturn Bluebird.try(function () {\n\t\tif (decryptortype === \"symKey\" || decryptortype === \"backup\") {\n\t\t\treturn Bluebird.try(function () {\n\t\t\t\treturn SymKey.get(decryptorid);\n\t\t\t}).then(function (theKey) {\n\t\t\t\treturn theKey.decryptKey().thenReturn(theKey);\n\t\t\t}).then(function (theKey) {\n\t\t\t\treturn theKey.decrypt(ctext, iv);\n\t\t\t}).then(function (decryptedData) {\n\t\t\t\treturn removeExpectedPrefix(decryptedData, \"key::\");\n\t\t\t});\n\t\t} else if (decryptortype === \"cryptKey\") {\n\t\t\treturn Bluebird.try(function () {\n\t\t\t\treturn CryptKey.get(decryptorid);\n\t\t\t}).then(function (theKey) {\n\t\t\t\treturn theKey.decryptKey().thenReturn(theKey);\n\t\t\t}).then(function (theKey) {\n\t\t\t\treturn theKey.unkem(chelper.hex2bits(ctext));\n\t\t\t});\n\t\t} else if (decryptortype === \"pw\") {\n\t\t\treturn Bluebird.try(function () {\n\t\t\t\tvar jsonData = chelper.Object2sjclPacket({\n\t\t\t\t\t\tct: ctext,\n\t\t\t\t\t\tiv: iv,\n\t\t\t\t\t\tsalt: salt\n\t\t\t\t\t}), result;\n\t\t\t\tif (password !== \"\") {\n\t\t\t\t\tresult = sjcl.decrypt(password, jsonData, { raw: 1 });\n\n\t\t\t\t\treturn removeExpectedPrefix(result, \"key::\");\n\t\t\t\t}\n\n\t\t\t\tthrow new errors.DecryptionError(\"no pw\");\n\t\t\t});\n\t\t} else {\n\t\t\tthrow new errors.InvalidDataError(\"invalid decryptortype\");\n\t\t}\n\t});\n}\n\n/** returns a decryptors object if loaded\n* @param decryptorData\n* @return decryptorObject or null\n*/\nfunction getDecryptor(decryptorData) {\n\tif (decryptorData.type === \"symKey\") {\n\t\treturn symKeys[decryptorData.decryptorid];\n\t}\n\n\tif (decryptorData.type === \"cryptKey\") {\n\t\treturn cryptKeys[decryptorData.decryptorid];\n\t}\n\n\treturn null;\n}\n\n/** general key object.\n* @param realid keys real id\n* @param decryptors array of decryptor data\n* @param optional secret unencrypted secret if we already have it\n*/\nKey = function keyConstructor(superKey, realid, decryptors, optionals) {\n\tvar theKey = this, decryptKeyPromise, dirtyDecryptors = [], internalSecret, preSecret;\n\n\tif (!decryptors) {\n\t\tdecryptors = [];\n\t}\n\n\t/** identity past processor */\n\tvar pastProcessor = function pastProcessor(secret) {\n\t\treturn secret;\n\t};\n\n\toptionals = optionals || {};\n\n\tif (typeof optionals.pastProcessor === \"function\") {\n\t\tpastProcessor = optionals.pastProcessor;\n\t}\n\n\tif (optionals.secret) {\n\t\tpreSecret = optionals.secret;\n\t\tinternalSecret = pastProcessor(optionals.secret);\n\t\tdecryptKeyPromise = Bluebird.resolve();\n\t}\n\n\t/** is the key decrypted */\n\tthis.decrypted = function decryptedF() {\n\t\treturn decryptKeyPromise && decryptKeyPromise.isFulfilled();\n\t};\n\n\tfunction decryptKey() {\n\t\tvar usedDecryptor;\n\t\tif (!decryptKeyPromise) {\n\t\t\tdecryptKeyPromise = Bluebird.try(function () {\n\t\t\t\tusedDecryptor = theKey.getFastestDecryptor();\n\n\t\t\t\tif (!usedDecryptor || !usedDecryptor.decryptor) {\n\t\t\t\t\tthrow new errors.DecryptionError(\"Could not Decrypt key!\");\n\t\t\t\t}\n\n\t\t\t\tvar d = usedDecryptor.decryptor;\n\n\t\t\t\treturn internalDecrypt(d.decryptorid, d.type, d.ct, d.iv, d.salt);\n\t\t\t}).then(function (result) {\n\t\t\t\tif (result === false) {\n\t\t\t\t\tthrow new Error(\"Could not decrypt\");\n\t\t\t\t}\n\n\t\t\t\tif (usedDecryptor.decryptor.type === \"cryptKey\") {\n\t\t\t\t\th.callEach(improvementListener, [theKey.getRealID()]);\n\t\t\t\t}\n\n\t\t\t\treturn pastProcessor(result);\n\t\t\t}).then(function (pastProcessedSecret) {\n\t\t\t\tpreSecret = internalSecret;\n\t\t\t\tinternalSecret = pastProcessedSecret;\n\t\t\t}).catch(function (err) {\n\t\t\t\tglobalErrors.push(err || { err: \"internaldecryptor returned false for realid: \" + realid });\n\t\t\t\tkeyStoreDebug(err);\n\t\t\t\tkeyStoreDebug(\"decryptor failed for key: \" + realid);\n\n\t\t\t\tdecryptors = decryptors.filter(function (decryptor) {\n\t\t\t\t\treturn decryptor !== usedDecryptor.decryptor;\n\t\t\t\t});\n\n\t\t\t\tif (decryptors.length === 0) {\n\t\t\t\t\tthrow new errors.DecryptionError(\"Could finally not decrypt key!\");\n\t\t\t\t}\n\n\t\t\t\tdecryptKeyPromise = undefined;\n\n\t\t\t\treturn decryptKey();\n\t\t\t});\n\t\t}\n\n\t\treturn decryptKeyPromise;\n\t}\n\n\t/** decrypt this key.\n\t* @param callback called with true/false\n\t* searches your whole keyspace for a decryptor and decrypts if possible\n\t*/\n\tthis.decryptKey = decryptKey;\n\n\n\t/** getter for real id */\n\tfunction getRealIDF() {\n\t\treturn correctKeyIdentifier(realid);\n\t}\n\tthis.getRealID = getRealIDF;\n\n\tthis.getRealidFingerPrint = function () {\n\t\treturn realid.split(\":\")[1];\n\t};\n\n\t/** getter for decryptors array\n\t* copies array before returning\n\t*/\n\tfunction getDecryptorsF() {\n\t\tvar result = [], i, tempR, k;\n\t\tfor (i = 0; i < decryptors.length; i += 1) {\n\t\t\ttempR = {};\n\t\t\tfor (k in decryptors[i]) {\n\t\t\t\tif (decryptors[i].hasOwnProperty(k)) {\n\t\t\t\t\ttempR[k] = decryptors[i][k];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.push(tempR);\n\t\t}\n\n\t\treturn result;\n\t}\n\tthis.getDecryptors = getDecryptorsF;\n\n\t/** get the fastest decryptor for this key.\n\t* @param level only used for recursion prevention.\n\t* @return {\n\t*  speed: speed of decryptor found.\n\t*  decryptor: decryptor found.\n\t* }\n\t*/\n\tfunction getFastestDecryptorF(level) {\n\t\tif (!level) {\n\t\t\tlevel = 0;\n\t\t}\n\n\t\tif (level > 100) {\n\t\t\tkeyStoreDebug(\"dafuq, deeply nested keys\");\n\t\t\treturn MAXSPEED;\n\t\t}\n\n\t\tvar i, cur, key, decryptorIndex = 0, smallest = MAXSPEED, subKeyData, speed, curSpeeds;\n\t\tfor (i = 0; i < decryptors.length; i += 1) {\n\t\t\tcur = decryptors[i];\n\t\t\tcurSpeeds = SPEEDS[cur.type];\n\n\t\t\tif (!curSpeeds) {\n\t\t\t\tspeed = MAXSPEED;\n\t\t\t} else if (typeof curSpeeds === \"number\") {\n\t\t\t\tspeed = curSpeeds;\n\t\t\t} else {\n\t\t\t\tkey = getDecryptor(cur);\n\t\t\t\tif (key) {\n\t\t\t\t\tif (key.decrypted()) {\n\t\t\t\t\t\tspeed = curSpeeds.loaded;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsubKeyData = key.getFastestDecryptor(level + 1);\n\t\t\t\t\t\tspeed = curSpeeds.loaded + subKeyData.speed;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tspeed = curSpeeds.unloaded;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (speed < smallest) {\n\t\t\t\tsmallest = speed;\n\t\t\t\tdecryptorIndex = i;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tspeed: smallest,\n\t\t\tdecryptor: decryptors[decryptorIndex]\n\t\t};\n\t}\n\tthis.getFastestDecryptor = getFastestDecryptorF;\n\n\t/** add crypt Key decryptor\n\t* @param realid decryptor key realid\n\t* @param tag decryption tag\n\t* @param callback callback\n\t*/\n\tfunction addAsymDecryptorF(realid, tag) {\n\t\treturn Bluebird.try(function () {\n\t\t\tvar decryptorData = {\n\t\t\t\tdecryptorid: realid,\n\t\t\t\ttype: \"cryptKey\",\n\t\t\t\tct: chelper.bits2hex(tag),\n\t\t\t\tdirty: true\n\t\t\t};\n\n\t\t\tdecryptors.push(decryptorData);\n\t\t\tdirtyKeys.push(superKey);\n\t\t\tdirtyDecryptors.push(decryptorData);\n\t\t});\n\t}\n\n\t/** add symKey decryptor.\n\t* @param realid realid of decryptor\n\t* @param callback callback\n\t*/\n\tfunction addSymDecryptorF(realid) {\n\t\treturn Bluebird.try(function () {\n\t\t\tif (realid instanceof SymKey) {\n\t\t\t\treturn realid;\n\t\t\t}\n\n\t\t\treturn SymKey.get(realid);\n\t\t}).then(function (cryptorKey) {\n\t\t\treturn theKey.decryptKey().thenReturn(cryptorKey);\n\t\t}).then(function (cryptorKey) {\n\t\t\tvar secret = preSecret || internalSecret;\n\t\t\treturn cryptorKey.encryptWithPrefix(\"key::\", secret).then(function (data) {\n\t\t\t\tvar decryptorData = {\n\t\t\t\t\tdecryptorid: cryptorKey.getRealID(),\n\t\t\t\t\ttype: \"symKey\",\n\t\t\t\t\tct: chelper.bits2hex(data.ct),\n\t\t\t\t\tiv: chelper.bits2hex(data.iv),\n\t\t\t\t\tdirty: true\n\t\t\t\t};\n\n\t\t\t\tdecryptors.push(decryptorData);\n\t\t\t\tdirtyKeys.push(superKey);\n\t\t\t\tdirtyDecryptors.push(decryptorData);\n\n\t\t\t\treturn cryptorKey.getRealID();\n\t\t\t});\n\t\t});\n\t}\n\n\t/** add a pw decryptor\n\t* @param pw password\n\t* @param callback callback\n\t*/\n\tfunction addPWDecryptorF(pw) {\n\t\treturn theKey.decryptKey().then(function () {\n\t\t\tvar prefix = sjcl.codec.utf8String.toBits(\"key::\");\n\t\t\tvar data = sjcl.bitArray.concat(prefix, preSecret || internalSecret);\n\n\t\t\treturn chelper.sjclPacket2Object(sjcl.json._encrypt(pw, data));\n\t\t}).then(function (data) {\n\t\t\tvar decryptorData = {\n\t\t\t\t//Think, shortHash here? id: ?,\n\t\t\t\ttype: \"pw\",\n\t\t\t\tct: chelper.bits2hex(data.ct),\n\t\t\t\tiv: chelper.bits2hex(data.iv),\n\t\t\t\tsalt: chelper.bits2hex(data.salt),\n\t\t\t\tdirty: true\n\t\t\t};\n\n\t\t\tdecryptors.push(decryptorData);\n\t\t\tdirtyKeys.push(superKey);\n\t\t\tdirtyDecryptors.push(decryptorData);\n\n\t\t\treturn decryptorData;\n\t\t});\n\t}\n\n\tthis.addAsymDecryptor = addAsymDecryptorF;\n\tthis.addSymDecryptor = addSymDecryptorF;\n\tthis.addPWDecryptor = addPWDecryptorF;\n\n\t/** get all data which need uploading. */\n\tfunction getDecryptorDataF(includeAllDecryptors) {\n\t\t//get the upload data for the decryptors of this key.\n\t\t//this will be called in the keys upload() function.\n\n\t\tvar decryptorArray = dirtyDecryptors;\n\n\t\tif (includeAllDecryptors) {\n\t\t\tdecryptorArray = decryptors;\n\t\t}\n\n\t\treturn decryptorArray.map(function (decryptor) {\n\t\t\tvar tempR = {}, k;\n\t\t\tfor (k in decryptor) {\n\t\t\t\tif (decryptor.hasOwnProperty(k)) {\n\t\t\t\t\ttempR[k] = decryptor[k];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (tempR.decryptorid) {\n\t\t\t\ttempR.decryptorid = correctKeyIdentifier(tempR.decryptorid);\n\t\t\t}\n\n\t\t\treturn tempR;\n\t\t});\n\t}\n\tthis.getDecryptorData = getDecryptorDataF;\n\n\t/** check if this key has dirty decryptors */\n\tfunction isDirtyF() {\n\t\treturn (theKey.dirtyDecryptors.length !== 0);\n\t}\n\tthis.isDirty = isDirtyF;\n\n\t/** remove uploaded keys from dirty array */\n\tfunction removeDirtyF(keys) {\n\t\tvar remaining = [], i, j, isRemaining, curD, curK;\n\t\tfor (i = 0; i < dirtyDecryptors.length; i += 1) {\n\t\t\tcurD = dirtyDecryptors[i];\n\t\t\tisRemaining = true;\n\t\t\tfor (j = 0; j < keys.length; j += 1) {\n\t\t\t\tcurK = keys[j];\n\t\t\t\tif (curD.type === curK.type && curD.ct === curK.ct && curD.decryptorid === curK.decryptorid) {\n\t\t\t\t\tkeys.splice(j, 1);\n\t\t\t\t\tisRemaining = false;\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isRemaining) {\n\t\t\t\tremaining.push(curD);\n\t\t\t}\n\t\t}\n\n\t\tdirtyDecryptors = remaining;\n\t}\n\tthis.removeDirty = removeDirtyF;\n\n\t/** get the secret of this key */\n\tthis.getSecret = function () {\n\t\tif (this.decrypted()) {\n\t\t\treturn internalSecret;\n\t\t}\n\n\t\treturn false;\n\t};\n};\n\n/** a SymKey.\n* @param keyData if not set: generate key; if string: hex of unencrypted key; otherwise: key data\n* @attribute id\n* @attribute realid\n* @attribute decryptor data\n* @attribute encrypted key\n* implements all symmetric key functions.\n*/\nSymKey = function (keyData) {\n\tvar intKey, comment = \"\";\n\n\tif (!keyData) {\n\t\tkeyData = sjcl.random.randomWords(8);\n\t}\n\n\tif (typeof keyData === \"string\") {\n\t\tkeyData = chelper.hex2bits(keyData);\n\t}\n\n\tif (keyData instanceof Array) {\n\t\tintKey = new Key(this, generateid(fingerPrintSymKey(keyData)), [], {secret: keyData});\n\t} else {\n\t\tintKey = new Key(this, keyData.realid, keyData.decryptors, {\n\t\t\tpastProcessor: function (secret) {\n\t\t\t\tvar fp = fingerPrintSymKey(secret);\n\t\t\t\tif (fp !== intKey.getRealidFingerPrint()) {\n\t\t\t\t\tthrow new errors.ValidationError(\"Fingerprint and Key id do not match\");\n\t\t\t\t}\n\t\t\t\treturn secret;\n\t\t\t}\n\t\t});\n\t}\n\n\tthis.getAccessCount = function () {\n\t\treturn keyData.accessCount;\n\t};\n\n\tthis.getUploadData = function (includeAllDecryptors) {\n\t\tvar data = {\n\t\t\trealid: intKey.getRealID(),\n\t\t\ttype: \"sym\",\n\t\t\tdecryptors: this.getDecryptorData(includeAllDecryptors),\n\t\t\tcomment: comment\n\t\t};\n\n\t\treturn data;\n\t};\n\n\tthis.getDecryptorData = intKey.getDecryptorData;\n\n\tthis.getRealID = intKey.getRealID;\n\tthis.getDecryptors = intKey.getDecryptors;\n\tthis.decrypted = intKey.decrypted;\n\n\tthis.addAsymDecryptor = intKey.addAsymDecryptor;\n\tthis.addSymDecryptor = intKey.addSymDecryptor;\n\tthis.addPWDecryptor = intKey.addPWDecryptor;\n\n\tthis.decryptKey = intKey.decryptKey;\n\tthis.getFastestDecryptor = intKey.getFastestDecryptor;\n\n\tthis.setComment = function setCommentF(theComment) {\n\t\tif (theComment) {\n\t\t\tcomment = theComment;\n\t\t}\n\t};\n\n\t/** encrypt a text.\n\t* @param text text to encrypt\n\t* @param callback called with result\n\t* @param optional iv initialization vector\n\t*/\n\n\tthis.encryptWithPrefix = function (prefix, data, progressCallback, noDecode) {\n\t\tif (privateActionsBlocked) {\n\t\t\tthrow new errors.SecurityError(\"Private Actions are blocked (encryptWithPrefix)\");\n\t\t}\n\n\t\tif (!isKeyUsableForEncryption(intKey.getRealID())) {\n\t\t\tthrow new errors.SecurityError(\"Key not usable for encryption: \" + intKey.getRealID());\n\t\t}\n\n\t\treturn intKey.decryptKey().then(function () {\n\t\t\tif (typeof data === \"string\") {\n\t\t\t\tdata = sjcl.codec.utf8String.toBits(data);\n\t\t\t}\n\n\t\t\tprefix = sjcl.codec.utf8String.toBits(prefix);\n\n\t\t\tif (data instanceof ArrayBuffer) {\n\t\t\t\tprefix = sjcl.codec.arrayBuffer.fromBits(prefix, false);\n\t\t\t\tvar l = prefix.byteLength + data.byteLength;\n\t\t\t\tvar p = 16;\n\t\t\t\tvar padding = new ArrayBuffer(p-l%p);\n\t\t\t\tdata = h.concatBuffers(prefix, data, padding);\n\t\t\t} else {\n\t\t\t\tdata = sjcl.bitArray.concat(prefix, data);\n\t\t\t}\n\n\t\t\treturn sjclWorkerInclude.sym.encrypt(intKey.getSecret(), data, progressCallback);\n\t\t}).then(function (result) {\n\t\t\tif (noDecode) {\n\t\t\t\treturn result;\n\t\t\t} else {\n\t\t\t\treturn chelper.sjclPacket2Object(result);\n\t\t\t}\n\t\t});\n\t};\n\n\t/** decrypt some text.\n\t* @param ctext text to decrypt\n\t* @param callback called with results\n\t* @param optional iv initialization vector\n\t*/\n\tthis.decrypt = function (ctext, iv, progressCallback) {\n\t\treturn intKey.decryptKey().then(function () {\n\t\t\tif (typeof ctext !== \"object\") {\n\t\t\t\tif (h.isHex(ctext)) {\n\t\t\t\t\tctext = chelper.hex2bits(ctext);\n\t\t\t\t}\n\n\t\t\t\tctext = {ct: ctext};\n\t\t\t} else {\n\t\t\t\tif (h.isHex(ctext.iv)) {\n\t\t\t\t\tctext.iv = chelper.hex2bits(ctext.iv);\n\t\t\t\t}\n\n\t\t\t\tif (h.isHex(ctext.ct)) {\n\t\t\t\t\tctext.ct = chelper.hex2bits(ctext.ct);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (iv) {\n\t\t\t\tif (h.isHex(iv)) {\n\t\t\t\t\tiv = chelper.hex2bits(iv);\n\t\t\t\t}\n\t\t\t\tctext.iv = iv;\n\t\t\t}\n\n\t\t\tif (ctext.ct.length < 500) {\n\t\t\t\treturn sjcl.json._decrypt(intKey.getSecret(), ctext, {raw: 1});\n\t\t\t} else {\n\t\t\t\treturn sjclWorkerInclude.sym.decrypt(intKey.getSecret(), ctext, progressCallback);\n\t\t\t}\n\t\t});\n\t};\n};\n\n/** make a symkey out of keydata */\nfunction makeSymKey(keyData) {\n\tif (keyData && keyData.realid) {\n\t\tif (!symKeys[keyData.realid]) {\n\t\t\tvar key = new SymKey(keyData);\n\t\t\tsymKeys[keyData.realid] = key;\n\t\t}\n\n\t\treturn symKeys[keyData.realid];\n\t}\n}\n\n/** load a key and his keychain. remove loaded keys */\nfunction getKey(realKeyID, callback) {\n\treturn keyGetFunction(realKeyID, callback);\n}\n\n/** generates a symmetric key\n* @param callback callback\n*/\nfunction symKeyGenerate(comment) {\n\treturn Bluebird.try(function () {\n\t\treturn new SymKey();\n\t}).then(function (key) {\n\t\tif (symKeys[key.getRealID()]) {\n\t\t\treturn symKeyGenerate(comment);\n\t\t}\n\n\t\tsymKeys[key.getRealID()] = key;\n\t\tnewKeys.push(key);\n\t\tmakeKeyUsableForEncryption(key.getRealID());\n\n\t\tkey.setComment(comment);\n\n\t\treturn symKeys[key.getRealID()];\n\t});\n}\n\n/** load  a symkey and its keychain */\nSymKey.get = function (realKeyID) {\n\treturn Bluebird.try(function () {\n\t\tif (!symKeys[realKeyID]) {\n\t\t\treturn getKey(realKeyID);\n\t\t}\n\t}).then(function () {\n\t\tif (symKeys[realKeyID]) {\n\t\t\treturn symKeys[realKeyID];\n\t\t}\n\n\t\tthrow new errors.InvalidDataError(\"keychain not found (sym) \" + realKeyID);\n\t});\n};\n\nSymKey.generate = symKeyGenerate;\n\n/** a ecc crypto key\n* @param keyData keys data.\n*/\nCryptKey = function (keyData) {\n\tvar publicKey, intKey, x, y, curve, point, realid, isPrivateKey = false, comment = \"\";\n\n\tif (!keyData || !keyData.point || !keyData.point.x || !keyData.point.y || !keyData.curve || !keyData.realid) {\n\t\tthrow new errors.InvalidDataError(\"invalid data\");\n\t}\n\n\tcurve = chelper.getCurve(keyData.curve);\n\n\tx =\tcurve.field.fromBits(chelper.hex2bits(keyData.point.x));\n\ty = curve.field.fromBits(chelper.hex2bits(keyData.point.y));\n\tpoint = new sjcl.ecc.point(curve, x, y);\n\n\tpublicKey = new sjcl.ecc.elGamal.publicKey(curve, point);\n\n\trealid = keyData.realid;\n\n\tif (keyData.exponent) {\n\t\tisPrivateKey = true;\n\n\t\tintKey = new Key(this, realid, keyData.decryptors, {\n\t\t\tsecret: keyData.exponent,\n\t\t\tpastProcessor: toPrivateKey(sjcl.ecc.elGamal, curve)\n\t\t});\n\t} else if (keyData.decryptors) {\n\t\tisPrivateKey = true;\n\t\tintKey = new Key(this, realid, keyData.decryptors, {\n\t\t\tpastProcessor: toPrivateKey(sjcl.ecc.elGamal, curve)\n\t\t});\n\t} else {\n\t\tintKey = new Key(this, realid, []);\n\t}\n\n\tif (fingerPrintPublicKey(publicKey) !== intKey.getRealidFingerPrint()) {\n\t\tthrow new errors.ValidationError(\"Fingerprint and Key id do not match\");\n\t}\n\n\tthis.getRealID = intKey.getRealID;\n\n\tif (isPrivateKey) {\n\t\tthis.decrypted = intKey.decrypted;\n\t\tthis.decryptKey = intKey.decryptKey;\n\n\t\tthis.getFastestDecryptor = intKey.getFastestDecryptor;\n\n\t\tthis.getDecryptorsF = intKey.getDecryptors;\n\n\t\tthis.addAsymDecryptor = intKey.addAsymDecryptor;\n\t\tthis.addSymDecryptor = intKey.addSymDecryptor;\n\t\tthis.addPWDecryptor = intKey.addPWDecryptor;\n\n\t\tthis.getUploadData = function (includeAllDecryptors) {\n\t\t\tvar p = publicKey._point, data = {\n\t\t\t\t\trealid: intKey.getRealID(),\n\t\t\t\t\tpoint: {\n\t\t\t\t\t\tx: chelper.bits2hex(p.x.toBits()),\n\t\t\t\t\t\ty: chelper.bits2hex(p.y.toBits())\n\t\t\t\t\t},\n\t\t\t\t\tcurve: chelper.getCurveName(publicKey._curve),\n\t\t\t\t\ttype: \"crypt\",\n\t\t\t\t\tdecryptors: this.getDecryptorData(includeAllDecryptors),\n\t\t\t\t\tcomment: comment\n\t\t\t\t};\n\n\t\t\treturn data;\n\t\t};\n\n\t\tthis.setComment = function setCommentF(theComment) {\n\t\t\tif (theComment) {\n\t\t\t\tcomment = theComment;\n\t\t\t}\n\t\t};\n\n\t\tthis.getDecryptorData = intKey.getDecryptorData;\n\t}\n\n\tfunction getFingerPrintF() {\n\t\treturn fingerPrintPublicKey(publicKey);\n\t}\n\n\tthis.getFingerPrint = getFingerPrintF;\n\n\t/** create a key\n\t* param callback callback\n\t*/\n\tthis.kem = function () {\n\t\tif (privateActionsBlocked) {\n\t\t\tthrow new errors.SecurityError(\"Private Actions are blocked (kem)\");\n\t\t}\n\n\t\tif (!isKeyUsableForEncryption(intKey.getRealID())) {\n\t\t\tthrow new errors.SecurityError(\"Key not usable for encryption: \" + intKey.getRealID());\n\t\t}\n\n\t\treturn Bluebird.try(function () {\n\t\t\treturn publicKey.kem();\n\t\t}).then(function (keyData) {\n\t\t\tvar resultKey = new SymKey(keyData.key);\n\t\t\tsymKeys[resultKey.getRealID()] = resultKey;\n\t\t\tnewKeys.push(resultKey);\n\t\t\tmakeKeyUsableForEncryption(resultKey.getRealID());\n\t\t\treturn resultKey.addAsymDecryptor(realid, keyData.tag).thenReturn(resultKey.getRealID());\n\t\t});\n\t};\n\n\tif (isPrivateKey) {\n\t\t/** unkem a key from a tag\n\t\t* @param tag the tag\n\t\t* @param callback callback\n\t\t*/\n\t\tthis.unkem = function (tag) {\n\t\t\treturn Bluebird.try(function () {\n\t\t\t\tif (!isPrivateKey) {\n\t\t\t\t\tthrow new Error(\"not a private key\");\n\t\t\t\t}\n\n\t\t\t\treturn intKey.decryptKey();\n\t\t\t}).then(function () {\n\t\t\t\tkeyStoreDebug(\"slow decrypt\");\n\n\t\t\t\treturn intKey.getSecret().unkem(tag);\n\t\t\t});\n\t\t};\n\t}\n};\n\n/** make a crypt key out of keydata */\nfunction makeCryptKey(keyData) {\n\tif (keyData && keyData.realid) {\n\t\tif (!cryptKeys[keyData.realid]) {\n\t\t\tvar key = new CryptKey(keyData);\n\t\t\tcryptKeys[keyData.realid] = key;\n\t\t}\n\n\t\treturn cryptKeys[keyData.realid];\n\t}\n}\n\n/** get a crypt key\n* @param realKeyID keys real id\n* @param callback callback\n*/\nCryptKey.get = function (realKeyID) {\n\treturn Bluebird.try(function () {\n\t\tif (!cryptKeys[realKeyID]) {\n\t\t\treturn getKey(realKeyID);\n\t\t}\n\t}).then(function () {\n\t\tif (cryptKeys[realKeyID]) {\n\t\t\treturn cryptKeys[realKeyID];\n\t\t}\n\n\t\tthrow new errors.InvalidDataError(\"keychain not found\");\n\t});\n};\n\n/** generate a crypt key\n* @param curve curve to use\n* @param callback callback\n*/\nCryptKey.generate = function (curve, comment) {\n\treturn waitForReady.async().then(function () {\n\t\tvar curveO = chelper.getCurve(curve), rawKey = sjcl.ecc.elGamal.generateKeys(curveO);\n\n\t\t/*jslint nomen: true*/\n\t\tvar p = rawKey.pub._point, data = {\n\t\t\t\tpoint: {\n\t\t\t\t\tx: chelper.bits2hex(p.x.toBits()),\n\t\t\t\t\ty: chelper.bits2hex(p.y.toBits())\n\t\t\t\t},\n\t\t\t\texponent: rawKey.sec._exponent.toBits(),\n\t\t\t\trealid: generateid(fingerPrintPublicKey(rawKey.pub)),\n\t\t\t\tcurve: chelper.getCurveName(rawKey.pub._curve),\n\t\t\t\tcomment: comment\n\t\t\t};\n\t\t/*jslint nomen: false*/\n\n\t\tvar key = makeCryptKey(data);\n\t\tnewKeys.push(key);\n\n\t\tkey.setComment(comment);\n\n\t\tmakeKeyUsableForEncryption(key.getRealID());\n\n\t\treturn key;\n\t});\n};\n\n/** a signature key\n* @param keyData sign key data\n*/\nSignKey = function (keyData) {\n\tvar publicKey, intKey, x, y, curve, point, realid, isPrivateKey = false, comment = \"\";\n\n\tif (!keyData || !keyData.point || !keyData.point.x || !keyData.point.y || !keyData.curve || !keyData.realid) {\n\t\tthrow new errors.InvalidDataError(\"invalid sign key data\");\n\t}\n\n\tcurve = chelper.getCurve(keyData.curve);\n\n\tx =\tcurve.field.fromBits(chelper.hex2bits(keyData.point.x));\n\ty = curve.field.fromBits(chelper.hex2bits(keyData.point.y));\n\tpoint = new sjcl.ecc.point(curve, x, y);\n\n\tpublicKey = new sjcl.ecc.ecdsa.publicKey(curve, point);\n\n\trealid = keyData.realid;\n\n\t//add exponent/decryptors\n\tif (keyData.exponent) {\n\t\tisPrivateKey = true;\n\n\t\tintKey = new Key(this, realid, keyData.decryptors, {\n\t\t\tsecret: keyData.exponent,\n\t\t\tpastProcessor: toPrivateKey(sjcl.ecc.ecdsa, curve)\n\t\t});\n\t} else if (keyData.decryptors) {\n\t\tisPrivateKey = true;\n\t\tintKey = new Key(this, realid, keyData.decryptors, {\n\t\t\tpastProcessor: toPrivateKey(sjcl.ecc.ecdsa, curve)\n\t\t});\n\t} else {\n\t\tintKey = new Key(this, realid, []);\n\t}\n\n\tif (fingerPrintPublicKey(publicKey) !== intKey.getRealidFingerPrint()) {\n\t\tthrow new errors.ValidationError(\"Fingerprint and Key id do not match\");\n\t}\n\n\tthis.getRealID = intKey.getRealID;\n\n\tthis.getJWKPublicKey = function () {\n\t\tvar p = publicKey._point;\n\n\t\treturn {\n\t\t\t\"crv\": \"P-256\",\n\t\t\t\"ext\": true,\n\t\t\t\"key_ops\":[\"verify\"],\n\t\t\t\"kty\": \"EC\",\n\t\t\t\"x\": keyStore.format.base64ToUrl(sjcl.codec.base64.fromBits(p.x.toBits())),\n\t\t\t\"y\": keyStore.format.base64ToUrl(sjcl.codec.base64.fromBits(p.y.toBits()))\n\t\t};\n\t};\n\n\tthis.getSubtlePublicKey = function () {\n\t\tif (!this._getSubtlePublicKeyPromise) {\n\t\t\tthis._getSubtlePublicKeyPromise = getSubtle().importKey(\"jwk\", this.getJWKPublicKey(), {\n\t\t\t\tname: \"ECDSA\",\n\t\t\t\tnamedCurve: \"P-256\"\n\t\t\t}, true, [\"verify\"]);\n\t\t}\n\n\t\treturn this._getSubtlePublicKeyPromise;\n\t};\n\n\t//add private key functions\n\tif (isPrivateKey) {\n\t\tthis.decrypted = intKey.decrypted;\n\t\tthis.decryptKey = intKey.decryptKey;\n\n\t\tthis.getRealID = intKey.getRealID;\n\t\tthis.getDecryptorsF = intKey.getDecryptors;\n\n\t\tthis.addAsymDecryptor = intKey.addAsymDecryptor;\n\t\tthis.addSymDecryptor = intKey.addSymDecryptor;\n\t\tthis.addPWDecryptor = intKey.addPWDecryptor;\n\n\t\tthis.getUploadData = function (includeAllDecryptors) {\n\t\t\tvar p = publicKey._point, data = {\n\t\t\t\t\trealid: intKey.getRealID(),\n\t\t\t\t\tpoint: {\n\t\t\t\t\t\tx: chelper.bits2hex(p.x.toBits()),\n\t\t\t\t\t\ty: chelper.bits2hex(p.y.toBits())\n\t\t\t\t\t},\n\t\t\t\t\tcurve: chelper.getCurveName(publicKey._curve),\n\t\t\t\t\ttype: \"sign\",\n\t\t\t\t\tdecryptors: this.getDecryptorData(includeAllDecryptors),\n\t\t\t\t\tcomment: comment\n\t\t\t\t};\n\n\t\t\treturn data;\n\t\t};\n\n\t\tthis.getDecryptorData = intKey.getDecryptorData;\n\n\t\tthis.setComment = function setCommentF(theComment) {\n\t\t\tif (theComment) {\n\t\t\t\tcomment = theComment;\n\t\t\t}\n\t\t};\n\t}\n\n\tfunction getFingerPrintF() {\n\t\treturn fingerPrintPublicKey(publicKey);\n\t}\n\n\tvar theKey = this;\n\n\tfunction subtleVerify(key, signatureBuf, buf) {\n\t\treturn getSubtle().verify({\n\t\t\tname: \"ECDSA\",\n\t\t\tnamedCurve: \"P-256\",\n\t\t\thash: \"SHA-256\"\n\t\t}, key.publicKey, signatureBuf, buf);\n\t}\n\n\tif (isPrivateKey) {\n\t\tthis.sign = function (hash, type) {\n\t\t\tif (privateActionsBlocked) {\n\t\t\t\tthrow new errors.SecurityError(\"Private Actions are blocked (sign)\");\n\t\t\t}\n\n\t\t\tvar trustManager = require(\"./trustManager\");\n\t\t\tvar signatureCache = require(\"./signatureCache\");\n\n\t\t\treturn Bluebird.try(function () {\n\t\t\t\tif (!trustManager.isLoaded) {\n\t\t\t\t\treturn trustManager.listenPromise(\"loaded\");\n\t\t\t\t}\n\t\t\t}).then(function () {\n\t\t\t\tif (!trustManager.hasKeyData(intKey.getRealID())) {\n\t\t\t\t\tkeyStoreDebug(\"key not in key database\");\n\t\t\t\t\talert(\"key not in key database: \" + intKey.getRealID() + \" - please report this issue to feedback@whispeer.de!\");\n\t\t\t\t\tthrow new errors.SecurityError(\"key not in key database\");\n\t\t\t\t}\n\n\t\t\t\treturn intKey.decryptKey();\n\t\t\t}).then(function () {\n\t\t\t\treturn intKey.getSecret().sign(hash);\n\t\t\t\t//return sjclWorkerInclude.asym.sign(intKey.getSecret(), hash).nodeify(this);\n\t\t\t}).then(function (signature) {\n\t\t\t\tif (signatureCache.isLoaded()) {\n\t\t\t\t\tsignatureCache.addValidSignature(signature, hash, realid, type);\n\t\t\t\t}\n\n\t\t\t\treturn signature;\n\t\t\t});\n\t\t};\n\t}\n\n\tfunction verifySjcl(signature, hash) {\n\t\tif (sjclWarning) {\n\t\t\tkeyStoreDebug(\"Verifying with sjcl\");\n\t\t\tsjclWarning = false;\n\t\t}\n\t\tif (firstVerify) {\n\t\t\tfirstVerify = false;\n\t\t\treturn Bluebird.resolve(publicKey.verify(hash, signature));\n\t\t}\n\n\t\treturn sjclWorkerInclude.asym.verify(publicKey, signature, hash);\n\t}\n\n\tfunction verifySubtle(signature, text) {\n\t\treturn Bluebird.try(function () {\n\t\t\treturn theKey.getSubtlePublicKey();\n\t\t}).then(function (key) {\n\t\t\tvar signatureBuf = sjcl.codec.arrayBuffer.fromBits(signature);\n\t\t\tvar buf = new TextEncoder(\"utf-8\").encode(text);\n\n\t\t\treturn subtleVerify({ publicKey: key }, signatureBuf, buf);\n\t\t});\n\t}\n\n\tfunction verify(signature, text, hash) {\n\t\tif (!getSubtle()) {\n\t\t\treturn verifySjcl(signature, hash);\n\t\t}\n\n\t\treturn verifySubtle(signature, text).then(function (valid) {\n\t\t\tif (!valid) {\n\t\t\t\treturn verifySjcl(signature, hash);\n\t\t\t}\n\n\t\t\treturn valid;\n\t\t}).catch(function (e) {\n\t\t\tif (sjclWarning) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t\treturn verifySjcl(signature, hash);\n\t\t});\n\t}\n\n\tfunction subtleToHex(buffer) {\n\t\tvar hexCodes = [];\n\t\tvar view = new DataView(buffer);\n\t\tfor (var i = 0; i < view.byteLength; i += 4) {\n\t\t\t// Using getUint32 reduces the number of iterations needed (we process 4 bytes each time)\n\t\t\tvar value = view.getUint32(i);\n\t\t\t// toString(16) will give the hex representation of the number without padding\n\t\t\tvar stringValue = value.toString(16);\n\t\t\t// We use concatenation and slice for padding\n\t\t\tvar padding = \"00000000\";\n\t\t\tvar paddedValue = (padding + stringValue).slice(-padding.length);\n\t\t\thexCodes.push(paddedValue);\n\t\t}\n\n\t\t// Join all the hex strings into one\n\t\treturn hexCodes.join(\"\");\n\t}\n\n\tfunction hash(text) {\n\t\treturn Bluebird.resolve(text).then(function () {\n\t\t\tif (!getSubtle()) {\n\t\t\t\tthrow new Error(\"subtle not available\");\n\t\t\t}\n\n\t\t\tvar buf = new TextEncoder(\"utf-8\").encode(text);\n\t\t\treturn getSubtle().digest(\"SHA-256\", buf);\n\t\t}).then(function (hash) {\n\t\t\treturn subtleToHex(hash);\n\t\t}).catch(function () {\n\t\t\tkeyStoreDebug(\"Subtle hashing failed falling back to sjcl\");\n\t\t\treturn sjcl.hash.sha256.hash(text);\n\t\t});\n\t}\n\n\tthis.getFingerPrint = getFingerPrintF;\n\tthis.verify = function (signature, text, type, id) {\n\t\tvar trustManager = require(\"./trustManager\");\n\t\tvar signatureCache = require(\"./signatureCache\");\n\t\tvar name = chelper.bits2hex(signature).substr(0, 10);\n\n\t\tif (debug.enabled(\"whispeer:keyStore\")) {\n\t\t\tconsole.time(`verify-${name}-${type}`);\n\t\t}\n\n\t\treturn hash(text).then(function (hash) {\n\t\t\thash = chelper.hex2bits(hash);\n\n\t\t\tif (!trustManager.hasKeyData(intKey.getRealID())) {\n\t\t\t\tthrow new errors.SecurityError(\"key not in key database\");\n\t\t\t}\n\n\t\t\tif (signatureCache.isValidSignatureInCache(signature, hash, realid)) {\n\t\t\t\tsignatureCache.addValidSignature(signature, hash, realid, type, id);\n\t\t\t\treturn Bluebird.resolve(true);\n\t\t\t}\n\n\t\t\tkeyStoreDebug(\"Slow verify of type: \" + type);\n\n\t\t\treturn verify(signature, text, hash).then(function (valid) {\n\t\t\t\tif (valid) {\n\t\t\t\t\tsignatureCache.addValidSignature(signature, hash, realid, type, id);\n\t\t\t\t}\n\n\t\t\t\treturn valid;\n\t\t\t}).catch(function (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}).finally(() => {\n\t\t\tif (debug.enabled(\"whispeer:keyStore\")) {\n\t\t\t\tconsole.timeEnd(`verify-${name}-${type}`);\n\t\t\t}\n\t\t})\n\t};\n};\n\n/** make a sign key out of keydata */\nfunction makeSignKey(keyData) {\n\tif (keyData && keyData.realid) {\n\t\tif (!signKeys[keyData.realid]) {\n\t\t\tvar key = new SignKey(keyData);\n\t\t\tsignKeys[keyData.realid] = key;\n\t\t}\n\n\t\treturn signKeys[keyData.realid];\n\t}\n}\n\n/** get a signature key\n* @param realKeyID the real id of the sign key\n* @param callback callback\n*/\nSignKey.get = function signKeyGet(realKeyID) {\n\tif (signKeys[realKeyID]) {\n\t\treturn Bluebird.resolve(signKeys[realKeyID])\n\t}\n\n\treturn getKey(realKeyID).then(function () {\n\t\tif (signKeys[realKeyID]) {\n\t\t\treturn signKeys[realKeyID];\n\t\t}\n\n\t\tthrow new errors.InvalidDataError(\"keychain not found (sign)\");\n\t});\n};\n\n/** generate a sign key\n* @param curve curve for the key\n* @param callback callback\n*/\nSignKey.generate = function (curve, comment) {\n\treturn waitForReady.async().then(function () {\n\t\tvar curveO = chelper.getCurve(curve), rawKey = sjcl.ecc.ecdsa.generateKeys(curveO);\n\n\t\t/*jslint nomen: true*/\n\t\tvar p = rawKey.pub._point, data = {\n\t\t\t\tpoint: {\n\t\t\t\t\tx: chelper.bits2hex(p.x.toBits()),\n\t\t\t\t\ty: chelper.bits2hex(p.y.toBits())\n\t\t\t\t},\n\t\t\t\texponent: rawKey.sec._exponent.toBits(),\n\t\t\t\trealid: generateid(fingerPrintPublicKey(rawKey.pub)),\n\t\t\t\tcurve: chelper.getCurveName(rawKey.pub._curve)\n\t\t\t};\n\t\t/*jslint nomen: false*/\n\n\t\tvar key = makeSignKey(data);\n\t\tnewKeys.push(key);\n\n\t\tkey.setComment(comment);\n\n\t\treturn key;\n\t});\n};\n\n/** make a key out of keyData. mainly checks type and calls appropriate function */\nmakeKey = function makeKeyF(key) {\n\tif (key.type === \"sym\") {\n\t\tmakeSymKey(key);\n\t} else if (key.type === \"crypt\") {\n\t\tmakeCryptKey(key);\n\t} else if (key.type === \"sign\") {\n\t\tmakeSignKey(key);\n\t} else {\n\t\tthrow new errors.InvalidDataError(\"unknown key type\");\n\t}\n};\n\nvar verifyAllAttributesAreHashes = function (data) {\n\tvar attr;\n\tfor (attr in data) {\n\t\tif (data.hasOwnProperty(attr)) {\n\t\t\tif (typeof data === \"object\") {\n\t\t\t\tverifyAllAttributesAreHashes(data[attr]);\n\t\t\t} else if (typeof data !== \"string\" || data.substr(0, 6) !== \"hash\") {\n\t\t\t\tthrow new errors.ValidationError(\"invalid hashobject\");\n\t\t\t}\n\t\t}\n\t}\n};\n\nvar ObjectPadder = function (obj, minLength) {\n\tthis._obj = obj;\n\tthis._minLength = minLength;\n};\n\nObjectPadder.prototype._padObject = function (val) {\n\treturn Bluebird.props(h.objectMap(val, function (value) {\n\t\tvar padder = new ObjectPadder(value, this._minLength);\n\t\treturn padder.pad();\n\t}, this));\n};\n\nObjectPadder.prototype._padArray = function (val) {\n\treturn Bluebird.resolve(val).bind(this).map(function (value) {\n\t\tvar padder = new ObjectPadder(value, this._minLength);\n\t\treturn padder.pad();\n\t});\n};\n\nObjectPadder.prototype._padString = function (val) {\n\tvar length = this._minLength - (val.length % this._minLength) + this._minLength;\n\n\treturn Bluebird.try(function () {\n\t\treturn keyStore.random.hex(length);\n\t}).then(function (rand) {\n\t\treturn rand + \"::\" + val;\n\t});\n};\n\nObjectPadder.prototype._padNumber = function (val) {\n\treturn this._padString(val.toString()).then(function (padded) {\n\t\treturn \"num::\" + padded;\n\t});\n};\n\nObjectPadder.prototype._padAttribute = function (attr) {\n\tvar type = typeof attr;\n\tif (type === \"object\") {\n\t\tif (attr instanceof Array) {\n\t\t\treturn this._padArray(attr);\n\t\t}\n\n\t\treturn this._padObject(attr);\n\t} else if (type === \"string\") {\n\t\treturn this._padString(attr);\n\t} else if (type === \"number\") {\n\t\treturn this._padNumber(attr);\n\t} else if (type === \"boolean\") {\n\t\treturn this._padNumber((attr ? 1 : 0));\n\t}\n\n\tthrow new errors.InvalidDataError(\"could not pad value of type \" + type);\n};\n\nObjectPadder.prototype.pad = function () {\n\treturn this._padAttribute(this._obj);\n};\n\nObjectPadder.prototype._unpadObject = function (val) {\n\tvar attr, result = {};\n\tfor (attr in val) {\n\t\tif (val.hasOwnProperty(attr)) {\n\t\t\tvar padder = new ObjectPadder(val[attr], this._minLength);\n\t\t\tresult[attr] = padder.unpad();\n\t\t}\n\t}\n\n\treturn result;\n};\n\nObjectPadder.prototype._unpadString = function (val) {\n\tvar isNumber = false;\n\n\tif (val.indexOf(\"num::\") === 0) {\n\t\tisNumber = true;\n\n\t\tval = val.substr(5);\n\t}\n\n\tif (val.length%this._minLength !== 2) {\n\t\tthrow new errors.InvalidDataError(\"padding size invalid\");\n\t}\n\n\tvar paddingIndex = val.indexOf(\"::\");\n\n\tif (paddingIndex === -1) {\n\t\tthrow new errors.InvalidDataError(\"no padding seperator found\");\n\t}\n\n\tvar unpadded = val.substr(paddingIndex + 2);\n\n\tif (isNumber) {\n\t\treturn parseFloat(unpadded);\n\t}\n\n\treturn unpadded;\n};\n\nObjectPadder.prototype._unpadArray = function (val) {\n\tvar result = [], i;\n\tfor (i = 0; i < val.length; i += 1) {\n\t\tvar padder = new ObjectPadder(val[i], this._minLength);\n\t\tresult[i] = padder.unpad();\n\t}\n\n\treturn result;\n};\n\nObjectPadder.prototype._unpadAttribute = function (attr) {\n\tvar type = typeof attr;\n\tif (type === \"object\") {\n\t\tif (attr instanceof Array) {\n\t\t\treturn this._unpadArray(attr);\n\t\t\t//TODO!\n\t\t} else {\n\t\t\treturn this._unpadObject(attr);\n\t\t}\n\t} else if (type === \"string\") {\n\t\treturn this._unpadString(attr);\n\t} else {\n\t\tthrow new errors.InvalidDataError(\"could not pad value of type \" + type);\n\t}\n};\n\nObjectPadder.prototype.unpad = function () {\n\treturn this._unpadAttribute(this._obj);\n};\n\nvar ObjectCryptor = function (key, depth, object) {\n\tthis._key = key;\n\tthis._depth = depth;\n\tthis._object = object;\n};\n\nObjectCryptor.prototype._encryptAttr = function (cur) {\n\tif (typeof cur === \"object\") {\n\t\treturn new ObjectCryptor(this._key, this._depth-1, cur).encrypt();\n\t} else if (typeof cur === \"string\" || typeof cur === \"number\" || typeof cur === \"boolean\") {\n\t\treturn this._key.encryptWithPrefix(\"data::\", cur.toString());\n\t}\n\n\tthrow new errors.InvalidDataError(\"Invalid encrypt!\");\n};\n\nObjectCryptor.prototype._encryptObject = function () {\n\treturn Bluebird.props(h.objectMap(this._object, function (value, attr) {\n\t\tif (attr !== \"key\") {\n\t\t\treturn this._encryptAttr(value);\n\t\t}\n\t}, this));\n};\n\nObjectCryptor.prototype._encryptJSON = function () {\n\treturn this._key.encryptWithPrefix(\"json::\", JSON.stringify(this._object));\n};\n\nObjectCryptor.prototype.encrypt = function () {\n\tif (this._depth > 0) {\n\t\treturn this._encryptObject();\n\t} else {\n\t\treturn this._encryptJSON();\n\t}\n};\n\nObjectCryptor.prototype.decryptCorrectObject = function (obj) {\n\tif (typeof obj === \"object\" && !(obj instanceof Array)) {\n\t\treturn obj;\n\t} else {\n\t\tobj = sjcl.codec.utf8String.fromBits(obj);\n\n\t\tvar prefix = obj.substr(0, 6);\n\t\tvar content = obj.substr(6);\n\n\t\tif (prefix === \"data::\") {\n\t\t\treturn content;\n\t\t} else if (prefix === \"json::\") {\n\t\t\treturn JSON.parse(content);\n\t\t} else {\n\t\t\tthrow new errors.ValidationError();\n\t\t}\n\t}\n};\n\nObjectCryptor.prototype._decryptEndAttribute = function () {\n\treturn this._key.decrypt(this._object).bind(this).then(function (result) {\n\t\treturn this.decryptCorrectObject(result);\n\t});\n};\n\nObjectCryptor.prototype._decryptPartialObjects = function () {\n\treturn Bluebird.props(h.objectMap(this._object, function (value, attr) {\n\t\tif (attr !== \"key\") {\n\t\t\treturn new ObjectCryptor(this._key, this._depth-1, value).decrypt();\n\t\t}\n\t}, this));\n};\n\nObjectCryptor.prototype.decrypt = function () {\n\tif (this._depth < 0) {\n\t\tthrow new errors.DecryptionError(\"invalid decryption depth!\");\n\t}\n\n\tif (this._object.iv && this._object.ct) {\n\t\treturn this._decryptEndAttribute();\n\t} else {\n\t\treturn this._decryptPartialObjects();\n\t}\n};\n\n/** our interface */\nkeyStore = {\n\treset: function reset() {\n\t\trecovery = false;\n\t\tdirtyKeys = [];\n\t\tnewKeys = [];\n\n\t\tkeyGenIdentifier = \"\";\n\n\t\tsymKeys = {};\n\t\tcryptKeys = {};\n\t\tsignKeys = {};\n\n\t\tmainKey = undefined;\n\n\t\tpassword = \"\";\n\t\tkeysUsableForEncryption = [];\n\t\tfirstVerify = true;\n\t},\n\n\tsetKeyGenIdentifier: function (identifier) {\n\t\tkeyGenIdentifier = identifier;\n\t\t//TODO: update all key identifiers for all keys.\n\t},\n\n\tgetKeyGenIdentifier: function () {\n\t\treturn keyGenIdentifier;\n\t},\n\n\tcorrectKeyIdentifier: function correctKeyIdentifierF(realid) {\n\t\treturn correctKeyIdentifier(realid);\n\t},\n\n\taddImprovementListener: function (listener) {\n\t\timprovementListener.push(listener);\n\t},\n\n\tsecurity: {\n\t\tblockPrivateActions: function () {\n\t\t\tprivateActionsBlocked = true;\n\t\t},\n\n\t\tallowPrivateActions: function () {\n\t\t\tprivateActionsBlocked = false;\n\t\t},\n\n\t\tarePrivateActionsBlocked: function () {\n\t\t\treturn privateActionsBlocked;\n\t\t},\n\n\t\taddEncryptionIdentifier: function (realid) {\n\t\t\tmakeKeyUsableForEncryption(realid);\n\t\t},\n\n\t\tsetPassword: function (pw) {\n\t\t\trecovery = false;\n\t\t\tpassword = pw;\n\t\t},\n\n\t\tverifyWithPW: function (data, expectedResult) {\n\t\t\tif (!recovery) {\n\t\t\t\t//decrypt data with pw\n\t\t\t\tvar result = sjcl.decrypt(password, chelper.Object2sjclPacket(data));\n\t\t\t\t//unpad data\n\t\t\t\tresult = new ObjectPadder(JSON.parse(result), 128).unpad();\n\n\t\t\t\t//check with expectedresult\n\t\t\t\tif (!h.deepEqual(expectedResult, result)) {\n\t\t\t\t\tthrow new errors.SecurityError(\"verify with pw failed\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tmakePWVerifiable: function (data, pw, cb) {\n\t\t\treturn new ObjectPadder(data, 128).pad().then(function (paddedData) {\n\t\t\t\treturn encryptPW(pw, JSON.stringify(paddedData));\n\t\t\t}).nodeify(cb);\n\t\t}\n\t},\n\n\tformat: {\n\t\turlToBase64: function(str) {\n\t\t\treturn str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n\t\t},\n\t\tbase64ToUrl: function(str) {\n\t\t\treturn str.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=/g, \"\");\n\t\t},\n\t\tbase64ToBits: function (base64) {\n\t\t\treturn sjcl.codec.base64.toBits(base64);\n\t\t},\n\t\tbitsToBase64: function (bits) {\n\t\t\treturn sjcl.codec.base64.fromBits(bits);\n\t\t},\n\t\tfingerPrint: function (keyID) {\n\t\t\tvar hex = keyID.split(\":\")[1];\n\t\t\treturn sjcl.codec.base32.fromBits(sjcl.codec.hex.toBits(hex)).toUpperCase();\n\t\t},\n\t\tbase32: function (bits) {\n\t\t\treturn sjcl.codec.base32.fromBits(bits);\n\t\t},\n\t\tunBase32: function (bits) {\n\t\t\treturn sjcl.codec.base32.toBits(bits);\n\t\t},\n\t\tunformat: function (str, start) {\n\t\t\tif (str.indexOf(start + \"::\") !== 0) {\n\t\t\t\tthrow new errors.InvalidDataError(\"format invalid\");\n\t\t\t}\n\n\t\t\treturn str.substr(start.length + 2);\n\t\t}\n\t},\n\n\thash: {\n\t\taddPaddingToObject: function (obj, minLength) {\n\t\t\tminLength = minLength || 128;\n\n\t\t\treturn new ObjectPadder(obj, minLength).pad();\n\t\t},\n\t\tremovePaddingFromObject: function (obj, padLength) {\n\t\t\tpadLength = padLength || 128;\n\t\t\treturn new ObjectPadder(obj, padLength).unpad();\n\t\t},\n\t\thash: function (text) {\n\t\t\treturn chelper.hash(text);\n\t\t},\n\n\t\thashArrayBuffer: function (buf) {\n\t\t\treturn Bluebird.try(() => {\n\t\t\t\treturn getSubtle().digest(\"SHA-256\", buf)\n\t\t\t}).then((bufHash) => {\n\t\t\t\treturn bufferToHex(bufHash)\n\t\t\t}).catch(() => {\n\t\t\t\treturn sjclWorkerInclude.hash(buf);\n\t\t\t})\n\t\t},\n\n\t\thashPW: function (pw, salt) {\n\t\t\treturn chelper.hashPW(pw, salt);\n\t\t},\n\n\t\thashObjectOrValueHexAsync: function (val, version) {\n\t\t\treturn Bluebird.try(function () {\n\t\t\t\tif (typeof val === \"object\") {\n\t\t\t\t\treturn sjclWorkerInclude.stringify(val, version, true);\n\t\t\t\t} else {\n\t\t\t\t\treturn sjcl.hash.sha256.hash(\"data::\" + val);\n\t\t\t\t}\n\t\t\t}).then(function (value) {\n\t\t\t\treturn chelper.bits2hex(value);\n\t\t\t}).then(function (hash) {\n\t\t\t\treturn \"hash::\" + hash;\n\t\t\t});\n\t\t},\n\n\t\thashObjectOrValueHex: function (val, version) {\n\t\t\tif (typeof val === \"object\") {\n\t\t\t\treturn \"hash::\" + new ObjectHasher(val, version).hash();\n\t\t\t} else {\n\t\t\t\treturn \"hash::\" + chelper.bits2hex(sjcl.hash.sha256.hash(\"data::\" + val));\n\t\t\t}\n\t\t}\n\t},\n\n\tupload: {\n\t\tpreLoadMultiple: function (realids, cb) {\n\t\t\treturn Bluebird.resolve(realids).map(function (realid) {\n\t\t\t\treturn getKey(realid);\n\t\t\t}).nodeify(cb);\n\t\t},\n\t\tisKeyLoaded: function (realid) {\n\t\t\treturn symKeys.hasOwnProperty(realid) || cryptKeys.hasOwnProperty(realid) || signKeys.hasOwnProperty(realid);\n\t\t},\n\t\taddKey: function (keyData) {\n\t\t\tif (h.isRealID(keyData.realid)) {\n\t\t\t\tmakeKey(keyData);\n\t\t\t}\n\n\t\t\treturn keyData.realid;\n\t\t},\n\t\tgetKeyAccessCount: function (keyrealid) {\n\t\t\tvar key = symKeys[keyrealid];\n\t\t\tif (key) {\n\t\t\t\treturn key.getAccessCount();\n\t\t\t}\n\n\t\t\treturn -1;\n\t\t},\n\t\tsetKeyGet: function (_keyGetFunction) {\n\t\t\tkeyGetFunction = _keyGetFunction;\n\t\t},\n\t\tgetExistingKey: function (keyid) {\n\t\t\tif (!keyStore.upload.isKeyLoaded(keyid)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar key = symKeys[keyid] || cryptKeys[keyid] || signKeys[keyid];\n\t\t\treturn key.getUploadData(true);\n\t\t},\n\t\tgetKey: function (keyid) {\n\t\t\tvar i;\n\t\t\tfor (i = 0; i < newKeys.length; i += 1) {\n\t\t\t\tif (keyid === newKeys[i].getRealID()) {\n\t\t\t\t\treturn newKeys[i].getUploadData();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgetKeys: function (keys) {\n\t\t\tvar addKeys = [];\n\t\t\tvar i;\n\t\t\tfor (i = 0; i < newKeys.length; i += 1) {\n\t\t\t\tif (keys.indexOf(newKeys[i].getRealID()) > -1) {\n\t\t\t\t\taddKeys.push(newKeys[i].getUploadData());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn addKeys;\n\t\t},\n\t\tgetDecryptors: function (allowed, allowedEncryptors) {\n\t\t\tvar addKeyDecryptors = {};\n\n\t\t\tdirtyKeys.filter(function (key) {\n\t\t\t\treturn allowed.indexOf(key.getRealID()) !== -1;\n\t\t\t}).forEach(function (key) {\n\t\t\t\tvar decryptors = key.getDecryptorData();\n\n\t\t\t\tif (allowedEncryptors) {\n\t\t\t\t\tdecryptors = decryptors.filter(function (decryptor) {\n\t\t\t\t\t\treturn allowedEncryptors.indexOf(decryptor.decryptorid) !== -1;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\taddKeyDecryptors[key.getRealID()] = decryptors;\n\t\t\t});\n\n\t\t\treturn addKeyDecryptors;\n\t\t},\n\t\tuploaded: function (data) {\n\t\t\t/*\n\t\t\t{\n\t\t\t\tkeys: {\n\t\t\t\t\trealid1: realid1,\n\t\t\t\t\trealid2: realid2,\n\t\t\t\t\trealid3: realid3,\n\t\t\t\t\t...\n\t\t\t\t},\n\t\t\t\tdecryptors: {\n\t\t\t\t\trealid1: data\n\t\t\t\t}\n\t\t\t}\n\t\t\t*/\n\t\t\tvar realid;\n\t\t\tfor (realid in data.decryptors) {\n\t\t\t\tif (data.decryptors.hasOwnProperty(realid)) {\n\t\t\t\t\tgetKey(realid).removeDirty(data.decryptors[realid]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar remainedKeys = [];\n\n\t\t\tvar i;\n\t\t\tfor (i = 0; i < newKeys.length; i += 1) {\n\t\t\t\trealid = newKeys[i].getRealID();\n\n\t\t\t\tif (!data.keys[realid]) {\n\t\t\t\t\tremainedKeys.push(newKeys[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnewKeys = remainedKeys;\n\t\t}\n\t},\n\n\trandom: {\n\t\thex: function (length, cb) {\n\t\t\treturn waitForReady.async().then(function () {\n\t\t\t\tvar res = chelper.bits2hex(sjcl.random.randomWords(Math.ceil(length/8)));\n\t\t\t\treturn res.substr(0, length);\n\t\t\t}).nodeify(cb);\n\t\t},\n\t\twords: function (number, cb) {\n\t\t\treturn waitForReady.async().then(function () {\n\t\t\t\treturn sjcl.random.randomWords(number);\n\t\t\t}).nodeify(cb);\n\t\t}\n\t},\n\n\tsym: {\n\t\tregisterMainKey: function (_mainKey) {\n\t\t\tmainKey = _mainKey;\n\t\t},\n\n\t\t/** generate a key\n\t\t* @param callback callback\n\t\t*/\n\t\tgenerateKey: function generateKeyF(callback, comment) {\n\t\t\treturn waitForReady.async().then(function () {\n\t\t\t\treturn SymKey.generate(comment);\n\t\t\t}).then(function (key) {\n\t\t\t\treturn key.getRealID();\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\tcreateBackupKey: function (realID, callback) {\n\t\t\t/* two keys: key1 -> key2 -> main\n\t\t\t* key2 is on the server\n\t\t\t* key1 is downloaded/printed\n\t\t\t* server never distributes key2 except when advised to do so (manually for now!)\n\t\t\t*/\n\t\t\tvar backupKey, outerBackupKey, toBackupKey;\n\n\t\t\treturn waitForReady.async().then(function () {\n\t\t\t\treturn SymKey.get(realID);\n\t\t\t}).then(function (_toBackupKey) {\n\t\t\t\ttoBackupKey = _toBackupKey;\n\t\t\t\touterBackupKey = sjcl.random.randomWords(8);\n\t\t\t\tbackupKey = new SymKey(sjcl.random.randomWords(8));\n\n\t\t\t\tmakeKeyUsableForEncryption(backupKey.getRealID());\n\t\t\t\tmakeKeyUsableForEncryption(new SymKey(outerBackupKey).getRealID());\n\n\t\t\t\treturn Bluebird.all([\n\t\t\t\t\ttoBackupKey.addSymDecryptor(backupKey),\n\t\t\t\t\tbackupKey.addSymDecryptor(new SymKey(outerBackupKey))\n\t\t\t\t]);\n\t\t\t}).then(function () {\n\t\t\t\tvar decryptorsAdded = keyStore.upload.getDecryptors([toBackupKey.getRealID()], [backupKey.getRealID()]);\n\t\t\t\tvar backupKeyData = backupKey.getUploadData();\n\n\t\t\t\tbackupKeyData.decryptors[0].type = \"backup\";\n\n\t\t\t\treturn {\n\t\t\t\t\tdecryptors: decryptorsAdded,\n\t\t\t\t\tinnerKey: backupKeyData,\n\t\t\t\t\touterKey: outerBackupKey\n\t\t\t\t};\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\tloadBackupKey: function (outerBackupKey) {\n\t\t\tvar key = new SymKey(outerBackupKey);\n\t\t\tif (!symKeys[key.getRealID()]) {\n\t\t\t\tsymKeys[key.getRealID()] = key;\n\t\t\t} else {\n\t\t\t\tthrow new errors.SecurityError(\"Key already exists in symKey database (double add?)\");\n\t\t\t}\n\n\t\t\trecovery = true;\n\n\t\t\treturn key.getRealID();\n\t\t},\n\n\t\t/** encrypt key with sym key\n\t\t* @param realID key to encrypt\n\t\t* @param parentKeyID key to encrypt with\n\t\t* @param callback callback\n\t\t*/\n\t\tsymEncryptKey: function symEncryptKeyF(realID, parentKeyID, callback) {\n\t\t\treturn SymKey.get(realID).then(function (key) {\n\t\t\t\treturn key.addSymDecryptor(parentKeyID);\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\t/** encrypt this key with an asymmetric key\n\t\t* @param realID key to encrypt\n\t\t* @param parentKeyID key to encrypt with\n\t\t* @param callback callback\n\t\t*/\n\t\tasymEncryptKey: function asymEncryptKeyF(realID, parentKeyID, callback) {\n\t\t\t//ensure the key exists first!\n\t\t\treturn SymKey.get(realID).then(function () {\n\t\t\t\treturn CryptKey.get(parentKeyID);\n\t\t\t}).then(function (key) {\n\t\t\t\treturn key.kem();\n\t\t\t}).then(function (parentRealID) {\n\t\t\t\treturn keyStore.sym.symEncryptKey(realID, parentRealID);\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\t/** encrypt key with password\n\t\t* @param realID key to encrypt\n\t\t* @param password password to encrypt with\n\t\t* @param callback callback\n\t\t*/\n\t\tpwEncryptKey: function pwEncryptKeyF(realID, password, callback) {\n\t\t\treturn SymKey.get(realID).then(function (key) {\n\t\t\t\treturn key.addPWDecryptor(password);\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\t/** encrypt text with this key.\n\t\t* @param text text to encrypt\n\t\t* @param realKeyID key to encrypt with\n\t\t* @param callback callback\n\t\t*/\n\t\tencryptText: function (text, realKeyID, callback) {\n\t\t\treturn SymKey.get(realKeyID).then(function (key) {\n\t\t\t\treturn key.encryptWithPrefix(\"data::\", text);\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\t/** encrypt an object\n\t\t* @param object Object to encrypt\n\t\t* @param realKeyID key to encrypt with\n\t\t* @param callback callback\n\t\t*/\n\t\tencryptObject: function (object, realKeyID, depth, callback) {\n\t\t\tif (object.iv) {\n\t\t\t\tthrow new errors.InvalidDataError(\"IV already set.\");\n\t\t\t}\n\n\t\t\treturn SymKey.get(realKeyID).then(function (key) {\n\t\t\t\treturn new ObjectCryptor(key, depth, object).encrypt();\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\tdecryptObject: function (cobject, depth, callback, keyID) {\n\t\t\treturn SymKey.get(keyID || mainKey).then(function (key) {\n\t\t\t\treturn new ObjectCryptor(key, depth, cobject).decrypt();\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\t/** decrypt an encrypted text\n\t\t* @param ctext text to decrypt\n\t\t* @param realKeyID key to decrypt with\n\t\t* @param callback callback\n\t\t*/\n\t\tdecryptText: function (ctext, realKeyID, callback) {\n\t\t\treturn SymKey.get(realKeyID).then(function (key) {\n\t\t\t\treturn key.decrypt(ctext);\n\t\t\t}).then(function (decryptedData) {\n\t\t\t\treturn sjcl.codec.utf8String.fromBits(removeExpectedPrefix(decryptedData, \"data::\"));\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\tencryptArrayBuffer: function (buf, realKeyID, progressCallback) {\n\t\t\treturn SymKey.get(realKeyID).then(function (key) {\n\t\t\t\treturn key.encryptWithPrefix(\"buf::\", buf, progressCallback, true);\n\t\t\t}).then(function (result) {\n\t\t\t\tresult.iv = sjcl.codec.arrayBuffer.fromBits(result.iv, false);\n\t\t\t\tresult.ct.tag = sjcl.codec.arrayBuffer.fromBits(result.ct.tag, false);\n\t\t\t\treturn h.concatBuffers(result.iv, result.ct.ciphertext_buffer, result.ct.tag);\n\t\t\t});\n\t\t},\n\n\t\tdecryptArrayBuffer: function (buf, realKeyID, progressCallback) {\n\t\t\treturn SymKey.get(realKeyID).then(function (key) {\n\t\t\t\tvar buf32 = new Uint32Array(buf);\n\n\t\t\t\tvar decr = {\n\t\t\t\t\tiv: sjcl.codec.arrayBuffer.toBits(new Uint32Array(buf32.subarray(0, 4)).buffer),\n\t\t\t\t\tct: new Uint32Array(buf32.subarray(4, buf32.byteLength/4-2)).buffer,\n\t\t\t\t\ttag: sjcl.codec.arrayBuffer.toBits(new Uint32Array(buf32.subarray(buf32.byteLength/4-2)).buffer)\n\t\t\t\t};\n\n\t\t\t\treturn key.decrypt(decr, null, progressCallback);\n\t\t\t}).then(function (decryptedData) {\n\t\t\t\treturn removeExpectedPrefix(decryptedData, \"buf::\");\n\t\t\t});\n\t\t},\n\n\t\tdecryptBigBase64: function (bin, realKeyID, callback) {\n\t\t\treturn SymKey.get(realKeyID).then(function (key) {\n\t\t\t\tbin = sjcl.codec.base64.toBits(bin);\n\n\t\t\t\tvar decr = {\n\t\t\t\t\tiv: sjcl.bitArray.bitSlice(bin, 0, 32*4),\n\t\t\t\t\tct: sjcl.bitArray.bitSlice(bin, 32*4)\n\t\t\t\t};\n\n\t\t\t\treturn key.decrypt(decr);\n\t\t\t}).then(function (decryptedData) {\n\t\t\t\treturn sjcl.codec.base64.fromBits(removeExpectedPrefix(decryptedData, \"bin::\"));\n\t\t\t}).nodeify(callback);\n\t\t}\n\t},\n\n\tasym: {\n\t\t/** generate a key\n\t\t* @param callback callback\n\t\t*/\n\t\tgenerateKey: function generateKeyF(callback, comment) {\n\t\t\treturn CryptKey.generate(\"256\", comment).then(function (key) {\n\t\t\t\treturn key.getRealID();\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\t/** encrypt key with sym key\n\t\t* @param realID key to encrypt\n\t\t* @param parentKeyID key to encrypt with\n\t\t* @param callback callback\n\t\t*/\n\t\tsymEncryptKey: function symEncryptKeyF(realID, parentKeyID, callback) {\n\t\t\treturn CryptKey.get(realID).then(function (key) {\n\t\t\t\treturn key.addSymDecryptor(parentKeyID);\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\t/** encrypt key with password\n\t\t* @param realID key to encrypt\n\t\t* @param password password to encrypt with\n\t\t* @param callback callback\n\t\t*/\n\t\tpwEncryptKey: function pwEncryptKeyF(realID, password, callback) {\n\t\t\treturn CryptKey.get(realID).then(function (key) {\n\t\t\t\treturn key.addPWDecryptor(password);\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\tfingerPrintKey: function (realID, cb) {\n\t\t\treturn CryptKey.get(realID).then(function (key) {\n\t\t\t\treturn key.getFingerPrint();\n\t\t\t}).nodeify(cb);\n\t\t}\n\t},\n\n\tsign: {\n\t\t/** generate a key\n\t\t* @param callback callback\n\t\t*/\n\t\tgenerateKey: function generateKeyF(callback, comment) {\n\t\t\treturn SignKey.generate(\"256\", comment).then(function (key) {\n\t\t\t\treturn key.getRealID();\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\t/** encrypt key with sym key\n\t\t* @param realID key to encrypt\n\t\t* @param parentKeyID key to encrypt with\n\t\t* @param callback callback\n\t\t*/\n\t\tsymEncryptKey: function symEncryptKeyF(realID, parentKeyID, callback) {\n\t\t\treturn SignKey.get(realID).then(function (key) {\n\t\t\t\treturn key.addSymDecryptor(parentKeyID);\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\t/** encrypt key with password\n\t\t* @param realID key to encrypt\n\t\t* @param password password to encrypt with\n\t\t* @param callback callback\n\t\t*/\n\t\tpwEncryptKey: function pwEncryptKeyF(realID, password, callback) {\n\t\t\treturn SignKey.get(realID).then(function (key) {\n\t\t\t\treturn key.addPWDecryptor(password);\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\tsignObject: function (object, realID, version, callback) {\n\t\t\treturn Bluebird.all([\n\t\t\t\tSignKey.get(realID),\n\t\t\t\tsjclWorkerInclude.stringify(object, version, true)\n\t\t\t]).spread(function (key, hash) {\n\t\t\t\treturn key.sign(hash, object._type);\n\t\t\t}).then(function (signature) {\n\t\t\t\treturn chelper.bits2hex(signature);\n\t\t\t}).nodeify(callback);\n\t\t},\n\n\t\tverifyObject: function (signature, object, realID, version, id) {\n\t\t\tsignature = chelper.hex2bits(signature);\n\n\t\t\treturn Bluebird.all([\n\t\t\t\tstringifyObject(object, version),\n\t\t\t\tSignKey.get(realID)\n\t\t\t]).spread(function (objectString, key) {\n\t\t\t\treturn key.verify(signature, objectString, object._type, id);\n\t\t\t}).catch(function (e) {\n\t\t\t\tconsole.error(e);\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t},\n\n\t\tfingerPrintKey: function (realID, cb) {\n\t\t\treturn CryptKey.get(realID).then(function (key) {\n\t\t\t\treturn key.getFingerPrint();\n\t\t\t}).nodeify(cb);\n\t\t}\n\t}\n};\n\nmodule.exports = keyStore;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/crypto/keyStore.js","\"use strict\"\nimport * as Bluebird from \"bluebird\"\n\nexport default class Queue {\n\n\tprivate queue = []\n\tprivate run = false\n\tprivate runningWeight = 0\n\n\tconstructor(private maxWeight) { }\n\n\tenqueue(weight, task) {\n\t\tconst promise = new Bluebird((resolve, reject) => {\n\t\t\tthis.queue.push({\n\t\t\t\ttask: task,\n\t\t\t\tweight: weight,\n\t\t\t\tresolve: resolve,\n\t\t\t\treject: reject\n\t\t\t})\n\t\t\tthis.runTasks()\n\t\t})\n\t\treturn promise\n\t}\n\n\tprivate runTasks() {\n\t\tif (!this.run) {\n\t\t\treturn\n\t\t}\n\n\t\tlet nextTask\n\n\t\twhile(this.queue.length > 0 && this.runningWeight < this.maxWeight) {\n\t\t\tnextTask = this.queue.shift()\n\t\t\tthis.runTask(nextTask)\n\t\t}\n\t}\n\n\tprivate runTask(task) {\n\t\tthis.runningWeight += task.weight\n\t\ttask.task().then(\n\t\t\tresult => { task.resolve(result) },\n\t\t\terror => { task.reject(error) }\n\t\t).finally(() => {\n\t\t\tthis.runningWeight -= task.weight\n\t\t\tthis.runTasks()\n\t\t})\n\t}\n\n\tstart() {\n\t\tthis.run = true\n\t\tthis.runTasks()\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/asset/Queue.ts","import socketService from \"./socket.service\"\nimport sessionService from \"./session.service\"\n\nclass FeatureToggles {\n\tconfig = {}\n\n\tconstructor() {\n\t\tsessionService.bootLogin()\n\t\t\t.then(() => this.loadToggles())\n\n\t\tsessionService.awaitLogin()\n\t\t\t.then(() => this.loadToggles())\n\t}\n\n\tprivate loadToggles = () =>\n\t\tsocketService.definitlyEmit(\"featureToggles\", {})\n\t\t\t.then((response) => response.toggles ? this.config = response.toggles : null)\n\n\tisFeatureEnabled(featureName) {\n\t\tif (!this.config.hasOwnProperty(featureName)) {\n\t\t\t// console.warn(`Unknown feature: ${featureName}`)\n\n\t\t\treturn false\n\t\t}\n\n\t\tif (this.config[featureName] === false) {\n\t\t\treturn false\n\t\t}\n\n\t\treturn true\n\t}\n\n\tgetFeatureConfig(featureName) {\n\t\treturn this.config[featureName]\n\t}\n}\n\nexport default new FeatureToggles()\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/featureToggles.ts","import h from \"../helper/helper\"\nimport { Message } from \"../messages/message\"\n\nconst MINUTE = 60 * 1000;\n\nexport default class Burst {\n\tprivate items: Message[]\n\tprivate chunkID\n\n\tconstructor () {\n\t\tthis.items = []\n\t}\n\n\tgetItems = () => {\n\t\treturn this.items;\n\t}\n\n\thasItem = (item) => {\n\t\treturn this.items.indexOf(item) > -1;\n\t}\n\n\taddItem = (item) => {\n\t\tif (!this.hasItems()) {\n\t\t\tthis.chunkID = item.getChunkID()\n\t\t}\n\n\t\tthis.items.push(item);\n\n\t\tthis.items.sort(function (m1, m2) {\n\t\t\treturn m1.getTime() - m2.getTime();\n\t\t});\n\t}\n\n\tremoveAllExceptLast = () => {\n\t\tthis.items.splice(0, this.items.length - 1);\n\t}\n\n\tfirstItem = () => {\n\t\treturn this.items[0];\n\t}\n\n\tlastItem = () => {\n\t\treturn this.items[this.items.length - 1];\n\t}\n\n\thasItems = () => {\n\t\treturn this.items.length > 0;\n\t}\n\n\tcontinousMessage(item: Message) {\n\t\tif (this.items.findIndex((m) => m.getClientID() === item.getPreviousID()) !== -1) {\n\t\t\treturn true\n\t\t}\n\n\t\treturn this.items.findIndex((m) => m.getPreviousID() === item.getClientID()) !== -1\n\t}\n\n\tfitsItem = (item: Message) => {\n\t\tif (!this.hasItems()) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.sameChunk(item) &&\n\t\t\tthis.sameSender(item) &&\n\t\t\tthis.continousMessage(item) &&\n\t\t\tthis.sameDay(item) &&\n\t\t\tthis.timeDifference(item) < MINUTE * 10\n\n\t}\n\n\tgetChunkID = () => this.chunkID\n\n\tsameChunk = (item: Message | Burst) => {\n\t\tif (!item) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.getChunkID() === item.getChunkID();\n\t}\n\n\tsameSender = (message) => {\n\t\treturn this.firstItem().data.sender.id === message.data.sender.id;\n\t}\n\n\tsameDay = (message) => {\n\t\tif (!message) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (message instanceof Burst) {\n\t\t\tmessage = message.firstItem();\n\t\t}\n\n\t\tvar date1 = new Date(h.parseDecimal(this.firstItem().getTime()));\n\t\tvar date2 = new Date(h.parseDecimal(message.getTime()));\n\n\t\tif (date1.getDate() !== date2.getDate()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (date1.getMonth() !== date2.getMonth()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (date1.getFullYear() !== date2.getFullYear()) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\ttimeDifference = (item) => {\n\t\treturn Math.abs(h.parseDecimal(item.getTime()) - h.parseDecimal(this.firstItem().getTime()));\n\t}\n\n\tisMe = () => {\n\t\treturn this.firstItem().data.sender.me;\n\t}\n\n\tisOther = () => {\n\t\treturn !this.firstItem().data.sender.me;\n\t}\n\n\tsender = () => {\n\t\treturn this.firstItem().data.sender;\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/messages/burst.ts","import Enum, { InternalSymbol } from \"./enum\";\n\nvar states : any = new Enum([\"INIT\", \"PENDING\", \"SUCCESS\", \"FAILED\"]);\n\nexport default class State {\n\t_state = states.INIT;\n\tdata = {\n\t\tinit: true,\n\t\tpending: false,\n\t\tsuccess: false,\n\t\tfailed: false\n\t};\n\n\t_turnOneDataTrue () {\n\t\tstates.symbols().forEach(function (symbol : InternalSymbol) {\n\t\t\tvar name : string = symbol.name.toLowerCase();\n\t\t\tif (this._state === symbol) {\n\t\t\t\tthis.data[name] = true;\n\t\t\t} else {\n\t\t\t\tthis.data[name] = false;\n\t\t\t}\n\t\t}, this);\n\t};\n\n\tsuccess () {\n\t\tif (this._state === states.PENDING) {\n\t\t\tthis._state = states.SUCCESS;\n\t\t\tthis._turnOneDataTrue();\n\t\t}\n\t};\n\n\tfailed () {\n\t\tif (this._state === states.PENDING) {\n\t\t\tthis._state = states.FAILED;\n\t\t\tthis._turnOneDataTrue();\n\t\t}\n\t};\n\n\treset () {\n\t\tthis._state = states.INIT;\n\t\tthis._turnOneDataTrue();\n\t};\n\n\tpending () {\n\t\tthis._state = states.PENDING;\n\t\tthis._turnOneDataTrue();\n\t};\n\n\tisPending () : boolean {\n\t\treturn this._state === states.PENDING;\n\t};\n\n\tisSuccess () : boolean {\n\t\treturn this._state === states.SUCCESS;\n\t};\n\n\tisFailed () : boolean {\n\t\treturn this._state === states.FAILED;\n\t};\n\n\tisInit () : boolean {\n\t\treturn this._state === states.INIT;\n\t};\n\n\tgetState () {\n\t\treturn this._state;\n\t};\n\n\tgetPossibleStates () {\n\t\treturn states;\n\t};\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/asset/state.ts","import { Component, ElementRef } from \"@angular/core\"; // tslint:disable-line:no-unused-variable\nimport { NavController, NavParams, IonicPage } from \"ionic-angular\"; // tslint:disable-line:no-unused-variable\n\nimport errorService from \"../../lib/services/error.service\";\n\nimport messageService from \"../../lib/messages/messageService\";\nimport Burst from \"../../lib/messages/burst\"\nimport ChatLoader, { Chat } from \"../../lib/messages/chat\"\nimport MessageLoader from \"../../lib/messages/message\"\n\nconst inView = require(\"in-view\");\n\nconst initService = require(\"../../lib/services/initService\");\n\nnamespace BurstHelper {\n\texport const getNewElements = (messagesAndUpdates, bursts) => {\n\t\treturn messagesAndUpdates.filter((message) => {\n\t\t\treturn bursts.reduce((prev, current) => {\n\t\t\t\treturn prev && !current.hasItem(message);\n\t\t\t}, true);\n\t\t});\n\t}\n\n\texport const calculateBursts = (messages: any[]) => {\n\t\tvar bursts = [new Burst()];\n\t\tvar currentBurst = bursts[0];\n\n\t\tmessages.sort((m1, m2) => {\n\t\t\treturn m2.getTime() - m1.getTime();\n\t\t});\n\n\t\tmessages.forEach((messageOrUpdate) => {\n\t\t\tif(!currentBurst.fitsItem(messageOrUpdate)) {\n\t\t\t\tcurrentBurst = new Burst();\n\t\t\t\tbursts.push(currentBurst);\n\t\t\t}\n\t\t\tcurrentBurst.addItem(messageOrUpdate);\n\t\t});\n\n\t\treturn bursts;\n\t}\n\n\tconst hasMatchingMessage = (oldBurst, newBurst) => {\n\t\tvar matchingMessages = newBurst.getItems().filter((message) => {\n\t\t\treturn oldBurst.hasItem(message);\n\t\t});\n\n\t\treturn matchingMessages.length > 0;\n\t}\n\n\tconst addBurst = (bursts, burst) => {\n\t\tbursts.push(burst);\n\n\t\treturn true;\n\t}\n\n\tconst mergeBurst = (oldBurst, newBurst) => {\n\t\tvar newMessages = newBurst.getItems().filter((message) => {\n\t\t\treturn !oldBurst.hasItem(message);\n\t\t});\n\n\t\tnewMessages.forEach((message) => {\n\t\t\toldBurst.addItem(message);\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tconst addBurstOrMerge = (bursts, burst) => {\n\t\tvar possibleMatches = bursts.filter((oldBurst) => {\n\t\t\treturn hasMatchingMessage(oldBurst, burst);\n\t\t});\n\n\t\tif (possibleMatches.length === 0) {\n\t\t\treturn addBurst(bursts, burst);\n\t\t}\n\n\t\tif (possibleMatches.length === 1) {\n\t\t\treturn mergeBurst(possibleMatches[0], burst);\n\t\t}\n\n\t\tif (possibleMatches.length > 1) {\n\t\t\terrorService.criticalError(new Error(\"Burst merging possible matches > 1 wtf...\"));\n\t\t\treturn false;\n\t\t}\n\t}\n\n\texport const mergeBursts = (bursts, newBursts) => {\n\t\treturn newBursts.reduce((prev, burst) => {\n\t\t\treturn prev && addBurstOrMerge(bursts, burst);\n\t\t}, true);\n\t}\n}\n\n@IonicPage({\n\tname: \"Messages\",\n\tsegment: \"messages/:chatID\",\n\tdefaultHistory: [\"Home\"]\n})\n@Component({\n\tselector: 'page-messages',\n\ttemplateUrl: 'messages.html'\n})\nexport class MessagesPage {\n\tchatID: number;\n\tchat: Chat;\n\n\tmessagesLoading: boolean = true;\n\n\tburstTopic: number = 0;\n\tbursts: any[] = [];\n\tlastMessageElement: any;\n\n\tmessages: any[];\n\n\tconstructor(public navParams: NavParams, public navCtrl: NavController, private element: ElementRef) {\n\t}\n\n\tngOnInit() {\n\t\tthis.chatID = parseFloat(this.navParams.get(\"chatID\"));\n\n\t\t/*if (ChatLoader.isLoaded(this.chatID)) {\n\t\t\tnavCtrl.push(\"Messages\", { chatID: 34 }, { animate: false })\n\t\t\tthis.chat = ChatLoader.getLoaded(this.chatID)\n\t\t\tthis.messagesLoading = false\n\t\t\treturn\n\t\t}*/\n\n\t\tif (this.chatID < 0) {\n\t\t\tif (!ChatLoader.isLoaded(this.chatID)) {\n\t\t\t\tthis.navCtrl.setRoot(\"Home\")\n\t\t\t\tthis.navCtrl.popToRoot()\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\tinitService.awaitLoading().then(() =>\n\t\t\tmessageService.getChat(this.chatID)\n\t\t).then((chat) => {\n\t\t\tthis.chat = chat;\n\n\t\t\tchat.loadInitialMessages().then(() => {\n\t\t\t\tthis.messagesLoading = false;\n\t\t\t\tthis.chat.markRead().catch(errorService.criticalError)\n\t\t\t});\n\t\t})\n\t}\n\n\tionViewDidEnter = () => {}\n\n\tgetPartners = () => {\n\t\tif (!this.chat) {\n\t\t\treturn []\n\t\t}\n\n\t\treturn this.chat.getPartners()\n\t}\n\n\tprivate getBursts = (options) => {\n\t\tif (!this.chat || this.chat.getMessages().length === 0) {\n\t\t\treturn { changed: false, bursts: [] };\n\t\t}\n\n\t\tconst messages = this.chat.getMessages()\n\t\t\t.map(({ id }) => MessageLoader.getLoaded(id))\n\n\t\tif (this.burstTopic !== this.chat.getID()) {\n\t\t\tthis.bursts = BurstHelper.calculateBursts(messages);\n\t\t\tthis.burstTopic = this.chat.getID();\n\n\t\t\treturn { changed: true, bursts: this.bursts };\n\t\t}\n\n\t\tvar newElements = BurstHelper.getNewElements(messages, this.bursts);\n\n\t\tif (options) {\n\t\t\tconst firstViewMessage = messages.find((elem) => {\n\t\t\t\treturn options.after == elem.getClientID().toString()\n\t\t\t})\n\n\t\t\tconst index = messages.indexOf(firstViewMessage)\n\n\t\t\tnewElements = newElements.filter((element) => {\n\t\t\t\treturn messages.indexOf(element) > index\n\t\t\t})\n\t\t}\n\n\t\tif (newElements.length === 0) {\n\t\t\treturn { changed: false, bursts: this.bursts };\n\t\t}\n\n\t\tthis.bursts.forEach((burst) =>\n\t\t\tburst.removeAllExceptLast()\n\t\t)\n\n\t\tvar newBursts = BurstHelper.calculateBursts(messages);\n\t\tif (!BurstHelper.mergeBursts(this.bursts, newBursts)) {\n\t\t\tconsole.warn(\"Rerender all bursts!\");\n\t\t\tthis.bursts = newBursts;\n\t\t}\n\n\t\treturn { changed: true, bursts: this.bursts };\n\t}\n\n\tngAfterViewChecked() {\n\t\tthis.registerMarkReadListener()\n\t}\n\n\tonElementInView = ({ target }) => {\n\t\tif (inView.is(this.lastMessageElement)) {\n\t\t\tthis.markRead()\n\t\t\ttarget.removeEventListener(\"scroll\", this.onElementInView)\n\t\t}\n\t}\n\n\tregisterMarkReadListener() {\n\t\tif (!this.chat || !this.chat.isUnread()) {\n\t\t\treturn\n\t\t}\n\n\t\tconst selector = \".messages__burst:last-child .messages__wrap:last-child\"\n\t\tconst lastMessageElement: Element = this.element.nativeElement.querySelector(selector)\n\n\t\tif (!lastMessageElement || lastMessageElement === this.lastMessageElement) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.lastMessageElement = lastMessageElement\n\n\t\tif (inView.is(lastMessageElement)) {\n\t\t\tthis.markRead()\n\t\t\treturn\n\t\t}\n\n\t\tdocument.querySelector(\"topicwithbursts .messages__list\").addEventListener(\"scroll\", this.onElementInView)\n\t}\n\n\tloadMoreMessages = () => {\n\t\tconsole.warn(\"load more messages\")\n\n\t\tthis.messagesLoading = true;\n\n\t\treturn this.chat.loadMoreMessages().then((remaining) => {\n\t\t\tthis.messagesLoading = false;\n\t\t\treturn remaining\n\t\t})\n\t}\n\n\tmessageBursts = (options) => {\n\t\tvar burstInfo = this.getBursts(options);\n\n\t\tburstInfo.bursts.sort((b1, b2) => {\n\t\t\treturn b1.firstItem().getTime() - b2.firstItem().getTime();\n\t\t});\n\n\t\treturn burstInfo;\n\t}\n\n\tmarkRead = () => {\n\t\tsetTimeout(() => {\n\t\t\tconsole.log('mark topic read', this.chat.getID())\n\t\t\tthis.chat.markRead().catch(errorService.criticalError)\n\t\t}, 0)\n\t}\n\n\tsendMessage = ({ text, images = [], files = [], voicemails = [] }) => {\n\t\tif (text.length === 0 && images.length === 0 && files.length === 0 && voicemails.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sendPromise = this.chat.sendMessage(text, { images, files, voicemails })\n\n\t\tif (this.chat.isDraft()) {\n\t\t\tsendPromise.then(() => {\n\t\t\t\tthis.navCtrl.push(\"Messages\", { chatID: this.chat.getID() }, { animate: false }).then(() => {\n\t\t\t\t\tthis.navCtrl.remove(this.navCtrl.length() - 2, 1)\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\n\t\tthis.chat.newMessage = \"\"\n\t\tthis.markRead()\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/messages/messages.ts","namespace Tutorial {\n\n\tconst tutorialVersion = 4;\n\texport let tutorialVisible = false;\n\n\texport function skip() {\n\t\ttutorialVisible = false;\n\t\tlocalStorage.setItem(\n\t\t\t'tutorialPassed',\n\t\t\t`${tutorialVersion}`\n\t\t);\n\t}\n\n\texport function checkVisibility() {\n\t\tconst passedVersion = parseInt(localStorage.getItem('tutorialPassed'), 10)\n\t\ttutorialVisible = isNaN(passedVersion) || (passedVersion < tutorialVersion)\n\t}\n\n\texport function resetVisibility() {\n\t\tconsole.log('resetting visibility')\n\t\tlocalStorage.setItem('tutorialPassed', '0');\n\t\ttutorialVisible = true;\n\t}\n}\n\nexport default Tutorial;\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/tutorial.ts","import { platformBrowserDynamic } from \"@angular/platform-browser-dynamic\";\n\nimport \"rxjs/add/operator/catch\";\nimport \"rxjs/add/operator/map\";\nimport \"rxjs/add/operator/toPromise\";\n\nimport { AppModule } from \"./app.module\";\n\nplatformBrowserDynamic().bootstrapModule(AppModule);\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/main.ts","const config = require('../config.js');\nimport State from '../asset/state';\n\nimport 'whatwg-fetch';\n\ninterface Error {\n\tstack: String\n}\n\nclass ErrorService {\n\tconstructor() {\n\t\tthis.criticalError = this.criticalError.bind(this);\n\t\tthis.logError = this.logError.bind(this);\n\n\t\twindow.addEventListener(\"unhandledrejection\", (e : any) => {\n\t\t\tvar reason = e.detail.reason;\n\n\t\t\tthis.criticalError(reason);\n\t\t});\n\t}\n\n\tcriticalError (e : any) {\n\t\tthis.logError(e);\n\t};\n\n\tlogError (e : Error) {\n\t\tif (e) {\n\t\t\tconsole.error(e);\n\n\t\t\tconst url = (config.https ? \"https://\" : \"http://\") +\n\t\t\t\tconfig.ws +\n\t\t\t\t\":\" + config.wsPort +\n\t\t\t\t\"/reportError\";\n\n\t\t\twindow.fetch(url, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tmode: 'cors',\n\t\t\t\theaders: new Headers({\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t}),\n\t\t\t\tbody: JSON.stringify({ error: e.toString(), stack: e.stack })\n\t\t\t}).catch(() => {});\n\t\t}\n\t};\n\n\tfailOnErrorPromise (state : State, promise : any) {\n\t\treturn promise.then(() => {\n\t\t\tstate.success();\n\t\t}).catch((e : Error) => {\n\t\t\tstate.failed();\n\t\t\tthis.criticalError(e);\n\t\t});\n\t};\n\n\tfailOnError (state : State) {\n\t\treturn (e : Error) => {\n\t\t\tif (e) {\n\t\t\t\tstate.failed();\n\t\t\t\tthis.criticalError(e);\n\t\t\t} else {\n\t\t\t\tstate.success();\n\t\t\t}\n\t\t};\n\t}\n}\n\nexport const errorServiceInstance = new ErrorService();\n\nexport default errorServiceInstance;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/error.service.ts","declare type positionType = { x: number, y: number, width: number, height: number }\n\ndeclare global {\n\tinterface Window {\n\t\tdevice: any;\n\t\tZone: any;\n\t\twhispeerGetStorage: any;\n\t\tFilePicker: {\n\t\t\tpickFile: (resolve: Function, reject: Function, utis?: string[] | string, position?: positionType) => void\n\t\t};\n\t\tfileChooser: {\n\t\t\topen: (resolve: Function, reject: Function) => void\n\t\t},\n\t\tFilePath: {\n\t\t\tresolveNativePath: (url: string, resolve: Function, reject: Function) => void\n\t\t},\n\t\tcordova: any,\n\t\tplugins: any\n\t}\n\n\tconst IONIC_ENV: string\n}\n\nrequire(\"interceptors/addKeysInterceptor\");\nrequire(\"interceptors/sessionServiceInterceptor\");\nrequire(\"services/trust.service\");\nrequire(\"blueimp-canvas-to-blob/js/canvas-to-blob\")\n\nimport moment from 'moment';\n\nimport { NgModule, ErrorHandler, NgZone } from '@angular/core'; // tslint:disable-line:no-unused-variable\nimport { DatePipe } from \"@angular/common\";\n\nimport { Platform, IonicApp, IonicErrorHandler, IonicModule, Config } from 'ionic-angular';\n\nimport * as Bluebird from 'bluebird';\n\nimport { MyApp } from './app.component';\n\nimport { BrowserModule } from '@angular/platform-browser';\n\nimport { SplashScreen } from \"@ionic-native/splash-screen\";\nimport { StatusBar } from \"@ionic-native/status-bar\";\nimport { Globalization } from '@ionic-native/globalization';\nimport { Push } from '@ionic-native/push';\nimport { PhotoViewer } from '@ionic-native/photo-viewer';\nimport { ImagePicker } from '@ionic-native/image-picker';\nimport { File } from '@ionic-native/file';\nimport { Camera } from '@ionic-native/camera';\nimport { BarcodeScanner } from \"@ionic-native/barcode-scanner\";\nimport { InAppBrowser } from '@ionic-native/in-app-browser';\nimport { Media } from '@ionic-native/media';\n\nimport { TranslateModule, TranslateLoader, TranslateService } from '@ngx-translate/core';\nimport { TranslateHttpLoader } from '@ngx-translate/http-loader';\nimport { HttpModule, Http } from '@angular/http';\n\nimport { isBusinessVersion } from \"../lib/services/location.manager\";\n\nimport \"../lib/services/featureToggles\"\nimport \"../lib/services/settings.service\"\n\n(window as any).startup = new Date().getTime();\n\nexport function createTranslateLoader(http: Http) {\n\treturn new TranslateHttpLoader(http, './assets/i18n/', '.json');\n}\n\nimport 'moment/locale/de';\n\nconst DEFAULT_LANG = \"de\"\n\n@NgModule({\n\tdeclarations: [\n\t\tMyApp\n\t],\n\timports: [\n\t\tIonicModule.forRoot(MyApp, {\n\t\t\tscrollPadding: false,\n\t\t\tscrollAssist: true,\n\t\t\tautoFocusAssist: false\n\t\t}, \n{\n  links: [\n    { loadChildren: '../pages/messages/messages.module#MessagesPageModule', name: 'Messages', segment: 'messages/:chatID', priority: 'low', defaultHistory: ['Home'] },\n    { loadChildren: '../pages/blocked-users/blockedUsers.module#ContactsPageModule', name: 'Blocked Users', segment: 'blockedusers', priority: 'low', defaultHistory: [] },\n    { loadChildren: '../pages/contact-requests/contact-requests.module#ContactRequestPageModule', name: 'Requests', segment: 'requests', priority: 'low', defaultHistory: [] },\n    { loadChildren: '../pages/contacts/contacts.module#ContactsPageModule', name: 'Contacts', segment: 'contacts', priority: 'low', defaultHistory: [] },\n    { loadChildren: '../pages/home/home.module#HomePageModule', name: 'Home', segment: 'home', priority: 'low', defaultHistory: [] },\n    { loadChildren: '../pages/login/login.module#LoginPageModule', name: 'Login', segment: 'login', priority: 'low', defaultHistory: [] },\n    { loadChildren: '../pages/messages/add/add.module#AddPageModule', name: 'Select User', segment: 'messages/:chatID/add', priority: 'low', defaultHistory: [] },\n    { loadChildren: '../pages/messages/details/details.module#DetailsPageModule', name: 'Chat Details', segment: 'messages/:chatID/details', priority: 'low', defaultHistory: [] },\n    { loadChildren: '../pages/new-message/new-message.module#NewMessagePageModule', name: 'New Message', segment: 'newMessage/:receiverIds', priority: 'low', defaultHistory: [] },\n    { loadChildren: '../pages/profile/profile.module#ProfilePageModule', name: 'Profile', segment: 'profile/:userId', priority: 'low', defaultHistory: [] },\n    { loadChildren: '../pages/sales/sales.module#SalesPageModule', name: 'Sales', segment: 'sales', priority: 'low', defaultHistory: [] },\n    { loadChildren: '../pages/settings/settings.module#SettingsPageModule', name: 'Settings', segment: 'settings', priority: 'low', defaultHistory: [] }\n  ]\n}),\n\t\tTranslateModule.forRoot({\n\t\t\tloader: {\n\t\t\t\tprovide: TranslateLoader,\n\t\t\t\tuseFactory: createTranslateLoader,\n\t\t\t\tdeps: [Http]\n\t\t\t}\n\t\t}),\n\t\tBrowserModule,\n\t\tHttpModule,\n\t],\n\tbootstrap: [IonicApp],\n\tentryComponents: [\n\t\tMyApp,\n\t],\n\tproviders: [\n\t\t{provide: ErrorHandler, useClass: IonicErrorHandler},\n\t\tDatePipe,\n\t\tBarcodeScanner,\n\t\tSplashScreen,\n\t\tStatusBar,\n\t\tGlobalization,\n\t\tPush,\n\t\tPhotoViewer,\n\t\tImagePicker,\n\t\tFile,\n\t\tCamera,\n\t\tInAppBrowser,\n\t\tMedia,\n\t]\n})\nexport class AppModule {\n\n\ttasks: any[] = []\n\ttaskRunnerStarted: Boolean = false\n\n\tstartTaskRunner = () => {\n\t\tif (this.taskRunnerStarted || this.tasks.length === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.taskRunnerStarted = true\n\t\tsetTimeout(this.runTasks, 0)\n\t}\n\n\trunTasks = () => {\n\t\tthis.taskRunnerStarted = false\n\n\t\tconst tasksStarted = Date.now()\n\t\tconst maxTaskCount = this.tasks.length\n\n\t\tfor (let i = 0; i < maxTaskCount; i += 1) {\n\t\t\tconst task = this.tasks.shift()\n\t\t\ttask()\n\n\t\t\tconst dateDiff = Date.now() - tasksStarted\n\n\t\t\t/*if (dateDiff > 50) {\n\t\t\t\tconsole.error(`Long running task detected ${dateDiff}`, task)\n\t\t\t}*/\n\n\t\t\tif (i + 1 !== maxTaskCount && dateDiff > 20) {\n\t\t\t\t// console.warn(`Breaking out of tasks loop ${i+1} / ${maxTaskCount} / ${this.tasks.length}: ${dateDiff}`)\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tthis.startTaskRunner()\n\t}\n\n\trunInAngularZone(fn) {\n\t\tif((<any>this.zone).inner !== window.Zone.current) {\n\t\t\tthis.zone.run(fn)\n\t\t\treturn\n\t\t}\n\n\t\tfn()\n\t}\n\n\tdisableContextMenues = () => {\n\t\t// disable context menu, e.g., on long clicking the fab button.\n\t\twindow.addEventListener(\"contextmenu\", e => e.preventDefault())\n\t}\n\n\tconstructor(\n\t\tprivate zone: NgZone,\n\t\tprivate translate: TranslateService, // tslint:disable-line:no-unused-variable\n\t\tprivate globalization: Globalization,\n\t\tprivate config: Config, // tslint:disable-line:no-unused-variable\n\t\tprivate platform: Platform // tslint:disable-line:no-unused-variable\n\t) {\n\t\ttranslate.setDefaultLang(\"en\");\n\n\t\t// this used to be a huge problem with long click in chrome.\n\t\t// this.disableContextMenues()\n\n\t\tplatform.ready().then(() => {\n\t\t\tthis.globalization.getPreferredLanguage().then(({ value }) => {\n\t\t\t\tconsole.warn(`Language from device: ${value}`)\n\t\t\t\treturn value.split(\"-\")[0].toLowerCase()\n\t\t\t}).catch(() => {\n\t\t\t\tconsole.warn('Cannot get language from device, remaining with default language');\n\t\t\t\treturn DEFAULT_LANG\n\t\t\t}).then((lang) => {\n\t\t\t\tmoment.locale(lang);\n\n\t\t\t\tif (isBusinessVersion()) {\n\t\t\t\t\ttranslate.use(`${lang}_business`)\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\ttranslate.use(lang)\n\t\t\t}).then(() => {\n\t\t\t\ttranslate.get('general.backButtonText').subscribe((val: string) => {\n\t\t\t\t\tconfig.set('ios', 'backButtonText', val);\n\t\t\t\t})\n\t\t\t})\n\t\t})\n\n\t\tif (IONIC_ENV === \"prod\") {\n\t\t\tBluebird.config({\n\t\t\t\twarnings: false,\n\t\t\t\tlongStackTraces: false,\n\t\t\t\tcancellation: false,\n\t\t\t\tmonitoring: false\n\t\t\t})\n\t\t}\n\n\t\tBluebird.setScheduler((fn) => {\n\t\t\tthis.tasks.push(fn)\n\n\t\t\tthis.runInAngularZone(this.startTaskRunner)\n\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/app.module.ts","var keyStore = require(\"services/keyStore.service\").default;\nvar socketService = require(\"services/socket.service\").default;\n\nvar interceptor = {\n\ttransformResponse: function (response) {\n\t\tif (!response.keys) {\n\t\t\treturn response;\n\t\t}\n\n\t\tresponse.keys.forEach(function (key) {\n\t\t\tkeyStore.upload.addKey(key);\n\t\t});\n\n\t\treturn response;\n\t}\n};\n\nsocketService.addInterceptor(interceptor);\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/interceptors/addKeysInterceptor.js","import RequestKeyService from \"./requestKey.service\";\nimport * as keyStore from \"../crypto/keyStore.js\";\n\nkeyStore.upload.setKeyGet(RequestKeyService.getKey);\n\nexport default keyStore;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/keyStore.service.ts","\"use strict\";\n\nconst h = require(\"../helper/helper\").default\nconst keyStore = require(\"crypto/keyStore\");\nconst errors = require(\"asset/errors\");\nconst config = require(\"config\");\nconst Bluebird = require(\"bluebird\");\n\nvar attributesNeverVerified = [\"_signature\", \"_hashObject\"];\n\n/** crypted content with metadata\n\t\t@param content the content to handle either encrypted or decrypted\n\t\t@param meta metadata for the content\n\t\t@param isDecrypted whether the content is decrypted\n*/\nfunction SecuredDataWithMetaData(content, meta, options, isDecrypted) {\n\toptions = options || {};\n\n\t\t//we need to somehow ensure that we have the correct object type.\n\tif (typeof options.type !== \"string\") {\n\t\tthrow new Error(\"need a type for security!\");\n\t}\n\n\tthis._type = options.type;\n\tthis._alternativeType = options.alternativeType\n\n\tthis._removeEmpty = options.removeEmpty;\n\tthis._encryptDepth = options.encryptDepth || 0;\n\n\tthis._attributesNotVerified = options.attributesNotVerified || [];\n\tthis._attributesNotVerified.filter(function (val) {\n\t\treturn val.match(/^A-z0-9$/);\n\t});\n\tthis._attributesNotVerified = attributesNeverVerified.concat(this._attributesNotVerified);\n\n\tthis._decrypted = isDecrypted;\n\n\tthis._hasContent = true;\n\n\tthis._original = {\n\t\tmeta: meta || {}\n\t};\n\n\tif (typeof content === \"undefined\") {\n\t\tthis._hasContent = false;\n\t} else if (isDecrypted) {\n\t\tthis._original.content = content;\n\t} else {\n\t\tthis._original.encryptedContent = content;\n\t}\n\n\tthis._updated = h.deepCopyObj(this._original);\n\n\tthis._isKeyVerified = false;\n}\n\nSecuredDataWithMetaData.prototype._blockDisallowedAttributes = function (data) {\n\tif (data._contentHash || data._key || data._signature || data._version) {\n\t\tthrow new Error(\"content hash/key should not be provided by outside world\");\n\t}\n};\n\nSecuredDataWithMetaData.prototype.hasContent = function () {\n\treturn this._hasContent\n}\n\nSecuredDataWithMetaData.prototype.getHash = function () {\n\treturn this._updated.meta._ownHash;\n};\n\nSecuredDataWithMetaData.prototype.getKey = function () {\n\treturn this._original.meta._key;\n};\n\nSecuredDataWithMetaData.prototype.sign = function (signKey, cb) {\n\tvar that = this;\n\tvar toSign = h.deepCopyObj(that._updated.meta);\n\tvar hashVersion = config.hashVersion;\n\n\treturn Bluebird.try(function () {\n\t\ttoSign._version = 1;\n\t\ttoSign._type = that._type;\n\n\t\ttoSign._hashVersion = hashVersion;\n\n\t\t\t\t//do not sign attributes which should not be verified\n\t\tthat._attributesNotVerified.forEach(function(attr) {\n\t\t\tdelete toSign[attr];\n\t\t});\n\n\t\tif (that._updated.paddedContent || that._updated.content) {\n\t\t\tvar hashContent = that._updated.paddedContent || that._updated.content;\n\n\t\t\treturn keyStore.hash.hashObjectOrValueHexAsync(hashContent).then(function (contentHash) {\n\t\t\t\ttoSign._contentHash = contentHash;\n\n\t\t\t\t\t\t\t\t//create new ownHash\n\t\t\t\tdelete toSign._ownHash;\n\t\t\t\treturn keyStore.hash.hashObjectOrValueHexAsync(toSign);\n\t\t\t}).then(function (ownHash) {\n\t\t\t\ttoSign._ownHash = ownHash;\n\t\t\t});\n\t\t}\n\t}).then(function () {\n\t\treturn keyStore.sign.signObject(toSign, signKey, hashVersion);\n\t}).then(function (signature) {\n\t\ttoSign._signature = signature;\n\n\t\treturn toSign;\n\t}).nodeify(cb);\n};\n\nSecuredDataWithMetaData.prototype.getUpdatedData = function (signKey, cb) {\n\treturn this.verify(signKey).bind(this).then(function () {\n\t\tif (this._hasContent) {\n\t\t\tkeyStore.security.addEncryptionIdentifier(this._original.meta._key);\n\t\t\treturn this._signAndEncrypt(signKey, this._original.meta._key);\n\t\t}\n\n\t\treturn this.sign(signKey);\n\t}).nodeify(cb);\n};\n\n/** sign and encrypt this object.\n\t\tpads and then encrypts our content.\n\t\tadds contentHash, key id and version to metaData and signs meta data.\n\t\t@param signKey key to use for signing\n\t\t@param cb callback(cryptedData, metaData),\n*/\nSecuredDataWithMetaData.prototype._signAndEncrypt = function (signKey, cryptKey) {\n\tif (!this._hasContent) {\n\t\tthrow new Error(\"can only sign and not encrypt\");\n\t}\n\n\tif (this._original.meta._key && (this._original.meta._key !== cryptKey || !this._isKeyVerified)) {\n\t\tthrow new Error(\"can not re-encrypt an old object with new key!\");\n\t}\n\n\treturn keyStore.hash.addPaddingToObject(this._updated.content, 128).bind(this).then(function (paddedContent) {\n\t\tthis._updated.paddedContent = paddedContent;\n\n\t\tthis._updated.meta._key = keyStore.correctKeyIdentifier(cryptKey);\n\n\t\treturn Bluebird.all([\n\t\t\tkeyStore.sym.encryptObject(paddedContent, cryptKey, this._encryptDepth),\n\t\t\tthis.sign(signKey)\n\t\t]);\n\t}).spread(function (cryptedData, meta) {\n\t\tthis._updated.meta = meta;\n\n\t\treturn {\n\t\t\tcontent: cryptedData,\n\t\t\tmeta: meta\n\t\t};\n\t})\n};\n\nSecuredDataWithMetaData.prototype.signAndEncrypt = function (signKey, cryptKey) {\n\treturn this._signAndEncrypt(signKey, cryptKey)\n};\n\nSecuredDataWithMetaData.prototype.hasType = function (type) {\n\tif (type === this._type) {\n\t\treturn true\n\t}\n\n\tif (this._alternativeType && this._alternativeType === type) {\n\t\treturn true\n\t}\n\n\treturn false\n}\n\n/** verify the decrypted data\n\t\tdecrypts data if necessary\n\t\t@param signKey key to check signature against\n\t\t@param id id for signature caching\n\t\t@throw SecurityError: contenthash or signature wrong\n*/\nSecuredDataWithMetaData.prototype.verifyAsync = function (signKey, id) {\n\t\t//check contentHash is correct\n\t\t//check signature is correct\n\n\treturn Bluebird.resolve().bind(this).then(function () {\n\t\tvar metaCopy = h.deepCopyObj(this._original.meta);\n\n\t\tthis._attributesNotVerified.forEach(function(attr) {\n\t\t\tdelete metaCopy[attr];\n\t\t});\n\n\t\tif (!this.hasType(metaCopy._type)) {\n\t\t\t// eslint-disable-next-line no-debugger\n\t\t\tdebugger\n\t\t\tthrow new errors.SecurityError(\"invalid object type. is: \" + metaCopy._type + \" should be: \" + this._type);\n\t\t}\n\n\t\tif (typeof metaCopy._hashVersion === \"number\") {\n\t\t\tmetaCopy._hashVersion = h.parseDecimal(metaCopy._hashVersion);\n\t\t}\n\n\t\tvar hashVersion = 1;\n\n\t\tif (metaCopy._hashVersion) {\n\t\t\thashVersion = metaCopy._hashVersion;\n\t\t} else if (metaCopy._v2 && metaCopy._v2 !== \"false\") {\n\t\t\thashVersion = 2;\n\t\t}\n\n\t\treturn keyStore.sign.verifyObject(this._original.meta._signature, metaCopy, signKey, hashVersion, id);\n\t}).then(function (correctSignature) {\n\t\tif (!correctSignature) {\n\t\t\talert(\"Bug: signature did not match (\" + this._original.meta._type + \") Please report this bug!\");\n\t\t\tthrow new errors.SecurityError(\"signature did not match \" + this._original.meta._type);\n\t\t}\n\n\t\treturn this._verifyContentHash();\n\t}).then(function () {\n\t\tthis._isKeyVerified = true;\n\n\t\treturn true;\n\t});\n};\n\nSecuredDataWithMetaData.prototype.verify = function (signKey, cb, id) {\n\treturn this.verifyAsync(signKey, id).nodeify(cb);\n};\n\nSecuredDataWithMetaData.prototype.updated = function () {\n\tthis._changed = false;\n};\n\nSecuredDataWithMetaData.prototype._decrypt = function () {\n\tif (!this._decryptionPromise) {\n\t\tthis._decryptionPromise = keyStore.sym.decryptObject(\n\t\t\t\t\t\tthis._original.encryptedContent,\n\t\t\t\t\t\tthis._encryptDepth,\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tthis._original.meta._key\n\t\t\t\t).bind(this).then(function (decryptedData) {\n\t\t\t\t\tthis._decrypted = true;\n\t\t\t\t\tthis._original.paddedContent = decryptedData;\n\t\t\t\t\tthis._original.content = keyStore.hash.removePaddingFromObject(decryptedData, 128);\n\t\t\t\t\tthis._updated.content = h.deepCopyObj(this._original.content);\n\n\t\t\t\t\treturn this._verifyContentHash();\n\t\t\t\t});\n\t}\n\n\treturn this._decryptionPromise;\n};\n\nSecuredDataWithMetaData.prototype.decrypt = function (cb) {\n\treturn Bluebird.resolve().bind(this).then(function () {\n\t\tif (this._hasContent && !this._decrypted) {\n\t\t\treturn this._decrypt();\n\t\t}\n\t}).then(function () {\n\t\tif (!this._hasContent) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this._original.content;\n\t}).nodeify(cb);\n};\n\nSecuredDataWithMetaData.prototype._verifyContentHash = function(cb) {\n\tif (!this._hasContent || !this._decrypted) {\n\t\treturn Bluebird.resolve().nodeify(cb);\n\t}\n\n\treturn Bluebird.bind(this).then(function () {\n\t\treturn keyStore.hash.hashObjectOrValueHexAsync(this._original.paddedContent || this._original.content);\n\t}).then(function (hash) {\n\t\tif (hash !== this._original.meta._contentHash) {\n\t\t\tthrow new errors.SecurityError(\"content hash did not match\");\n\t\t}\n\t}).nodeify(cb);\n};\n\nSecuredDataWithMetaData.prototype.isChanged = function () {\n\treturn this._changed;\n};\nSecuredDataWithMetaData.prototype.isEncrypted = function () {\n\treturn !this._decrypted;\n};\nSecuredDataWithMetaData.prototype.isDecrypted = function () {\n\treturn this._decrypted;\n};\n\nSecuredDataWithMetaData.prototype.contentGet = function () {\n\treturn h.deepCopyObj(this._updated.content);\n};\nSecuredDataWithMetaData.prototype.metaGet = function () {\n\treturn h.deepCopyObj(this._updated.meta);\n};\nSecuredDataWithMetaData.prototype.metaHasAttr = function (attr) {\n\treturn this._updated.meta.hasOwnProperty(attr);\n};\nSecuredDataWithMetaData.prototype.metaKeys = function () {\n\treturn Object.keys(this._updated.meta).filter(function (key) {\n\t\treturn key[0] !== \"_\";\n\t});\n};\nSecuredDataWithMetaData.prototype.metaAttr = function (attr) {\n\treturn h.deepCopyObj(this._updated.meta[attr]);\n};\n\n/** sets the whole content to the given data\n\t\t@param newContent new value for this objects content\n*/\nSecuredDataWithMetaData.prototype.contentSet = function (newContent) {\n\tthis._hasContent = this._changed = true;\n\tthis._updated.content = newContent;\n};\n\n/** set a certain attribute in the content object\n\t\t@param attr attribute to set\n\t\t@param value value to set attribute to\n*/\nSecuredDataWithMetaData.prototype.contentSetAttr = function (attr, value) {\n\tif (typeof this._updated.content !== \"object\") {\n\t\tthrow new Error(\"our content is not an object\");\n\t}\n\n\tthis._updated.content[attr] = value;\n\tthis._changed = true;\n};\n\nSecuredDataWithMetaData.prototype.contentRemoveAttr = function (attr) {\n\tif (typeof this._updated.content !== \"object\") {\n\t\tthrow new Error(\"our content is not an object\");\n\t}\n\n\tdelete this._updated.content[attr];\n\tthis._changed = true;\n}\n\n/** sets the whole metaData to the given data\n\t\t@param newMetaData new value for this objects metaData\n*/\nSecuredDataWithMetaData.prototype.metaSet = function (newMetaData) {\n\tthis._blockDisallowedAttributes(newMetaData);\n\n\tthis._changed = true;\n\tthis._updated.meta = newMetaData;\n};\n\nSecuredDataWithMetaData.prototype.metaRemoveAttr = function (attr) {\n\tif (attr[0] === \"_\") {\n\t\tthrow new Error(\"private attributes should not be provided by outside world\");\n\t}\n\n\tthis._changed = true;\n\tdelete this._updated.meta[attr];\n};\n\nSecuredDataWithMetaData.prototype.metaSetAttr = function (attr, value) {\n\tif (attr[0] === \"_\") {\n\t\tthrow new Error(\"private attributes should not be provided by outside world\");\n\t}\n\n\tthis._changed = true;\n\tthis._updated.meta[attr] = value;\n};\n\n/** set a certain attribute in the meta object\n\t\t@param attrs [] list of which attribute to set\n\t\t@param value value to set attribute to\n*/\nSecuredDataWithMetaData.prototype.metaAdd = function (attrs, value) {\n\tthis._changed = h.deepSetCreate(this._updated.meta, attrs, value);\n};\n\nSecuredDataWithMetaData.prototype.setParent = function (parentSecuredData) {\n\tthis._updated.meta._parent = parentSecuredData.getHash();\n};\n\nSecuredDataWithMetaData.prototype.checkParent = function (expectedParent) {\n\tif (this._updated.meta._parent !== expectedParent.getHash()) {\n\t\tthrow new errors.SecurityError(\"wrong parent. is: \" + this._updated.meta._parent + \" should be: \" + expectedParent.getHash());\n\t}\n};\n\nSecuredDataWithMetaData.prototype.getRelationshipCounter = function () {\n\treturn h.parseDecimal(this._updated.meta._sortCounter || 0);\n};\n\nSecuredDataWithMetaData.prototype.setAfterRelationShip = function (afterSecuredData) {\n\tthis._updated.meta._sortCounter = afterSecuredData.getRelationshipCounter() + 1;\n};\n\nSecuredDataWithMetaData.prototype.checkAfter = function (securedData) {\n\tif (this.getRelationshipCounter() < securedData.getRelationshipCounter()) {\n\t\tthrow new errors.SecurityError(\"wrong ordering. \" + this.getRelationshipCounter() + \" should be after \" + securedData.getRelationshipCounter());\n\t}\n};\n\nSecuredDataWithMetaData.prototype.checkBefore = function (securedData) {\n\tif (this.getRelationshipCounter() > securedData.getRelationshipCounter()) {\n\t\tthrow new errors.SecurityError(\"wrong ordering. \" + this.getRelationshipCounter() + \" should be before \" + securedData.getRelationshipCounter());\n\t}\n};\n\nvar api = {\n\tcreatePromisified: function (content, meta, options, signKey, cryptKey) {\n\t\tvar securedData, securedDataPromise;\n\t\tsecuredDataPromise = Bluebird.fromCallback(function (cb) {\n\t\t\tsecuredData = api.create(content, meta, options, signKey, cryptKey, cb);\n\t\t});\n\n\t\treturn {\n\t\t\tpromise: securedDataPromise,\n\t\t\tdata: securedData\n\t\t};\n\t},\n\tcreateAsync: function (content, meta, options, signKey, cryptKey) {\n\t\treturn Bluebird.fromCallback(function (cb) {\n\t\t\tapi.create(content, meta, options, signKey, cryptKey, cb);\n\t\t});\n\t},\n\tcreate: function (content, meta, options, signKey, cryptKey, cb) {\n\t\tvar secured = api.createRaw(content, meta, options)\n\n\t\tBluebird.resolve().delay(1).then(function () {\n\t\t\treturn secured._signAndEncrypt(signKey, cryptKey);\n\t\t}).nodeify(cb);\n\n\t\treturn secured;\n\t},\n\tload: function (content, meta, options) {\n\t\treturn new SecuredDataWithMetaData(content, meta, options);\n\t},\n\tcreateRaw: function (content, meta, options) {\n\t\treturn new SecuredDataWithMetaData(content, meta, options, true);\n\t}\n};\n\nmodule.exports = api;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/asset/securedDataWithMetaData.js","/* (ignored) */\n\n\n//////////////////\n// WEBPACK FOOTER\n// ws (ignored)\n// module id = 335\n// module chunks = 12","module.exports = {\n\t\"hashVersion\": 3,\n\t\"socket\": {\n\t\t\"autoConnect\": true,\n\t\t\"autoReconnect\": true\n\t},\n\t\"serviceWorker\": {\n\t\t\"enabled\": false\n\t}\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/lib/conf/base.config.json\n// module id = 339\n// module chunks = 12","module.exports = {\n\t\"https\": true,\n\t\"ws\": \"data.whispeer.de\",\n\t\"wsPort\": 443,\n\t\"debug\": false,\n\t\"production\": true,\n\t\"workerScript\": \"build/worker.bundle.js\",\n\t\"serviceWorker\": {\n\t\t\"enabled\": true\n\t}\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/lib/conf/production.config.json\n// module id = 340\n// module chunks = 12","interface BlobPrefixed extends Blob {\n\twebkitSlice?: (start: number, end: number) => Blob;\n\tmozSlice?: (start: number, end: number) => Blob;\n}\n\ninterface SocketService {\n\tawaitConnection: () => Bluebird<void>;\n\temit: (channel: string, request: any) => Bluebird<any>;\n}\n\nimport * as Bluebird from \"bluebird\";\nimport Observer from \"../asset/observer\";\n\nexport default class BlobUploader extends Observer {\n\tstatic MAXIMUMPARTSIZE = 1000 * 1000;\n\tstatic STARTPARTSIZE = 5 * 1000;\n\tstatic MINIMUMPARTSIZE = 1 * 1000;\n\tstatic MAXIMUMTIME = 2 * 1000;\n\n\t_blob: BlobPrefixed;\n\t_doneBytes = 0;\n\t_partSize: number;\n\t_blobid: string;\n\t_uploadingPromise: Bluebird<void>;\n\t_socket: SocketService;\n\n\tconstructor(socket: SocketService, blob: Blob, blobid: string) {\n\t\tsuper();\n\n\t\tthis._blob = blob;\n\t\tthis._blobid = blobid;\n\n\t\tthis._socket = socket;\n\n\t\tthis._reset();\n\t}\n\n\t_reset() {\n\t\tthis._doneBytes = 0;\n\t\tthis._partSize = BlobUploader.STARTPARTSIZE;\n\t}\n\n\tstatic sliceBlob (blob: BlobPrefixed, start: number, end: number) {\n\t\tif (typeof blob.slice === \"function\") {\n\t\t\treturn blob.slice(start, end);\n\t\t}\n\n\t\tif (typeof blob.webkitSlice === \"function\") {\n\t\t\treturn blob.webkitSlice(start, end);\n\t\t}\n\n\t\tif (typeof blob.mozSlice === \"function\") {\n\t\t\treturn blob.mozSlice(start, end);\n\t\t}\n\n\t\treturn blob;\n\t};\n\n\tupload = () => {\n\t\tif (!this._uploadingPromise) {\n\t\t\tthis._uploadingPromise =  this._uploadPartUntilDone();\n\t\t}\n\n\t\treturn this._uploadingPromise;\n\t};\n\n\t_halfSize () {\n\t\tthis._partSize = Math.max(this._partSize / 2, BlobUploader.MINIMUMPARTSIZE);\n\t};\n\n\t_doubleSize () {\n\t\tthis._partSize = Math.min(this._partSize * 2, BlobUploader.MAXIMUMPARTSIZE);\n\t};\n\n\t_uploadPartUntilDone = () : Bluebird<void> => {\n\t\tif (this._doneBytes === this._blob.size) {\n\t\t\treturn Bluebird.resolve();\n\t\t}\n\n\t\treturn this._uploadPart().then(() => {\n\t\t\treturn this._uploadPartUntilDone();\n\t\t});\n\t}\n\n\t_uploadPart () {\n\t\tvar uploadStarted = new Date().getTime(), uploadSize: number;\n\n\t\treturn this._socket.awaitConnection().then(() => {\n\t\t\tvar partToUpload = BlobUploader.sliceBlob(this._blob, this._doneBytes, this._doneBytes + this._partSize);\n\t\t\tuploadSize = partToUpload.size;\n\t\t\tvar lastPart = this._blob.size === this._doneBytes + uploadSize;\n\n\t\t\treturn this._socket.emit(\"blob.uploadBlobPart\", {\n\t\t\t\tblobid: this._blobid,\n\t\t\t\tblobPart: partToUpload,\n\t\t\t\tdoneBytes: this._doneBytes,\n\t\t\t\tsize: uploadSize,\n\t\t\t\tlastPart: lastPart\n\t\t\t});\n\t\t}).then((response: any) => {\n\t\t\tif (response.reset) {\n\t\t\t\tconsole.warn(\"Restarting Upload\");\n\t\t\t\treturn this._reset();\n\t\t\t}\n\n\t\t\tvar uploadTook = new Date().getTime() - uploadStarted;\n\n\t\t\tif (uploadTook > BlobUploader.MAXIMUMTIME) {\n\t\t\t\tthis._halfSize();\n\t\t\t} else {\n\t\t\t\tthis._doubleSize();\n\t\t\t}\n\n\t\t\tthis._doneBytes += uploadSize;\n\t\t\tthis.notify(this._doneBytes, \"progress\");\n\t\t}).catch((e: any) => {\n\t\t\tconsole.error(e);\n\t\t\tthis._halfSize();\n\t\t\treturn Bluebird.delay(5000);\n\t\t});\n\t};\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/blobUploader.service.ts","import * as Bluebird from \"bluebird\"\n\nexport default class Storage {\n\tprivate _prefix: string\n\n\tconstructor(prefix: string) {\n\t\tthis._prefix = prefix\n\t}\n\n\tget = (key: string): any =>\n\t\tlocalStorage.getItem(this.calculateKey(key))\n\n\tset = (key: string, data: any) =>\n\t\tlocalStorage.setItem(this.calculateKey(key), data)\n\n\tremove = (key: string) =>\n\t\tlocalStorage.removeItem(this.calculateKey(key))\n\n\tclear = () => {\n\t\tconst usedKeys = Object.keys(localStorage)\n\t\tusedKeys.filter(function (key) {\n\t\t\treturn key.indexOf(this._prefix) === 0\n\t\t}, this).forEach(function (key) {\n\t\t\tlocalStorage.setItem(key, \"\")\n\t\t})\n\n\t\treturn Bluebird.resolve()\n\t}\n\n\tsave = () =>\n\t\tBluebird.resolve()\n\n\tprivate calculateKey = (key: string) =>\n\t\tthis._prefix + \".\" + key\n\n\tawaitLoading = () => Bluebird.resolve()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/Storage.ts","\"use strict\";\n\nconst sjcl = require(\"sjcl\");\nconst Bluebird = require(\"bluebird\");\n\n/**\n* Wait until randomizer is ready.\n* calls callback if randomizer is ready.\n*/\nvar waitForReady = function (callback) {\n\tif (sjcl.random.isReady()) {\n\t\tcallback();\n\t\treturn true;\n\t}\n\n\twaitForReady.waiting = true;\n\n\tsjcl.random.addEventListener(\"seeded\", function () {\n\t\twaitForReady.waiting = false;\n\t\twaitForReady.ready = true;\n\t\tcallback();\n\t});\n\n\treturn false;\n};\n\nwaitForReady.async = Bluebird.promisify(waitForReady);\n\nwaitForReady.ready = false;\nwaitForReady.waiting = false;\n\nmodule.exports = waitForReady;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/crypto/waitForReady.js","\"use strict\";\n\nconst WorkerPool = require(\"../worker/worker-pool\");\nconst bluebird = require(\"bluebird\");\nconst chelper = require(\"crypto/minimalHelper\");\nconst config = require(\"config\");\n\nfunction getEntropy() {\n\ttry {\n\t\tvar ab;\n\n\t\t// get cryptographically strong entropy depending on runtime environment\n\t\tif (window && Uint32Array) {\n\t\t\tab = new Uint32Array(32);\n\t\t\tif (window.crypto && window.crypto.getRandomValues) {\n\t\t\t\twindow.crypto.getRandomValues(ab);\n\t\t\t} else if (window.msCrypto && window.msCrypto.getRandomValues) {\n\t\t\t\twindow.msCrypto.getRandomValues(ab);\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn ab;\n\t\t}\n\t} catch (e) {\n\t\tconsole.error(e);\n\t}\n\n\treturn false;\n}\n\nfunction addEntropy(theWorker, callback) {\n\tvar entropy = getEntropy();\n\n\tif (entropy) {\n\t\ttheWorker.runTask({randomNumber: entropy, entropy: 1024}).then(callback);\n\t} else {\n\t\tthrow new Error(\"no entropy from browser ... browser too old\");\n\t}\n}\n\nvar workerCount = 4;\n\nif (navigator.hardwareConcurrency) {\n\tworkerCount = Math.max(navigator.hardwareConcurrency - 1, workerCount);\n}\n\n//Promise, numberOfWorkers, workerPath, setupMethod, requireOverRide\nvar workers = new WorkerPool(bluebird, workerCount, {\n\tsetupMethod: addEntropy,\n\tworkerScriptOverride: config.workerScript || false\n});\n\nvar sjclWorker = {\n\thash: function (toHash) {\n\t\treturn workers.schedule({\n\t\t\tisHash: true,\n\t\t\ttoHash: toHash\n\t\t});\n\t},\n\tstringify: function (content, version, hash) {\n\t\treturn workers.schedule({\n\t\t\tstringify: true,\n\t\t\tcontent: content,\n\t\t\tversion: version,\n\t\t\thash: hash\n\t\t});\n\t},\n\tasym: {\n\t\tgenerateCryptKey: function (curve) {\n\t\t\tvar data = {\n\t\t\t\tasym: true,\n\t\t\t\tgenerate: true,\n\t\t\t\tcrypt: true\n\t\t\t};\n\n\t\t\tif (curve) {\n\t\t\t\tdata.curve = curve;\n\t\t\t}\n\n\t\t\treturn workers.schedule(data);\n\t\t},\n\t\tgenerateSignKey: function (curve) {\n\t\t\tvar data = {\n\t\t\t\tasym: true,\n\t\t\t\tgenerate: true,\n\t\t\t\tcrypt: false,\n\t\t\t\tcurve: curve\n\t\t\t};\n\n\t\t\treturn workers.schedule(data);\n\t\t},\n\t\tkem: function (publicKey) {\n\t\t\tvar data = {\n\t\t\t\tasym: true,\n\t\t\t\tgenerate: false,\n\t\t\t\taction: \"kem\",\n\n\t\t\t\tcurve: chelper.getCurveName(publicKey._curve),\n\t\t\t\tx: publicKey._point.x.toString(),\n\t\t\t\ty: publicKey._point.y.toString()\n\t\t\t};\n\n\t\t\treturn workers.schedule(data);\n\t\t},\n\t\tunkem: function (privateKey, tag) {\n\t\t\tvar data = {\n\t\t\t\tasym: true,\n\t\t\t\tgenerate: false,\n\t\t\t\taction: \"unkem\",\n\n\t\t\t\tcurve: chelper.getCurveName(privateKey._curve),\n\t\t\t\texponent: privateKey._exponent.toString(),\n\t\t\t\ttag: chelper.bits2hex(tag)\n\t\t\t};\n\n\t\t\treturn workers.schedule(data);\n\t\t},\n\t\tsign: function (privateKey, toSign) {\n\t\t\tvar data = {\n\t\t\t\tasym: true,\n\t\t\t\tgenerate: false,\n\t\t\t\taction: \"sign\",\n\n\t\t\t\tcurve: chelper.getCurveName(privateKey._curve),\n\t\t\t\texponent: privateKey._exponent.toString(),\n\t\t\t\ttoSign: chelper.bits2hex(toSign)\n\t\t\t};\n\n\t\t\treturn workers.schedule(data);\n\t\t},\n\t\tverify: function (publicKey, signature, hash) {\n\t\t\tvar data = {\n\t\t\t\tasym: true,\n\t\t\t\tgenerate: false,\n\t\t\t\taction: \"verify\",\n\n\t\t\t\tcurve: chelper.getCurveName(publicKey._curve),\n\t\t\t\tpoint: {\n\t\t\t\t\tx: publicKey._point.x.toString(),\n\t\t\t\t\ty: publicKey._point.y.toString()\n\t\t\t\t},\n\n\t\t\t\tsignature: chelper.bits2hex(signature),\n\t\t\t\thash: chelper.bits2hex(hash)\n\t\t\t};\n\n\t\t\treturn workers.schedule(data);\n\t\t}\n\t},\n\tsym: {\n\t\tencrypt: function (key, message, progressListener) {\n\t\t\tvar data = {\n\t\t\t\t\"key\": key,\n\t\t\t\t\"message\": message,\n\n\t\t\t\t\"asym\": false,\n\t\t\t\t\"encrypt\": true\n\t\t\t};\n\n\t\t\treturn workers.schedule(data, progressListener);\n\t\t},\n\t\tdecrypt: function (key, message, progressListener) {\n\t\t\tvar data = {\n\t\t\t\t\"key\": key,\n\t\t\t\t\"message\": message,\n\n\t\t\t\t\"asym\": false,\n\t\t\t\t\"encrypt\": false\n\t\t\t};\n\n\t\t\treturn workers.schedule(data, progressListener);\n\t\t}\n\t}\n};\n\nmodule.exports = sjclWorker;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/crypto/sjclWorkerInclude.js","\"use strict\";\n\nconst Worker = require(\"worker/worker-loader\");\n\n/** constructor for worker pool\n*   @param Promise a promise implementation\n*   @param numberOfWorkers the number of workers you want to run in parallel\n*   @param optional setupMethod a function to call after the worker is created.\n*   @param requireOverRide the path to require, if it can not be determined automatically.\n*/\nvar WorkerPool = function (Promise, numberOfWorkers, options) {\n\tthis._Promise = Promise;\n\tthis._numberOfWorkers = numberOfWorkers;\n\tthis._numberOfRunningWorkers = 0;\n\n\tthis._options = options || {};\n\n\tthis._queue = [];\n\tthis._workers = [];\n\n\tthis._setupMethod = this._options.setupMethod;\n\tthis._setupDone = typeof this._setupMethod !== \"function\";\n\tthis._setupRunning = false;\n\n\tthis._createNewWorker();\n};\n\nWorkerPool.prototype._createNewWorker = function () {\n\tif (this._workers.length < this._numberOfWorkers) {\n\t\tvar newWorker = new Worker(this._Promise, this._options.workerScriptOverride);\n\t\tnewWorker.onFree(this._onFree.bind(this, newWorker));\n\t\tthis._workers.push(newWorker);\n\t}\n};\n\nWorkerPool.prototype._onFree = function (worker) {\n\tif (this._workers.length > this._numberOfWorkers) {\n        //remove from workers\n\t\treturn;\n\t}\n\n\tif (this._setupRunning) {\n\t\treturn;\n\t}\n\n\tif (!this._setupDone) {\n\t\tvar that = this;\n\t\tthis._setupRunning = true;\n\t\tthis._setupMethod(worker, function () {\n\t\t\tthat._setupRunning = false;\n\t\t\tthat._setupDone = true;\n\t\t\tthat._onFree(worker);\n\t\t});\n\n\t\treturn;\n\t}\n\n\tthis._runFromQueue();\n};\n\nWorkerPool.prototype._runFromQueue = function () {\n\tthis._workers.forEach(function (worker) {\n\t\tif (!worker.isBusy() && this._queue.length > 0) {\n\t\t\tvar current = this._queue.shift();\n\n\t\t\tworker.runIfFree(current.task, current.metaListener).then(current.resolve, current.reject);\n\t\t}\n\t}, this);\n};\n\nWorkerPool.prototype._saveCallBack = function (task, metaListener, resolve, reject) {\n\tthis._queue.push({\n\t\ttask: task,\n\t\tmetaListener: metaListener,\n\t\tresolve: resolve,\n\t\treject: reject\n\t});\n};\n\n/** schedule a new task\n*   @param the task to schedule\n*   @param metaListener a listener for meta information (e.g. progress)\n*/\nWorkerPool.prototype.schedule = function (task, metaListener) {\n\tthis._createNewWorker();\n\n\tvar waitPromise =  new this._Promise(this._saveCallBack.bind(this, task, metaListener));\n\tthis._runFromQueue();\n\treturn waitPromise;\n};\n\n/** close all workers. finish remaining tasks first */\nWorkerPool.prototype.drain = function () {\n\tthis.setNumberOfWorkers(0);\n};\n\nWorkerPool.prototype.setNumberOfWorkers = function (numberOfWorkers) {\n\tthis._numberOfWorkers = numberOfWorkers;\n\n\tif (numberOfWorkers > this._numberOfWorkers) {\n\t\tfor (var i = 0; i < this._queue.length; i += 1) {\n\t\t\tthis._createNewWorker();\n\t\t}\n\t}\n};\n\nmodule.exports = WorkerPool;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/worker/worker-pool.js","\"use strict\";\n\nvar PromiseWorker = function (Promise, workerScriptOverride) {\n    this._Promise = Promise;\n    this._busy = true;\n\n    if (!workerScriptOverride) {\n        this._worker = new Worker(\"./build/worker.bundle.js\");\n    } else {\n        this._worker = new Worker(workerScriptOverride);\n    }\n\n    this._taskQueue = [];\n    this._freeListener = [];\n    this._taskCallback = null;\n    this._metaListener = null;\n\n    this._worker.onmessage = this._workerMessage.bind(this);\n\n    this._worker.postMessage({\n        action: \"setup\"\n    });\n};\n\nPromiseWorker.prototype._workerMessage = function (event) {\n    var data = event.data.data; var type = event.data.type;\n    if (type === \"meta\" && this._metaListener) {\n        this._metaListener(data);\n    } else if (type === \"resultTask\") {\n        this._taskCallback.resolve(data);\n        this._free();\n    } else if (type === \"setup\") {\n        this._free();\n    } else if (type === \"error\") {\n        this._taskCallback.reject(data);\n        this._free();\n    }\n};\n\nPromiseWorker.prototype.isBusy = function () {\n    return this._busy;\n};\n\nPromiseWorker.prototype._lockFree = function () {\n    var that = this;\n    return new this._Promise(function (resolve) {\n        that._taskQueue.push(resolve);\n        that._checkQueues();\n    });\n};\n\nPromiseWorker.prototype.runIfFree = function (data, metaListener) {\n    if (!this._busy) {\n        return this._run(data, metaListener);\n    }\n\n    return false;\n};\n\nPromiseWorker.prototype.onFree = function (cb) {\n    this._freeListener.push(cb);\n};\n\n/** called when the worker is freed.\n    - checks if there are any waiting tasks and runs them\n    - if no waiting tasks exist calls free listener.\n */\nPromiseWorker.prototype._free = function () {\n    this._busy = false;\n    this._taskCallback = null;\n    this._metaListener = null;\n\n    this._checkQueues();\n};\n\nPromiseWorker.prototype._checkQueues = function () {\n    if (this._busy) {\n        return;\n    }\n\n    if (this._taskQueue.length > 0) {\n        this._busy = true;\n        this._taskQueue.shift()();\n\n        return;\n    }\n\n    this._freeListener.forEach(function (listener) {\n        try {\n            listener();\n        } catch (e) {\n            console.error(e);\n        }\n    });\n};\n\nPromiseWorker.prototype._saveCallbacks = function (resolve, reject) {\n    this._taskCallback = {\n        resolve: resolve,\n        reject: reject\n    };\n};\n\nPromiseWorker.prototype._run = function (data, metaListener) {\n    this._busy = true;\n    this._metaListener = metaListener;\n\n    var waitPromise = new this._Promise(this._saveCallbacks.bind(this));\n    this._worker.postMessage({\n        action: \"runTask\",\n        data: data\n    });\n    return waitPromise;\n};\n\n/** run a task as soon as the worker is free\n    @param data data to sent to worker task\n    @param metaListener callback for meta information\n*/\nPromiseWorker.prototype.runTask = function (data, metaListener) {\n    return this._lockFree().then(this._run.bind(this, data, metaListener));\n};\n\nmodule.exports = PromiseWorker;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/worker/worker-loader.js","\"use strict\";\n\nconst chelper = require(\"crypto/minimalHelper\");\nconst sjcl = require(\"sjcl\");\n\nvar ObjectHasher = function (data, version) {\n\tthis._data = data;\n\tthis._version = parseInt(version, 10);\n};\n\nObjectHasher.prototype.sjclHash = function (data) {\n\treturn \"hash::\" + chelper.bits2hex(sjcl.hash.sha256.hash(data));\n};\n\nObjectHasher.prototype._hashProperty = function (val) {\n\treturn (this._version >= 2 ? val.toString() : this.sjclHash(\"data::\" + val.toString()));\n};\n\nObjectHasher.prototype._doHashNewObject = function (val) {\n\tvar hasher = new ObjectHasher(val, this._version);\n\tif (this._version === 3) {\n\t\treturn hasher.stringify();\n\t}\n\n\treturn this.sjclHash(hasher.stringify());\n};\n\nObjectHasher.prototype._doHash = function (val, attr) {\n\tvar allowedTypes = [\"number\", \"string\", \"boolean\"];\n\n\tif (attr === \"hash\") {\n\t\tthrow new Error(\"object can not have hash attributes\");\n\t}\n\n\tvar type = typeof val;\n\tif (type === \"object\") {\n\t\treturn this._doHashNewObject(val);\n\t}\n\n\tif (allowedTypes.indexOf(type) > -1) {\n\t\treturn this._hashProperty(val);\n\t}\n\n\tthrow new Error(\"can not hash objects with \" + type);\n};\n\nObjectHasher.prototype._stringifyArray = function () {\n\tvar i, result = [];\n\tfor (i = 0; i < this._data.length; i += 1) {\n\t\tresult.push(this._doHash(this._data[i]), i);\n\t}\n\n\treturn JSON.stringify(result);\n};\n\nObjectHasher.prototype._jsonifyUnique = function (obj) {\n\tvar sortation = Object.keys(obj).sort();\n\treturn JSON.stringify(obj, sortation);\n};\n\nObjectHasher.prototype._stringifyObject = function () {\n\tvar attr, hashObj = {};\n\tfor (attr in this._data) {\n\t\tif (this._data.hasOwnProperty(attr)) {\n\t\t\thashObj[attr] = this._doHash(this._data[attr], attr);\n\t\t}\n\t}\n\n\treturn this._jsonifyUnique(hashObj);\n};\n\nObjectHasher.prototype._stringifyObjectOrArray = function () {\n\tif (this._data instanceof Array) {\n\t\treturn this._stringifyArray();\n\t} else {\n\t\treturn this._stringifyObject();\n\t}\n};\n\nObjectHasher.prototype.stringify = function() {\n\tif (typeof this._data !== \"object\") {\n\t\tthrow new Error(\"this is not an object!\");\n\t}\n\n\tif (this._version === 4) {\n\t\treturn JSON.stringify(ObjectHasher.handleVal(this._data));\n\t}\n\n\treturn this._stringifyObjectOrArray();\n};\n\nObjectHasher.prototype.hash = function () {\n\treturn chelper.bits2hex(this.hashBits());\n};\n\nObjectHasher.prototype.hashBits = function () {\n\treturn sjcl.hash.sha256.hash(this.stringify());\n};\n\nObjectHasher.getType = function (val) {\n\tif (typeof val === \"object\") {\n\t\tif (val instanceof Array) {\n\t\t\treturn \"arr\";\n\t\t} else {\n\t\t\treturn \"obj\";\n\t\t}\n\t}\n\n\treturn \"val\";\n};\n\nObjectHasher.transformVal = function (val) {\n\tif (typeof val === \"object\") {\n\t\tif (val instanceof Array) {\n\t\t\treturn val.map(ObjectHasher.handleVal);\n\t\t} else {\n\t\t\treturn ObjectHasher.mapToArray(val);\n\t\t}\n\t}\n\n\treturn val.toString();\n};\n\nObjectHasher.handleVal = function (val, key) {\n\tif (key) {\n\t\treturn [\n\t\t\tObjectHasher.getType(val),\n\t\t\tkey,\n\t\t\tObjectHasher.transformVal(val)\n\t\t];\n\t}\n\n\treturn [\n\t\tObjectHasher.getType(val),\n\t\tObjectHasher.transformVal(val)\n\t];\n};\n\nObjectHasher.mapToArray = function (obj) {\n\treturn Object.keys(obj).sort().map(function (key) {\n\t\treturn ObjectHasher.handleVal(obj[key], key);\n\t});\n};\n\nmodule.exports = ObjectHasher;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/crypto/objectHasher.js","var sessionService = require(\"services/session.service\").default;\nvar socketService = require(\"services/socket.service\").default;\n\nvar interceptor = {\n\n\ttransformResponse: function (response, request) {\n\t\tif (request.sid && !response.logedin) {\n\t\t\tsessionService.logout();\n\t\t}\n\t\treturn response;\n\t},\n\n\ttransformRequest: function(request) {\n\t\trequest.sid = sessionService.getSID();\n\t\treturn request;\n\t}\n};\n\nsocketService.addInterceptor(interceptor);\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/interceptors/sessionServiceInterceptor.js","var Bluebird = require(\"bluebird\");\nvar h = require(\"../helper/helper\").default;\n\nvar errorService = require(\"services/error.service\").errorServiceInstance;\n\nvar migrations = [\"regenerateFriendsKeys\", \"fixBrokenSettings\"];\n\nfunction runMigration(ownUser, migrationState) {\n\treturn Bluebird.try(function () {\n\t\tvar migration = require(\"migrations/\" + h.pad(\"\" + (migrationState + 1), 5) + \"-\" + migrations[migrationState]);\n\t\treturn migration();\n\t}).then(function (success) {\n\t\tif (!success) {\n\t\t\tconsole.error(\"Migration failed \" + migrationState, success);\n\t\t\t//AUTSCH!\n\t\t} else {\n\t\t\treturn ownUser.setMigrationState(migrationState + 1);\n\t\t}\n\t});\n}\n\n\nvar doMigration = function () {\n\tvar ownUser = require(\"users/userService\").default.getOwn(), migrationState;\n\n\tif (ownUser) {\n\t\townUser.getMigrationState().then(function(state) {\n\t\t\tmigrationState = h.parseDecimal(state) || 0;\n\t\t\tif (migrationState < migrations.length) {\n\t\t\t\treturn runMigration(ownUser, migrationState);\n\t\t\t}\n\t\t}).catch(errorService.criticalError);\n\t}\n};\n\nmodule.exports = doMigration;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/migrationService.js","var map = {\n\t\"./00001-regenerateFriendsKeys\": 182,\n\t\"./00001-regenerateFriendsKeys.js\": 182,\n\t\"./00002-fixBrokenSettings\": 185,\n\t\"./00002-fixBrokenSettings.js\": 185,\n\t\"./migrationExample\": 186,\n\t\"./migrationExample.js\": 186\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) // check for number or string\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\treturn id;\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 359;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/lib/migrations ^\\.\\/.*$\n// module id = 359\n// module chunks = 12","import errorService from \"../services/error.service\"\nimport socketService from \"../services/socket.service\"\n\nimport h from \"../helper/helper\"\nimport * as Bluebird from \"bluebird\"\n\nconst initService = require(\"services/initService\")\nimport State from \"../asset/state\"\nconst keyStoreService = require(\"crypto/keyStore\")\nconst signatureCache = require(\"crypto/signatureCache\")\n\nimport sessionService from \"../services/session.service\"\nimport blobService from \"../services/blobService\"\nimport Profile from \"../users/profile\"\nimport trustService from \"../services/trust.service\"\nimport settingsService from \"../services/settings.service\"\nimport filterService from \"../services/filter.service\"\nimport { reloadApp, isIOS } from \"../services/location.manager\"\nimport MutableObjectLoader, { UpdateEvent } from \"../services/mutableObjectLoader\"\n\nimport requestKeyService from \"../services/requestKey.service\"\n\nimport { ProfileLoader } from \"../users/profile\"\nimport { SignedKeysLoader } from \"../users/signedKeys\"\n\nconst friendsService = require(\"services/friendsService\")\nconst trustManager = require(\"crypto/trustManager\")\n\nconst RELOAD_DELAY_MIN = 10 * 1000\nconst RELOAD_DELAY_MAX = 60 * 1000\nconst RELOAD_OWN_DELAY = 5 * 1000\nconst advancedBranches = [\"location\", \"birthday\", \"relationship\", \"education\", \"work\", \"gender\", \"languages\"]\n\nconst advancedDefaults = {\n\tlocation: {},\n\tbirthday: {},\n\trelationship: {},\n\teducation: [],\n\twork: {},\n\tgender: {},\n\tlanguages: []\n}\n\nfunction applicableParts(scope, privacy, profile) {\n\tvar result = {}\n\n\tif (privacy === undefined || profile === undefined) {\n\t\tthrow new Error(\"dafuq\")\n\t}\n\n\th.objectEach(privacy, (key, val) => {\n\t\tif (profile[key]) {\n\t\t\tif (typeof val.encrypt !== \"undefined\") {\n\t\t\t\tif (!val.encrypt || val.visibility.indexOf(scope) > -1) {\n\t\t\t\t\tresult[key] = profile[key]\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresult[key] = applicableParts(scope, val, profile[key])\n\t\t\t}\n\t\t}\n\t})\n\n\treturn result\n}\n\nfunction applicablePublicParts(privacy, profile) {\n\tvar result = {}\n\n\tif (privacy === undefined || profile === undefined) {\n\t\tthrow new Error(\"dafuq\")\n\t}\n\n\th.objectEach(privacy, (key, value) => {\n\t\tif (profile[key]) {\n\t\t\tif (typeof value.encrypt !== \"undefined\") {\n\t\t\t\tif (!value.encrypt) {\n\t\t\t\t\tresult[key] = profile[key]\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresult[key] = applicablePublicParts(value, profile[key])\n\t\t\t}\n\t\t}\n\t})\n\n\treturn result\n}\n\nfunction getAllProfileTypes(privacySettings) {\n\tvar profileTypes = []\n\tadvancedBranches.forEach((branch) => {\n\t\tif (privacySettings[branch].encrypt) {\n\t\t\tprofileTypes = profileTypes.concat(privacySettings[branch].visibility)\n\t\t}\n\t})\n\n\tif (privacySettings.basic.firstname.encrypt) {\n\t\tprofileTypes = profileTypes.concat(privacySettings.basic.firstname.visibility)\n\t}\n\n\tif (privacySettings.basic.lastname.encrypt) {\n\t\tprofileTypes = profileTypes.concat(privacySettings.basic.lastname.visibility)\n\t}\n\n\treturn h.arrayUnique(profileTypes)\n}\n\nfunction deleteCache() {\n\treturn Bluebird.try(() => {\n\t\treturn new Bluebird((resolve) => {\n\t\t\tvar deleteRequest = indexedDB.deleteDatabase(\"whispeerCache\")\n\n\t\t\tdeleteRequest.onerror = resolve\n\t\t\tdeleteRequest.onsuccess = resolve\n\t\t})\n\t})\n}\n\ninterface UserInterface {\n\tgetID: () => number\n\n\tgenerateNewFriendsKey: () => any\n\trebuildProfiles: () => any\n\tgetFingerPrint: () => any\n\tcreateBackupKey: () => any\n\tgetTrustLevel: () => any\n\n\tloadFullData: () => any\n\tloadImage: () => any\n\tloadBasicData: () => any\n\n\tgetMigrationState: () => any\n\tisOwn: () => any\n\tgetNickOrMail: () => any\n\n\tgetMainKey: () => any\n\tgetSignKey: () => any\n\tgetCryptKey: () => any\n\tgetFriendShipKey: () => any\n\tgetContactKey: () => any\n\tgetFriendsKey: () => any\n\n\tgetNickname: () => any\n\tgetMail: () => any\n\tgetName: () => any\n\n\tisNotExistingUser: () => any\n\tignoreFriendShip: () => any\n\tacceptFriendShip: () => any\n\tremoveAsFriend: () => any\n\taddAsFriend: () => any\n\tisBlocked: () => boolean\n}\n\ntype ProfilesType = {\n\tprivate: Profile[],\n\tme: Profile,\n\tpublic: Profile\n}\n\nclass User implements UserInterface {\n\tprivate mainKey\n\tprivate signKey\n\tprivate cryptKey\n\tprivate friendShipKey\n\tprivate friendsKey\n\tprivate migrationState\n\tprivate signedKeys\n\n\tprivate id\n\tprivate mail\n\tprivate nickname\n\tprivate profiles:ProfilesType = {\n\t\tprivate: [],\n\t\tme: null,\n\t\tpublic: null,\n\t}\n\tprivate mutualFriends\n\n\tprivate addFriendState = new State()\n\tprivate ignoreFriendState = new State()\n\n\tprivate loadBasicDataPromise\n\n\tdata: any = {}\n\n\tconstructor (userData, signedKeys, profiles: ProfilesType) {\n\t\tthis.id = h.parseDecimal(userData.id)\n\t\tthis.mainKey = userData.mainKey\n\n\t\tthis.signedKeys = signedKeys\n\n\t\t//all keys we get from the signedKeys object:\n\t\tthis.signKey = this.signedKeys.metaAttr(\"sign\")\n\t\tthis.cryptKey = this.signedKeys.metaAttr(\"crypt\")\n\n\t\tthis.nickname = userData.nickname\n\n\t\tconst { mutualFriends, mail, migrationState = 0 } = userData\n\n\t\tthis.setData()\n\t\tthis.update({ mutualFriends, mail, migrationState, profiles })\n\t\tthis.attachListener()\n\t}\n\n\tupdate = ({ mutualFriends, mail, migrationState, profiles }: { mutualFriends: number[], mail: string, migrationState: number, profiles:ProfilesType}) => {\n\t\tthis.mutualFriends = mutualFriends\n\t\tthis.mail = mail\n\t\tthis.migrationState = migrationState\n\t\tthis.profiles = profiles\n\n\t\tthis.data.mutualFriends = this.mutualFriends\n\n\t\tthis.setNames()\n\n\t\tadvancedBranches.map((branch) => {\n\t\t\tthis.data.advanced[branch] = this.getAdvancedAttribute(branch)\n\t\t})\n\t}\n\n\tprivate setNames = () => {\n\t\tconst names = this.getName()\n\n\t\tthis.data.name = names.name\n\t\tthis.data.names = names\n\n\t\tthis.data.basic.shortname = names.shortname\n\t}\n\n\tisBlocked = () =>\n\t\tsettingsService.isBlocked(this.id)\n\n\tprivate setData = () => {\n\t\tthis.data = {\n\t\t\tnotExisting: false,\n\t\t\tuser: this,\n\n\t\t\tid: this.id,\n\n\t\t\ttrustLevel: 0,\n\n\t\t\tsignatureValid: true,\n\t\t\tfingerprint: keyStoreService.format.fingerPrint(this.signKey),\n\n\t\t\taddFriendState: this.addFriendState.data,\n\t\t\tignoreFriendState: this.ignoreFriendState.data,\n\n\t\t\tme: this.isOwn(),\n\t\t\tother: !this.isOwn(),\n\t\t\tonline: friendsService.onlineStatus(this.getID()) || 0,\n\n\t\t\tbasic: {\n\t\t\t\tage: \"?\",\n\t\t\t\tlocation: \"?\",\n\t\t\t\tmutualFriends: [],\n\t\t\t\turl: \"user/\" + this.nickname,\n\t\t\t\timage: \"assets/img/user.png\"\n\t\t\t},\n\t\t\tadvanced: {}\n\t\t}\n\t}\n\n\tprivate getAdvancedAttribute(branch) {\n\t\tconst result = this.getProfileAttribute(branch)\n\n\t\tif (branch === \"gender\" && typeof result === \"string\") {\n\t\t\treturn h.deepCopyObj({ gender: result })\n\t\t}\n\n\t\treturn h.deepCopyObj(result || advancedDefaults[branch], 3)\n\t}\n\n\tprivate attachListener = () => {\n\t\tif (this.isOwn()) {\n\t\t\tthis.friendsKey = this.signedKeys.metaAttr(\"friends\")\n\t\t} else {\n\t\t\tfriendsService.awaitLoading().then(() => {\n\t\t\t\tif (friendsService.didOtherRequest(this.id)) {\n\t\t\t\t\tthis.friendsKey = this.signedKeys.metaAttr(\"friends\")\n\t\t\t\t}\n\n\t\t\t\tif (friendsService.didIRequest(this.id)) {\n\t\t\t\t\tthis.friendShipKey = friendsService.getUserFriendShipKey(this.id)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tfriendsService.listen((status) => {\n\t\t\tthis.data.online = status\n\t\t}, \"online:\" + this.getID())\n\n\t\tfriendsService.awaitLoading().then(() => {\n\t\t\tthis.data.added = friendsService.didIRequest(this.getID())\n\t\t\tthis.data.isMyFriend = friendsService.areFriends(this.getID())\n\n\t\t\tfriendsService.listen(() => {\n\t\t\t\tthis.data.added = friendsService.didIRequest(this.getID())\n\t\t\t\tthis.data.isMyFriend = friendsService.areFriends(this.getID())\n\t\t\t})\n\t\t})\n\n\t\tsettingsService.listen(() => this.setNames(), \"updated\")\n\t}\n\n\tgenerateNewFriendsKey = () => {\n\t\tvar newFriendsKey\n\t\treturn Bluebird.try(() => {\n\t\t\tif (!this.isOwn()) {\n\t\t\t\tthrow new Error(\"not my own user\")\n\t\t\t}\n\n\t\t\t//generate new key\n\t\t\treturn keyStoreService.sym.generateKey(null, \"friends\")\n\t\t}).then((_newFriendsKey) => {\n\t\t\tnewFriendsKey = _newFriendsKey\n\n\t\t\t//encrypt with all friendShipKeys\n\t\t\tvar keys = friendsService.getAllFriendShipKeys()\n\n\t\t\tvar keysPromises = keys.map((key) => {\n\t\t\t\treturn keyStoreService.sym.symEncryptKey(newFriendsKey, key)\n\t\t\t})\n\n\t\t\treturn Bluebird.all([\n\t\t\t\tBluebird.all(keysPromises),\n\t\t\t\tkeyStoreService.sym.symEncryptKey(newFriendsKey, this.mainKey),\n\n\t\t\t\t//encrypt old friends key with new friends key\n\t\t\t\tkeyStoreService.sym.symEncryptKey(this.friendsKey, newFriendsKey),\n\t\t\t])\n\t\t}).then(() => {\n\t\t\t//update signedKeys\n\t\t\tthis.signedKeys.metaSetAttr(\"friends\", newFriendsKey)\n\t\t\treturn this.signedKeys.getUpdatedData(this.signKey)\n\t\t}).then((updatedSignedKeys) => {\n\t\t\tthis.friendsKey = newFriendsKey\n\t\t\treturn {\n\t\t\t\tupdatedSignedKeys,\n\t\t\t\tnewFriendsKey\n\t\t\t}\n\t\t})\n\t}\n\n\tsetFriendShipKey = (key) => {\n\t\tif (!this.friendShipKey) {\n\t\t\tthis.friendShipKey = key\n\t\t}\n\t}\n\n\t/** profile management */\n\n\t// there is mainly one profile: the \"me\" profile, containing all data.\n\t// this profile is always updated when we edit the profile.\n\t// every other profile is a smaller part of this profile and is generated\n\t// after updating the \"me\" profile (or at other times - e.g. when settings change)\n\n\t/* gets a given profile attribute to value\n\t* @param attribute attribute to set\n\t* @param cb\n\t*/\n\tgetProfileAttribute = (attribute) => {\n\t\tif (this.profiles.me) {\n\t\t\treturn this.profiles.me.getAttribute(attribute)\n\t\t}\n\n\t\tvar profiles = this.profiles.private.concat([this.profiles.public])\n\n\t\tconst values = profiles.map((profile: Profile) => {\n\t\t\treturn profile.getAttribute(attribute)\n\t\t}).filter((value: any) => {\n\t\t\treturn typeof value !== \"undefined\" && value !== \"\"\n\t\t})\n\n\t\tif (values.length === 0) {\n\t\t\treturn \"\"\n\t\t}\n\n\t\tvalues.sort((val1, val2) => {\n\t\t\tif (typeof val1 === \"object\" && typeof val2 === \"object\") {\n\t\t\t\treturn Object.keys(val2).length - Object.keys(val1).length\n\t\t\t}\n\n\t\t\treturn 0\n\t\t})\n\n\t\treturn values[0]\n\t}\n\n\t/** uses the me profile to generate new profiles */\n\trebuildProfiles = () => {\n\t\tvar scopes, privacySettings\n\t\treturn Bluebird.try(() => {\n\t\t\tif (!this.isOwn()) {\n\t\t\t\tthrow new Error(\"update on another user failed\")\n\t\t\t}\n\n\t\t\tprivacySettings = settingsService.getBranch(\"privacy\")\n\t\t\tscopes = getAllProfileTypes(privacySettings)\n\n\t\t\treturn filterService.filterToKeys(scopes)\n\t\t}).then((keys: any) => {\n\t\t\tconst profile = this.profiles.me.getFull()\n\n\t\t\tvar scopeData = h.joinArraysToObject({\n\t\t\t\tname: scopes,\n\t\t\t\tkey: keys.slice(0, keys.length - 1)\n\t\t\t})\n\n\t\t\tvar pub = new Profile({ content: applicablePublicParts(privacySettings, profile) }, { isPublicProfile: true })\n\t\t\tvar pubPromise = pub.sign(this.getSignKey())\n\n\t\t\tvar privatePromises = scopeData.map((scope) => {\n\t\t\t\tvar newProfile = new Profile({\n\t\t\t\t\tcontent: applicableParts(scope.name, privacySettings, profile)\n\t\t\t\t})\n\n\t\t\t\treturn newProfile.signAndEncrypt(this.getSignKey(), scope.key)\n\t\t\t})\n\n\t\t\treturn Bluebird.all([\n\t\t\t\tpubPromise,\n\t\t\t\tBluebird.all(privatePromises)\n\t\t\t])\n\t\t}).spread((pub, profileData) => {\n\t\t\treturn {\n\t\t\t\tpub: pub,\n\t\t\t\tpriv: profileData\n\t\t\t}\n\t\t})\n\n\t}\n\n\tsetMail = (newMail, cb) => {\n\t\tif (newMail === this.mail) {\n\t\t\treturn Bluebird.resolve().nodeify(cb)\n\t\t}\n\n\t\treturn socketService.emit(\"user.mailChange\", { mail: newMail }).then(() => {\n\t\t\tthis.mail = newMail\n\t\t}).nodeify(cb)\n\t}\n\n\t/** uploads all profiles (also recreates them) */\n\tuploadChangedProfile = (cb) => {\n\t\treturn Bluebird.try(() => {\n\t\t\treturn Bluebird.all([\n\t\t\t\tthis.rebuildProfiles(),\n\t\t\t\tthis.profiles.me.getUpdatedData(this.getSignKey())\n\t\t\t])\n\t\t}).spread((profileData, myProfile: any) => {\n\t\t\tprofileData.me = myProfile\n\n\t\t\treturn socketService.emit(\"user.profile.update\", profileData)\n\t\t}).then(() => {\n\t\t\tthis.profiles.me.updated()\n\n\t\t\tthis.loadBasicDataPromise = null\n\t\t\treturn this.loadBasicData()\n\t\t}).nodeify(cb)\n\t}\n\n\t/* sets a given profile attribute to value\n\t* @param attribute attribute to set\n\t* @param value value of the attribute\n\t* @param cb\n\t*/\n\tsetProfileAttribute = (attribute, value) => {\n\t\treturn this.profiles.me.setAttribute(attribute, value)\n\t}\n\n\tremoveProfileAttribute = (attribute) => {\n\t\treturn this.profiles.me.removeAttribute(attribute)\n\t}\n\n\tgetFingerPrint = () => {\n\t\treturn keyStoreService.format.fingerPrint(this.getSignKey())\n\t}\n\n\tsetAdvancedProfile = (advancedProfile, cb) => {\n\t\treturn Bluebird.resolve(advancedBranches).map((branch: string) => {\n\t\t\treturn this.profiles.me.setAttribute(branch, advancedProfile[branch])\n\t\t}).nodeify(cb)\n\t}\n\n\t/** end profile management */\n\n\tverifyFingerPrint = (fingerPrint) => {\n\t\treturn Bluebird.try(() => {\n\t\t\tif (fingerPrint !== keyStoreService.format.fingerPrint(this.getSignKey())) {\n\t\t\t\tthrow new Error(\"wrong code\")\n\t\t\t}\n\n\t\t\treturn trustService.verifyUser(this)\n\t\t}).then(() => {\n\t\t\tthis.data.trustLevel = 2\n\t\t})\n\t}\n\n\tcreateBackupKey = () => {\n\t\tvar outerKey\n\t\treturn Bluebird.try(() => {\n\t\t\treturn initService.awaitLoading()\n\t\t}).then(() => {\n\t\t\treturn keyStoreService.sym.createBackupKey(this.mainKey)\n\t\t}).then((backupKeyData) => {\n\t\t\tvar decryptors = backupKeyData.decryptors\n\t\t\tvar innerKey = backupKeyData.innerKey\n\n\t\t\touterKey = backupKeyData.outerKey\n\n\t\t\treturn socketService.emit(\"user.backupKey\", {\n\t\t\t\tinnerKey: innerKey,\n\t\t\t\tdecryptors: decryptors\n\t\t\t})\n\t\t}).then((data) => {\n\t\t\tif (data.error) {\n\t\t\t\tthrow new Error(\"server error\")\n\t\t\t}\n\n\t\t\treturn keyStoreService.format.base32(outerKey)\n\t\t})\n\t}\n\n\tgetTrustLevel = () => {\n\t\tconst trust = trustService.getKey(this.getSignKey())\n\n\t\tif (trust.isOwn()) {\n\t\t\treturn -1\n\t\t}\n\n\t\tif (trust.isVerified()) {\n\t\t\treturn 2\n\t\t}\n\n\t\tif (trust.isWhispeerVerified() || trust.isNetworkVerified()) {\n\t\t\treturn 1\n\t\t}\n\n\t\treturn 0\n\t}\n\n\tchangePassword = (newPassword, cb) => {\n\t\treturn Bluebird.try(() => {\n\t\t\tif (!this.isOwn()) {\n\t\t\t\tthrow new Error(\"not my own user\")\n\t\t\t}\n\n\t\t\tvar ownKeys = {main: this.mainKey, sign: this.signKey}\n\n\t\t\treturn Bluebird.all([\n\t\t\t\tkeyStoreService.security.makePWVerifiable(ownKeys, newPassword),\n\t\t\t\tkeyStoreService.random.hex(16),\n\n\t\t\t\tkeyStoreService.sym.pwEncryptKey(this.mainKey, newPassword),\n\n\t\t\t\tdeleteCache(),\n\t\t\t])\n\t\t}).spread((signedOwnKeys, salt, decryptor) => {\n\t\t\treturn socketService.emit(\"user.changePassword\", {\n\t\t\t\tsignedOwnKeys,\n\t\t\t\tpassword: {\n\t\t\t\t\tsalt: salt,\n\t\t\t\t\thash: keyStoreService.hash.hashPW(newPassword, salt),\n\t\t\t\t},\n\t\t\t\tdecryptor: decryptor\n\t\t\t})\n\t\t}).then(() => {\n\t\t\tsessionService.setPassword(newPassword)\n\t\t}).nodeify(cb)\n\t}\n\n\tloadFullData = () => {\n\t\treturn this.loadBasicData()\n\t}\n\n\tgetFriends = (cb) => {\n\t\treturn friendsService.getUserFriends(this.getID(), cb)\n\t}\n\n\tloadImage = () => {\n\t\tconst blob = this.getProfileAttribute(\"imageBlob\")\n\n\t\tif (!blob) {\n\t\t\tthis.data.basic.image = \"assets/img/user.png\"\n\t\t\treturn\n\t\t}\n\n\t\treturn blobService.getBlobUrl(blob.blobid).then(url =>\n\t\t\tisIOS() ?\n\t\t\t\turl.replace(\"file://\", \"\") : url\n\t\t).then((imageUrl) => {\n\t\t\tthis.data.basic.image = imageUrl\n\t\t}).catch((e) => errorService.criticalError(e))\n\t}\n\n\tloadBasicData = () => {\n\t\tthis.data.trustLevel = this.getTrustLevel()\n\n\t\tthis.loadImage()\n\n\t\treturn Bluebird.resolve()\n\t}\n\n\tsetMigrationState = (migrationState, cb) => {\n\t\treturn socketService.emit(\"user.setMigrationState\", {\n\t\t\t\tmigrationState: migrationState\n\t\t}).nodeify(cb)\n\t}\n\n\tgetMigrationState = () => {\n\t\treturn Bluebird.resolve(this.migrationState)\n\t}\n\n\tisOwn = () => {\n\t\treturn this.getID() === sessionService.getUserID()\n\t}\n\n\tgetNickOrMail = () => {\n\t\treturn this.nickname || this.mail\n\t}\n\n\tgetMainKey = () => {\n\t\treturn this.mainKey\n\t}\n\n\tgetSignKey = () => {\n\t\treturn this.signKey\n\t}\n\n\tgetCryptKey = () => {\n\t\treturn this.cryptKey\n\t}\n\n\tgetFriendShipKey = () => {\n\t\treturn this.friendShipKey\n\t}\n\n\tgetContactKey = () => {\n\t\treturn this.friendShipKey || this.cryptKey\n\t}\n\n\tgetFriendsKey = () => {\n\t\treturn this.friendsKey\n\t}\n\n\tgetID = () => {\n\t\treturn parseInt(this.id, 10)\n\t}\n\n\tgetNickname = () => {\n\t\treturn this.nickname\n\t}\n\n\tgetMail = () => {\n\t\treturn this.mail\n\t}\n\n\tprivate getSearchName = () => {\n\t\tconst basic = this.getProfileAttribute(\"basic\") || {}\n\t\tconst nickname = this.getNickname()\n\n\t\tconst searchNames = [nickname]\n\n\t\tif (basic.firstname) {\n\t\t\tsearchNames.push(basic.firstname)\n\t\t}\n\n\t\tif (basic.lastname) {\n\t\t\tsearchNames.push(basic.lastname)\n\t\t}\n\n\t\treturn searchNames.join(\" \").toLowerCase()\n\t}\n\n\tprivate getLongName = () => {\n\t\tconst basic = this.getProfileAttribute(\"basic\") || {}\n\t\tconst nickname = this.getNickname()\n\n\t\tif (basic.firstname && basic.lastname) {\n\t\t\treturn basic.firstname + \" \" + basic.lastname\n\t\t}\n\n\t\tif (basic.firstname || basic.lastname) {\n\t\t\treturn basic.firstname || basic.lastname\n\t\t}\n\n\t\treturn nickname\n\t}\n\n\tgetName = () => {\n\t\tconst basic = this.getProfileAttribute(\"basic\") || {}\n\t\tconst nickname = this.getNickname()\n\n\t\tif (this.isBlocked()) {\n\t\t\treturn {\n\t\t\t\tname: nickname,\n\t\t\t\toriginalName: this.getLongName(),\n\t\t\t\tsearchName: this.getSearchName(),\n\t\t\t\tfirstname: \"\",\n\t\t\t\tlastname: \"\",\n\t\t\t\tnickname: nickname,\n\t\t\t\tshortname: nickname,\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tname: this.getLongName(),\n\t\t\tsearchName: this.getSearchName(),\n\t\t\tfirstname: basic.firstname || \"\",\n\t\t\tlastname: basic.lastname || \"\",\n\t\t\tnickname: nickname,\n\t\t\tshortname: basic.firstname || basic.lastname || nickname\n\t\t}\n\t}\n\n\tignoreFriendShip = () => {\n\t\tthis.ignoreFriendState.pending()\n\t\tif (!this.isOwn()) {\n\t\t\tfriendsService.ignoreFriendShip(this.getID(), errorService.failOnError(this.ignoreFriendState))\n\t\t} else {\n\t\t\tthis.ignoreFriendState.failed()\n\t\t}\n\t}\n\n\tacceptFriendShip = () => {\n\t\tthis.addFriendState.pending()\n\t\tif (!this.isOwn()) {\n\t\t\tfriendsService.acceptFriendShip(this.getID(), errorService.failOnError(this.addFriendState))\n\t\t} else {\n\t\t\tthis.addFriendState.failed()\n\t\t}\n\t}\n\n\tisNotExistingUser = () => {\n\t\treturn false\n\t}\n\n\tremoveAsFriend = () => {\n\t\tif (!this.isOwn()) {\n\t\t\tfriendsService.removeFriend(this.getID(), errorService.criticalError)\n\t\t} else {\n\t\t\tthis.addFriendState.failed()\n\t\t}\n\t}\n\n\taddAsFriend = () => {\n\t\tthis.addFriendState.pending()\n\t\tif (!this.isOwn()) {\n\t\t\tfriendsService.friendship(this.getID(), errorService.failOnError(this.addFriendState))\n\t\t} else {\n\t\t\tthis.addFriendState.failed()\n\t\t}\n\t}\n}\n\ntype CachedUser = any\n\nfunction loadProfileInfo(profileInfo, signKey, isPublic = false) {\n\treturn ProfileLoader.load({\n\t\t...profileInfo,\n\t\tisPublic,\n\t\tsignKey\n\t})\n}\n\nconst getProfiles = (userData, signKey, isMe) => {\n\treturn Bluebird.try(async function () {\n\t\tconst profiles = {\n\t\t\tpublic: null,\n\t\t\tprivate: null,\n\t\t\tme: null\n\t\t}\n\n\t\tif (!isMe) {\n\t\t\tif (userData.profile.pub) {\n\t\t\t\tuserData.profile.pub.profileid = userData.profile.pub.profileid || userData.id\n\n\t\t\t\tprofiles.public = await loadProfileInfo(userData.profile.pub, signKey, true)\n\t\t\t}\n\n\t\t\tprofiles.private = []\n\n\t\t\tif (userData.profile.priv && userData.profile.priv instanceof Array) {\n\t\t\t\tconst priv = userData.profile.priv\n\n\t\t\t\tprofiles.private = await Bluebird.resolve(priv)\n\t\t\t\t\t.map(profile => loadProfileInfo(profile, signKey))\n\t\t\t}\n\t\t} else {\n\t\t\tprofiles.me =  await loadProfileInfo(userData.profile.me, signKey)\n\t\t}\n\n\t\treturn profiles\n\t})\n}\n\nconst deletedUserName = \"Deleted user\"\nexport class NotExistingUser implements UserInterface {\n\tdata: any\n\n\tconstructor (identifier?) {\n\t\tthis.data = {\n\t\t\ttrustLevel: -1,\n\t\t\tnotExisting: true,\n\t\t\tbasic: {\n\t\t\t\tshortname: deletedUserName,\n\t\t\t\timage: \"assets/img/user.png\"\n\t\t\t},\n\t\t\tname: deletedUserName,\n\t\t\tuser: this\n\t\t}\n\n\t\tif (typeof identifier === \"number\") {\n\t\t\tthis.data.id = identifier\n\t\t}\n\t}\n\n\tisBlocked = () => false\n\n\tgetID = () => -1\n\tgenerateNewFriendsKey = () => Bluebird.reject(new Error(\"not my own user\"))\n\tisNotExistingUser = () => true\n\tloadBasicData = () => Bluebird.resolve()\n\tloadFullData = () => Bluebird.resolve()\n\tisOwn = () => false\n\n\trebuildProfiles = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetFingerPrint = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tcreateBackupKey = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetTrustLevel = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tloadImage = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetMigrationState = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetNickOrMail = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetMainKey = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetSignKey = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetCryptKey = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetFriendShipKey = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetContactKey = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetFriendsKey = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetNickname = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetMail = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tgetName = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tignoreFriendShip = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tacceptFriendShip = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\tremoveAsFriend = () => { throw new Error(\"not implemented for NotExistingUser\") }\n\taddAsFriend = () => { throw new Error(\"not implemented for NotExistingUser\") }\n}\n\nconst improveKeyAccess = (keys, identifier) => {\n\treturn UserLoader.get(sessionService.getUserID()).then((ownUser) => {\n\t\tif (!ownUser || ownUser.getNickOrMail() !== identifier) {\n\t\t\tthrow new Error(\"user changed so no improvement update!\")\n\t\t}\n\n\t\treturn Bluebird.all(keys.map(function (keyID) {\n\t\t\treturn keyStoreService.sym.symEncryptKey(keyID, ownUser.getMainKey())\n\t\t}))\n\t}).then(function () {\n\t\treturn socketService.emit(\"key.addFasterDecryptors\", {\n\t\t\tkeys: keyStoreService.upload.getDecryptors(keys)\n\t\t})\n\t})\n}\n\nconst improvementListener = (identifier) => {\n\tlet improve = []\n\n\tkeyStoreService.addImprovementListener((rid) => {\n\t\timprove.push(rid)\n\n\t\tif (improve.length === 1) {\n\t\t\tBluebird.delay(5000).then(() => {\n\t\t\t\tconst keys = improve\n\t\t\t\timprove = []\n\n\t\t\t\treturn improveKeyAccess(keys, identifier)\n\t\t\t}).catch(errorService.criticalError)\n\t\t}\n\t})\n}\n\nfunction enhanceOwnUser(userData) {\n\tconst nickname = userData.nickname\n\tconst mainKey = userData.mainKey\n\tconst signKey = userData.signedKeys.sign\n\n\tkeyStoreService.setKeyGenIdentifier(nickname)\n\timprovementListener(nickname)\n\tkeyStoreService.sym.registerMainKey(mainKey)\n\n\tkeyStoreService.security.verifyWithPW(userData.signedOwnKeys, {\n\t\tmain: mainKey,\n\t\tsign: signKey\n\t})\n\n\tkeyStoreService.security.addEncryptionIdentifier(mainKey)\n\tkeyStoreService.security.addEncryptionIdentifier(signKey)\n\n\ttrustManager.setOwnSignKey(signKey)\n\n\ttrustService.ownKeysLoaded()\n\n\tBluebird.all([\n\t\trequestKeyService.getKey(signKey),\n\t\trequestKeyService.getKey(mainKey)\n\t]).then(() => {\n\t\trequestKeyService.cacheKey(signKey, `user-sign-${nickname}`, requestKeyService.MAXCACHETIME);\n\t\trequestKeyService.cacheKey(mainKey, `user-main-${nickname}`, requestKeyService.MAXCACHETIME);\n\t})\n}\n\nexport default class UserLoader extends MutableObjectLoader<UserInterface, CachedUser>({\n\tdownload: (id) =>\n\t\tsocketService.awaitConnection()\n\t\t\t.then(() => socketService.definitlyEmit(\"user.getMultiple\", { identifiers: [id] }))\n\t\t\t.then((response) => response.users[0]),\n\tload: (userData) =>\n\t\tBluebird.resolve(userData),\n\trestore: (userData, previousInstance) => {\n\t\tif (previousInstance) {\n\t\t\tif (previousInstance instanceof NotExistingUser && userData.userNotExisting) {\n\t\t\t\treturn previousInstance\n\t\t\t}\n\n\t\t\tif (previousInstance instanceof User && !userData.userNotExisting) {\n\t\t\t\treturn Bluebird.try(async function () {\n\t\t\t\t\tconst userID = previousInstance.getID()\n\t\t\t\t\tconst isMe = sessionService.isOwnUserID(userID)\n\t\t\t\t\tconst signKey = previousInstance.getSignKey()\n\n\t\t\t\t\tconst { mutualFriends, mail, migrationState } = userData\n\n\t\t\t\t\tconst profiles = await getProfiles(userData, signKey, isMe)\n\n\t\t\t\t\tpreviousInstance.update({ mutualFriends, mail, migrationState, profiles })\n\n\t\t\t\t\treturn previousInstance\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tconsole.warn(\"previous instance is not a user but current data is. Reloading\")\n\t\t\treloadApp()\n\t\t\treturn previousInstance\n\t\t}\n\n\t\treturn Bluebird.try(async function () {\n\t\t\tif (userData.userNotExisting) {\n\t\t\t\treturn new NotExistingUser(userData.identifier)\n\t\t\t}\n\n\t\t\tif (userData.error === true) {\n\t\t\t\treturn new NotExistingUser()\n\t\t\t}\n\n\t\t\tconst userID = h.parseDecimal(userData.id)\n\t\t\tconst isMe = sessionService.isOwnUserID(userID)\n\n\t\t\tif (isMe) {\n\t\t\t\tenhanceOwnUser(userData)\n\t\t\t\tawait signatureCache.awaitLoading()\n\t\t\t}\n\n\t\t\tconst signKey = userData.signedKeys.sign\n\t\t\tconst nickname = userData.nickname\n\n\t\t\ttrustService.addNewUsers({ key: signKey, userid: userID, nickname })\n\n\t\t\tconst signedKeys = await SignedKeysLoader.load({ signedKeys: userData.signedKeys, signKey })\n\n\t\t\tconst profiles = await getProfiles(userData, signKey, isMe)\n\n\t\t\tconst user = new User(userData, signedKeys, profiles)\n\n\t\t\tif (isMe) {\n\t\t\t\ttrustService.ownUserLoaded(user)\n\t\t\t}\n\n\t\t\treturn user\n\t\t})\n\t},\n\tshouldUpdate: (event, instance) => {\n\t\tif (sessionService.isOwnUserID(instance.getID())) {\n\t\t\treturn Bluebird.delay(RELOAD_OWN_DELAY).thenReturn(true)\n\t\t}\n\n\t\tif (event === UpdateEvent.wake) {\n\t\t\treturn Bluebird.delay(h.randomIntFromInterval(RELOAD_DELAY_MIN, RELOAD_DELAY_MAX)).thenReturn(true)\n\t\t}\n\n\t\treturn Bluebird.resolve(false)\n\t},\n\tgetID: (userData) => userData.id.toString(),\n\tcacheName: \"user\"\n}) {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/users/user.ts","interface SocketService {\n\tawaitConnection: () => Bluebird<void>;\n\temit: (channel: string, request: any) => Bluebird<any>;\n}\n\nimport * as Bluebird from \"bluebird\";\nimport Observer from \"../asset/observer\";\n\nimport { ServerError } from \"./socket.service\";\n\nimport h from \"../helper/helper\"\nimport Progress from \"../asset/Progress\"\n\nconst MAXIMUMPARTSIZE = 1000 * 1000\nconst STARTPARTSIZE = 5 * 1000\nconst MINIMUMPARTSIZE = 1 * 1000\nconst MAXIMUMTIME = 2 * 1000\n\nexport default class BlobDownloader extends Observer {\n\tprivate blobParts: ArrayBuffer[] = []\n\tprivate blobid: string\n\tprivate downloadPromise: Bluebird<{ blob: Blob, meta: any }>\n\tprivate socket: SocketService\n\tprivate partSize: number = STARTPARTSIZE\n\tprivate doneBytes: number = 0\n\tprivate done: boolean = false\n\tprivate meta: any\n\tprivate progress: Progress\n\n\tconstructor(socket: SocketService, blobid: string, progress?: Progress) {\n\t\tsuper();\n\n\t\tthis.blobid = blobid;\n\t\tthis.socket = socket;\n\t\tthis.progress = progress || new Progress()\n\t}\n\n\tdownload = () => {\n\t\tif (!this.downloadPromise) {\n\t\t\tthis.downloadPromise =  this.downloadPartsUntilDone();\n\t\t}\n\n\t\treturn this.downloadPromise;\n\t};\n\n\tprivate halfSize () {\n\t\tthis.partSize = Math.max(this.partSize / 2, MINIMUMPARTSIZE);\n\t};\n\n\tprivate doubleSize () {\n\t\tthis.partSize = Math.min(this.partSize * 2, MAXIMUMPARTSIZE);\n\t};\n\n\tprivate concatParts() {\n\t\treturn Bluebird.resolve({\n\t\t\tblob: new Blob(this.blobParts, { type: \"image/png\" }),\n\t\t\tmeta: this.meta\n\t\t})\n\t}\n\n\tprivate downloadPartsUntilDone = () : Bluebird<any> => {\n\t\tif (this.done) {\n\t\t\tthis.progress.setTotal(this.doneBytes)\n\t\t\tthis.progress.progress(this.doneBytes)\n\n\t\t\treturn this.concatParts()\n\t\t}\n\n\t\treturn this.downloadPart().then(() => {\n\t\t\treturn this.downloadPartsUntilDone();\n\t\t});\n\t}\n\n\tprivate downloadPart () {\n\t\tvar uploadStarted = new Date().getTime()\n\n\t\treturn this.socket.awaitConnection().then(() => {\n\t\t\treturn this.socket.emit(\"blob.getBlobPart\", {\n\t\t\t\tblobid: this.blobid,\n\t\t\t\tstart: this.doneBytes,\n\t\t\t\tsize: this.partSize\n\t\t\t});\n\t\t}).then((response) => {\n\t\t\tvar uploadTook = new Date().getTime() - uploadStarted;\n\n\t\t\tthis.blobParts.push(response.part)\n\t\t\tthis.doneBytes += response.part.byteLength\n\n\t\t\tthis.progress.progress(this.doneBytes)\n\n\t\t\tif (uploadTook > MAXIMUMTIME) {\n\t\t\t\tthis.halfSize();\n\t\t\t} else {\n\t\t\t\tthis.doubleSize();\n\t\t\t}\n\n\t\t\tthis.done = response.last\n\t\t\tthis.meta = response.meta\n\n\t\t\tthis.notify(this.doneBytes, \"progress\");\n\t\t}).catch((e: any) => {\n\t\t\tif (e instanceof ServerError) {\n\t\t\t\tconst response = e.extra.response\n\n\t\t\t\tif (h.hasErrorId(response, 71)) {\n\t\t\t\t\treturn Bluebird.reject(e)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconsole.error(e);\n\t\t\tthis.halfSize();\n\t\t\treturn Bluebird.delay(5000);\n\t\t});\n\t};\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/blobDownloader.service.ts","(function () {\n\t\"use strict\";\n\tvar profileJSON = {\n\t\t\"type\": \"object\",\n\t\t\"properties\": {\n\t\t\t\"basic\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"firstname\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"lastname\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"image\": {\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"pattern\": /^(|data:image\\/\\w+;base64,[A-Za-z0-9+\\/=]*)$/\n\t\t\t},\n\n\t\t\t\"imageBlob\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"additionalProperties\": false,\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"imageHash\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"pattern\": /^[A-Fa-f0-9]*$/\n\t\t\t\t\t},\n\t\t\t\t\t\"blobid\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"pattern\": /^[A-z0-9]*$/\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"location\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"road\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"number\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"town\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"state\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"country\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"contact\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"im\": {\n\t\t\t\t\t\t\"type\": \"Array\",\n\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\t\t\"messenger\": {\n\t\t\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\t\t\"enum\": [\"icq\", \"skype\", \"jabber\"]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"address\": {\n\t\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"mail\": {\n\t\t\t\t\t\t\"type\": \"Array\",\n\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\"format\": \"email\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"telephone\": {\n\t\t\t\t\t\t\"type\": \"Array\",\n\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\t\t\"where\": {\n\t\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"number\": {\n\t\t\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\t\t\"format\": \"phone\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"mobile\": {\n\t\t\t\t\t\t\"type\": \"Array\",\n\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\t\t\"where\": {\n\t\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"number\": {\n\t\t\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\t\t\"format\": \"phone\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"website\": {\n\t\t\t\t\t\t\"type\": \"Array\",\n\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\"format\": \"url\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"relationship\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"partner\": {\n\t\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\t\"user\": {\n\t\t\t\t\t\t\t\t\"type\": \"integer\",\n\t\t\t\t\t\t\t\t\"minimum\": 1\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"partnerSignature\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"since\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"format\": \"date\",\n\t\t\t\t\t\t\"after\": \"1900-01-01\"\n\t\t\t\t\t},\n\t\t\t\t\t\"status\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"enum\": [\"single\", \"relationship\", \"engaged\", \"married\", \"divorced\", \"widowed\", \"complicated\", \"open\", \"inlove\"]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"relatives\": {\n\t\t\t\t\"type\": \"array\",\n\t\t\t\t\"items\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\"user\": {\n\t\t\t\t\t\t\t\"type\": \"integer\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"status\": {\n\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\"enum\": [\n\t\t\t\t\t\t\t\t\"sister\",\n\t\t\t\t\t\t\t\t\"brother\",\n\n\t\t\t\t\t\t\t\t\"mother\",\n\t\t\t\t\t\t\t\t\"father\",\n\n\t\t\t\t\t\t\t\t\"daughter\",\n\t\t\t\t\t\t\t\t\"son\",\n\n\t\t\t\t\t\t\t\t\"aunt\",\n\t\t\t\t\t\t\t\t\"uncle\",\n\n\t\t\t\t\t\t\t\t\"niece\",\n\t\t\t\t\t\t\t\t\"nephew\",\n\n\t\t\t\t\t\t\t\t\"femalecousin\",\n\t\t\t\t\t\t\t\t\"malecousin\",\n\n\t\t\t\t\t\t\t\t\"grandmother\",\n\t\t\t\t\t\t\t\t\"grandfather\",\n\n\t\t\t\t\t\t\t\t\"granddaughter\",\n\t\t\t\t\t\t\t\t\"grandson\",\n\n\t\t\t\t\t\t\t\t\"stepsister\",\n\t\t\t\t\t\t\t\t\"stepbrother\",\n\n\t\t\t\t\t\t\t\t\"stepmother\",\n\t\t\t\t\t\t\t\t\"stepfather\",\n\n\t\t\t\t\t\t\t\t\"stepdaughter\",\n\t\t\t\t\t\t\t\t\"stepson\",\n\n\t\t\t\t\t\t\t\t\"sister-in-law\",\n\t\t\t\t\t\t\t\t\"brother-in-law\",\n\n\t\t\t\t\t\t\t\t\"mother-in-law\",\n\t\t\t\t\t\t\t\t\"father-in-law\",\n\n\t\t\t\t\t\t\t\t\"daughter-in-law\",\n\t\t\t\t\t\t\t\t\"son-in-law\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"extended\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"sex\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"enum\": [\"f\", \"m\"]\n\t\t\t\t\t},\n\t\t\t\t\t\"birthday\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"format\": \"date\",\n\t\t\t\t\t\t\"after\": \"1900-01-01\"\n\t\t\t\t\t},\n\t\t\t\t\t\"religion\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"political\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"knowledge\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"education\": {\n\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\t\t\"name\": {\n\t\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"startDate\": {\n\t\t\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\t\t\"format\": \"date\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"endDate\": {\n\t\t\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\t\t\"format\": \"date\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"edutype\": {\n\t\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"titles\": {\n\t\t\t\t\t\t\t\t\t\"type\": \"Array\",\n\t\t\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\t\t\t\t\t\"name\": {\n\t\t\t\t\t\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\"date\": {\n\t\t\t\t\t\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"format\": \"date\"\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"knowledge\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"languages\": {\n\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"jobs\": {\n\t\t\t\t\"type\": \"array\",\n\t\t\t\t\"items\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\"title\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"company\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"startDate\": {\n\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\"format\": \"date\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"endDate\": {\n\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\"format\": \"date\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tif (typeof module !== \"undefined\" && module.exports) {\n\t\tmodule.exports = profileJSON;\n\t} else if (typeof define !== \"undefined\") {\n\t\tdefine(function() {\n\t\t\treturn profileJSON;\n\t\t});\n\t}\n})();\n\n\n// WEBPACK FOOTER //\n// ./src/lib/validation/validations/profileV.js","(function () {\n\t\"use strict\";\n\n\tvar profileEncryptedJSON = {\n\t\t\"type\": \"object\",\n\t\t\"properties\": {\n\t\t\t\"basic\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"iv\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"ct\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"image\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"iv\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"ct\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"location\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"iv\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"ct\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"contact\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"iv\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"ct\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"relationship\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"iv\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"ct\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"relatives\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"iv\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"ct\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"extended\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"iv\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"ct\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"knowledge\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"iv\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"ct\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"jobs\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"iv\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"ct\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"key\": {\n\t\t\t\t\"type\": \"string\",\n\t\t\t}\n\t\t}\n\t};\n\n\tif (typeof module !== \"undefined\" && module.exports) {\n\t\tmodule.exports = profileEncryptedJSON;\n\t} else if (typeof define !== \"undefined\") {\n\t\tdefine(function() {\n\t\t\treturn profileEncryptedJSON;\n\t\t});\n\t}\n})();\n\n\n// WEBPACK FOOTER //\n// ./src/lib/validation/validations/profileEncryptedV.js","(function () {\n\t\"use strict\";\n\n\t/*\n\t\tmessage: {\n\t\t\tmeta: {\n\t\t\t\tpreviousOwn: (int),\n\t\t\t\tpreviousOther: (int),\n\t\t\t\tsender: (int),\n\t\t\t\tsignature: (hex),\n\t\t\t\ttopicid: (int),\n\t\t\t\tread: (bool)\n\t\t\t}\n\t\t\tcontent: {\n\t\t\t\tkey,\n\t\t\t\tiv: (hex),\n\t\t\t\ttext: (hex),\n\t\t\t\tsignature: (hex)\n\t\t\t}\n\n\t\t}\n\n\t*/\n\n\tvar messageJSON = {\n\t\t\"type\": \"object\",\n\t\t\"properties\": {\n\t\t\t\"meta\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"createTime\": {\n\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\"type\": \"integer\",\n\t\t\t\t\t\t\"min\": 1388718525297\n\t\t\t\t\t},\n\t\t\t\t\t\"_parent\": {\n\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"_sortCounter\": {\n\t\t\t\t\t\t\"type\": \"integer\"\n\t\t\t\t\t},\n\t\t\t\t\t\"_ownHash\": {\n\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"_signature\": {\n\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"encrSignature\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\n\t\t\t\t\t\"sender\": {\n\t\t\t\t\t\t\"type\": \"integer\",\n\t\t\t\t\t\t\"min\": 1\n\t\t\t\t\t},\n\t\t\t\t\t\"topicid\": {\n\t\t\t\t\t\t\"type\": \"integer\",\n\t\t\t\t\t\t\"min\": 1\n\t\t\t\t\t},\n\t\t\t\t\t\"read\": {\n\t\t\t\t\t\t\"type\": \"boolean\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"content\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"iv\": {\n\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"hex\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"ct\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tif (typeof module !== \"undefined\" && module.exports) {\n\t\tmodule.exports = messageJSON;\n\t} else if (typeof define !== \"undefined\") {\n\t\tdefine(function() {\n\t\t\treturn messageJSON;\n\t\t});\n\t}\n})();\n\n\n// WEBPACK FOOTER //\n// ./src/lib/validation/validations/messageV.js","(function () {\n\t\"use strict\";\n\n\t/*\n\t\ttopic: {\n\t\t\tcreateTime: (int)\n\t\t\tkey: key,\n\t\t\treceiver: [{identifier, key}],\n\t\t\tcreator: (int),\n\t\t\tnewest (int),\n\t\t\tunread: (bool)\n\t\t}\n\t*/\n\n\tvar topicJSON = {\n\t\t\"name\": \"Topic\",\n\t\t\"type\": \"object\",\n\t\t\"properties\": {\n\t\t\t\"createTime\": {\n\t\t\t\t\"required\": true,\n\t\t\t\t\"type\": \"number\",\n\t\t\t\t\"min\": 1376244464102\n\t\t\t},\n\t\t\t\"_key\": {\n\t\t\t\t\"required\": true,\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"receiver\": {\n\t\t\t\t\"required\": true,\n\t\t\t\t\"type\": \"array\",\n\t\t\t\t\"items\": {\n\t\t\t\t\t\"type\": \"int\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"creator\": {\n\t\t\t\t\"type\": \"number\",\n\t\t\t\t\"min\": 1\n\t\t\t},\n\t\t\t\"unread\": {\n\t\t\t\t\"type\": \"array\",\n\t\t\t\t\"items\": {\n\t\t\t\t\t\"type\": \"int\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tif (typeof module !== \"undefined\" && module.exports) {\n\t\tmodule.exports = topicJSON;\n\t} else if (typeof define !== \"undefined\") {\n\t\tdefine(function() {\n\t\t\treturn topicJSON;\n\t\t});\n\t}\n})();\n\n\n// WEBPACK FOOTER //\n// ./src/lib/validation/validations/topicV.js","(function () {\n\t\"use strict\";\n\n\t/*\n\t\ttopic: {\n\t\t\tcreateTime: (int)\n\t\t\tkey: key,\n\t\t\treceiver: [{identifier, key}],\n\t\t\tcreator: (int),\n\t\t\tnewest (int),\n\t\t\tunread: (bool)\n\t\t}\n\t*/\n\n\tvar topicJSON = {\n\t\t\"name\": \"Topic\",\n\t\t\"type\": \"object\",\n\t\t\"extends\": \"securedData\",\n//\t\t\"additionalProperties\": false,\n\t\t\"properties\": {\n\t\t\t\"createTime\": {\n\t\t\t\t\"required\": true,\n\t\t\t\t\"type\": \"number\",\n\t\t\t\t\"min\": 1376244464102\n\t\t\t},\n\t\t\t\"_key\": {\n\t\t\t\t\"required\": true,\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"receiver\": {\n\t\t\t\t\"required\": true,\n\t\t\t\t\"type\": \"array\",\n\t\t\t\t\"items\": {\n\t\t\t\t\t\"type\": \"integer\",\n\t\t\t\t\t\"min\": 1\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"creator\": {\n\t\t\t\t\"required\": true,\n\t\t\t\t\"type\": \"number\",\n\t\t\t\t\"min\": 1\n\t\t\t}\n\t\t}\n\t};\n\n\tif (typeof module !== \"undefined\" && module.exports) {\n\t\tmodule.exports = topicJSON;\n\t} else if (typeof define !== \"undefined\") {\n\t\tdefine(function() {\n\t\t\treturn topicJSON;\n\t\t});\n\t}\n})();\n\n\n// WEBPACK FOOTER //\n// ./src/lib/validation/validations/topicCreateV.js","(function () {\n\t\"use strict\";\n\n\t/*\n\t\tcircle: {\n\t\t\tkey,\n\t\t\tcontent,\n\t\t\tiv\n\t\t}\n\t*/\n\n\tvar circleJSON = {\n\t\t\"type\": \"object\",\n\t\t\"properties\": {\n\t\t\t\"meta\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"required\": true,\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"users\": {\n\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\"type\": \"integer\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"circleKey\": {\n\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"content\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"required\": true,\n\t\t\t\t\"extends\": \"encryptedData\",\n\t\t\t\t\"properties\": {}\n\t\t\t}\n\t\t}\n\t};\n\n\tif (typeof module !== \"undefined\" && module.exports) {\n\t\tmodule.exports = circleJSON;\n\t} else if (typeof define !== \"undefined\") {\n\t\tdefine(function() {\n\t\t\treturn circleJSON;\n\t\t});\n\t}\n})();\n\n\n// WEBPACK FOOTER //\n// ./src/lib/validation/validations/circleV.js","(function () {\n\t\"use strict\";\n\n\t/*\n\t\tpost: {\n\t\t\tmeta: {\n\t\t\t\tcontentHash,\n\t\t\t\ttime,\n\t\t\t\tsignature,\n\t\t\t\t(key),\n\t\t\t\t(receiver), //for a wallpost\n\t\t\t}\n\t\t\tcontent //padded!\n\t\t}\n\t*/\n\n\tvar postJSON = {\n\t\t\"name\": \"Post\",\n\t\t\"type\": \"object\",\n\t\t\"properties\": {\n\t\t\t\"meta\": {\n\t\t\t\t\"required\": true,\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"extends\": \"securedDataContent\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"sender\": {\n\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\"type\": \"integer\"\n\t\t\t\t\t},\n\t\t\t\t\t\"time\": {\n\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\"type\": \"integer\",\n\t\t\t\t\t\t\"min\": 1388714536420\n\t\t\t\t\t},\n\t\t\t\t\t\"key\": {\n\t\t\t\t\t\t\"type\": \"object\"\n\t\t\t\t\t},\n\t\t\t\t\t\"walluser\": {\n\t\t\t\t\t\t\"type\": \"integer\",\n\t\t\t\t\t\t\"min\": 1\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"content\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"required\": true,\n\t\t\t\t\"extends\": \"encryptedData\",\n\t\t\t\t\"properties\": {}\n\t\t\t}\n\t\t}\n\t};\n\n\tif (typeof module !== \"undefined\" && module.exports) {\n\t\tmodule.exports = postJSON;\n\t} else if (typeof define !== \"undefined\") {\n\t\tdefine(function() {\n\t\t\treturn postJSON;\n\t\t});\n\t}\n})();\n\n\n// WEBPACK FOOTER //\n// ./src/lib/validation/validations/postV.js","\"use strict\";\n\nconst Bluebird = require(\"bluebird\");\nconst keyStore = require(\"crypto/keyStore\");\n\nvar encryptedDataObject = function (data) {\n\tvar encryptedData = data, decryptedData;\n\n\tthis.decrypt = function (cb) {\n\t\tif (decryptedData) {\n\t\t\treturn Bluebird.resolve(decryptedData).nodeify(cb);\n\t\t}\n\n\t\treturn keyStore.sym.decryptObject(encryptedData, 0).then(function (decryptedObj) {\n\t\t\tif (decryptedObj) {\n\t\t\t\tdecryptedData = decryptedObj;\n\n\t\t\t\treturn decryptedData;\n\t\t\t}\n\n\t\t\tthrow new Error(\"could not decrypt\");\n\t\t}).nodeify(cb);\n\t};\n};\n\nmodule.exports = encryptedDataObject;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/crypto/encryptedData.js","import * as Bluebird from \"bluebird\";\nconst errors = require(\"../asset/errors.js\");\n\nimport keyStore from \"./keyStore.service\";\n\nconst circleService = require(\"circles/circleService\");\n\nconst localize = require(\"i18n/localizationConfig\");\n\nclass FilterService {\n\tprivate alwaysAvailableFilter = [\"allfriends\"];\n\n\talwaysFilterToKey(filter: any) {\n\t\tconst userService = require(\"../users/userService\").default;\n\n\t\tswitch (filter) {\n\t\t\tcase \"allfriends\":\n\t\t\t\treturn userService.getOwn().getFriendsKey();\n\t\t\tcase \"everyone\":\n\t\t\t\t//we do not encrypt it anyhow .... this needs to be checked in before!\n\t\t\t\tthrow new Error(\"should never be here\");\n\t\t\tdefault:\n\t\t\t\tthrow new errors.InvalidFilter(\"unknown always value\");\n\t\t}\n\t}\n\n\tcircleFilterToKey(filter: any) {\n\t\treturn Bluebird.try(() => {\n\t\t\treturn circleService.loadAll();\n\t\t}).then(() => {\n\t\t\treturn circleService.get(filter).getKey();\n\t\t});\n\t}\n\n\tuserFilterToKey(user: any) {\n\t\treturn Bluebird.try(() => {\n\t\t\tconst userService = require(\"../users/userService\").default;\n\t\t\treturn userService.get(user);\n\t\t}).then((user) => {\n\t\t\treturn user.getContactKey();\n\t\t});\n\t}\n\n\tfriendsFilterToKey(user: any) {\n\t\treturn Bluebird.try(() => {\n\t\t\tconst userService = require(\"../users/userService\").default;\n\t\t\treturn userService.get(user);\n\t\t}).then((user) => {\n\t\t\treturn user.getFriendsKey();\n\t\t});\n\t}\n\n\tpublic filterToKeys(filters: any, cb?: any) {\n\t\treturn Bluebird.try(() => {\n\t\t\tconst userService = require(\"../users/userService\").default;\n\n\t\t\tvar filterPromises = filters.map((filter: any) => {\n\t\t\t\tvar map = filter.split(\":\");\n\n\t\t\t\tswitch(map[0]) {\n\t\t\t\t\tcase \"friends\":\n\t\t\t\t\t\treturn this.friendsFilterToKey(map[1]);\n\t\t\t\t\tcase \"always\":\n\t\t\t\t\t\treturn this.alwaysFilterToKey(map[1]);\n\t\t\t\t\tcase \"circle\":\n\t\t\t\t\t\treturn this.circleFilterToKey(map[1]);\n\t\t\t\t\tcase \"user\":\n\t\t\t\t\t\treturn this.userFilterToKey(map[1]);\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new errors.InvalidFilter(\"unknown group\");\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfilterPromises.push(userService.getOwn().getMainKey());\n\n\t\t\treturn Bluebird.all(filterPromises);\n\t\t}).nodeify(cb);\n\t}\n\n\tpublic getCircleByID(id: any) {\n\t\treturn circleService.loadAll().then(() => {\n\t\t\tvar circle = circleService.get(id).data;\n\t\t\treturn {\n\t\t\t\tname: circle.name,\n\t\t\t\tid: \"circle:\" + circle.id,\n\t\t\t\tsref: \"app.circles.show({circleid: \" + circle.id + \"})\",\n\t\t\t\tcount: circle.userids.length\n\t\t\t};\n\t\t});\n\t}\n\n\tgetFriendsFilterByID(id: any) {\n\t\tconst userService = require(\"../users/userService\").default;\n\t\treturn userService.get(id).then((user: any) => {\n\t\t\treturn {\n\t\t\t\tname: localize.getLocalizedString(\"directives.friendsOf\", {name: user.data.name}),\n\t\t\t\tid: \"friends:\" + user.data.id,\n\t\t\t\tsref: \"app.user({identifier: \" + user.data.id + \"})\"\n\t\t\t};\n\t\t});\n\t}\n\n\tpublic getAlwaysByID(id: any) {\n\t\tconst userService = require(\"../users/userService\").default;\n\t\tif (id !== \"allfriends\") {\n\t\t\tthrow new Error(\"Invalid Always id\");\n\t\t}\n\n\t\tvar key = userService.getOwn().getFriendsKey();\n\n\t\treturn {\n\t\t\tname: localize.getLocalizedString(\"directives.allfriends\"),\n\t\t\tid: \"always:\" + id,\n\t\t\tsref: \"app.friends\",\n\t\t\tcount: keyStore.upload.getKeyAccessCount(key) - 1\n\t\t};\n\t}\n\n\tpublic getFilterByID(id: any) {\n\t\treturn Bluebird.try(() => {\n\t\t\tvar colon = id.indexOf(\":\");\n\t\t\tvar domain = id.substr(0, colon + 1);\n\t\t\tvar domainID = id.substr(colon + 1);\n\n\t\t\tif (domain === \"always:\") {\n\t\t\t\treturn this.getAlwaysByID(domainID);\n\t\t\t} else if (domain === \"circle:\") {\n\t\t\t\treturn this.getCircleByID(domainID);\n\t\t\t} else if (domain === \"friends:\") {\n\t\t\t\treturn this.getFriendsFilterByID(domainID);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic getFiltersByID = (ids: any) => {\n\t\treturn Bluebird.resolve(ids).map(this.getFilterByID.bind(this));\n\t}\n\n\tpublic getAllFilters() {\n\t\tvar alwaysAvailable = this.alwaysAvailableFilter.map((e) => {\n\t\t\treturn this.getAlwaysByID(e);\n\t\t});\n\n\t\treturn circleService.loadAll().then(() => {\n\t\t\tvar circles = circleService.data.circles;\n\n\t\t\tvar circle = circles.map((e: any) => {\n\t\t\t\treturn {\n\t\t\t\t\tname: e.name,\n\t\t\t\t\tid: \"circle:\" + e.id,\n\t\t\t\t\tcount: e.userids.length\n\t\t\t\t};\n\t\t\t});\n\n\t\t\treturn alwaysAvailable.concat(circle);\n\t\t});\n\t}\n}\n\nexport default new FilterService();\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/filter.service.ts","module.exports = {\n\tgetLocalizedString: function () {\n\t\treturn \"Translation missing\";\n\t}\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/i18n/localizationConfig.js","import ObjectLoader from \"../services/cachedObjectLoader\"\nimport * as Bluebird from \"bluebird\"\nconst SecuredData = require(\"asset/securedDataWithMetaData\")\nconst keyStoreService = require(\"crypto/keyStore\")\n\n// actually typeof securedData but securedData is not a ts class yet\ntype SignedKeys = any\n\ntype SignedKeysCache = {\n\tcrypt: string,\n\tfriends: string,\n\tsign: string,\n\t_hashVersion: string,\n\t_signature: string,\n\t_type: string,\n\t_version: string,\n}\n\nexport class SignedKeysLoader extends ObjectLoader<SignedKeys, SignedKeysCache>({\n\tcacheName: \"signedKeys\",\n\tgetID: ({ signedKeys: { _signature }, signKey }) => `${signKey}-${_signature}`,\n\tdownload: () => { throw new Error(\"profile get by id is not implemented\") },\n\tload: ({ signedKeys, signKey }): Bluebird<SignedKeysCache> => {\n\t\tconst securedData = SecuredData.load(undefined, signedKeys, { type: \"signedKeys\" })\n\n\t\treturn securedData.verifyAsync(signKey).then(() =>\n\t\t\tsecuredData.metaGet()\n\t\t)\n\t},\n\trestore: (signedKeysCache: SignedKeysCache) => {\n\t\tconst signedKeys = SecuredData.createRaw(undefined, signedKeysCache, { type: \"signedKeys\" })\n\n\t\tconst friends = signedKeys.metaAttr(\"friends\")\n\t\tconst crypt = signedKeys.metaAttr(\"crypt\")\n\n\t\tkeyStoreService.security.addEncryptionIdentifier(friends)\n\t\tkeyStoreService.security.addEncryptionIdentifier(crypt)\n\n\t\treturn signedKeys\n\t}\n}) {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/users/signedKeys.ts","var map = {\n\t\"./de\": 98,\n\t\"./de-at\": 187,\n\t\"./de-at.js\": 187,\n\t\"./de-ch\": 188,\n\t\"./de-ch.js\": 188,\n\t\"./de.js\": 98,\n\t\"./en-au\": 189,\n\t\"./en-au.js\": 189,\n\t\"./en-ca\": 190,\n\t\"./en-ca.js\": 190,\n\t\"./en-gb\": 191,\n\t\"./en-gb.js\": 191,\n\t\"./en-ie\": 192,\n\t\"./en-ie.js\": 192,\n\t\"./en-nz\": 193,\n\t\"./en-nz.js\": 193\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) // check for number or string\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\treturn id;\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 375;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/moment/locale \\/de|\\/en\n// module id = 375\n// module chunks = 12","var SecuredData = require(\"asset/securedDataWithMetaData\");\nimport h from \"../helper/helper\"\n\nexport default class TopicUpdate {\n\tstate: any\n\tprivate _id: any\n\tprivate securedData: any\n\tprivate userID: any\n\n\tconstructor({ content, server, meta, sender }) {\n\t\tvar content = content,\n\t\t\tmeta = meta;\n\n\t\tthis._id = server.id;\n\t\tthis.securedData = SecuredData.createRaw(content, meta, { type: \"topicUpdate\" });\n\t\tthis.userID = meta.userID;\n\n\t\tthis.state = {\n\t\t\tloading: false,\n\t\t\ttimestamp: h.parseDecimal(meta.time),\n\t\t\ttitle: content.title,\n\t\t\tsender\n\t\t};\n\t}\n\n\tsetState = (newState) => {\n\t\tthis.state = {\n\t\t\t...this.state,\n\t\t\t...newState\n\t\t};\n\t};\n\n\tgetID = () => {\n\t\treturn this._id;\n\t};\n\n\tgetTime = () => {\n\t\treturn h.parseDecimal(this.securedData.metaAttr(\"time\"));\n\t};\n\n\tisAfter = (topicUpdate) => {\n\t\tif (!topicUpdate) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn topicUpdate.getTime() < this.getTime();\n\t};\n\n\tensureParent = (topic) => {\n\t\tthis.securedData.checkParent(topic.getSecuredData());\n\t}\n\n\tensureIsAfterTopicUpdate = (topicUpdate) => {\n\t\tthis.securedData.checkAfter(topicUpdate.getSecuredData());\n\t}\n\n\tgetUserID = () => {\n\t\treturn this.userID;\n\t}\n\n\tgetSecuredData = () => {\n\t\treturn this.securedData;\n\t}\n\n\tgetMetaUpdate = () => {\n\t\treturn this.securedData.metaAttr(\"metaUpdate\")\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/messages/chatTitleUpdate.ts","import * as Bluebird from \"bluebird\"\n\nimport ObjectLoader from \"../services/mutableObjectLoader\"\nimport socketService from \"../services/socket.service\"\nimport sessionService from \"../services/session.service\"\n\nimport ChatLoader from \"./chat\"\n\ntype ChatIDList = number[]\n\nexport class ChatList {\n\tconstructor(private chatIDs: ChatIDList) {}\n\n\tget() {\n\t\treturn this.chatIDs\n\t}\n\n\tset(chatIDs: ChatIDList) {\n\t\tthis.chatIDs = chatIDs\n\t}\n}\n\nexport default class ChatListLoader extends ObjectLoader<ChatList, ChatIDList>({\n\tdownload: () => socketService.definitlyEmit(\"chat.getAllIDs\", {}).then(response => response.chatIDs),\n\tload: chatResponse => Bluebird.resolve(chatResponse),\n\tgetID: () => sessionService.getUserID(),\n\trestore: (chatIDs, previousInstance) => {\n\t\tconst firstLoadedIndex = chatIDs.findIndex((id) => ChatLoader.isLoaded(id))\n\t\tconst chatsToLoad = firstLoadedIndex === -1 ? [] : chatIDs.slice(0, firstLoadedIndex)\n\n\t\treturn Bluebird.all(chatsToLoad.map((id) => ChatLoader.get(id))).then(() => {\n\t\t\tif (previousInstance) {\n\t\t\t\tpreviousInstance.set(chatIDs)\n\n\t\t\t\treturn previousInstance\n\t\t\t}\n\n\t\t\treturn new ChatList(chatIDs)\n\t\t})\n\t},\n\tshouldUpdate: () => Bluebird.resolve(true),\n\tcacheName: \"chatList\"\n}) {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/messages/chatList.ts","import { Component, ViewChild } from \"@angular/core\";\nimport { Platform, NavController } from \"ionic-angular\";\nimport * as Bluebird from 'bluebird';\n\nimport { SplashScreen } from \"@ionic-native/splash-screen\";\nimport { StatusBar } from \"@ionic-native/status-bar\";\nimport { Globalization } from '@ionic-native/globalization';\nimport { Push } from '@ionic-native/push';\n\nimport { PushService } from \"../lib/services/push.service\";\nimport socketService from \"../lib/services/socket.service\";\nimport { isBusinessVersion } from \"../lib/services/location.manager\";\nimport Tutorial from \"./tutorial\";\n\nimport sessionService from '../lib/services/session.service';\n\n// When we think it's safe to hide the splash screen, there might actually be\n// some more drawing going on. This delay is to offset for that rendering.\nconst SPLASH_SCREEN_HIDE_DELAY = 200\n\nconst TUTORIAL_SLIDES = 7\n\n@Component({\n\ttemplateUrl: \"app.html\"\n})\n\nexport class MyApp {\n\n\trootPage = \"Home\";\n\n\t@ViewChild(\"navigation\") nav: NavController;\n\n\tshowTutorial = () => {\n\t\tconst activeView = this.nav.getActive()\n\n\t\tif (!activeView || !activeView.instance) {\n\t\t\treturn false\n\t\t}\n\n\t\treturn !activeView.instance.tutorialDisabled && Tutorial.tutorialVisible;\n\t}\n\n\tslideNumber = 1;\n\tadvance() {\n\t\tthis.slideNumber++;\n\t\tif (this.slideNumber === TUTORIAL_SLIDES + 1) {\n\t\t\tthis.slideNumber = 1;\n\t\t\tTutorial.skip();\n\t\t}\n\t}\n\n\tlang = 'de';\n\tcurrentSlide() {\n\t\treturn `assets/img/${this.lang}/tutorial_${this.slideNumber}.png`\n\t}\n\n\ttutorialClicked(event) {\n\t\tconst { offsetX, offsetY, target } = event;\n\t\tconst { offsetHeight, offsetWidth, nodeName } = target;\n\n\t\tif (nodeName !== 'IMG') {\n\t\t\treturn this.advance();\n\t\t}\n\n\t\tconst px = offsetX / offsetWidth;\n\t\tconst py = offsetY / offsetHeight;\n\t\tconst firstSlide = this.slideNumber === 1\n\t\tconst shouldSkip = (0.73 < px) && (px < 0.98) && (0.03 < py) && (py < 0.10)\n\n\t\tif (shouldSkip && firstSlide) {\n\t\t\tTutorial.skip();\n\t\t} else {\n\t\t\tthis.advance();\n\t\t}\n\t}\n\n\tinitializeTutorialWithLanguage() {\n\t\tthis.globalization.getPreferredLanguage().then(({ value }) => {\n\t\t\tconst en = (value.toLowerCase().indexOf('de') === -1);\n\t\t\tthis.lang = en ? 'en' : 'de';\n\t\t}).catch(() => {\n\t\t\tconsole.warn('Cannot get language from device, remaining with default language');\n\t\t}).then(() => {\n\t\t\tTutorial.checkVisibility();\n\t\t})\n\t}\n\n\tconstructor(\n\t\tplatform: Platform,\n\t\tprivate splashScreen: SplashScreen,\n\t\tprivate statusBar: StatusBar,\n\t\tprivate globalization: Globalization,\n\t\tprivate push: Push\n\t) {\n\t\tplatform.ready().then(() => {\n\t\t\t// Okay, so the platform is ready and our plugins are available.\n\t\t\t// Here you can do any higher level native things you might need.\n\t\t\tthis.statusBar.styleLightContent();\n\n\t\t\tconst pushService = new PushService(this.nav, platform, this.push);\n\t\t\tpushService.register();\n\n\t\t\tsocketService.addInterceptor({\n\t\t\t\ttransformResponse: (response) => {\n\t\t\t\t\tif (isBusinessVersion() && response.logedin && !response.error) {\n\t\t\t\t\t\tconst activeNav = this.nav.getActive()\n\t\t\t\t\t\tconst onSalesPage = activeNav && activeNav.component.name === \"SalesPage\"\n\n\t\t\t\t\t\tif (onSalesPage && response.isBusiness) {\n\t\t\t\t\t\t\tthis.nav.remove(0, this.nav.length() - 1)\n\t\t\t\t\t\t\tthis.nav.setRoot(\"Home\")\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!onSalesPage && !response.isBusiness) {\n\t\t\t\t\t\t\tthis.nav.remove(0, this.nav.length() - 1)\n\t\t\t\t\t\t\tthis.nav.setRoot(\"Sales\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn response\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tsessionService.bootLogin().then((loggedin) => {\n\n\t\t\t\tBluebird.delay(SPLASH_SCREEN_HIDE_DELAY).then(() => this.splashScreen.hide())\n\t\t\t\tif (!loggedin && this.nav.length() > 0) {\n\t\t\t\t\tthis.nav.remove(0, this.nav.length() - 1)\n\t\t\t\t\tthis.nav.setRoot(\"Login\")\n\t\t\t\t}\n\n\t\t\t\tthis.initializeTutorialWithLanguage();\n\t\t\t});\n\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/app.component.ts","import { Push, PushObject } from '@ionic-native/push';\n\nimport { NavController, Platform } from \"ionic-angular\";\n\nimport { MessagesPage } from \"../../pages/messages/messages\";\n\nimport * as Bluebird from \"bluebird\";\nimport socketService from \"./socket.service\";\nimport { withPrefix } from \"./storage.service\";\nimport errorService from \"./error.service\";\n\nconst initService = require(\"./initService\");\nimport messageService from \"../messages/messageService\";\n\nconst sessionStorage = withPrefix(\"whispeer.session\");\n\nconst sjcl = require(\"sjcl\");\n\nexport class PushService {\n\tconstructor(private navCtrl: NavController, private platform: Platform, private push: Push) {}\n\n\tpushInstance: PushObject;\n\n\tprivate getOrCreatePushkey = () => {\n\t\tconst storagePushKey = sessionStorage.get(\"pushKey\");\n\t\tif (storagePushKey) {\n\t\t\treturn sjcl.codec.hex.toBits(storagePushKey);\n\t\t}\n\n\t\tconst pushKey = sjcl.random.randomWords(8);\n\t\tsessionStorage.set(\"pushKey\", sjcl.codec.hex.fromBits(pushKey));\n\n\t\treturn pushKey;\n\t}\n\n\tgetType = () => {\n\t\tconst platform = window.device.platform;\n\n\t\tif (platform === \"Android\") {\n\t\t\treturn \"android\";\n\t\t} else if (platform === \"iOS\") {\n\t\t\treturn \"ios\";\n\t\t}\n\t}\n\n\tprivate pushConfig = {\n\t\t\"android\": {\n\t\t\t\"senderID\": \"809266780938\",\n\t\t\t\"icon\": \"ic_stat_icon\",\n\t\t\t\"iconColor\": \"#5ab70d\"\n\t\t},\n\t\t\"ios\": {\n\t\t\t\"alert\": true,\n\t\t\t\"badge\": true,\n\t\t\t\"sound\": true\n\t\t}\n\t}\n\n\tprivate registration = (data) => {\n\t\tconsole.log(\"-> registration\", data);\n\t\tconst type = this.getType()\n\n\t\tBluebird.all([\n\t\t\tsessionStorage.awaitLoading(),\n\t\t\tinitService.awaitLoading(),\n\t\t\tsocketService.awaitConnection()\n\t\t]).then(() => {\n\t\t\tconst pushKey = this.getOrCreatePushkey();\n\n\t\t\tif (!type) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\treturn socketService.definitlyEmit(\"pushNotification.subscribe\", {\n\t\t\t\ttoken: data.registrationId,\n\t\t\t\tkey: sjcl.codec.hex.fromBits(pushKey),\n\t\t\t\ttype\n\t\t\t});\n\t\t}).catch(errorService.criticalError);\n\t}\n\n\tprivate getActiveNav = () => this.navCtrl.getActive().instance\n\n\tprivate isOnMessagesPage = () => {\n\t\treturn this.getActiveNav() instanceof MessagesPage\n\t}\n\n\tprivate isActiveChat = (chatID) => {\n\t\tconst navChatID = this.getActiveNav().navParams.data.chatID\n\n\t\treturn parseInt(navChatID, 10) === parseInt(chatID, 10)\n\t}\n\n\tprivate goToChat = (chatID) => {\n\t\tif (this.isOnMessagesPage()) {\n\t\t\tif (this.isActiveChat(chatID)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst index = this.navCtrl.getActive().index;\n\t\t\tthis.navCtrl.remove(index);\n\t\t}\n\n\t\treturn this.navCtrl.push(\"Messages\", { chatID });\n\t}\n\n\tprivate goToUser = (userId) => {\n\t\treturn this.navCtrl.push(\"Profile\", { userId: userId });\n\t}\n\n\tprivate goToReference = (reference) => {\n\t\tif (reference.type === \"message\") {\n\t\t\tthis.goToChat(reference.chatID);\n\t\t}\n\n\t\tif (reference.type === \"contactRequest\") {\n\t\t\tthis.goToUser(reference.id);\n\t\t}\n\t}\n\n\tprivate notification = (data) => {\n\t\tconsole.info(\"Got Push notification with data\", data);\n\n\t\tif (data && data.additionalData) {\n\t\t\tconst additionalData = data.additionalData;\n\n\t\t\tBluebird.all([\n\t\t\t\tsessionStorage.awaitLoading(),\n\t\t\t\tinitService.awaitLoading()\n\t\t\t]).then(() => {\n\t\t\t\tif (!additionalData.foreground && additionalData.reference) {\n\t\t\t\t\tthis.goToReference(additionalData.reference)\n\t\t\t\t}\n\n\t\t\t\tvar pushKey = sessionStorage.get(\"pushKey\");\n\n\t\t\t\tif (additionalData.encryptedContent && pushKey) {\n\t\t\t\t\tif (typeof additionalData.encryptedContent === \"object\") {\n\t\t\t\t\t\tadditionalData.encryptedContent = JSON.stringify(additionalData.encryptedContent)\n\t\t\t\t\t}\n\n\t\t\t\t\tpushKey = sjcl.codec.hex.toBits(pushKey);\n\t\t\t\t\tadditionalData.content = JSON.parse(sjcl.json.decrypt(pushKey, additionalData.encryptedContent));\n\t\t\t\t}\n\n\t\t\t\tif (additionalData.content) {\n\t\t\t\t\tconst message = additionalData.content.message\n\n\t\t\t\t\tif (message) {\n\t\t\t\t\t\tdelete message.meta.sender\n\t\t\t\t\t\tdelete message.meta.sendTime\n\t\t\t\t\t\tdelete message.meta.topicid\n\t\t\t\t\t\tdelete message.meta.messageid\n\t\t\t\t\t}\n\n\t\t\t\t\treturn messageService.addSocketData(additionalData.content);\n\t\t\t\t}\n\t\t\t}).then(() =>\n\t\t\t\tthis.pushInstance.finish()\n\t\t\t).then(\n\t\t\t\t() => console.info(`push done at ${new Date()}`),\n\t\t\t\t() => console.warn(\"Finishing push failed!\")\n\t\t\t)\n\t\t}\n\t};\n\n\tunregister = () =>\n\t\tthis.pushInstance.unregister()\n\n\tregister = () => {\n\t\ttry {\n\t\t\tconsole.info(\"Registering for Push\")\n\t\t\tthis.pushInstance = this.push.init(this.pushConfig);\n\n\t\t\tthis.pushInstance.on(\"registration\").subscribe(this.registration);\n\t\t\tthis.pushInstance.on(\"notification\").subscribe(this.notification);\n\n\t\t\tthis.platform.resume.subscribe(() => {\n\t\t\t\tconsole.warn(\"Resume app\");\n\t\t\t\tthis.pushInstance.clearAllNotifications()\n\t\t\t})\n\t\t} catch (e) {\n\t\t\tconsole.warn(\"Push is not available!\");\n\t\t}\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/push.service.ts","import * as Bluebird from \"bluebird\";\nimport socketService from \"./socket.service\";\nimport * as keyStore from \"../crypto/keyStore.js\";\n\nimport Observer from \"../asset/observer\";\n\nconst initService = require(\"services/initService\");\n\ninterface IVisibility {\n\tencrypt: boolean,\n\tvisibility: string[]\n}\n\ninterface blockedUserInfo {\n\tid: number,\n\tsince: number\n}\n\ninterface ISettings {\n\tprivacy: {\n\t\tbasic: {\n\t\t\tfirstname: IVisibility,\n\t\t\tlastname: IVisibility\n\t\t},\n\t\timageBlob: IVisibility,\n\t\tlocation: IVisibility,\n\t\tbirthday: IVisibility,\n\t\trelationship: IVisibility,\n\t\teducation: IVisibility,\n\t\twork: IVisibility,\n\t\tgender: IVisibility,\n\t\tlanguages: IVisibility\n\t},\n\tdonate: {\n\t\trefused: boolean,\n\t\tlater: number\n\t},\n\tsharePosts: string[],\n\tfilterSelection: string[],\n\tsound: {\n\t\tenabled: boolean\n\t},\n\tmessages: {\n\t\tsendShortCut: string\n\t},\n\tsafety: {\n\t\tblockedUsers: blockedUserInfo[]\n\t},\n\tuiLanguage: string\n}\n\nimport h from \"../helper/helper\";\nconst EncryptedData = require(\"crypto/encryptedData\");\nconst SecuredData = require(\"asset/securedDataWithMetaData\");\n\nconst notVisible:IVisibility = {\n\tencrypt: true,\n\tvisibility: []\n}\n\nconst privacyAttributes = [\"birthday\", \"location\", \"relationship\", \"education\", \"work\", \"gender\", \"languages\"]\n\nconst publicBranches = [\"uiLanguage\", \"sound\", \"donate\", \"safety\"]\nconst serverBranches = [\"mailsEnabled\"]\n\nconst defaultSettings:ISettings = {\n\tprivacy: {\n\t\tbasic: {\n\t\t\tfirstname: {\n\t\t\t\tencrypt: false,\n\t\t\t\tvisibility: [\"always:allfriends\"]\n\t\t\t},\n\t\t\tlastname: {\n\t\t\t\tencrypt: false,\n\t\t\t\tvisibility: [\"always:allfriends\"]\n\t\t\t}\n\t\t},\n\t\timageBlob: {\n\t\t\tencrypt: false,\n\t\t\tvisibility: []\n\t\t},\n\t\tlocation: notVisible,\n\t\tbirthday: notVisible,\n\t\trelationship: notVisible,\n\t\teducation: notVisible,\n\t\twork: notVisible,\n\t\tgender: notVisible,\n\t\tlanguages: notVisible\n\t},\n\tdonate: {\n\t\trefused: false,\n\t\tlater: 0\n\t},\n\tsharePosts: [\"always:allfriends\"],\n\tfilterSelection: [],\n\tsound: {\n\t\tenabled: true\n\t},\n\tmessages: {\n\t\tsendShortCut: \"enter\"\n\t},\n\tsafety: {\n\t\tblockedUsers: []\n\t},\n\tuiLanguage: \"en\"\n}\n\nconst isBranchPublic = (branchName: string) => {\n\treturn publicBranches.indexOf(branchName) > -1;\n}\n\nconst isBranchServer = (branchName: string) => {\n\treturn serverBranches.indexOf(branchName) > -1;\n}\n\nconst securedDataOptions = { type: \"settings\", removeEmpty: true }\n\nconst turnOldSettingsToNew = (settings: any) => {\n\tvar result = {\n\t\tmeta: { initialLanguage: <string> undefined },\n\t\tcontent: { }\n\t};\n\n\th.objectEach(settings, (key: any, val: any) => {\n\t\tif (isBranchPublic(key)) {\n\t\t\tresult.meta[key] = val;\n\t\t} else {\n\t\t\tresult.content[key] = val;\n\t\t}\n\t});\n\n\treturn result;\n}\n\nclass SettingsService extends Observer {\n\n\tsettings: any;\n\tserverSettings = {};\n\tapi: any;\n\n\tloadCachePromise = Bluebird.resolve();\n\n\tprivate migrateToFormat2 = (givenOldSettings: any) => {\n\t\tconsole.warn(\"migrating settings to format 2\");\n\n\t\treturn Bluebird.try(() => {\n\t\t\tkeyStore.security.allowPrivateActions();\n\t\t\tvar oldSettings = new EncryptedData(givenOldSettings);\n\t\t\treturn oldSettings.decrypt();\n\t\t}).then(decryptedSettings => {\n\t\t\tvar data = turnOldSettingsToNew(decryptedSettings);\n\n\t\t\tdata.meta.initialLanguage = h.getLanguageFromPath();\n\n\t\t\tvar ownUser = require(\"users/userService\").default.getOwn();\n\n\t\t\treturn SecuredData.createAsync(data.content,\n\t\t\t\tdata.meta,\n\t\t\t\tsecuredDataOptions,\n\t\t\t\townUser.getSignKey(),\n\t\t\t\townUser.getMainKey()\n\t\t\t)\n\n\t\t}).then(signedAndEncryptedSettings => {\n\t\t\tthis.settings = SecuredData.load(\n\t\t\t\tsignedAndEncryptedSettings.content,\n\t\t\t\tsignedAndEncryptedSettings.meta,\n\t\t\t\tsecuredDataOptions\n\t\t\t)\n\n\t\t\treturn socketService.emit(\"settings.setSettings\", {\n\t\t\t\tsettings: signedAndEncryptedSettings,\n\t\t\t}).thenReturn(this.settings);\n\t\t})\n\t}\n\n\tloadSettings = (givenSettings: any) => {\n\t\tthis.serverSettings = givenSettings.server || {};\n\n\t\treturn Bluebird.try(() => {\n\t\t\tif (givenSettings.ct) {\n\t\t\t\treturn this.migrateToFormat2(givenSettings);\n\t\t\t} else {\n\t\t\t\treturn SecuredData.load(givenSettings.content, givenSettings.meta, securedDataOptions);\n\t\t\t}\n\t\t}).then(_settings => {\n\t\t\tthis.settings = _settings;\n\n\t\t\tvar decryptAsync = Bluebird.promisify(this.decrypt.bind(this));\n\n\t\t\treturn decryptAsync();\n\t\t}).then(() => {\n\t\t\tthis.notify(\"\", \"loaded\");\n\t\t});\n\t}\n\n\tloadFromCache = (cacheEntry: any) => {\n\t\tvar userService = require(\"users/userService\").default;\n\n\t\tthis.loadCachePromise = userService.getOwnAsync().then(() => {\n\t\t\treturn this.loadSettings(cacheEntry.data);\n\t\t});\n\n\t\treturn this.loadCachePromise;\n\t}\n\n\tloadFromServer = (data: any) => {\n\t\treturn this.loadCachePromise.then(() => {\n\t\t\tif (data.unChanged) {\n\t\t\t\treturn Bluebird.resolve();\n\t\t\t}\n\n\t\t\tvar givenSettings = data.content;\n\t\t\tvar toCache = h.deepCopyObj(givenSettings);\n\n\t\t\tvar userService = require(\"users/userService\").default;\n\t\t\treturn userService.getOwnAsync().then(() => {\n\t\t\t\treturn this.loadSettings(givenSettings);\n\t\t\t}).thenReturn(toCache);\n\t\t});\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tinitService.get(\"settings.get\", this.loadFromServer, {\n\t\t\tcacheCallback: this.loadFromCache,\n\t\t\tcache: true\n\t\t});\n\t}\n\n\tsetDefaultLanguage = (language: string) => defaultSettings.uiLanguage = language\n\n\tgetContent = () => this.settings.contentGet()\n\n\tsetContent = (content: any) => this.settings.contentSet(content)\n\n\tdecrypt = (cb: Function) => {\n\t\treturn Bluebird.try(() => {\n\t\t\tvar ownUser = require(\"users/userService\").default.getOwn();\n\n\t\t\treturn Bluebird.all([\n\t\t\t\tthis.settings.decrypt(),\n\t\t\t\tthis.settings.verify(ownUser.getSignKey(), null, \"settings\")\n\t\t\t]);\n\t\t}).nodeify(cb);\n\t};\n\n\tgetBranchContent = (branchName: string) => {\n\t\tif (isBranchServer(branchName)) {\n\t\t\treturn this.serverSettings[branchName];\n\t\t}\n\n\t\tif (isBranchPublic(branchName)) {\n\t\t\treturn this.settings.metaAttr(branchName);\n\t\t}\n\n\t\treturn this.settings.contentGet()[branchName];\n\t}\n\n\tgetBranch = (branchName: string) => {\n\t\tif (!this.settings) {\n\t\t\treturn defaultSettings[branchName];\n\t\t}\n\n\t\tconst branchContent = this.getBranchContent(branchName)\n\n\t\tif (typeof branchContent === \"undefined\") {\n\t\t\treturn defaultSettings[branchName];\n\t\t}\n\n\t\treturn branchContent;\n\t};\n\n\tupdateBranch = (branchName: any, value: any) => {\n\t\tif (isBranchServer(branchName)) {\n\t\t\tthis.serverSettings[branchName] = value;\n\t\t} else if (isBranchPublic(branchName)) {\n\t\t\tthis.settings.metaSetAttr(branchName, value);\n\t\t} else {\n\t\t\tthis.settings.contentSetAttr(branchName, value);\n\t\t}\n\n\t\tthis.notify(\"\", \"updated\");\n\t};\n\n\n\tsetPrivacy = (privacy: any) => {\n\t\treturn Bluebird.try(() => {\n\t\t\tthis.updateBranch(\"privacy\", privacy);\n\t\t\treturn this.uploadChangedData();\n\t\t}).then(() => {\n\t\t\tconst userService = require(\"users/userService\").default;\n\t\t\treturn userService.getOwn().uploadChangedProfile();\n\t\t})\n\t}\n\n\tremoveCircle = (id: any) => {\n\t\treturn Bluebird.try(() => {\n\t\t\tvar privacy = this.getBranch(\"privacy\");\n\n\t\t\tprivacyAttributes.forEach((safetyName: any) => {\n\t\t\t\th.removeArray(privacy[safetyName].visibility, \"circle:\" + id);\n\t\t\t});\n\n\t\t\th.removeArray(privacy.basic.firstname.visibility, \"circle:\" + id);\n\t\t\th.removeArray(privacy.basic.lastname.visibility, \"circle:\" + id);\n\n\t\t\treturn this.setPrivacy(privacy);\n\t\t})\n\t}\n\n\tuploadChangedData = () => {\n\t\tif (!this.settings.isChanged()) {\n\t\t\treturn Bluebird.resolve(true)\n\t\t}\n\n\t\tvar userService = require(\"users/userService\").default;\n\n\t\treturn this.settings.getUpdatedData(\n\t\t\t\tuserService.getOwn().getSignKey()\n\t\t\t).then((newEncryptedSettings: any) => {\n\t\t\t\tnewEncryptedSettings.server = this.serverSettings;\n\n\t\t\t\treturn socketService.emit(\"settings.setSettings\", {\n\t\t\t\t\tsettings: newEncryptedSettings\n\t\t\t\t});\n\t\t\t}).then((result: any) =>\n\t\t\t\tresult.success\n\t\t\t)\n\t};\n\n\tgetBlockedUsers = (): blockedUserInfo[] => this.getBranch(\"safety\").blockedUsers\n\n\tsetBlockedUsers = (blockedUsers: blockedUserInfo[]): Bluebird<any> => {\n\t\tconst safety = this.getBranch(\"safety\")\n\n\t\tthis.updateBranch(\"safety\", {\n\t\t\t...safety,\n\t\t\tblockedUsers\n\t\t})\n\n\t\treturn this.uploadChangedData()\n\t}\n\n\tisBlockedSince = (userID: number, time: number) =>\n\t\t!!this.getBlockedUsers().find(({ id, since }) => userID === id && since < time )\n\n\tisBlocked = (userID: number) =>\n\t\t!!this.getBlockedUsers().find(({ id }) => userID === id)\n\n\tgetPrivacyAttribute = (attr: any) => {\n\t\tvar b = this.getBranch(\"privacy\"),\n\t\t\t\ti: number,\n\t\t\t\tattrs = attr.split(\".\"),\n\t\t\t\tcur = b;\n\n\t\tfor (i = 0; i < attrs.length; i += 1) {\n\t\t\tif (cur[attrs[i]]) {\n\t\t\t\tif (typeof cur[attrs[i]].encrypt !== \"undefined\") {\n\t\t\t\t\treturn cur[attrs[i]];\n\t\t\t\t}\n\t\t\t\tcur = cur[attrs[i]];\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error(\"could not find attribute settings\");\n\t};\n\n\tgetPrivacyEncryptionStatus = (attr: any) => {\n\t\treturn this.getPrivacyAttribute(attr).encrypt;\n\t};\n\n\tgetPrivacyVisibility = (attr: any) => {\n\t\tvar privacyAttribute = this.getPrivacyAttribute(attr);\n\n\t\tif (privacyAttribute.encrypt) {\n\t\t\treturn privacyAttribute.visibility;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n};\n\nexport default new SettingsService();\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/settings.service.ts","\"use strict\";\nfunction extendError(ParentErrorClass, name) {\n\tif (ParentErrorClass.prototype instanceof Error || ParentErrorClass === Error) {\n\t\tvar F = function(){};\n\t\tvar CustomError = function(message, data) {\n\t\t\tvar _this = this;\n\n\t\t\tvar tmp = new ParentErrorClass(message);\n\t\t\ttmp.name = this.name = name || \"Error\";\n\n\t\t\t_this.data = data;\n\t\t\t_this.stack = tmp.stack;\n\t\t\t_this.message = tmp.message;\n\t\t\t_this.name = name;\n\n\t\t\treturn _this;\n\t\t};\n\t\tvar SubClass = function (){};\n\t\tSubClass.prototype = ParentErrorClass.prototype;\n\t\tF.prototype = CustomError.prototype = new SubClass();\n\t\tCustomError.prototype.constructor = CustomError;\n\n\t\treturn CustomError;\n\t} else {\n\t\tthrow new Error(\"our error should inherit from error!\");\n\t}\n}\n\nvar InvalidDataError = extendError(Error, \"InvalidDataError\");\nvar InvalidHexError = extendError(InvalidDataError, \"InvalidHexError\");\nvar InvalidFilter = extendError(InvalidDataError, \"InvalidFilter\");\n\nvar SecurityError = extendError(Error, \"SecurityError\");\nvar AccessViolation = extendError(SecurityError, \"AccessViolation\");\nvar DecryptionError = extendError(SecurityError, \"DecryptionError\");\nvar ValidationError = extendError(SecurityError, \"ValidationError\");\n\nvar LoginError = extendError(Error, \"LoginError\");\n\nmodule.exports = {\n\tSecurityError: SecurityError,\n\tAccessViolation: AccessViolation,\n\tDecryptionError: DecryptionError,\n\tValidationError: ValidationError,\n\n\tInvalidDataError: InvalidDataError,\n\tInvalidHexError: InvalidHexError,\n\tInvalidFilter: InvalidFilter,\n\n\tLoginError: LoginError,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/asset/errors.js","import * as StorageService from \"./storage.service\"\nimport Storage from \"./Storage\"\nimport h from \"../helper/helper\"\n\nconst loginStorage: Storage = StorageService.withPrefix(\"whispeer.login\");\n\nconst blockedReturnUrls: string[] = [\"/b2c\", \"/recovery\"];\n\nconst basePath = window.top.location.href.match(/([^?#]*)/)[0]\nconst basePathname = basePath.match(/(.*)\\/.*/)[1]\n\nconst setTopLocation = (url: string) => {\n\tconsole.warn(\"set top location\", url, basePath + url)\n\twindow.top.location.href = basePath + url\n}\n\nconst setTopPath = (url: string) => {\n\tconsole.warn(\"set top path\", url, basePathname + url)\n\twindow.top.location.href = basePathname + url\n}\n\nexport const landingPage = () => {\n\tsetTopLocation(\"#/nav/n4/login\")\n\twindow.top.location.reload()\n}\n\nexport const isIOS = () => window.device && window.device.platform === \"iOS\"\n\nexport const isLoginPage = () => {\n\treturn window.top.location.pathname.indexOf(\"/login\") !== -1;\n}\n\nexport const isBusinessVersion = () => {\n\treturn window.top.location.pathname.indexOf(\"business.html\") !== -1\n}\n\nexport const goToPrivateHome = () => {\n\tsetTopPath(\"/index.html\")\n}\n\nexport const loginPage = () => {\n\tsetTopLocation(\"#/nav/n4/login\");\n}\n\nexport const goToBusinessVersion = () => {\n\tsetTopPath(\"/business.html\")\n}\n\nexport const reloadApp = () => {\n\tif (isBusinessVersion()) {\n\t\tgoToBusinessVersion()\n\t} else {\n\t\tgoToPrivateHome()\n\t}\n}\n\nexport const isBlockedReturnUrl = (url: string) => {\n\treturn blockedReturnUrls.filter((blockedUrl: string) => {\n\t\treturn url.indexOf(blockedUrl) !== -1;\n\t}).length > 0;\n};\n\nexport const setReturnUrl = (url: string) => {\n\tif (isBlockedReturnUrl(url)) {\n\t\treturn;\n\t}\n\n\tloginStorage.set(\"returnUrl\", url);\n};\n\nexport const getUrlParameter = (param: any) => {\n\tvar search = window.top.location.search;\n\tvar pairs = search.substr(1).split(\"&\");\n\n\tvar result = h.array.find(pairs.map((pair: any) => {\n\t\tif (pair.indexOf(\"=\") !== -1) {\n\t\t\treturn {\n\t\t\t\tkey: pair.substr(0, pair.indexOf(\"=\")),\n\t\t\t\tvalue: pair.substr(pair.indexOf(\"=\") + 1)\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tkey: pair,\n\t\t\t\tvalue: \"\"\n\t\t\t};\n\t\t}\n\t}), (pair: any) => {\n\t\treturn pair.key === param;\n\t});\n\n\tif (result) {\n\t\treturn result.value;\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/location.manager.ts","\"use strict\";\n\nconst h = require(\"helper/helper\").default\nconst baseConfig = require(\"conf/base.config.json\")\nconst config = require(\"conf/\" + WHISPEER_ENV + \".config.json\")\n\nmodule.exports = h.extend(h.extend({}, baseConfig), config);\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/config.js","\"use strict\";\n\ndeclare var webkitURL: any\ndeclare var global: any\ndeclare var process: any\n\ninterface MyWindow extends Window {\n\tBlobBuilder, WebKitBlobBuilder, MozBlobBuilder, MSBlobBuilder\n}\n\ndeclare var window: MyWindow;\n\nfunction getGlobal() {\n\tif (typeof window !== \"undefined\") {\n\t\treturn window;\n\t}\n\n\tif (typeof global !== \"undefined\") {\n\t\t// eslint-disable-next-line no-undef\n\t\treturn (global as any);\n\t}\n}\n\nvar glob = getGlobal();\n\nvar uuidPattern = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\";\nvar uuidRegexPattern = uuidPattern.replace(/x/g, \"[a-fA-F0-9]\").replace(/y/g, \"[89abAB]\");\nvar uuidRegex = new RegExp(uuidRegexPattern);\n\n/** contains general helper functions */\nvar helper = {\n\texecuteOnce: (func: () => any) => {\n\t\tlet val\n\t\treturn () => {\n\t\t\tif (!val) {\n\t\t\t\tval = func()\n\t\t\t}\n\n\t\t\treturn val\n\t\t}\n\t},\n\tensurePromise: function (p, cb) {\n\t\treturn (...args) => {\n\t\t\treturn p.resolve(cb(...args))\n\t\t}\n\t},\n\thasErrorId: function (response, id) {\n\t\tvar errorData = response.errorData\n\t\treturn Object.keys(errorData).some((key) => {\n\t\t\treturn errorData[key].id === id\n\t\t})\n\t},\n\tcreateErrorType: function (name) {\n\t\tfunction CustomError(message, extra?) {\n\t\t\tvar error = Error.call(this, message);\n\n\t\t\tthis.name = name;\n\t\t\tthis.extra = extra;\n\t\t\tthis.message = error.message;\n\t\t\tthis.stack = error.stack;\n\t\t}\n\n\t\tCustomError.prototype = Object.create(Error.prototype);\n\t\tCustomError.prototype.constructor = CustomError;\n\n\t\treturn CustomError;\n\t},\n\tcacheResult: function<returnType> (func: Function) {\n\t\tlet result: returnType\n\n\t\treturn function (...args) {\n\t\t\tif (!result) {\n\t\t\t\tresult = func.apply(this, args)\n\t\t\t}\n\n\t\t\treturn result\n\t\t}\n\t},\n\tcacheUntilSettled: function (func: Function) {\n\t\tlet resultPromise\n\n\t\treturn function (...args) {\n\t\t\tif (!resultPromise) {\n\t\t\t\tresultPromise = func.apply(this, args)\n\t\t\t}\n\n\t\t\tresultPromise.finally(() => {\n\t\t\t\tresultPromise = null\n\t\t\t})\n\n\t\t\treturn resultPromise\n\t\t}\n\t},\n\trandomIntFromInterval: function(min,max) {\n\t\treturn Math.floor(Math.random()*(max-min+1)+min);\n\t},\n\tgenerateUUID: function() {\n\t\t/* eslint-disable no-bitwise */\n\t\tvar d = new Date().getTime();\n\t\tvar uuid = uuidPattern.replace(/[xy]/g, function(c) {\n\t\t\tvar r = (d + Math.random()*16)%16 | 0;\n\t\t\td = Math.floor(d/16);\n\t\t\treturn (c === \"x\" ? r : (r&0x3|0x8)).toString(16);\n\t\t});\n\t\t/* eslint-enable no-bitwise */\n\t\treturn uuid;\n\t},\n\trepeatUntilTrue: function (Promise, func, delay) {\n\t\tfunction repeatFunc() {\n\t\t\treturn func().then(function (res) {\n\t\t\t\tif (!res) {\n\t\t\t\t\treturn Promise.delay(delay).then(function () {\n\t\t\t\t\t\treturn repeatFunc();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn repeatFunc();\n\t},\n\tencodeParameters: function (parameters) {\n\t\tvar keys = Object.keys(parameters);\n\n\t\tif (keys.length === 0) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tvar result = \"?\";\n\n\t\tkeys.forEach(function (key) {\n\t\t\tresult += key;\n\n\t\t\tif (parameters[key] !== null) {\n\t\t\t\tresult += \"=\" + parameters[key];\n\t\t\t}\n\n\t\t\tresult += \"&\";\n\t\t});\n\n\t\tresult = result.substr(0, result.length - 1);\n\n\t\treturn result;\n\t},\n\tgetWeekNumber: function (d) {\n\t\t// Copy date so don't modify original\n\t\td = new Date(+d);\n\t\td.setHours(0,0,0);\n\t\t// Set to nearest Thursday: current date + 4 - current day number\n\t\t// Make Sunday's day number 7\n\t\td.setDate(d.getDate() + 4 - (d.getDay()||7));\n\t\t// Get first day of year\n\t\tvar yearStart = new Date(d.getFullYear(),0,1).getTime();\n\t\t// Calculate full weeks to nearest Thursday\n\t\tvar weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);\n\t\t// Return array of year and week number\n\t\treturn weekNo;\n\t},\n\tgetLanguageFromPath: function () {\n\t\treturn window.top.location.pathname.split(\"/\")[1];\n\t},\n\tor: function (v1, v2) {\n\t\treturn v1 || v2;\n\t},\n\tand: function (v1, v2) {\n\t\treturn v1 && v2;\n\t},\n\tnot: function (func) {\n\t\treturn function () {\n\t\t\treturn !func.apply(this, arguments);\n\t\t};\n\t},\n\n\taddAfterHook: function (func, hook, thisArg) {\n\t\treturn function () {\n\t\t\tfunc.apply(thisArg, arguments);\n\t\t\thook.apply(thisArg, arguments);\n\t\t};\n\t},\n\n\tconcatBuffers: function () {\n\t\tvar bufs = Array.prototype.slice.call(arguments);\n\n\t\tvar len = 0, offset = 0;\n\t\tbufs.forEach(function (buf) {\n\t\t\tlen += buf.byteLength;\n\t\t});\n\n\t\tvar tmp = new Uint8Array(len);\n\n\t\tbufs.forEach(function (buf) {\n\t\t\ttmp.set(new Uint8Array(buf), offset);\n\t\t\toffset += buf.byteLength;\n\t\t});\n\n\t\treturn tmp.buffer;\n\t},\n\n\tdebouncePromise: function (Bluebird, func, time) {\n\t\tvar timer = null;\n\t\treturn function() {\n\t\t\tvar args = arguments;\n\n\t\t\tif(timer) {\n\t\t\t\tclearTimeout(timer);\n\t\t\t}\n\n\t\t\tvar promise = new Bluebird(function(resolve) {\n\t\t\t\ttimer = setTimeout(function() {\n\t\t\t\t\tresolve();\n\t\t\t\t}, time);\n\t\t\t}).then(function() {\n\t\t\t\treturn func.apply(null, args);\n\t\t\t});\n\n\t\t\treturn promise;\n\t\t};\n\t},\n\n\tdebounce: function (func, time) {\n\t\tvar timeout, args;\n\t\treturn function () {\n\t\t\targs = arguments;\n\n\t\t\tif (timeout) {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t}\n\n\t\t\ttimeout = setTimeout(function () {\n\t\t\t\tfunc.apply(null, args);\n\t\t\t}, time);\n\t\t};\n\t},\n\n\tpromisify: function (Promise, cb) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\ttry {\n\t\t\t\tcb(function (e, result) {\n\t\t\t\t\tif (e) {\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t},\n\n\tjoinArraysToObject: function (config) {\n\t\tvar result = [];\n\t\tvar len = config[Object.keys(config)[0]].length;\n\n\t\tif (len === 0) {\n\t\t\treturn result;\n\t\t}\n\n\t\tvar i;\n\t\tfor (i = 0; i < len; i += 1) {\n\t\t\tresult.push({});\n\t\t}\n\n\t\thelper.objectEach(config, function (key, arrVal) {\n\t\t\tif (arrVal.length !== len) {\n\t\t\t\tthrow new Error(\"arrays need to have the same length\");\n\t\t\t}\n\n\t\t\tarrVal.forEach(function (val, index) {\n\t\t\t\tresult[index][key] = val;\n\t\t\t});\n\t\t});\n\n\t\treturn result;\n\t},\n\n\tcapitaliseFirstLetter: function (string) {\n\t\treturn string.charAt(0).toUpperCase() + string.slice(1);\n\t},\n\n\tlowercaseFirstLetter: function (string: string) {\n\t\treturn string.charAt(0).toLowerCase() + string.slice(1);\n\t},\n\n\tobjectifyResult: function (name, cb) {\n\t\treturn function (e, result) {\n\t\t\tvar data = {};\n\t\t\tif (e) {\n\t\t\t\tcb(e);\n\t\t\t} else {\n\t\t\t\tdata[name] = result;\n\t\t\t\tcb(null, data);\n\t\t\t}\n\t\t};\n\t},\n\n\tarray: {\n\t\tisArray: function (arr) {\n\t\t\treturn Object.prototype.toString.call(arr) === \"[object Array]\";\n\t\t},\n\t\tfirst: function (arr) {\n\t\t\treturn arr[0];\n\t\t},\n\t\tlast: function (arr) {\n\t\t\treturn arr[arr.length - 1];\n\t\t},\n\t\tfind: function (arr, func) {\n\t\t\tvar results = arr.filter(func);\n\n\t\t\tif (results.length === 1) {\n\t\t\t\treturn results[0];\n\t\t\t}\n\t\t},\n\t\tspreadByArray: function (toSpread, attributeNames) {\n\t\t\tvar res = {};\n\n\t\t\ttoSpread.forEach(function (val, index) {\n\t\t\t\tres[attributeNames[index]] = val;\n\t\t\t});\n\n\t\t\treturn res;\n\t\t},\n\t\tcontains: function (arr, element) {\n\t\t\treturn arr.indexOf(element) > -1;\n\t\t},\n\t\tflatten: function (arr) {\n\t\t\tvar i, result = [];\n\t\t\tfor (i = 0; i < arr.length; i += 1) {\n\t\t\t\tif (arr[i] instanceof Array) {\n\t\t\t\t\tresult = result.concat(helper.array.flatten(arr[i]));\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(arr[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t},\n\n\tobject: {\n\t\tdeepSet: function (obj, partials, value) {\n\t\t\tobj = obj || {};\n\t\t\tif (partials.length === 0) {\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tvar curPartial = obj;\n\t\t\tpartials.forEach(function (part, index) {\n\t\t\t\tif (index === partials.length - 1) {\n\t\t\t\t\tcurPartial[part] = value;\n\t\t\t\t}\n\n\t\t\t\tif (!curPartial[part]) {\n\t\t\t\t\tcurPartial[part] = {};\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn obj;\n\t\t},\n\t\tdeepHas: function (obj, partials) {\n\t\t\tvar hasDeep = true, currentPartial = obj;\n\t\t\tpartials.forEach(function (partial) {\n\t\t\t\tif (currentPartial.hasOwnProperty(partial)) {\n\t\t\t\t\tcurrentPartial = currentPartial[partial];\n\t\t\t\t} else {\n\t\t\t\t\thasDeep = false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn hasDeep;\n\t\t},\n\t\tdeepGet: function (obj, partials) : any {\n\t\t\tvar currentPart = obj, depth = 0, previousPart;\n\n\t\t\tif (partials.length === 0) {\n\t\t\t\treturn {\n\t\t\t\t\tdepth: 0,\n\t\t\t\t\tvalue: obj\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tpartials.forEach(function (partial) {\n\t\t\t\tif (typeof currentPart[partial] !== \"undefined\") {\n\t\t\t\t\tpreviousPart = currentPart;\n\t\t\t\t\tcurrentPart = currentPart[partial];\n\t\t\t\t\tdepth+=1;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\tdepth: depth,\n\t\t\t\tvalue: currentPart,\n\t\t\t\tparentValue: previousPart\n\t\t\t};\n\t\t},\n\t\tmultipleFlatJoin: function (objs) {\n\t\t\tvar result = {};\n\n\t\t\tfunction doJoin(base, obj) {\n\t\t\t\thelper.objectEach(obj, function (key, value) {\n\t\t\t\t\tif (base.hasOwnProperty(key) && value !== base[key]) {\n\t\t\t\t\t\tthrow new Error(\"attribute already set!\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult[key] = value;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tobjs.map(function (e) {\n\t\t\t\tdoJoin(result, e);\n\t\t\t});\n\n\t\t\treturn result;\n\t\t}\n\t},\n\n\tpad: function (str, max) {\n\t\tstr = str.toString();\n\t\treturn str.length < max ? helper.pad(\"0\" + str, max) : str;\n\t},\n\n\tcanvasToBlob: function (canvas, type, cb) {\n\t\tcanvas.toBlob(function (blob) {\n\t\t\tcb(null, blob);\n\t\t}, type);\n\t},\n\n\tblobToDataURI: function (blob, cb) {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function() {\n\t\t\tcb(null, reader.result);\n\t\t};\n\t\treader.readAsDataURL(blob);\n\t},\n\n\tdataURItoBlob: function (dataURI) {\n\t\tif (glob.atob && glob.Blob && glob.ArrayBuffer && glob.Uint8Array) {\n\t\t\ttry {\n\t\t\t\t// convert base64 to raw binary data held in a string\n\t\t\t\t// doesn't handle URLEncoded DataURIs\n\t\t\t\tvar byteString = atob(dataURI.split(\",\")[1]);\n\n\t\t\t\t// separate out the mime component\n\t\t\t\tvar mimeString = dataURI.split(\",\")[0].split(\":\")[1].split(\";\")[0];\n\n\t\t\t\t// write the bytes of the string to an ArrayBuffer\n\t\t\t\tvar ab = new ArrayBuffer(byteString.length);\n\t\t\t\tvar ia = new Uint8Array(ab);\n\t\t\t\tfor (var i = 0; i < byteString.length; i++) {\n\t\t\t\t\tia[i] = byteString.charCodeAt(i);\n\t\t\t\t}\n\n\t\t\t\ttry{\n\t\t\t\t\treturn new Blob([ab], { type: mimeString });\n\t\t\t\t}\n\t\t\t\tcatch(e){\n\t\t\t\t\t// TypeError old chrome and FF\n\t\t\t\t\twindow.BlobBuilder = window.BlobBuilder ||\n\t\t\t\t\t\t\t\t\t\t window.WebKitBlobBuilder ||\n\t\t\t\t\t\t\t\t\t\t window.MozBlobBuilder ||\n\t\t\t\t\t\t\t\t\t\t window.MSBlobBuilder;\n\t\t\t\t\tif (e.name === \"TypeError\" && window.BlobBuilder){\n\t\t\t\t\t\tvar bb = new window.BlobBuilder();\n\t\t\t\t\t\tbb.append([ab]);\n\t\t\t\t\t\treturn bb.getBlob(mimeString);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/** calls all listeners */\n\tcallListener: function(listener, arg1) {\n\t\tvar i;\n\t\tfor (i = 0; i < listener.length; i += 1) {\n\t\t\ttry {\n\t\t\t\tlistener[i](null,arg1);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\t},\n\n\taggregateOnce: function (delayTime, callFunction) {\n\t\tvar timerStarted = false;\n\n\t\tfunction doLoad() {\n\t\t\ttimerStarted = false;\n\n\t\t\tcallFunction(function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn function () {\n\t\t\tif (!timerStarted) {\n\t\t\t\ttimerStarted = true;\n\n\t\t\t\twindow.setTimeout(doLoad, delayTime);\n\t\t\t}\n\t\t};\n\t},\n\n\tFullFiller: function () {\n\t\tvar running = false, waiters = [];\n\t\tvar success = false, failure = false, error;\n\n\t\tthis.finish = function (e) {\n\t\t\tfailure = !!e;\n\t\t\tsuccess = !e;\n\t\t\terror = e;\n\n\t\t\thelper.callEach(waiters, [error]);\n\t\t};\n\n\t\tthis.success = function () {\n\t\t\tif (!success && !failure) {\n\t\t\t\tsuccess = true;\n\n\t\t\t\thelper.callEach(waiters);\n\t\t\t}\n\t\t};\n\n\t\tthis.fail = function (e) {\n\t\t\tif (!success && !failure) {\n\t\t\t\tfailure = true;\n\t\t\t\terror = e;\n\n\t\t\t\thelper.callEach(waiters, [error]);\n\t\t\t}\n\t\t};\n\n\t\tthis.isSuccess = function () {\n\t\t\treturn success;\n\t\t};\n\n\t\tthis.start = function (cb) {\n\t\t\tif (!running && !success && !failure) {\n\t\t\t\trunning = true;\n\t\t\t\tcb();\n\t\t\t}\n\t\t};\n\n\t\tthis.await = function (cb) {\n\t\t\tif (success || failure) {\n\t\t\t\tcb(error);\n\t\t\t} else {\n\t\t\t\twaiters.push(cb);\n\t\t\t}\n\t\t};\n\t},\n\n\tdelayMultiplePromise: function (Bluebird, delayTime, loadFunction, maxOnce) {\n\t\tvar idsToLoad = [];\n\t\tvar loadPromises = {}, loaderPromise;\n\n\t\tfunction doLoad() {\n\t\t\tvar identifiers = idsToLoad.splice(0, maxOnce || idsToLoad.length);\n\n\t\t\treturn loadFunction(identifiers).then(function (results) {\n\t\t\t\tloaderPromise = null;\n\t\t\t\treturn results;\n\t\t\t}).map(function (result, i) {\n\t\t\t\treturn {\n\t\t\t\t\tid: identifiers[i],\n\t\t\t\t\tresult: result\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tfunction getLoaderPromise() {\n\t\t\tif (!loaderPromise) {\n\t\t\t\tloaderPromise = Bluebird.delay(delayTime).then(function () {\n\t\t\t\t\treturn doLoad();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn loaderPromise;\n\t\t}\n\n\t\tfunction awaitNextLoad(identifier) {\n\t\t\treturn getLoaderPromise().filter(function (res) {\n\t\t\t\treturn res.id === identifier;\n\t\t\t}).then(function (remainingResults) {\n\t\t\t\tif (remainingResults.length === 0) {\n\t\t\t\t\treturn awaitNextLoad(identifier);\n\t\t\t\t}\n\n\t\t\t\treturn remainingResults[0].result;\n\t\t\t});\n\t\t}\n\n\t\treturn function (identifier) {\n\t\t\tif (!loadPromises[identifier]) {\n\t\t\t\tidsToLoad.push(identifier);\n\n\t\t\t\tloadPromises[identifier] = awaitNextLoad(identifier);\n\t\t\t}\n\n\t\t\treturn loadPromises[identifier];\n\t\t};\n\t},\n\n\tdelayMultiple: function (delayTime, loadFunction, maxOnce?) {\n\t\tvar timerStarted = false;\n\t\tvar idsToLoad = [];\n\t\tvar loadListeners = {};\n\n\t\tfunction doLoad() {\n\t\t\tvar identifier = idsToLoad.splice(0, maxOnce || idsToLoad.length);\n\n\t\t\tloadFunction(identifier, function (err, results) {\n\t\t\t\tif (err) {\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\n\t\t\t\tvar i, curIdentifier, curListener;\n\t\t\t\tfor (i = 0; i < results.length; i += 1) {\n\t\t\t\t\tcurIdentifier = identifier[i];\n\t\t\t\t\tcurListener = loadListeners[curIdentifier];\n\n\t\t\t\t\thelper.callListener(curListener, results[i]);\n\t\t\t\t\tdelete loadListeners[curIdentifier];\n\t\t\t\t}\n\n\t\t\t\tif (idsToLoad.length === 0) {\n\t\t\t\t\ttimerStarted = false;\n\t\t\t\t} else {\n\t\t\t\t\twindow.setTimeout(doLoad, delayTime);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn function (identifier, cb) {\n\t\t\tif (loadListeners[identifier]) {\n\t\t\t\tloadListeners[identifier].push(cb);\n\t\t\t} else {\n\t\t\t\tloadListeners[identifier] = [cb];\n\t\t\t\tidsToLoad.push(identifier);\n\n\t\t\t\tif (!timerStarted) {\n\t\t\t\t\ttimerStarted = true;\n\n\t\t\t\t\twindow.setTimeout(doLoad, delayTime);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t},\n\n\tsetGeneralState: function (state, obj) {\n\t\tobj.saving = false;\n\t\tobj.success = false;\n\t\tobj.failure = false;\n\n\t\tswitch(state) {\n\t\t\tcase \"saving\":\n\t\t\t\tobj.saving = true;\n\t\t\t\tbreak;\n\t\t\tcase \"success\":\n\t\t\t\tobj.success = true;\n\t\t\t\tbreak;\n\t\t\tcase \"failure\":\n\t\t\tdefault:\n\t\t\t\tobj.failure = true;\n\t\t\t\tbreak;\n\t\t}\n\t},\n\n\tstringifyCertainAttributes: function (obj, attributes) {\n\t\tvar attr, result = {};\n\t\tfor (attr in obj) {\n\t\t\tif (obj.hasOwnProperty(attr)) {\n\t\t\t\tif (attributes.indexOf(attr) > -1) {\n\t\t\t\t\tresult[attr] = JSON.stringify(obj[attr]);\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof obj[attr] === \"object\") {\n\t\t\t\t\t\tthrow new Error(\"value should not be stringified but is object\");\n\t\t\t\t\t}\n\n\t\t\t\t\tresult[attr] = obj[attr];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tunStringifyCertainAttributes: function (obj, attributes) {\n\t\tvar attr, result = {};\n\t\tfor (attr in obj) {\n\t\t\tif (obj.hasOwnProperty(attr)) {\n\t\t\t\tif (attributes.indexOf(attr) > -1) {\n\t\t\t\t\tresult[attr] = JSON.parse(obj[attr]);\n\t\t\t\t} else {\n\t\t\t\t\tresult[attr] = obj[attr];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tnewElement: function (Constructor) {\n\t\treturn function (e) {\n\t\t\treturn new Constructor(e);\n\t\t};\n\t},\n\n\tarraySubtract: function (original, subtractor) {\n\t\tvar i, result = [];\n\t\tfor (i = 0; i < original.length; i += 1) {\n\t\t\tif (subtractor.indexOf(original[i]) === -1) {\n\t\t\t\tresult.push(original[i]);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tarrayUnique: function (arr) {\n\t\tvar hashMap = {}, i, name, l = arr.length, result = [];\n\n\t\tfor(i=0; i<l; i+=1) {\n\t\t\tif (arr[i]) {\n\t\t\t\thashMap[arr[i]] = arr[i];\n\t\t\t}\n\t\t}\n\n\t\tfor (name in hashMap) {\n\t\t\tif (hashMap.hasOwnProperty(name)) {\n\t\t\t\tresult.push(hashMap[name]);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tarrayEqual: function (arr1, arr2) {\n\t\treturn arr1.length === arr2.length && helper.arraySubtract(arr1, arr2).length === 0 && helper.arraySubtract(arr2, arr1).length === 0;\n\t},\n\n\tdeepEqual: function (obj1, obj2) {\n\t\tif (obj1 === obj2) {\n\t\t\treturn true;\n\t\t} else if (typeof obj1 === \"object\" && typeof obj2 === \"object\") {\n\t\t\tvar keys1 = Object.keys(obj1), keys2 = Object.keys(obj2);\n\n\t\t\tif (!helper.arrayEqual(keys1, keys2)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar i, cur;\n\t\t\tfor (i = 0; i < keys1.length; i += 1) {\n\t\t\t\tcur = keys1[i];\n\n\t\t\t\tif (!helper.deepEqual(obj1[cur], obj2[cur])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\tdeepCopyArray: function (arr, depth) {\n\t\tvar result = [], i;\n\t\tfor (i = 0; i < arr.length; i += 1) {\n\t\t\tresult[i] = helper.deepCopyObj(arr[i], depth-1);\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tdeepCopyObj: function (obj, depth?: number) {\n\t\tif (typeof obj !== \"object\") {\n\t\t\treturn obj;\n\t\t}\n\n\t\tif (depth < 0) {\n\t\t\tthrow new Error(\"too deep\");\n\t\t}\n\n\t\tif (obj instanceof Array) {\n\t\t\treturn helper.deepCopyArray(obj, depth);\n\t\t}\n\n\t\tvar attr, value, result = {};\n\t\t// Extend the base object\n\t\tfor (attr in obj) {\n\t\t\tif (obj.hasOwnProperty(attr)) {\n\t\t\t\tvalue = obj[attr];\n\n\t\t\t\tresult[attr] = helper.deepCopyObj(value, depth-1);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t},\n\n\textend: function (target, extender, depth, removeEmpty) {\n\t\tfunction shouldDeleteAttribute(value) {\n\t\t\tif (!removeEmpty) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn value === \"\" || value === null || (typeof value === \"object\" && Object.keys(value).length === 0);\n\t\t}\n\n\t\tif (!target) {\n\t\t\treturn extender;\n\t\t}\n\n\t\tif (depth < 0) {\n\t\t\tthrow new Error(\"too deep\");\n\t\t}\n\n\t\tvar attr, given, added;\n\t\t// Extend the base object\n\t\tfor (attr in extender) {\n\t\t\tif (extender.hasOwnProperty(attr)) {\n\t\t\t\ttarget[attr] = target[attr] || {};\n\n\t\t\t\tgiven = target[attr];\n\t\t\t\tadded = extender[attr];\n\n\t\t\t\tif (added !== undefined) {\n\t\t\t\t\tif (typeof given === \"object\" && typeof added === \"object\" && !(added instanceof Array)) {\n\t\t\t\t\t\thelper.extend(given, added, depth-1, removeEmpty);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttarget[attr] = added;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shouldDeleteAttribute(target[attr])) {\n\t\t\t\t\t\tdelete target[attr];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t},\n\n\textendNoOverwrite: function (target, extender) {\n\t\thelper.objectEach(extender, function (key, value) {\n\t\t\tif (typeof target[key] === \"undefined\") {\n\t\t\t\ttarget[key] = helper.deepCopyObj(value);\n\t\t\t} else if (typeof target[key] === \"object\") {\n\t\t\t\thelper.extendNoOverwrite(target[key], value);\n\t\t\t}\n\t\t});\n\t},\n\n\tparseDecimal: function (e) : number {\n\t\treturn parseInt(e, 10);\n\t},\n\n\tassert: function (bool) {\n\t\tif (!bool) {\n\t\t\tthrow new Error(\"assertion not met!\");\n\t\t}\n\t},\n\n\tqm: function (attr) {\n\t\treturn function (obj) {\n\t\t\treturn obj[attr];\n\t\t};\n\t},\n\n\tnop: function () {},\n\n\tobjectJoin: function (obj1, obj2) {\n\t\tvar result = {};\n\n\t\thelper.objectEach(obj1, function (key, value) {\n\t\t\tif (obj2.hasOwnProperty(key) && value !== obj2[key]) {\n\t\t\t\tif (typeof value === \"object\" && typeof obj2[key] === \"object\") {\n\t\t\t\t\tresult[key] = helper.objectJoin(value, obj2[key]);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(\"attribute set in both!\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresult[key] = value;\n\t\t\t}\n\t\t});\n\n\t\thelper.objectEach(obj2, function (key, value) {\n\t\t\tif (!obj1.hasOwnProperty(key)) {\n\t\t\t\tresult[key] = value;\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t},\n\n\tobjectEach: function (obj, cb, thisArg?: any) {\n\t\tvar attr;\n\t\tfor (attr in obj) {\n\t\t\tif (obj.hasOwnProperty(attr)) {\n\t\t\t\tcb.call(thisArg, attr, obj[attr]);\n\t\t\t}\n\t\t}\n\t},\n\n\tcopyObj: function (obj) {\n\t\tvar newObj = {}, attr;\n\t\tfor (attr in obj) {\n\t\t\tif (obj.hasOwnProperty(attr)) {\n\t\t\t\tnewObj[attr] = obj[attr];\n\t\t\t}\n\t\t}\n\n\t\treturn newObj;\n\t},\n\n\tcontainsOr: function (value) {\n\t\tvar i;\n\t\tfor (i = 1; i < arguments.length; i += 1) {\n\t\t\tif (arguments[i].indexOf(value) > -1) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\n\tarrayToObject: function (arr, func) {\n\t\tvar i, res = {};\n\t\tfor (i = 0; i < arr.length; i += 1) {\n\t\t\tres[func(arr[i], i)] = arr[i];\n\t\t}\n\n\t\treturn res;\n\t},\n\n\tremoveArray: function (arr, val) {\n\t\tif (!arr) {\n\t\t\treturn [];\n\t\t}\n\n\t\tvar ax;\n\n\t\twhile ((ax = arr.indexOf(val)) !== -1) {\n\t\t\tarr.splice(ax, 1);\n\t\t}\n\n\t\treturn arr;\n\t},\n\n\tcallEach: function (listener, args?, returnFunction: Function = () => {}) {\n\t\tvar result;\n\n\t\tlistener.forEach(function (theListener) {\n\t\t\ttry {\n\t\t\t\tvar currentResult = theListener.apply(null, args);\n\t\t\t\tif (result) {\n\t\t\t\t\tresult = returnFunction(result, currentResult);\n\t\t\t\t} else {\n\t\t\t\t\tresult = currentResult;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t},\n\n\tobjectMap: function (obj, func, thisArg?) {\n\t\tvar attr, res = {}, result;\n\t\tfor (attr in obj) {\n\t\t\tif (obj.hasOwnProperty(attr)) {\n\t\t\t\tresult = func.call(thisArg, obj[attr], attr);\n\n\t\t\t\tif (result) {\n\t\t\t\t\tres[attr] = result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t},\n\n\tsetAll: function (obj, value) {\n\t\tvar attr;\n\t\tfor (attr in obj) {\n\t\t\tif (obj.hasOwnProperty(attr)) {\n\t\t\t\tif (typeof obj[attr] === \"object\") {\n\t\t\t\t\thelper.setAll(obj, value);\n\t\t\t\t} else {\n\t\t\t\t\tobj[attr] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tdeepGet: function (obj, key) {\n\t\tvar i;\n\t\tvar cur = obj;\n\n\t\tif (typeof key === \"string\") {\n\t\t\tkey = [key];\n\t\t}\n\n\t\tif (!cur) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (i = 0; i < key.length; i += 1) {\n\t\t\tif (cur[key[i]]) {\n\t\t\t\tcur = cur[key[i]];\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\treturn cur;\n\t},\n\n\tdeepSet: function (obj, key, value) {\n\t\tvar toSet = key.pop();\n\t\tvar branch = helper.deepGet(obj, key);\n\t\tif (branch) {\n\t\t\tbranch[toSet] = value;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\n\ttoUrl: function(file) {\n\t\tvar url;\n\n\t\tif (file.localURL) {\n\t\t\treturn file.localURL;\n\t\t}\n\n\t\tif (typeof URL !== \"undefined\") {\n\t\t\turl = URL.createObjectURL(file);\n\t\t} else if (typeof webkitURL !== \"undefined\") {\n\t\t\turl = webkitURL.createObjectURL(file);\n\t\t}\n\n\t\treturn url;\n\t},\n\n\tdeepSetCreate: function (obj, keys, value) {\n\t\tvar changed = false, cur = obj;\n\t\tkeys.forEach(function (key, index) {\n\t\t\tif (index+1 < keys.length) {\n\t\t\t\tif (!cur[key]) {\n\t\t\t\t\tcur[key] = {};\n\t\t\t\t}\n\n\t\t\t\tcur = cur[key];\n\t\t\t} else if (cur[key] !== value) {\n\t\t\t\tcur[key] = helper.deepCopyObj(value);\n\t\t\t\tchanged = true;\n\t\t\t}\n\t\t});\n\n\t\treturn changed;\n\t},\n\n\tvalidateObjects: function validateObjectsF(reference, data, noValueCheck?) {\n\t\tvar key;\n\t\tfor (key in data) {\n\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\tif (!reference[key]) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!noValueCheck) {\n\t\t\t\t\tif (typeof reference[key] === \"object\") {\n\t\t\t\t\t\tif (!helper.validateObjects(reference[key], data[key])) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (typeof reference[key] === \"function\") {\n\t\t\t\t\t\tif (!reference[key](data[key])) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (reference[key] !== true) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/** chars for a sid */\n\tcodeChars: [\"Q\", \"W\", \"E\", \"R\", \"T\", \"Z\", \"U\", \"I\", \"O\", \"P\", \"A\", \"S\", \"D\", \"F\", \"G\", \"H\", \"J\", \"K\", \"L\", \"Y\", \"X\", \"C\", \"V\", \"B\", \"N\", \"M\", \"q\", \"w\", \"e\", \"r\", \"t\", \"z\", \"u\", \"i\", \"o\", \"p\", \"a\", \"s\", \"d\", \"f\", \"g\", \"h\", \"j\", \"k\", \"l\", \"y\", \"x\", \"c\", \"v\", \"b\", \"n\", \"m\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"0\"],\n\n\t/** get a file names extension */\n\tgetExtension: function (filename) {\n\t\tvar i = filename.lastIndexOf(\".\");\n\t\treturn (i < 0) ? \"\" : filename.substr(i);\n\t},\n\n\t/** get a filenames name */\n\tgetName: function (filename) {\n\t\tvar i = filename.lastIndexOf(\".\");\n\t\treturn (i < 0) ? filename : filename.substr(0, i);\n\t},\n\n\t/** just a function which moves on in step */\n\tpassFunction: function () {\n\t\tthis.apply(null, arguments);\n\t},\n\t/** order a certain ass-array correctly\n\t* @param object object to sort\n\t* @param order correct order (normal array)\n\t* @param getFunction which func to call on objects to get their \"value\"\n\t* @return ordered object\n\t*/\n\torderCorrectly: function (object, order, getFunction) {\n\t\tvar i, j, results = [];\n\t\tfor (i = 0; i < order.length; i += 1) {\n\t\t\tfor (j = 0; j < object.length; j += 1) {\n\t\t\t\tif (object[j][getFunction]() === order[i]) {\n\t\t\t\t\tresults.push(object[j]);\n\n\t\t\t\t\tobject.splice(j, 1);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t},\n\n\tisUUID: function (uuid) {\n\t\treturn helper.isString(uuid) && uuid.match(uuidRegex);\n\t},\n\n\t/** is data an integer?\n\t* @param data value to check for int value\n\t* @return bool is integer?\n\t*/\n\tisInt: function (data) {\n\t\tvar y = parseInt(data, 10);\n\t\tif (isNaN(y)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn y.toString() === data.toString();\n\t},\n\n\t/** is data an id?*/\n\tisID: function (data) {\n\t\tif (helper.isInt(data)) {\n\t\t\tdata = parseInt(data, 10);\n\n\t\t\treturn (data > 0);\n\t\t}\n\n\t\treturn false;\n\t},\n\n\tisRealID: function (data) {\n\t\tif (typeof data !== \"string\") {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar parts = data.split(\":\");\n\n\t\tif (parts.length !== 2) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (parts[1].length !== 64) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!helper.isNickname(parts[0]) && !helper.isMail(parts[0])) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/** is data a valid nickname? */\n\tisNickname: function (data) {\n\t\treturn (helper.isString(data) && data.length !== 0 && !!data.match(/^[A-z][A-z0-9]*$/));\n\t},\n\n\t/** is data an e-mail? */\n\tisMail: function (data) {\n\t\tvar regex = /^.+@.+$/;\n\t\treturn (helper.isString(data) && data.length !== 0 && regex.test(data));\n\t},\n\n\t/** is data a session Key (hex value with certain length) */\n\tisSessionKey: function (data) {\n\t\treturn (helper.isset(data) && (data.length === 64 || data.length === 32) && helper.isHex(data));\n\t},\n\n\tisPassword: function (data) {\n\t\treturn (helper.isHex(data) && data.length === 64);\n\t},\n\n\tisCurve: function (data) {\n\t\tif (data === \"c256\" || data === \"256\") {\n\t\t\treturn true;\n\t\t}\n\t\t//TODO!\n\t\treturn false;\n\t},\n\n\tisBase64: function (data) {\n\t\treturn (helper.isset(data) && typeof data === \"string\" && !!data.match(/^[A-Za-z0-9\\+\\/=]|=[^=]|={3,}$/));\n\t},\n\n\tisSignature: function (data) {\n\t\treturn helper.isHex(data);\n\t},\n\n\tisHex: function (data) {\n\t\treturn (helper.isset(data) && typeof data === \"string\" && !!data.match(/^[A-Fa-f0-9]*$/));\n\t},\n\n\t/** typeof val == object? */\n\tisObject: function (val) {\n\t\treturn (typeof val === \"object\");\n\t},\n\n\t/** is val set (not null/undefined) */\n\tisString: function (val) {\n\t\treturn (val !== undefined && val !== null && typeof val === \"string\");\n\t},\n\n\t/** is val set (not null/undefined) */\n\tisset: function (val) {\n\t\treturn (val !== undefined && val !== null);\n\t},\n\n\t/** checks if an array is set and attributes in that array are set.\n\t* @param arrayName the array to check\n\t* @param other attributes to check for\n\t* checks if arrayName[1][2][3][4]... is set where 1-inf are the given attributes.\n\t* helper function\n\t* @author Nilos\n\t*/\n\tarraySet: function (arrayName) {\n\t\tvar i = 1;\n\t\tvar memory;\n\t\tif (helper.isset(arrayName)) {\n\t\t\tmemory = arrayName;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (i = 1; i < arguments.length; i += 1) {\n\t\t\tif (helper.isset(memory[arguments[i]])) {\n\t\t\t\tmemory = memory[arguments[i]];\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t},\n\n\tnT: function (cb) {\n\t\tvar nT = function nTf() {\n\t\t\tvar args = arguments;\n\t\t\tif (typeof process !== \"undefined\") {\n\t\t\t\tprocess.nextTick(function () {\n\t\t\t\t\tcb.apply(this, args);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcb.apply(this, args);\n\t\t\t}\n\t\t};\n\n\t\treturn nT;\n\t},\n\n\t/** step function\n\t* throws given errors\n\t* passes on all other stuff to given function\n\t*/\n\tsF: function (cb) {\n\t\tvar mysf: any = function sfFunction(err) {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err.stack);\n\t\t\t\tthis(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar args = []; // empty array\n\t\t\tvar i;\n\t\t\t// copy all other arguments we want to \"pass through\"\n\t\t\tfor (i = 1; i < arguments.length; i += 1) {\n\t\t\t\targs.push(arguments[i]);\n\t\t\t}\n\n\t\t\treturn cb.apply(this, args);\n\t\t};\n\n\t\tmysf.getRealFunction = function () {\n\t\t\treturn cb;\n\t\t};\n\n\t\treturn mysf;\n\t},\n\n\t/** handle Error function for step\n\t* passes given errors to callback but only those!\n\t* throws other errors.\n\t*/\n\thE: function (cb, errors) {\n\t\treturn function (err) {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err);\n\n\t\t\t\tvar passToNext = false;\n\n\t\t\t\tif (errors instanceof Array) {\n\t\t\t\t\tvar i;\n\t\t\t\t\tfor (i = 0; i < errors.length; i += 1) {\n\t\t\t\t\t\tif (err instanceof errors[i]) {\n\t\t\t\t\t\t\tpassToNext = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tpassToNext = err instanceof errors;\n\t\t\t\t}\n\n\t\t\t\tif (!passToNext) {\n\t\t\t\t\tthis(err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn cb.apply(this, arguments);\n\t\t};\n\t},\n\n\temptyUnion: function (arr1, arr2) {\n\t\treturn helper.arraySubtract(arr1, arr2).length === arr1.length && helper.arraySubtract(arr2, arr1).length === arr2.length;\n\t},\n\n\t/** is needle in haystack? */\n\tinArray: function (haystack, needle) {\n\t\tvar i = 0;\n\t\tfor (i = 0; i < haystack.length; i += 1) {\n\t\t\tif (haystack[i] === needle) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\n\tfirstCapital: function (string) {\n\t\treturn string.charAt(0).toUpperCase() + string.slice(1);\n\t}\n}\n\nexport default helper\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/helper/helper.ts","\"use strict\";\n\nconst Observer = require(\"asset/observer\");\nconst SecuredData = require(\"asset/securedDataWithMetaData\");\nconst Enum = require(\"asset/enum\");\nconst errors = require(\"asset/errors\");\nconst Bluebird = require(\"bluebird\");\nvar database, loaded = false,\n\ttrustManager;\n\nvar sortedTrustStates = [\"BROKEN\", \"UNTRUSTED\", \"TIMETRUSTED\", \"WHISPEERVERIFIED\", \"NETWORKVERIFIED\", \"VERIFIED\", \"OWN\"];\n\nvar trustStates = new Enum.default(sortedTrustStates);\n\nsortedTrustStates = sortedTrustStates.map(function(trustLevel) {\n\treturn trustStates.fromString(\"|\" + trustLevel + \"|\");\n});\n\nfunction serializeTrust(trustLevel) {\n\treturn trustStates.toString(trustLevel);\n}\n\nfunction unserializeTrust(trustLevel) {\n\treturn trustStates.fromString(trustLevel);\n}\n\nfunction KeyTrustData(data) {\n\tvar trustSymbol = unserializeTrust(data.trust);\n\n\tthis.getAddedTime = function() {\n\t\treturn data.added;\n\t};\n\tthis.getKey = function() {\n\t\treturn data.key;\n\t};\n\tthis.getUserID = function() {\n\t\treturn data.userid;\n\t};\n\tthis.getNickname = function() {\n\t\treturn data.nickname;\n\t};\n\tthis.getTrust = function() {\n\t\treturn trustSymbol;\n\t};\n\n\n\tthis.isUntrusted = function() {\n\t\treturn trustSymbol === trustStates.UNTRUSTED;\n\t};\n\tthis.isTimeTrusted = function() {\n\t\treturn trustSymbol === trustStates.TIMETRUSTED;\n\t};\n\tthis.isWhispeerVerified = function() {\n\t\treturn trustSymbol === trustStates.WHISPEERVERIFIED;\n\t};\n\tthis.isNetworkVerified = function() {\n\t\treturn trustSymbol === trustStates.NETWORKVERIFIED;\n\t};\n\tthis.isVerified = function() {\n\t\treturn trustSymbol === trustStates.VERIFIED;\n\t};\n\tthis.isOwn = function() {\n\t\treturn trustSymbol === trustStates.OWN;\n\t};\n\n\tthis.setTrust = function(trustLevel) {\n\t\ttrustManager.setKeyTrustLevel(data.key, trustLevel);\n\t};\n}\n\nfunction userToDataSet({ key, userid, nickname }, trustLevel) {\n\tvar content = {\n\t\tadded: new Date().getTime(),\n\t\ttrust: serializeTrust(trustLevel || trustStates.UNTRUSTED),\n\t\tkey,\n\t\tuserid,\n\t\tnickname\n\t};\n\n\treturn content;\n}\n\nvar fakeKeyExistence = 0,\n\townKey, specialKeys = [\"me\", \"nicknames\", \"ids\"];\n\ntrustManager = {\n\tallow: function(count) {\n\t\tif (!loaded) {\n\t\t\tfakeKeyExistence = count;\n\t\t}\n\t},\n\tdisallow: function() {\n\t\tfakeKeyExistence = 0;\n\t},\n\ttrustStates: trustStates,\n\tisLoaded: function() {\n\t\treturn loaded;\n\t},\n\tcreateDatabase: function({ key, userid, nickname }) {\n\t\tvar data = {};\n\n\t\tdata.nicknames = {}\n\t\tdata.ids = {}\n\n\t\tdata[key] = userToDataSet({ key, userid, nickname }, trustStates.OWN)\n\n\t\tdata.nicknames[nickname] = key\n\t\tdata.ids[userid] = key\n\t\tdata.me =  key\n\n\t\tdatabase = SecuredData.load(undefined, data, {\n\t\t\ttype: \"trustManager\"\n\t\t});\n\n\t\tloaded = true;\n\t},\n\tsetOwnSignKey: function(_ownKey) {\n\t\townKey = _ownKey;\n\t},\n\taddDataSet: function(dataSet) {\n\t\tvar signKey = dataSet.key;\n\n\t\tvar idKey = database.metaAttr([\"ids\", dataSet.userid]);\n\t\tvar nicknameKey = database.metaAttr([\"nicknames\", dataSet.nickname]);\n\n\t\tif (idKey && idKey !== signKey) {\n\t\t\tthrow new errors.SecurityError(\"we already have got a key for this users id\");\n\t\t}\n\n\t\tif (nicknameKey && nicknameKey !== signKey) {\n\t\t\tthrow new errors.SecurityError(\"we already have got a key for this users nickname\");\n\t\t}\n\n\t\tdatabase.metaAdd([signKey], dataSet);\n\n\t\tif (dataSet.nickname) {\n\t\t\tdatabase.metaAdd([\"nicknames\", dataSet.nickname], signKey);\n\t\t}\n\n\t\tdatabase.metaAdd([\"ids\", dataSet.userid], signKey);\n\t},\n\tupdateDatabase: function(data, cb) {\n\t\tif (!loaded || data._signature === database.metaAttr(\"_signature\")) {\n\t\t\treturn Bluebird.resolve().nodeify(cb);\n\t\t}\n\n\t\tvar givenDatabase = SecuredData.load(undefined, data, {\n\t\t\ttype: \"trustManager\"\n\t\t});\n\t\treturn Bluebird.try(function() {\n\t\t\tif (data.me === ownKey) {\n\t\t\t\treturn givenDatabase.verifyAsync(ownKey, \"user\");\n\t\t\t}\n\n\t\t\tthrow new errors.SecurityError(\"not my trust database\");\n\t\t}).then(function() {\n\t\t\tvar newKeys = givenDatabase.metaKeys().filter(function(key) {\n\t\t\t\treturn !database.metaHasAttr(key);\n\t\t\t});\n\n\t\t\tvar oldKeys = givenDatabase.metaKeys().filter(function(key) {\n\t\t\t\treturn database.metaHasAttr(key);\n\t\t\t}).filter(function(key) {\n\t\t\t\treturn specialKeys.indexOf(key) === -1;\n\t\t\t});\n\n\t\t\tvar changed = false;\n\n\t\t\tnewKeys.forEach(function(signKey) {\n\t\t\t\tchanged = true;\n\n\t\t\t\tvar userDataSet = givenDatabase.metaAttr(signKey);\n\n\t\t\t\ttrustManager.addDataSet(userDataSet);\n\t\t\t});\n\n\t\t\toldKeys.forEach(function(signKey) {\n\t\t\t\tvar oldValue = database.metaAttr(signKey);\n\t\t\t\tvar newValue = givenDatabase.metaAttr(signKey);\n\n\t\t\t\tvar oldTrust = unserializeTrust(oldValue.trust);\n\t\t\t\tvar newTrust = unserializeTrust(newValue.trust);\n\n\t\t\t\tif (sortedTrustStates.indexOf(oldTrust) < sortedTrustStates.indexOf(newTrust)) {\n\t\t\t\t\tchanged = true;\n\t\t\t\t\tdatabase.metaAdd([signKey, \"trust\"], newValue.trust);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (changed) {\n\t\t\t\ttrustManager.notify(\"\", \"updated\");\n\t\t\t}\n\n\t\t\treturn changed;\n\t\t}).nodeify(cb);\n\t},\n\tloadDatabase: function(data, cb) {\n\t\tif (loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (data.me !== ownKey) {\n\t\t\tthrow new errors.SecurityError(\"not my trust database\");\n\t\t}\n\n\t\tvar givenDatabase = SecuredData.load(undefined, data, {\n\t\t\ttype: \"trustManager\"\n\t\t});\n\t\treturn Bluebird.try(function() {\n\t\t\treturn givenDatabase.verifyAsync(ownKey, \"user\");\n\t\t}).then(function() {\n\t\t\ttrustManager.disallow();\n\t\t\tdatabase = givenDatabase;\n\t\t\tloaded = true;\n\n\t\t\ttrustManager.notify(\"\", \"loaded\");\n\t\t}).nodeify(cb);\n\t},\n\thasKeyData: function(keyid) {\n\t\tif (!loaded) {\n\t\t\tif (keyid === ownKey) {\n\t\t\t\treturn true;\n\t\t\t} else if (fakeKeyExistence > 0) {\n\t\t\t\tfakeKeyExistence -= 1;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"trust manager not yet loaded\");\n\t\t\t}\n\t\t}\n\t\treturn database.metaHasAttr(keyid);\n\t},\n\tgetKeyData: function(keyid) {\n\t\tvar keyData = database.metaAttr(keyid);\n\n\t\tif (keyData) {\n\t\t\treturn new KeyTrustData(keyData);\n\t\t}\n\n\t\treturn false;\n\t},\n\taddUser: function(userInfo) {\n\t\ttrustManager.addDataSet(userToDataSet(userInfo));\n\t},\n\tsetKeyTrustLevel: function(signKey, trustLevel) {\n\t\tif (trustLevel === trustStates.OWN) {\n\t\t\tthrow new Error(\"do not use setKeyTrustLevel for own keys.\");\n\t\t}\n\n\t\tif (database.metaHasAttr(signKey)) {\n\t\t\tdatabase.metaAdd([signKey, \"trust\"], serializeTrust(trustLevel));\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n\tgetUpdatedVersion: function(cb) {\n\t\treturn database.sign(ownKey).nodeify(cb);\n\t}\n};\n\nObserver.extend(trustManager);\n\nmodule.exports = trustManager;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/crypto/trustManager.js","\"use strict\";\nconst h = require(\"../helper/helper\").default\nconst config = require(\"config\");\nconst Observer = require(\"asset/observer\");\nconst keyStore = require(\"crypto/keyStore\");\nconst chelper = require(\"crypto/helper\");\nconst Bluebird = require(\"bluebird\");\nvar loaded = false,\n\tchanged = false,\n\tisLoaded = {};\n\nisLoaded.promise = new Bluebird(function(resolve) {\n\tisLoaded.promiseResolve = resolve;\n});\n\nfunction dataSetToHash(signature, hash, key) {\n\tvar data = {\n\t\tsignature: chelper.bits2hex(signature),\n\t\tsignatureHash: chelper.bits2hex(hash),\n\t\tkey: key\n\t};\n\n\treturn keyStore.hash.hashObjectOrValueHex(data, config.hashVersion);\n}\n\n/*\n\tuser:  signedKeys, signedFriendList, profile\n\tme: circle, trustManager, settings\n\tmessage: topic, message\n\tpost: post, comment\n\n\tnoCache: friendShip, removeFriend\n*/\n\nvar types = {\n\tme: {\n\t\tmaxCount: -1,\n\t\tsaveID: true\n\t},\n\tuser: {\n\t\tmaxCount: 500,\n\t\tsaveID: true\n\t},\n\ttopic: {\n\t\tmaxCount: 30,\n\t\tsaveID: false\n\t},\n\tmessage: {\n\t\tmaxCount: 200,\n\t\tsaveID: false\n\t},\n\tpost: {\n\t\tmaxCount: 100,\n\t\tsaveID: false\n\t}\n};\n\nvar cacheTypes = {\n\tsignatureCache: \"noCache\",\n\n\tsignedFriendList: \"user\",\n\n\tcircle: \"me\",\n\ttrustManager: \"me\",\n\tsettings: \"me\",\n\n\ttopicUpdate: \"noCache\",\n\n\tpost: \"post\",\n\tpostPrivate: \"post\",\n\n\ttopic: \"noCache\",\n\tmessage: \"noCache\",\n\n\tprofile: \"noCache\",\n\tsignedKeys: \"noCache\",\n\n\tcomment: \"noCache\",\n\tfriendShip: \"noCache\",\n\tremoveFriend: \"noCache\"\n};\n\nvar Database = function(type, options) {\n\tthis._type = type;\n\n\tthis._maxCount = options.maxCount;\n\tthis._saveID = options.saveID;\n\n\tthis._signatures = {};\n};\n\nDatabase.prototype.getType = function() {\n\treturn this._type;\n};\n\nDatabase.prototype.getCacheEntry = function(id) {\n\tvar entry = {};\n\tif (this._maxCount > -1) {\n\t\tentry.date = new Date().getTime();\n\t}\n\n\tif (this._saveID && id) {\n\t\tentry.id = id;\n\t}\n\n\treturn entry;\n};\n\nDatabase.prototype.allEntries = function() {\n\treturn this.allSignatures().map(function(signatureHash) {\n\t\tvar entry = h.deepCopyObj(this.getEntry(signatureHash));\n\t\tentry.signatureHash = signatureHash;\n\t\treturn entry;\n\t}, this);\n};\n\nDatabase.prototype.getEntry = function(signatureHash) {\n\treturn this._signatures[signatureHash];\n};\n\nDatabase.prototype.joinEntries = function(entries) {\n\tentries.forEach(function(entry) {\n\t\tvar signatureHash = entry.signatureHash;\n\n\t\tdelete entry.signatureHash;\n\n\t\tif (!this._signatures[signatureHash]) {\n\t\t\tthis._signatures[signatureHash] = entry;\n\t\t}\n\t}, this);\n};\n\nDatabase.prototype.deleteByID = function(id) {\n\tif (!this._saveID || !id) {\n\t\treturn;\n\t}\n\n\tthis.allEntries().filter(function(entry) {\n\t\treturn entry.id === id;\n\t}).forEach(function(entry) {\n\t\tthis.deleteEntry(entry.signatureHash);\n\t}, this);\n};\n\nDatabase.prototype.deleteEntry = function(signatureHash) {\n\tdelete this._signatures[signatureHash];\n};\n\nDatabase.prototype.addSignature = function(signature, hash, key, id) {\n\tif (!h.isRealID(key) || !h.isSignature(chelper.bits2hex(signature))) {\n\t\tthrow new Error(\"invalid input\");\n\t}\n\n\tvar sHash = dataSetToHash(signature, hash, key);\n\n\tchanged = true;\n\n\tthis.deleteByID(id);\n\tthis._signatures[sHash] = this.getCacheEntry(id);\n\n\tthis.cleanUp();\n};\n\nDatabase.prototype.hasEntry = function(signatureHash) {\n\tif (this._signatures[signatureHash]) {\n\t\treturn true;\n\t}\n\n\treturn false;\n};\n\nDatabase.prototype.hasSignature = function(signature, hash, key) {\n\tvar sHash = dataSetToHash(signature, hash, key);\n\treturn this.hasEntry(sHash);\n};\n\nDatabase.prototype.cleanUp = function() {\n\tif (this._maxCount === -1) {\n\t\treturn;\n\t}\n\n\tvar entries = this.allEntries();\n\tif (entries.length <= this._maxCount) {\n\t\treturn;\n\t}\n\n\tconsole.log(\"Cleaning up database of type \" + this._type + \" (\" + entries.length + \")\");\n\n\tentries.sort(function(a, b) {\n\t\treturn a.date - b.date;\n\t});\n\n\tentries.slice(0, entries.length - this._maxCount).forEach(function(entry) {\n\t\tthis.deleteEntry(entry.signatureHash);\n\t}, this);\n};\n\nDatabase.prototype.allSignatures = function() {\n\treturn Object.keys(this._signatures);\n};\n\nvar allDatabases = [];\nh.objectEach(types, function(name, val) {\n\ttypes[name] = new Database(name, val);\n\tallDatabases.push(types[name]);\n});\n\nvar signatureCache = {\n\tawaitLoading: function() {\n\t\treturn isLoaded.promise;\n\t},\n\t/**\n\t * Has the signature cache changed? (was a signature added/removed?)\n\t */\n\tisChanged: function() {\n\t\treturn changed;\n\t},\n\tresetChanged: function() {\n\t\tchanged = false;\n\t},\n\tisLoaded: function() {\n\t\treturn loaded;\n\t},\n\t/**\n\t * Load a given signature cache\n\t * @param signatureCacheData signature cache data to load.\n\t * @param ownKey own signing key\n\t */\n\tload: function(signatureCacheData, ownKey) {\n\t\tif (signatureCacheData.internalHashVersion !== config.hashVersion) {\n\t\t\tconsole.warn(\"resetting signature cache to upgrade to new hash version\");\n\t\t\tsignatureCache.initialize(ownKey);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (signatureCacheData.me !== ownKey) {\n\t\t\tconsole.warn(\"not my signature cache\");\n\t\t\tsignatureCache.initialize(ownKey);\n\n\t\t\treturn;\n\t\t}\n\n\t\tsignatureCacheData.databases.forEach(function(db) {\n\t\t\ttypes[db.type].joinEntries(db.entries);\n\t\t});\n\n\t\tsignatureCache.initialize(ownKey);\n\t},\n\t/**\n\t * Initialize cache\n\t * @param ownKey id of the own sign key\n\t */\n\tinitialize: function() {\n\t\tloaded = true;\n\n\t\tisLoaded.promiseResolve();\n\t},\n\t/**\n\t * Get the signed updated version of this signature cache\n\t */\n\tgetUpdatedVersion: function() {\n\t\tif (!loaded) {\n\t\t\treturn Bluebird.reject(\"Signature Cache not yet loaded!\");\n\t\t}\n\n\t\tvar databases = allDatabases.map(function(db) {\n\t\t\treturn {\n\t\t\t\ttype: db.getType(),\n\t\t\t\tentries: db.allEntries()\n\t\t\t};\n\t\t});\n\n\t\tvar data = {\n\t\t\tinternalHashVersion: config.hashVersion,\n\t\t\tdatabases: databases\n\t\t};\n\n\t\treturn Bluebird.resolve(data);\n\t},\n\t/**\n\t * Check if a signature is in the cache\n\t * @param signature the signature to check for\n\t * @param hash hash that was signed\n\t * @param key key that was used to sign the signature\n\t */\n\tisValidSignatureInCache: function(signature, hash, key) {\n\t\tvar sHash = dataSetToHash(signature, hash, key);\n\n\t\treturn allDatabases.filter(function(database) {\n\t\t\treturn database.hasEntry(sHash);\n\t\t}).length > 0;\n\t},\n\t/**\n\t * Add a valid signature to the cache.\n\t * @param signature the signature to add\n\t * @param hash the hash that was signed by the signature\n\t * @param key the key used to verify the signature\n\t * @param type type of the signed object\n\t * @param (id) id of the signed object\n\t */\n\taddValidSignature: function(signature, hash, key, type, id) {\n\t\tif (!h.isRealID(key) || !h.isSignature(chelper.bits2hex(signature))) {\n\t\t\tthrow new Error(\"invalid input\");\n\t\t}\n\n\t\tvar reducedType = cacheTypes[type];\n\n\t\tif (!reducedType) {\n\t\t\tconsole.warn(\"unknown type: \" + type);\n\t\t\treturn;\n\t\t}\n\n\t\tif (reducedType === \"noCache\") {\n\t\t\treturn;\n\t\t}\n\n\t\tif (id) {\n\t\t\tid = type + \"-\" + id;\n\t\t}\n\n\t\tvar db = types[reducedType];\n\t\tdb.addSignature(signature, hash, key, id);\n\t}\n};\n\nObserver.extend(signatureCache);\n\nmodule.exports = signatureCache;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/crypto/signatureCache.js","import * as Bluebird from \"bluebird\"\n\nimport Cache from \"../services/Cache\"\n\ntype hookType<ObjectType, CachedObjectType> = {\n\tdownload: (id: string) => Bluebird<any>,\n\tload: (response: any) => Bluebird<CachedObjectType>,\n\trestore: (response: CachedObjectType) => Bluebird<ObjectType> | ObjectType,\n\tgetID: (response: any) => string,\n\tcacheName: string\n}\n\nfunction createLoader<ObjectType, CachedObjectType>({ download, load, restore, getID, cacheName }: hookType<ObjectType, CachedObjectType>) {\n\tlet loading: { [s: string]: Bluebird<ObjectType> } = {}\n\tlet byId: { [s: string]: ObjectType } = {}\n\n\tconst cache = new Cache(cacheName)\n\n\tconst considerLoaded = (id) => {\n\t\tloading = { ...loading }\n\t\tdelete loading[id]\n\t}\n\n\tconst cacheInMemory = (id, instance) => {\n\t\tbyId = { ...byId, [id]: instance }\n\t\treturn instance\n\t}\n\n\tconst loadFromCache = (id) =>\n\t\tcache.get(id)\n\t\t\t.then((cacheResponse) => cacheResponse.data)\n\t\t\t.then(restore)\n\t\t\t.then((instance) => {\n\t\t\t\tcacheInMemory(id, instance)\n\t\t\t\tconsiderLoaded(id)\n\t\t\t\treturn instance\n\t\t\t})\n\n\tconst serverResponseToInstance = (response, id) =>\n\t\tload(response)\n\t\t\t.then((cacheableData) => cache.store(id, cacheableData).thenReturn(cacheableData))\n\t\t\t.then(restore)\n\t\t\t.then((instance) => cacheInMemory(id, instance))\n\t\t\t.finally(() => considerLoaded(id))\n\n\treturn class ObjectLoader {\n\t\tstatic getLoaded(id): ObjectType {\n\t\t\tif (!ObjectLoader.isLoaded(id)) {\n\t\t\t\tthrow new Error(`Not yet loaded: ${id}`)\n\t\t\t}\n\n\t\t\treturn byId[id]\n\t\t}\n\n\t\tstatic isLoaded(id) {\n\t\t\treturn byId.hasOwnProperty(id)\n\t\t}\n\n\t\t// Throws\n\t\tstatic getFromCache(id): Bluebird<ObjectType> {\n\t\t\tif (byId[id]) {\n\t\t\t\treturn Bluebird.resolve(byId[id])\n\t\t\t}\n\n\t\t\treturn loadFromCache(id)\n\t\t}\n\n\t\tstatic load(response): Bluebird<ObjectType> {\n\t\t\tconst id = getID(response)\n\n\t\t\tif (byId[id]) {\n\t\t\t\treturn Bluebird.resolve(byId[id])\n\t\t\t}\n\n\t\t\tif (!loading[id]) {\n\t\t\t\tloading = {\n\t\t\t\t\t...loading,\n\t\t\t\t\t[id]: loadFromCache(id).catch(() => serverResponseToInstance(response, id))\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t return loading[id]\n\t\t}\n\n\t\tstatic get(id): Bluebird<ObjectType> {\n\t\t\tif (typeof id === \"undefined\" || id === null) {\n\t\t\t\tthrow new Error(`Can't get object with id ${id} - ${cacheName}`)\n\t\t\t}\n\n\t\t\tif (byId[id]) {\n\t\t\t\treturn Bluebird.resolve(byId[id])\n\t\t\t}\n\n\t\t\tif (!loading[id]) {\n\t\t\t\tlet promise = loadFromCache(id)\n\t\t\t\t\t.catch(() => download(id).then((response) => serverResponseToInstance(response, id)))\n\n\t\t\t\tloading = {\n\t\t\t\t\t...loading,\n\t\t\t\t\t[id]: promise\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t return loading[id]\n\t\t}\n\n\t\tstatic getAll = () => {\n\t\t\treturn byId\n\t\t}\n\n\t\tstatic removeLoaded = (id) => delete byId[id]\n\n\t\tstatic addLoaded = (id, obj: ObjectType) => {\n\t\t\tbyId[id] = obj\n\t\t}\n\t}\n}\n\nexport default createLoader\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/cachedObjectLoader.ts","/**\n* friendsService\n**/\n\nvar h = require(\"../helper/helper\").default;\nvar Observer = require(\"asset/observer\");\nvar SecuredData = require(\"asset/securedDataWithMetaData\");\nvar Bluebird = require(\"bluebird\");\n\nvar socket = require(\"services/socket.service\").default;\nvar keyStore = require(\"services/keyStore.service\").default;\nvar initService = require(\"services/initService\");\n\nvar friends = [],\n\trequests = [],\n\trequested = [],\n\tignored = [],\n\tremoved = [],\n\tdeleted = [],\n\tsignedList,\n\tonlineFriends = {},\n\tfriendsService,\n\tfriendsServiceLoaded = false;\n\nvar friendsData = {\n\trequestsCount: 0,\n\tfriendsCount: 0,\n\trequestedCount: 0\n};\n\nfunction updateCounters() {\n\tfriendsData.friendsCount = friends.length;\n\tfriendsData.requestsCount = requests.length;\n\tfriendsData.requestedCount = requested.length;\n}\n\nfunction userOnline(uid, status) {\n\tonlineFriends[uid] = status;\n\tfriendsService.notify(status, \"online:\" + uid);\n}\n\nfunction createBasicData(ownUser, otherUser) {\n\tvar friendShipKey;\n\n\t//encr intermediate key w/ users cryptKey\n\treturn keyStore.sym.asymEncryptKey(\n\t\townUser.getFriendsKey(),\n\t\totherUser.getCryptKey()\n\t).then(function (_friendShipKey) {\n\t\tfriendShipKey = _friendShipKey;\n\t\tvar mainKey = ownUser.getMainKey();\n\n\t\tsignedList.metaSetAttr(otherUser.getID(), friendShipKey);\n\n\t\treturn Bluebird.all([\n\t\t\tSecuredData.load(undefined, {\n\t\t\t\tuser: otherUser.getID()\n\t\t\t}, { type: \"friendShip\" }).sign(ownUser.getSignKey()),\n\n\t\t\tsignedList.sign(ownUser.getSignKey()),\n\n\t\t\tkeyStore.sym.symEncryptKey(friendShipKey, mainKey)\n\t\t]);\n\t}).spread(function (securedData, signedList) {\n\t\tvar data = {\n\t\t\tsignedList: signedList,\n\t\t\tmeta: securedData,\n\t\t\tkey: keyStore.upload.getKey(friendShipKey)\n\t\t};\n\n\t\treturn {\n\t\t\tdata: data,\n\t\t\tkey: friendShipKey\n\t\t};\n\t});\n}\n\nfunction generateRemovalData(ownUser, otherUser) {\n\treturn Bluebird.try(function () {\n\t\tvar signedRemovalPromise = SecuredData.load(undefined, {\n\t\t\tinitial: removed.indexOf(ownUser.getID()) === -1,\n\t\t\tuser: otherUser.getID()\n\t\t}, { type: \"removeFriend\" }).sign(ownUser.getSignKey()\t);\n\n\t\tsignedList.metaRemoveAttr(otherUser.getID());\n\n\t\tvar signedListPromise = signedList.sign(ownUser.getSignKey());\n\n\t\treturn Bluebird.all([\n\t\t\tsignedRemovalPromise,\n\t\t\tsignedListPromise\n\t\t]);\n\t}).spread(function (signedRemoval, updatedSignedList) {\n\t\treturn ownUser.generateNewFriendsKey().then(function (result) {\n\t\t\treturn {\n\t\t\t\tsignedRemoval: signedRemoval,\n\t\t\t\tupdatedSignedList: updatedSignedList,\n\t\t\t\tsignedKeys: result.updatedSignedKeys,\n\t\t\t\tnewFriendsKey: result.newFriendsKey\n\t\t\t};\n\t\t});\n\t});\n}\n\nfunction addAsFriend(uid) {\n\tvar otherUser, friendShipKey, userService = require(\"users/userService\").default;\n\treturn Bluebird.try(function () {\n\t\treturn friendsService.awaitLoading();\n\t}).then(function () {\n\t\treturn userService.get(uid);\n\t}).then(function (u) {\n\t\totherUser = u;\n\t\treturn createBasicData(userService.getOwn(), otherUser);\n\t}).then(function (result) {\n\t\tfriendShipKey = result.key;\n\n\t\tvar friendsKey = userService.getOwn().getFriendsKey();\n\t\tresult.data.decryptors = keyStore.upload.getDecryptors([friendsKey], [friendShipKey]);\n\n\t\treturn socket.emit(\"friends.add\", result.data);\n\t}).then(function (result) {\n\t\tif (result.success) {\n\t\t\totherUser.setFriendShipKey(friendShipKey);\n\n\t\t\tif (result.friends) {\n\t\t\t\tfriends.push(uid);\n\t\t\t\th.removeArray(requests, uid);\n\t\t\t\tfriendsService.notify(uid, \"new\");\n\t\t\t} else {\n\t\t\t\trequested.push(uid);\n\t\t\t\tfriendsService.notify(uid, \"newRequested\");\n\t\t\t}\n\n\t\t\tupdateCounters();\n\t\t}\n\t});\n}\n\nsocket.channel(\"friendRequest\", function (e, requestData) {\n\tvar uid = h.parseDecimal(requestData.uid);\n\tif (!h.containsOr(uid, requests, friends, requested))  {\n\t\trequests.push(uid);\n\t\tupdateCounters();\n\n\t\tfriendsService.notify(uid, \"newRequest\");\n\t}\n});\n\nsocket.channel(\"friendAccept\", function (e, requestData) {\n\tvar uid = h.parseDecimal(requestData.uid);\n\tif (!h.containsOr(uid, requests, friends))  {\n\t\tfriends.push(uid);\n\t\th.removeArray(requested, uid);\n\n\t\tupdateCounters();\n\n\t\tfriendsService.notify(uid, \"new\");\n\n\t\tuserOnline(uid, 2);\n\t}\n});\n\nsocket.channel(\"friendOnlineChange\", function (e, requestData) {\n\tuserOnline(requestData.uid, requestData.status);\n});\n\nfunction checkAndRemove(uid) {\n\tvar userService = require(\"users/userService\").default;\n\treturn Bluebird.try(function () {\n\t\treturn Bluebird.all([\n\t\t\tuserService.get(uid),\n\t\t\tsocket.emit(\"friends.getSignedData\", {\n\t\t\t\tuid: uid\n\t\t\t})\n\t\t]);\n\t}).spread(function (user, data) {\n\t\tvar signedData = data.signedData;\n\t\tif (h.parseDecimal(signedData.user) !== userService.getOwn().getID() || signedData.initial === \"false\") {\n\t\t\tthrow new Error(\"invalid signed removal\");\n\t\t}\n\n\t\treturn SecuredData.load(undefined, signedData, { type: \"removeFriend\" }).verify(user.getSignKey());\n\t}).then(function () {\n\t\treturn friendsService.removeFriend(uid);\n\t});\n}\n\nfunction removeUnfriendedPersons() {\n\tvar userService = require(\"users/userService\").default;\n\treturn Bluebird.try(function () {\n\t\treturn userService.getMultiple(removed);\n\t}).then(function (removedFriends) {\n\t\treturn removedFriends.reduce(function (previousPromise, friend) {\n\t\t\treturn previousPromise.then(function () {\n\t\t\t\treturn checkAndRemove(friend.getID());\n\t\t\t});\n\t\t}, Bluebird.resolve());\n\t});\n}\n\nvar loadingPromise;\n\nfriendsService = {\n\tisLoaded: function () {\n\t\treturn friendsServiceLoaded;\n\t},\n\tensureIsLoaded: function (method) {\n\t\tif (!friendsService.isLoaded()) {\n\t\t\tthrow new Error(\"friends service not yet loaded! Method: \" + method);\n\t\t}\n\t},\n\tawaitLoading: function (cb) {\n\t\treturn loadingPromise.nodeify(cb);\n\t},\n\tgetUserFriends: function (uid, cb) {\n\t\treturn Bluebird.try(function () {\n\t\t\treturn socket.emit(\"friends.getUser\", {\n\t\t\t\tuserid: uid\n\t\t\t});\n\t\t}).then(function (result) {\n\t\t\treturn result.friends;\n\t\t}).nodeify(cb);\n\t},\n\tremoveFriend: function (uid, cb) {\n\t\tfriendsService.ensureIsLoaded(\"removeFriend\");\n\n\t\tif (friends.indexOf(uid) === -1 && removed.indexOf(uid) === -1) {\n\t\t\tthrow new Error(\"not a friend!\");\n\t\t}\n\n\t\tvar userService = require(\"users/userService\").default, circleService = require(\"circles/circleService\");\n\t\tvar otherUser, ownUser = userService.getOwn(), userCircles = circleService.inWhichCircles(uid);\n\n\t\treturn Bluebird.try(function () {\n\t\t\treturn userService.get(uid);\n\t\t}).then(function (u) {\n\t\t\totherUser = u;\n\n\t\t\treturn generateRemovalData(ownUser, otherUser, this);\n\t\t}).then(function (result) {\n\t\t\treturn socket.emit(\"friends.remove\", {\n\t\t\t\tuid: uid,\n\t\t\t\tsignedRemoval: result.signedRemoval,\n\t\t\t\tsignedList: result.updatedSignedList,\n\t\t\t\tsignedKeys: result.signedKeys,\n\t\t\t\tnewFriendsKey: keyStore.upload.getKey(result.newFriendsKey)\n\t\t\t});\n\t\t}).then(function (result) {\n\t\t\tif (result.success) {\n\t\t\t\th.removeArray(friends, uid);\n\t\t\t\th.removeArray(removed, uid);\n\n\t\t\t\tupdateCounters();\n\t\t\t\tfriendsService.notify(uid, \"remove\");\n\t\t\t\tuserOnline(uid, -1);\n\n\t\t\t\treturn circleService.loadAll();\n\t\t\t}\n\n\t\t\tthrow new Error(\"could not remove friends\");\n\t\t}).then(function () {\n\t\t\treturn Bluebird.all(userCircles.map(function (circle) {\n\t\t\t\treturn circle.removePersons([uid]);\n\t\t\t}));\n\t\t}).then(function () {\n\t\t\t//update profile for new friendsKey\n\t\t\treturn ownUser.rebuildProfiles();\n\t\t}).nodeify(cb);\n\t},\n\tfriendship: function (uid, cb) {\n\t\tif (h.containsOr(uid, friends, requested)) {\n\t\t\treturn Bluebird.resolve().nodeify(cb);\n\t\t}\n\n\t\treturn addAsFriend(uid).nodeify(cb);\n\t},\n\tignoreFriendShip: function (uid, cb) {\n\t\treturn Bluebird.try(function () {\n\t\t\tif (requests.indexOf(uid) > -1 && !h.containsOr(uid, friends, requested)) {\n\t\t\t\treturn socket.emit(\"friends.ignore\", { uid: uid });\n\t\t\t}\n\n\t\t\tthrow new Error(\"no request Oo\");\n\t\t}).then(function () {\n\t\t\tignored.push(uid);\n\t\t\th.removeArray(requests, uid);\n\t\t\tfriendsService.notify(uid, \"ignore\");\n\t\t\tupdateCounters();\n\t\t}).nodeify(cb);\n\t},\n\tacceptFriendShip: function (uid, cb) {\n\t\tif (requests.indexOf(uid) > -1 && !h.containsOr(uid, friends)) {\n\t\t\treturn addAsFriend(uid).nodeify(cb);\n\t\t}\n\t},\n\tdidIRequest: function (uid) {\n\t\tfriendsService.ensureIsLoaded(\"didIRequest\");\n\n\t\treturn h.containsOr(uid, friends, requested);\n\t},\n\tdidOtherRequest: function (uid) {\n\t\tfriendsService.ensureIsLoaded(\"didOtherRequest\");\n\n\t\treturn h.containsOr(uid, friends, requests);\n\t},\n\tareFriends: function (uid) {\n\t\tfriendsService.ensureIsLoaded(\"areFriends\");\n\n\t\treturn h.containsOr(uid, friends);\n\t},\n\tnoRequests: function (uid) {\n\t\tfriendsService.ensureIsLoaded(\"noRequests\");\n\n\t\treturn !h.containsOr(uid, friends, requested, requests);\n\t},\n\tgetRequestStatus: function (uid) {\n\t\tfriendsService.ensureIsLoaded(\"getRequestStatus\");\n\n\t\tif (friends.indexOf(uid) > -1) {\n\t\t\treturn \"friends\";\n\t\t}\n\n\t\tif (requested.indexOf(uid) > -1) {\n\t\t\treturn \"requested\";\n\t\t}\n\n\t\tif (requests.indexOf(\"uid\") > -1) {\n\t\t\treturn \"accept\";\n\t\t}\n\n\t\treturn \"request\";\n\t},\n\tgetRequests: function () {\n\t\tfriendsService.ensureIsLoaded(\"getRequests\");\n\n\t\treturn requests.slice();\n\t},\n\tgetFriends: function () {\n\t\tfriendsService.ensureIsLoaded(\"getFriends\");\n\n\t\treturn friends.slice();\n\t},\n\tgetRequested: function () {\n\t\tfriendsService.ensureIsLoaded(\"getRequested\");\n\n\t\treturn requested.slice();\n\t},\n\tgetUserFriendShipKey: function (uid) {\n\t\tfriendsService.ensureIsLoaded(\"getUserFriendShipKey\");\n\n\t\treturn signedList.metaAttr(uid);\n\t},\n\tgetUserForKey: function (realid) {\n\t\tfriendsService.ensureIsLoaded(\"getUserForKey\");\n\n\t\tvar meta = signedList.metaGet(), result;\n\t\th.objectEach(meta, function (key, value) {\n\t\t\tif (value === realid) {\n\t\t\t\tresult = h.parseDecimal(key);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t},\n\tgetAllFriendShipKeys: function () {\n\t\tfriendsService.ensureIsLoaded(\"getAllFriendShipKeys\");\n\n\t\tvar meta = signedList.metaGet(), keys = [];\n\t\th.objectEach(meta, function (key, value) {\n\t\t\tif (h.isInt(key)) {\n\t\t\t\tkeys.push(value);\n\t\t\t}\n\t\t});\n\n\t\treturn keys;\n\t},\n\tload: function () {\n\t\tvar userService = require(\"users/userService\").default;\n\n\t\treturn socket.definitlyEmit(\"friends.all\", {}).then(function (data) {\n\t\t\tfriends = data.friends.map(h.parseDecimal);\n\t\t\trequests = data.requests.map(h.parseDecimal);\n\t\t\trequested = data.requested.map(h.parseDecimal);\n\t\t\tignored = data.ignored.map(h.parseDecimal);\n\t\t\tremoved = data.removed.map(h.parseDecimal);\n\t\t\tdeleted = data.deleted.map(h.parseDecimal);\n\n\t\t\tupdateCounters();\n\n\t\t\tsignedList = SecuredData.load(undefined, data.signedList || {}, { type: \"signedFriendList\" });\n\n\t\t\tvar requestedOrFriends = signedList.metaKeys().map(h.parseDecimal);\n\t\t\tif (!h.arrayEqual(requestedOrFriends, requested.concat(friends).concat(removed).concat(deleted))) {\n\t\t\t\tthrow new Error(\"unmatching arrays\");\n\t\t\t}\n\n\t\t\treturn userService.getOwnAsync().thenReturn(data);\n\t\t}).then(function (data) {\n\t\t\tif (data.signedList) {\n\t\t\t\treturn signedList.verify(userService.getOwn().getSignKey(), \"user\");\n\t\t\t}\n\t\t}).then(function () {\n\t\t\tfriendsServiceLoaded = true;\n\n\t\t\tvar requestedOrFriends = signedList.metaKeys().map(h.parseDecimal);\n\t\t\trequestedOrFriends.forEach(function (uid) {\n\t\t\t\tkeyStore.security.addEncryptionIdentifier(signedList.metaAttr(uid));\n\t\t\t});\n\n\t\t\tif (removed.length > 0) {\n\t\t\t\treturn removeUnfriendedPersons();\n\t\t\t}\n\t\t});\n\t},\n\tonlineStatus: function (uid) {\n\t\tif (friends.indexOf(uid) === -1) {\n\t\t\treturn -1;\n\t\t}\n\n\t\treturn onlineFriends[uid] || 0;\n\t},\n\tdata: friendsData\n};\n\nObserver.extend(friendsService);\n\nloadingPromise = initService.awaitLoading().then(function () {\n\treturn friendsService.load();\n});\n\ninitService.awaitLoading().then(function () {\n\treturn Bluebird.delay(500);\n}).then(function () {\n\treturn socket.definitlyEmit(\"friends.getOnline\", {});\n}).then(function (data) {\n\th.objectEach(data.online, function (uid, status) {\n\t\tuserOnline(uid, status);\n\t});\n});\n\nsocket.channel(\"notify.signedList\", function (e, data) {\n\tif (signedList.metaAttr(\"_signature\") !== data._signature) {\n\t\tvar userService = require(\"users/userService\").default;\n\t\tvar updatedSignedList = SecuredData.load(undefined, data, { type: \"signedFriendList\" });\n\n\t\tBluebird.try(function () {\n\t\t\treturn updatedSignedList.verify(userService.getOwn().getSignKey(), null, \"user\");\n\t\t}).then(function () {\n\t\t\tsignedList = updatedSignedList;\n\t\t});\n\t}\n});\n\nmodule.exports = friendsService;\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/friendsService.js","import * as Bluebird from 'bluebird';\n\nimport socketService from \"../services/socket.service\"\n\nimport ObjectLoader from \"../services/mutableObjectLoader\"\n\nimport ChunkLoader, { Chunk } from \"./chatChunk\"\nimport MessageLoader, { Message } from \"./message\"\n\nimport h from \"../helper/helper\"\n\nimport Cache from \"../services/Cache\";\nimport keyStore from \"../services/keyStore.service\"\nimport Observer from \"../asset/observer\"\nimport settings from \"../services/settings.service\"\nimport sessionService from \"../services/session.service\"\n\nconst initService = require(\"services/initService\");\n\nconst messageSendCache = new Cache(\"unsentMessages\", { maxEntries: -1, maxBlobSize: -1 });\n\nlet unreadChatIDs = []\n\nconst addAfterTime = (arr:timeArray, id: any, time: number) => {\n\tconst firstLaterIndex = arr.findIndex((ele) => ele.time > time)\n\n\tif (firstLaterIndex === -1) {\n\t\treturn [\n\t\t\t...arr,\n\t\t\t{ id, time }\n\t\t]\n\t}\n\n\treturn [\n\t\t...arr.slice(0, firstLaterIndex),\n\t\t{ id, time },\n\t\t...arr.slice(firstLaterIndex)\n\t]\n}\n\ntype timeArray = {\n\tid: any,\n\ttime: number\n}[]\n\nconst getUnstoredMessages = () => {\n\tconst messagesMap = MessageLoader.getAll() || {}\n\n\tconst messages = Object.keys(messagesMap).map((id) => messagesMap[id])\n\n\treturn messages.filter((m) => !m.hasBeenSent()).filter((m) => m.hasAttachments())\n}\n\nwindow.addEventListener(\"beforeunload\", function (e) {\n\tconst confirmationMessage = \"Unsent files and images. Leave page anyway?\"\n\n\tif (getUnstoredMessages().length > 0) {\n\t\tconst event = e || window.event\n\t\tevent.returnValue = confirmationMessage //Gecko + IE\n\t\treturn confirmationMessage //Gecko + Webkit, Safari, Chrome etc.\n\t}\n\n\treturn\n});\n\nconst verifyMessageAssociations = (message: Message, latestChunkID: number) => {\n\treturn Bluebird.all([\n\t\tChunkLoader.get(message.getChunkID()),\n\t\tChunkLoader.get(latestChunkID),\n\t]).then(([messageChunk, latestChunk]) => {\n\t\tmessage.verifyParent(messageChunk)\n\n\t\treturn Chunk.loadChunkChain(latestChunk, messageChunk).thenReturn([latestChunk, messageChunk])\n\t}).then(([latestChunk, messageChunk]) => {\n\t\tlatestChunk.ensureChunkChain(messageChunk)\n\t})\n}\n\nexport class Chat extends Observer {\n\t//Sorted IDs\n\tprivate messages:timeArray = []\n\tprivate chatUpdates:timeArray = []\n\n\tprivate chunkIDs: number[] = []\n\n\tprivate loadMissingMessagesPromise = Bluebird.resolve()\n\tprivate waitingMissingMessages = false\n\n\tprivate lastStoredInfo: {\n\t\tid: any,\n\t\tunreadMessageIDs: any[],\n\t\tlatestMessageID: any,\n\t\tlatestChunkID: any\n\t}\n\n\t// Unsorted IDs\n\tprivate unreadMessageIDs: number[] = []\n\n\tprivate id: number\n\tprivate draft: boolean = false\n\n\tpublic newMessage = \"\"\n\n\tconstructor({ id, latestMessage, latestChunk, unreadMessageIDs }, draft?: boolean) {\n\t\tsuper()\n\n\t\tthis.id = id\n\t\tthis.draft = draft\n\n\t\tthis.update({ latestChunk, latestMessage, unreadMessageIDs })\n\t}\n\n\tprivate store = () => {\n\t\tif (this.draft) {\n\t\t\treturn\n\t\t}\n\n\t\tconst storeInfo = {\n\t\t\tid: this.id,\n\t\t\tunreadMessageIDs: this.unreadMessageIDs,\n\t\t\tlatestMessageID: this.getLatestMessage(),\n\t\t\tlatestChunkID: this.getLatestChunk()\n\t\t}\n\n\t\tif (h.deepEqual(this.lastStoredInfo, storeInfo)) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.lastStoredInfo = storeInfo\n\n\t\tChatLoader.updateCache(this.id, storeInfo)\n\t}\n\n\tcreate = ({ id, latestChunkID }) => {\n\t\tthis.draft = false\n\n\t\tthis.id = id\n\t\tthis.chunkIDs = [latestChunkID]\n\n\t\tChatLoader.addLoaded(id, this)\n\t\tChatLoader.removeLoaded(-1)\n\t}\n\n\tisBlocked = () => {\n\t\tif (this.getReceiverIDs.length > 2) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst otherReceiver = this.getReceiverIDs().find((id) => id !== sessionService.getUserID())\n\t\treturn settings.isBlocked(otherReceiver)\n\t}\n\n\tupdate = ({ latestChunk, latestMessage, unreadMessageIDs }) => {\n\t\tthis.unreadMessageIDs = unreadMessageIDs\n\n\t\tthis.addChunkID(latestChunk.getID(), false)\n\n\t\tif (latestMessage) {\n\t\t\tthis.addMessage(latestMessage, false)\n\t\t}\n\t}\n\n\tgetID = () => {\n\t\treturn this.id\n\t}\n\n\tisUnread() {\n\t\treturn unreadChatIDs.indexOf(this.id) > -1\n\t}\n\n\tisMessageUnread = (message: Message) =>\n\t\t\tthis.unreadMessageIDs.indexOf(message.getClientID()) > -1\n\n\tprivate removeMessageID = (removeID) => {\n\t\tthis.messages = this.messages.filter(({ id }) => removeID !== id)\n\t}\n\n\taddMessage = (message: Message, updateCache = true) => {\n\t\tthis.addMessageID(message.getClientID(), message.getTime(), updateCache)\n\n\t\tthis.scheduleLoadMissingMessages()\n\t}\n\n\tprivate addMessageID = (id, time, updateCache = true) => {\n\t\tconst alreadyAdded = this.messages.find((message) => message.id === id)\n\n\t\tif (alreadyAdded) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.messages = addAfterTime(this.messages, id, time)\n\n\t\tif (updateCache) {\n\t\t\tthis.store()\n\t\t}\n\t}\n\n\tverifyMessageAssociations = (message: Message) =>\n\t\tverifyMessageAssociations(message, h.array.last(this.chunkIDs))\n\n\taddChunkID = (chunkID, updateCache = true) => {\n\t\tif (this.chunkIDs.indexOf(chunkID) > -1) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.chunkIDs = [...this.chunkIDs, chunkID].sort((a, b) => a - b)\n\n\t\tif (updateCache) {\n\t\t\tthis.store()\n\t\t}\n\t}\n\n\tprivate hasMessage = (id) =>\n\t\tthis.messages.find((message) => message.id === id)\n\n\tprivate loadPreviousMessagesFromCache = (message: Message, limit = 20) => {\n\t\tconst messagesLoaded = []\n\n\t\treturn Bluebird.try(async () => {\n\t\t\tlet currentMessage = message\n\n\t\t\tfor (let i = 0; i < limit; i += 1) {\n\t\t\t\tif (!currentMessage.getPreviousID()) {\n\t\t\t\t\treturn messagesLoaded\n\t\t\t\t}\n\n\t\t\t\tconst previousMessage = await MessageLoader.getFromCache(currentMessage.getPreviousID())\n\n\t\t\t\tawait this.verifyMessageAssociations(previousMessage)\n\n\t\t\t\tif (this.hasMessage(previousMessage.getClientID())) {\n\t\t\t\t\treturn messagesLoaded\n\t\t\t\t}\n\n\t\t\t\tmessagesLoaded.push(previousMessage)\n\n\t\t\t\tcurrentMessage = previousMessage\n\t\t\t}\n\n\t\t\treturn messagesLoaded\n\t\t}).catch(() => messagesLoaded).then((messages) => {\n\t\t\tmessages.forEach((m) => this.addMessage(m))\n\t\t\treturn messages\n\t\t})\n\t}\n\n\tprivate loadMissingMessages = () => {\n\t\treturn Bluebird.try(async () => {\n\t\t\tconst batchSizes = [1, 3, 10, 20]\n\t\t\tlet iteration = 0, batchSize\n\n\t\t\twhile(batchSize = batchSizes[iteration++]) {\n\t\t\t\tconst knownMessages = this.messages\n\t\t\t\t\t.map(({ id }) => MessageLoader.getLoaded(id))\n\t\t\t\t\t.filter((m) => m.hasBeenSent())\n\n\t\t\t\tif (knownMessages.length < 2) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tconst ids = knownMessages.map((m) => m.getClientID())\n\n\t\t\t\tconst messagesWithoutPredecessor = knownMessages.filter((m) =>\n\t\t\t\t\tids.indexOf(m.getPreviousID()) === -1\n\t\t\t\t).sort((a, b) => a.getTime() - b.getTime())\n\n\t\t\t\tif (knownMessages.filter((m) => !m.getPreviousID()).length > 1) {\n\t\t\t\t\tconsole.warn(\"Got more than one last message in chat. Aborting!\")\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (messagesWithoutPredecessor.length === 1) {\n\t\t\t\t\tconsole.warn(\"No more missing messages\")\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tconsole.warn(`Loading batch size ${batchSize} messages. Missing ${messagesWithoutPredecessor.length}`)\n\n\t\t\t\tawait Bluebird.all(messagesWithoutPredecessor.map((m) => {\n\t\t\t\t\treturn this.loadOlderMessages(m, batchSize)\n\t\t\t\t}))\n\t\t\t}\n\n\t\t\t//TODO we were unable to finish in 34 messages :(\n\t\t\t//TODO remove everything except first block\n\t\t})\n\t}\n\n\t// TODO: Check if this leaks memory\n\tscheduleLoadMissingMessages = () => {\n\t\tif (this.messages.length < 2) {\n\t\t\treturn\n\t\t}\n\n\t\tif (this.waitingMissingMessages) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.waitingMissingMessages = true\n\n\t\tconsole.warn(\"Scheduling missing message check\")\n\n\t\tthis.loadMissingMessagesPromise = this.loadMissingMessagesPromise\n\t\t\t.delay(50)\n\t\t\t.finally(() => {\n\t\t\t\tthis.waitingMissingMessages = false\n\t\t\t\treturn this.loadMissingMessages()\n\t\t\t})\n\n\t\treturn this.loadMissingMessagesPromise\n\t}\n\n\tloadOlderMessages(message: Message, limit = 20) {\n\t\treturn Bluebird.try(async () => {\n\t\t\tif (message) {\n\t\t\t\tconst messagesFromCache = await this.loadPreviousMessagesFromCache(message, limit)\n\n\t\t\t\tlimit -= messagesFromCache.length\n\n\t\t\t\tif (limit < 1) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (messagesFromCache.length > 0) {\n\t\t\t\t\tmessage = h.array.last(messagesFromCache)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst { messages, chunks = [], remainingMessagesCount } = await socketService.definitlyEmit(\"chat.getMessages\", {\n\t\t\t\tid: this.getID(),\n\t\t\t\toldestKnownMessage: message ? message.getServerID() : 0,\n\t\t\t\tlimit\n\t\t\t})\n\n\t\t\tawait Bluebird.all<Chunk>(chunks.map((chunk) => ChunkLoader.load(chunk)))\n\n\t\t\tconst messagesObjects = await Bluebird.all<Message>(messages.map((message) => MessageLoader.load(message)))\n\t\t\tawait Bluebird.all(messagesObjects.map((message) => this.verifyMessageAssociations(message)))\n\n\t\t\tmessagesObjects.forEach((message) =>\n\t\t\t\tthis.addMessage(message)\n\t\t\t)\n\n\t\t\treturn remainingMessagesCount\n\t\t})\n\t}\n\n\tloadMoreMessages() {\n\t\tif (this.draft) {\n\t\t\treturn Bluebird.resolve(0)\n\t\t}\n\n\t\tconst oldestKnownMessage = this.messages.length === 0 ? null : MessageLoader.getLoaded(this.messages[0].id)\n\n\t\treturn this.loadOlderMessages(oldestKnownMessage)\n\t}\n\n\tloadInitialMessages = h.cacheResult<Bluebird<any>>(() => this.loadMoreMessages())\n\n\tgetMessages() {\n\t\treturn this.messages\n\t}\n\n\tgetChatUpdates() {\n\t\treturn this.chatUpdates\n\t}\n\n\tgetLatestChatUpdate() {\n\t\tif (this.chatUpdates.length > 0) {\n\t\t\treturn h.array.last(this.chatUpdates).id\n\t\t}\n\t}\n\n\tgetLatestChunk() {\n\t\treturn h.array.last(this.chunkIDs)\n\t}\n\n\tgetLatestMessage() {\n\t\tif (this.messages.length > 0) {\n\t\t\treturn h.array.last(this.messages).id\n\t\t}\n\t}\n\n\tlocalMarkRead() {\n\t\tif (this.unreadMessageIDs.length === 0 && unreadChatIDs.indexOf(this.id) === -1) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.unreadMessageIDs = []\n\t\tunreadChatIDs = unreadChatIDs.filter((id) => id !== this.id)\n\n\t\tthis.notify(this.getID(), \"read\")\n\t\tthis.store()\n\t}\n\n\tmarkRead() {\n\t\tthis.localMarkRead()\n\n\t\tif (this.draft) {\n\t\t\treturn Bluebird.resolve()\n\t\t}\n\n\t\treturn socketService.definitlyEmit(\"chat.markRead\", { id: this.id })\n\t}\n\n\tgetUnreadMessageIDs = () => {\n\t\treturn this.unreadMessageIDs\n\t}\n\n\taddUnreadMessage(id) {\n\t\tif (this.unreadMessageIDs.indexOf(id) === -1) {\n\t\t\tthis.unreadMessageIDs.push(id)\n\t\t}\n\n\t\tif (unreadChatIDs.indexOf(this.id) === -1) {\n\t\t\tunreadChatIDs.push(this.id)\n\t\t}\n\n\t\tthis.store()\n\t}\n\n\tisAdmin = (user) => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\n\t\treturn latestChunk.isAdmin(user)\n\t}\n\n\tamIAdmin = () => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\n\t\treturn latestChunk.amIAdmin()\n\t}\n\n\tgetReceivers = () => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\n\t\treturn latestChunk.getReceivers()\n\t}\n\n\tgetReceiverIDs = () => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\n\t\treturn latestChunk.getReceiverIDs()\n\t}\n\n\tgetTitle = () => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\n\t\treturn latestChunk.getTitle()\n\t}\n\n\tgetPartners = () => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\n\t\treturn latestChunk.getPartners()\n\t}\n\n\tremoveReceiver = (receiver) => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\t\tconst oldReceiverIDs = latestChunk.getReceiver()\n\t\tconst newReceiverIDs = oldReceiverIDs.filter((id) => id !== receiver.getID())\n\n\t\treturn this.createSuccessor(newReceiverIDs, {})\n\t}\n\n\taddAdmin = (receiver) => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\n\t\tconst adminIDs = latestChunk.getAdmins()\n\n\t\tif (adminIDs.indexOf(receiver.getID()) > -1) {\n\t\t\treturn Bluebird.resolve()\n\t\t}\n\n\t\treturn this.setAdmins([...adminIDs, receiver.getID()])\n\t}\n\n\tgetAdmins = () => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\n\t\treturn latestChunk.getAdmins()\n\t}\n\n\tsetAdmins = (admins) => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\t\treturn this.createSuccessor(latestChunk.getReceiver(), { admins })\n\t}\n\n\taddReceivers = (newReceiverIDs, canReadOldMessages = false) => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\n\t\tconst oldReceivers = latestChunk.getReceiver()\n\n\t\treturn this.createSuccessor(oldReceivers.concat(newReceiverIDs), { canReadOldMessages })\n\t}\n\n\tloadAllChunks = () => {\n\t\treturn socketService.emit(\"chat.getChunks\", { id: this.id }).then(({ chunks }) =>\n\t\t\tchunks\n\t\t).map((chunk) =>\n\t\t\tChunkLoader.load(chunk)\n\t\t)\n\t}\n\n\tprivate encryptAllChunksForReceiver = (chunkData, addedReceiver: number[]) => {\n\t\treturn this.loadAllChunks().then((chunks) => {\n\t\t\tchunks.sort((c1, c2) => c1.getID() - c2.getID())\n\n\t\t\tchunks.forEach((chunk, index) => {\n\t\t\t\tif (chunks[index + 1] && chunks[index + 1].getPredecessorID() !== chunk.getID()) {\n\t\t\t\t\tthrow new Error(\"chunk chain invalid\")\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tconst receiverKeys = addedReceiver.map((receiver) =>\n\t\t\t\tchunkData.receiverKeys[receiver]\n\t\t\t)\n\n\t\t\tconst chunkKeys = chunks.map((chunk) => chunk.getSecuredData().metaAttr(\"_key\")).filter((value, index, self) =>\n\t\t\t\tself.indexOf(value) === index\n\t\t\t)\n\n\t\t\treturn Bluebird.all(receiverKeys.map((receiverKey) =>\n\t\t\t\tBluebird.all(chunkKeys.map((chunkKey) => {\n\t\t\t\t\treturn keyStore.sym.symEncryptKey(chunkKey, receiverKey)\n\t\t\t\t})\n\t\t\t))).thenReturn([chunkKeys, receiverKeys])\n\t\t}).then(([chunkKeys, receiverKeys]) => {\n\t\t\treturn { ...chunkData, previousChunksDecryptors: keyStore.upload.getDecryptors(chunkKeys, receiverKeys) }\n\t\t})\n\t}\n\n\tprivate createSuccessor = (receiver, options : { canReadOldMessages? : boolean, title? : String, admins? : number[] }) => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\n\t\tconst {\n\t\t\tcanReadOldMessages = false,\n\t\t\ttitle = latestChunk.getTitle(),\n\t\t\tadmins = latestChunk.getAdmins(),\n\t\t} = options\n\n\t\tif (!latestChunk.amIAdmin()) {\n\t\t\tthrow new Error(\"Not an admin of this chunk\")\n\t\t}\n\n\t\tconst addedReceiver = receiver.filter((id) => latestChunk.getReceiver().indexOf(id) === -1)\n\t\tconst removedReceiver = latestChunk.getReceiver().filter((id) => receiver.indexOf(id) === -1)\n\n\t\tif (removedReceiver.length > 0 && canReadOldMessages) {\n\t\t\tthrow new Error(\"Can not remove receiver and allow reading of old messages\")\n\t\t}\n\n\t\treturn latestChunk.getSuccessor().then((successor) => {\n\t\t\tif (successor) {\n\t\t\t\tthrow new Error(\"TODO: Chunk has a successor. Try again?\")\n\t\t\t}\n\n\t\t\tconst content = { title }\n\t\t\tconst meta = { admins }\n\n\t\t\tconst newKey = addedReceiver.length > 0 || removedReceiver.length > 0\n\n\t\t\treturn Chunk.createRawData(receiver, {\n\t\t\t\tcontent,\n\t\t\t\tmeta,\n\t\t\t\tpredecessorChunk: latestChunk,\n\t\t\t\tgivenKey: !newKey && latestChunk ? latestChunk.getKey() : null\n\t\t\t})\n\t\t}).then((chunkData) => {\n\t\t\tif (!canReadOldMessages || addedReceiver.length === 0) {\n\t\t\t\treturn chunkData\n\t\t\t}\n\n\t\t\treturn this.encryptAllChunksForReceiver(chunkData, addedReceiver)\n\t\t}).then(({ chunk, keys, receiverKeys, previousChunksDecryptors }) => {\n\t\t\treturn socketService.emit(\"chat.chunk.create\", {\n\t\t\t\tpredecessorID: latestChunk.getID(),\n\t\t\t\tchunk,\n\t\t\t\tkeys,\n\t\t\t\treceiverKeys,\n\t\t\t\tpreviousChunksDecryptors,\n\t\t\t\tcanReadOldMessages\n\t\t\t})\n\t\t}).then((response: any) => {\n\t\t\treturn ChunkLoader.load(response.chunk)\n\t\t}).then((chunk) => {\n\t\t\tthis.addChunkID(chunk.getID())\n\t\t})\n\t}\n\n\tsetTitle = (title) => {\n\t\tconst latestChunk = ChunkLoader.getLoaded(this.getLatestChunk())\n\n\t\treturn this.createSuccessor(latestChunk.getReceiverIDs(), { title })\n\t}\n\n\tsendUnsentMessage = (messageData, files) => {\n\t\tif (files.length > 0) {\n\t\t\treturn\n\t\t}\n\n\t\treturn this.sendMessage(messageData.message, { images: [], files: [], voicemails: [] }, messageData.id);\n\t};\n\n\tprivate storeMessage = (messageObject, message, id) => {\n\t\tif (id) {\n\t\t\treturn Bluebird.resolve()\n\t\t}\n\n\t\tif (this.draft) {\n\t\t\treturn Bluebird.resolve()\n\t\t}\n\n\t\tif (messageObject.hasAttachments()) {\n\t\t\treturn Bluebird.resolve()\n\t\t}\n\n\t\treturn Bluebird.try(() =>\n\t\t\tmessageSendCache.store(\n\t\t\t\tmessageObject.getClientID(),\n\t\t\t\t{\n\t\t\t\t\tchatID: this.getID(),\n\t\t\t\t\tid: messageObject.getClientID(),\n\t\t\t\t\tmessage\n\t\t\t\t}\n\t\t\t)\n\t\t)\n\t}\n\n\tisDraft = () => this.draft\n\n\tsendMessage = (message, attachments, id?) => {\n\t\tvar messageObject = new Message(message, this, attachments, id)\n\n\t\treturn this.storeMessage(messageObject, message, id).finally(() => {\n\t\t\tvar sendMessagePromise = messageObject.sendContinously();\n\n\t\t\tsendMessagePromise.then(() => {\n\t\t\t\tthis.removeMessageID(messageObject.getClientID())\n\t\t\t\tthis.addMessage(messageObject)\n\n\t\t\t\treturn messageSendCache.delete(messageObject.getClientID());\n\t\t\t});\n\n\t\t\tsendMessagePromise.catch((e) => {\n\t\t\t\tconsole.error(e);\n\t\t\t\talert(\"An error occured sending a message!\" + e.toString());\n\t\t\t});\n\n\t\t\tMessageLoader.addLoaded(messageObject.getClientID(), messageObject)\n\t\t\tthis.addMessageID(messageObject.getClientID(), Number.MAX_SAFE_INTEGER)\n\n\t\t\treturn sendMessagePromise\n\t\t})\n\t};\n\n\tstatic getUnreadChatIDs() {\n\t\treturn unreadChatIDs\n\t}\n}\n\ntype ChatCache = {\n\tid: number,\n\tlatestMessageID: any,\n\tlatestChunkID: any,\n\tunreadMessageIDs: any\n}\n\nexport default class ChatLoader extends ObjectLoader<Chat, ChatCache>({\n\tdownload: (id) =>\n\t\tsocketService.definitlyEmit(\"chat.get\", { id }).then((response) => response.chat),\n\tload: (chatResponse) => {\n\t\tconst loadChunks = Bluebird.all(chatResponse.chunks.map((chunkData) =>\n\t\t\tChunkLoader.load(chunkData)\n\t\t))\n\n\t\tconst loadMessages = Bluebird.all(chatResponse.messages.map((messageData) =>\n\t\t\tMessageLoader.load(messageData)\n\t\t))\n\n\t\tconst { id, latestMessageID, latestChunkID, unreadMessageIDs } = chatResponse.chat\n\n\t\treturn Bluebird.all([\n\t\t\tloadChunks,\n\t\t\tloadMessages,\n\t\t]).thenReturn({ id, latestMessageID, latestChunkID, unreadMessageIDs })\n\t},\n\tgetID: (response) => response.chat.id,\n\trestore: (chatInfo, previousInstance) => {\n\t\treturn Bluebird.try(async function () {\n\t\t\tconst { id, latestMessageID, latestChunkID, unreadMessageIDs } = chatInfo\n\n\t\t\tconst latestMessage = latestMessageID ? await MessageLoader.get(latestMessageID) : null\n\t\t\tconst latestChunk = await ChunkLoader.get(latestChunkID)\n\n\t\t\tif (latestMessage) {\n\t\t\t\tawait verifyMessageAssociations(latestMessage, latestChunk.getID())\n\t\t\t}\n\n\t\t\tif (previousInstance) {\n\t\t\t\tpreviousInstance.update({ unreadMessageIDs, latestMessage, latestChunk })\n\t\t\t\treturn previousInstance\n\t\t\t}\n\n\t\t\treturn new Chat({\n\t\t\t\tid,\n\t\t\t\tlatestMessage,\n\t\t\t\tlatestChunk,\n\t\t\t\tunreadMessageIDs\n\t\t\t})\n\t\t})\n\t},\n\tshouldUpdate: (event, instance) => Bluebird.resolve(!instance.isDraft()),\n\tcacheName: \"chat\"\n}) {}\n\nlet lastLoaded = 0\n\nconst setUnreadChatIDs = (unreadIDs) => {\n\tconst chats = ChatLoader.getAll()\n\n\tObject.keys(chats).forEach((id) => {\n\t\tconst chat = chats[id].instance\n\n\t\tif (unreadIDs.indexOf(chat.getID()) !== -1) {\n\t\t\treturn\n\t\t}\n\n\t\tchat.localMarkRead()\n\t})\n\n\tunreadChatIDs = unreadIDs\n}\n\nsocketService.channel(\"unreadChats\", (e, data) => {\n\tif (e) {\n\t\tconsole.warn(e)\n\t}\n\n\tif (!data.unreadChatIDs) {\n\t\tconsole.warn(\"got no chat ids from socket channel\")\n\t\treturn\n\t}\n\n\tsetUnreadChatIDs(data.unreadChatIDs)\n})\n\nconst loadUnreadChatIDs = () => {\n\tif (new Date().getTime() - lastLoaded < 5 * 1000) {\n\t\treturn\n\t}\n\n\treturn initService.awaitLoading().then(function () {\n\t\treturn Bluebird.delay(500);\n\t}).then(function () {\n\t\treturn socketService.awaitConnection();\n\t}).then(function () {\n\t\treturn socketService.emit(\"chat.getUnreadIDs\", {});\n\t}).then(function (data) {\n\t\tif (!data.chatIDs) {\n\t\t\tconsole.warn(\"got no chat ids from socket request\")\n\t\t\treturn\n\t\t}\n\n\t\tsetUnreadChatIDs(data.chatIDs);\n\t});\n}\n\nsocketService.on(\"connect\", function () {\n\tloadUnreadChatIDs();\n});\n\ninitService.listen(function () {\n\tloadUnreadChatIDs();\n}, \"initDone\");\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/messages/chat.ts","\"use strict\";\n\nimport Observer from \"./observer\"\nimport h from \"../helper/helper\"\n\nclass Progress extends Observer {\n\tprivate done: number = 0\n\tprivate donePercentage: number = 0\n\tprivate options: { total?: number, depends?: Progress[] }\n\tprivate total: number\n\tprivate depends: Progress[]\n\n\tdata = { progress: 0 }\n\n\tconstructor (options?: { total?: number, depends?: Progress[] }) {\n\t\tsuper()\n\n\t\tthis.options = options;\n\t\tthis._parseOptions();\n\t}\n\n\tprivate _parseOptions = () => {\n\t\tif (this.options) {\n\t\t\tthis.total = this.options.total;\n\t\t\tif (this.options.depends) {\n\t\t\t\tthis._listenDepends(this.options.depends);\n\t\t\t}\n\t\t}\n\t};\n\n\tprivate _listenDepends = (depends) => {\n\t\tthis.depends = depends;\n\n\t\tdepends.forEach((depend) => {\n\t\t\tdepend.listen(this.recalculate.bind(this), \"progress\");\n\t\t});\n\t};\n\n\tremoveDepend = (depend) => {\n\t\tif (!this.depends && this.total) {\n\t\t\tthrow new Error(\"trying to mix depending progress and manual progress\");\n\t\t}\n\n\t\th.removeArray(this.depends, depend)\n\n\t\tthis.recalculate();\n\t}\n\n\taddDepend = (depend) => {\n\t\tif (!this.depends && this.total) {\n\t\t\tthrow new Error(\"trying to mix depending progress and manual progress\");\n\t\t}\n\n\t\tthis.depends = this.depends || [];\n\n\t\tthis.depends.push(depend);\n\t\tdepend.listen(this.recalculate.bind(this), \"progress\");\n\n\t\tthis.recalculate();\n\t};\n\n\tprogressDelta = (delta) => {\n\t\tif (this.depends) {\n\t\t\tthrow new Error(\"trying to mix depending progress and manual progress\");\n\t\t}\n\n\t\tthis.done += delta;\n\t\tthis.recalculate();\n\t};\n\n\tprogress = (done) => {\n\t\tif (this.depends) {\n\t\t\tthrow new Error(\"trying to mix depending progress and manual progress\");\n\t\t}\n\n\t\tthis.done = done;\n\t\tthis.recalculate();\n\t};\n\n\tsetTotal = (total) => {\n\t\tif (this.depends) {\n\t\t\tthrow new Error(\"trying to mix depending progress and manual progress\");\n\t\t}\n\n\t\tthis.total = total;\n\t\tthis.recalculate();\n\t};\n\n\treset = () => {\n\t\tthis.done = 0;\n\t\tthis.recalculate();\n\t};\n\n\tprivate joinDepends = () => {\n\t\tvar done = 0, total = 0;\n\t\tthis.depends.forEach((depend) => {\n\t\t\tdone += depend.getDone();\n\t\t\ttotal += depend.getTotal() || 0;\n\t\t});\n\n\t\tthis.done = done;\n\t\tthis.total = total;\n\t};\n\n\tgetDone = () => {\n\t\treturn this.done;\n\t};\n\n\tgetTotal = () => {\n\t\treturn this.total;\n\t};\n\n\tgetProgress = () => {\n\t\treturn this.donePercentage;\n\t};\n\n\tprivate recalculate = () => {\n\t\tif (this.depends) {\n\t\t\tthis.joinDepends();\n\t\t}\n\n\t\tif (!this.total) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.donePercentage = this.done / this.total;\n\t\tthis.donePercentage = Math.min(this.donePercentage, 1);\n\n\t\tthis.data.progress = this.donePercentage;\n\n\t\tthis.notify(this.donePercentage, \"progress\");\n\t};\n}\n\nexport default Progress\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/asset/Progress.ts","import h from \"../helper/helper\";\nconst validator = require(\"validation/validator\");\nimport Observer from \"../asset/observer\"\nconst SecuredData = require(\"asset/securedDataWithMetaData\");\nimport * as Bluebird from \"bluebird\"\nconst debug = require(\"debug\");\n\nconst userService = require(\"users/userService\").default;\nimport socket from \"../services/socket.service\"\nimport ObjectLoader from \"../services/cachedObjectLoader\"\nconst keyStore = require(\"services/keyStore.service\").default;\nconst sessionService = require(\"services/session.service\").default;\n\nimport ChatTitleUpdate from \"./chatTitleUpdate\"\n\nconst debugName = \"whispeer:chunk\";\nconst chunkDebug = debug(debugName);\n\nconst CHUNK_SECURED_DATA_OPTIONS = {\n\ttype: \"topic\", // Keep topic for now until lots of clients have picked up the change\n\talternativeType: \"chatChunk\" // Allow for chatChunk already\n}\n\nexport class Chunk extends Observer {\n\tprivate securedData\n\tprivate receiver\n\tprivate id\n\tprivate createTime\n\tprivate successorID: number\n\tprivate predecessorID: number\n\tprivate receiverObjects: any[]\n\tprivate chatID: number\n\tprivate title: string = \"\"\n\tprivate admins: number[]\n\tprivate titleUpdate: ChatTitleUpdate\n\n\tconstructor({ content, server, meta, receiverObjects }, public chunkData?) {\n\t\tsuper()\n\n\t\tvar err = validator.validate(\"topic\", meta);\n\t\tif (err) {\n\t\t\tthrow err;\n\t\t}\n\n\t\tmeta.receiver.sort();\n\n\t\tthis.securedData = SecuredData.createRaw(content, meta, CHUNK_SECURED_DATA_OPTIONS);\n\n\t\tthis.id = server.id\n\t\tthis.chatID = server.chatID\n\t\tthis.predecessorID = server.predecessorID\n\t\tthis.createTime = server.createTime\n\n\t\tthis.receiver = this.securedData.metaAttr(\"receiver\").map(h.parseDecimal);\n\n\t\tconst metaAdmins = this.securedData.metaAttr(\"admins\")\n\t\tconst creator = this.securedData.metaAttr(\"creator\")\n\n\t\tthis.admins = (metaAdmins ? metaAdmins : [creator]).map(h.parseDecimal)\n\n\t\tif (this.securedData.hasContent()) {\n\t\t\tthis.title = this.securedData.contentGet().title\n\t\t} else {\n\t\t\tthis.title = \"\"\n\t\t}\n\n\t\tthis.receiverObjects = receiverObjects\n\n\t\tvar predecessorID = this.getPredecessorID()\n\n\t\tif (predecessorID && ChunkLoader.isLoaded(predecessorID)) {\n\t\t\tChunkLoader.getLoaded(predecessorID).setSuccessor(this.getID())\n\t\t}\n\t}\n\n\tcreate = ({ server: { id, chatID }}) => {\n\t\tthis.id = id\n\t\tthis.chatID = chatID\n\n\t\tChunkLoader.addLoaded(id, this)\n\t\tChunkLoader.removeLoaded(-1)\n\t}\n\n\tgetChatID = () => this.chatID\n\n\tgetSecuredData = () => {\n\t\treturn this.securedData;\n\t}\n\n\tgetHash = () => {\n\t\treturn this.securedData.getHash();\n\t}\n\n\tgetID = () => {\n\t\treturn h.parseDecimal(this.id);\n\t};\n\n\tgetTime = () => {\n\t\tif (this.createTime) {\n\t\t\treturn this.createTime\n\t\t}\n\n\t\treturn this.getSecuredData().metaAttr(\"createTime\");\n\t};\n\n\tgetKey = () => {\n\t\treturn this.securedData.metaAttr(\"_key\");\n\t};\n\n\tsetLatestTitleUpdate = (titleUpdate: ChatTitleUpdate) => {\n\t\tthis.titleUpdate = titleUpdate\n\t}\n\n\tensureChunkChain = (predecessor) => {\n\t\tif (this.getID() === predecessor.getID()) {\n\t\t\treturn\n\t\t}\n\n\t\tvar predecessorID = this.getPredecessorID()\n\n\t\tif (!predecessorID || !ChunkLoader.isLoaded(predecessorID)) {\n\t\t\tthrow new Error(`Chunk chain broken ${predecessorID}`)\n\t\t}\n\n\t\tconst predecessorChunk = ChunkLoader.getLoaded(predecessorID)\n\n\t\tpredecessorChunk.verifyParent(this)\n\n\t\tpredecessorChunk.ensureChunkChain(predecessor)\n\t}\n\n\tverifyParent = (chunk: Chunk) => {\n\t\tchunk.getSecuredData().checkParent(this.getSecuredData())\n\t}\n\n\tgetReceivers = () => {\n\t\treturn this.receiverObjects\n\t}\n\n\tgetPartners = () => {\n\t\treturn this.receiverObjects.filter((receiverObject) => {\n\t\t\treturn !receiverObject.user.isOwn() || this.receiverObjects.length === 1\n\t\t});\n\t}\n\n\tgetPartnerDisplay = (maxDisplay = 3) => {\n\t\tconst partners = this.getPartners()\n\n\t\tif (partners.length <= maxDisplay) {\n\t\t\treturn partners\n\t\t}\n\n\t\treturn partners.slice(0, maxDisplay - 1)\n\t}\n\n\tgetReceiver = () => {\n\t\treturn this.receiver\n\t}\n\n\tgetAdmins = () => {\n\t\treturn this.admins\n\t}\n\n\tgetReceiverIDs = () => {\n\t\treturn this.receiver\n\t}\n\n\tgetTitle = () => {\n\t\tif (this.titleUpdate) {\n\t\t\treturn this.titleUpdate.state.title\n\t\t}\n\n\t\treturn this.title\n\t}\n\n\tisAdmin = (user) => {\n\t\treturn this.getAdmins().indexOf(user.getID()) > -1\n\t}\n\n\tamIAdmin = () => {\n\t\treturn this.isAdmin(userService.getOwn())\n\t}\n\n\tgetCreator = () => {\n\t\treturn h.parseDecimal(this.securedData.metaAttr(\"creator\"))\n\t}\n\n\thasPredecessor = () => {\n\t\treturn !!this.predecessorID\n\t}\n\n\tgetPredecessorID = () => {\n\t\tif (!this.hasPredecessor()) {\n\t\t\treturn null\n\t\t}\n\n\t\treturn h.parseDecimal(this.predecessorID)\n\t}\n\n\tgetPredecessor = () => {\n\t\tif (!this.hasPredecessor()) {\n\t\t\treturn Bluebird.resolve(null)\n\t\t}\n\n\t\treturn ChunkLoader.get(this.getPredecessorID()).catch((err) => {\n\t\t\tconsole.log(err)\n\t\t\treturn null\n\t\t}, socket.errors.Server)\n\t}\n\n\tsetSuccessor = (successorID) => {\n\t\tthis.successorID = successorID\n\n\t\tchunkDebug(\"Set successor of chunk \" , this.getID(), \" succ: \", successorID)\n\n\t\tthis.notify({ successorID: successorID }, \"successor\")\n\t}\n\n\thasKnownSuccessor = () => {\n\t\treturn !!this.successorID\n\t}\n\n\tgetLoadedSuccessor = () => {\n\t\tif (!this.hasKnownSuccessor()) {\n\t\t\treturn\n\t\t}\n\n\t\treturn ChunkLoader.getLoaded(this.successorID)\n\t}\n\n\tgetSuccessor = () => {\n\t\tif (this.successorID) {\n\t\t\treturn ChunkLoader.get(this.successorID)\n\t\t}\n\n\t\treturn socket.emit(\"chat.chunk.successor\", { id: this.getID() }).then((response) => {\n\t\t\tif (!response.chunk) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\treturn ChunkLoader.load(response.chunk).then((successorChunk) => {\n\t\t\t\tif (successorChunk.getPredecessorID() !== this.getID()) {\n\t\t\t\t\tthrow new Error(\"server returned invalid successor chunk\")\n\t\t\t\t}\n\n\t\t\t\treturn successorChunk\n\t\t\t})\n\t\t})\n\t}\n\n\tstatic loadChunkChain(newChunk, oldChunk) {\n\t\tif (newChunk.getID() === oldChunk.getID()) {\n\t\t\treturn Bluebird.resolve()\n\t\t}\n\n\t\tif (newChunk.getPredecessorID() === oldChunk.getID()) {\n\t\t\treturn Bluebird.resolve()\n\t\t}\n\n\t\treturn newChunk.getPredecessor().then((pred) => {\n\t\t\tif (!pred) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (pred.getID() === oldChunk.getID()) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\treturn Chunk.loadChunkChain(pred, oldChunk)\n\t\t})\n\t}\n\n\tprivate static createChunkKey = () => {\n\t\treturn keyStore.sym.generateKey(null, \"chunkMain\").then((chunkKey) => {\n\t\t\treturn keyStore.sym.symEncryptKey(chunkKey, userService.getOwn().getMainKey()).thenReturn(chunkKey)\n\t\t})\n\t}\n\n\tstatic cryptInfo = async (receiverObjectsExceptOwn) => {\n\t\tconst receiverKeys = {}\n\n\t\tconst chunkKey = await Chunk.createChunkKey()\n\n\t\tconst cryptKeys = await Bluebird.all(receiverObjectsExceptOwn.map((receiverObject) => {\n\t\t\tconst crypt = receiverObject.getCryptKey();\n\t\t\treturn keyStore.sym.asymEncryptKey(chunkKey, crypt);\n\t\t}));\n\n\t\tconst cryptKeysData = keyStore.upload.getKeys(cryptKeys);\n\n\t\treceiverObjectsExceptOwn.forEach((receiver, index) => {\n\t\t\treceiverKeys[receiver.getID()] = cryptKeys[index];\n\t\t});\n\n\t\tconst cryptInfo = {\n\t\t\tkeys: cryptKeysData.concat([keyStore.upload.getKey(chunkKey)]),\n\t\t\treceiverKeys,\n\t\t}\n\n\t\treturn { cryptInfo, chunkKey }\n\t}\n\n\tstatic createRawData(receiver, { content = {}, meta = {}, givenKey, predecessorChunk } : { content: any, givenKey?: any, meta?: any, predecessorChunk?: Chunk}) {\n\t\treturn Bluebird.try(async () => {\n\n\t\t\tconst receiverIDs = receiver.map((val) => h.parseDecimal(val))\n\n\t\t\tif (receiverIDs.indexOf(sessionService.getUserID()) === -1) {\n\t\t\t\treceiverIDs.push(sessionService.getUserID())\n\t\t\t}\n\n\t\t\tconst receiverObjects = await userService.getMultiple(receiverIDs);\n\n\t\t\tconst receiverObjectsExceptOwn = receiverObjects.filter((receiver) => !receiver.isOwn())\n\n\t\t\tconst givenInfo = { cryptInfo: { receiverKeys: {}, keys: [] }, chunkKey: givenKey}\n\n\t\t\tconst { cryptInfo, chunkKey } = givenKey ? givenInfo : await Chunk.cryptInfo(receiverObjectsExceptOwn)\n\n\t\t\treceiverIDs.sort();\n\n\t\t\tconst chunkMeta = {\n\t\t\t\t...meta,\n\t\t\t\tcreateTime: new Date().getTime(),\n\t\t\t\treceiver: receiverIDs,\n\t\t\t\tcreator: userService.getOwn().getID(),\n\t\t\t}\n\n\t\t\tconst secured = SecuredData.createRaw(content, chunkMeta, { type: \"topic\" })\n\n\t\t\tif (predecessorChunk) {\n\t\t\t\tsecured.setParent(predecessorChunk.getSecuredData())\n\t\t\t}\n\n\t\t\tconst cData = await secured.signAndEncrypt(userService.getOwn().getSignKey(), chunkKey)\n\n\t\t\treturn Object.assign({\n\t\t\t\tchunk: cData,\n\t\t\t}, cryptInfo)\n\t\t})\n\t};\n}\n\nObserver.extend(Chunk);\n\nconst decryptAndVerifyTitleUpdate = (titleUpdate) => {\n\treturn Bluebird.try(async () => {\n\t\tif (!titleUpdate) {\n\t\t\treturn\n\t\t}\n\n\t\tconst { content, meta, server } = titleUpdate\n\n\t\tconst securedData = SecuredData.load(content, meta, { type: \"topicUpdate\" });\n\n\t\tconst sender = await userService.get(meta.userID);\n\n\t\tawait Bluebird.all([\n\t\t\tsecuredData.decrypt(),\n\t\t\tsecuredData.verify(sender.getSignKey())\n\t\t])\n\n\t\treturn {\n\t\t\tcontent: securedData.contentGet(),\n\t\t\tmeta: securedData.metaGet(),\n\t\t\tserver\n\t\t}\n\t})\n}\n\ntype ChunkCache = {\n\tcontent: any,\n\tmeta: any,\n\tserver: any,\n\ttitleUpdate: {\n\t\tserver: any\n\t\tcontent: any\n\t\tmeta: any\n\t}\n}\n\nexport default class ChunkLoader extends ObjectLoader<Chunk, ChunkCache>({\n\tcacheName: \"chunk\",\n\tdownload: id => socket.emit(\"chat.chunk.get\", { id }),\n\trestore: ({ meta, content, server, titleUpdate }: ChunkCache) => {\n\t\treturn Bluebird.try(async function () {\n\t\t\tconst loadReceiverPromise = userService.getMultipleFormatted(meta.receiver.sort().map(h.parseDecimal))\n\n\t\t\tconst creator = await userService.get(meta.creator)\n\n\t\t\tif (!creator.isNotExistingUser()) {\n\t\t\t\tkeyStore.security.addEncryptionIdentifier(meta._key)\n\t\t\t} else {\n\t\t\t\t// TODO data.disabled = true;\n\t\t\t}\n\n\t\t\tconst chunk = new Chunk({\n\t\t\t\tmeta: meta,\n\t\t\t\tcontent: content,\n\t\t\t\tserver: server,\n\t\t\t\treceiverObjects: await loadReceiverPromise\n\t\t\t})\n\n\t\t\tif (titleUpdate) {\n\t\t\t\tconst chatTitleUpdate = new ChatTitleUpdate({\n\t\t\t\t\tcontent: titleUpdate.content,\n\t\t\t\t\tmeta: titleUpdate.meta,\n\t\t\t\t\tserver: titleUpdate.server,\n\t\t\t\t\tsender: await userService.get(titleUpdate.meta.userID)\n\t\t\t\t})\n\n\t\t\t\tchunk.setLatestTitleUpdate(chatTitleUpdate)\n\t\t\t}\n\n\t\t\treturn chunk\n\t\t})\n\t},\n\tload: ({ content, meta, server, latestTitleUpdate }) : Bluebird<ChunkCache> => {\n\t\treturn Bluebird.try(async function () {\n\t\t\tconst securedData = SecuredData.load(content, meta, CHUNK_SECURED_DATA_OPTIONS)\n\n\t\t\tconst creator = await userService.get(securedData.metaAttr(\"creator\"))\n\n\t\t\tconst titleUpdate = await decryptAndVerifyTitleUpdate(latestTitleUpdate)\n\n\t\t\tawait securedData.verify(creator.getSignKey())\n\t\t\tawait securedData.decrypt()\n\n\t\t\treturn {\n\t\t\t\tcontent: securedData.contentGet(),\n\t\t\t\tmeta: securedData.metaGet(),\n\t\t\t\tserver,\n\t\t\t\ttitleUpdate\n\t\t\t}\n\t\t})\n\t},\n\tgetID: response => response.server.id\n}) {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/messages/chatChunk.ts","import * as Bluebird from \"bluebird\"\n\nconst userService = require(\"users/userService\").default\nconst keyStore = require(\"services/keyStore.service\").default\nconst SecuredData = require(\"asset/securedDataWithMetaData\")\n\nimport h from \"../helper/helper\"\nimport socket from \"../services/socket.service\"\nimport ObjectLoader from \"../services/cachedObjectLoader\"\nimport ChunkLoader, { Chunk } from \"./chatChunk\"\nimport { Chat } from \"./chat\"\nimport FileUpload from \"../services/fileUpload.service\"\nimport ImageUpload from \"../services/imageUpload.service\"\nimport blobService from \"../services/blobService\"\nimport Progress from \"../asset/Progress\"\nimport settings from \"../services/settings.service\"\n\ntype attachments = { images: ImageUpload[], files: FileUpload[], voicemails: FileUpload[] }\n\nconst extractImagesInfo = (infos, key) => {\n\treturn infos.map((info) =>\n\t\th.objectMap(info, (val) => val[key])\n\t)\n}\n\nexport class Message {\n\tprivate wasSent: boolean\n\tprivate isOwnMessage: boolean\n\n\tprivate serverID: number\n\tprivate clientID: any\n\tprivate previousID: any\n\tprivate securedData: any\n\tprivate attachments: attachments\n\n\tprivate sendTime: number\n\n\tpublic data: any\n\n\tprivate chunkID: number\n\n\tprivate chat: Chat\n\n\tconstructor(messageData, chat?: Chat, attachments?: attachments, id?) {\n\t\tif (chat) {\n\t\t\tthis.initializePending(chat, messageData, attachments, id)\n\t\t} else {\n\t\t\tthis.initialize(messageData)\n\t\t}\n\t}\n\n\tprivate initialize = ({ meta, content, server, sender }) => {\n\t\tthis.wasSent = true\n\n\t\tconst { serverID, clientID } = Message.idFromData(server)\n\t\tthis.serverID = serverID\n\t\tthis.clientID = clientID\n\n\t\tthis.previousID = server.previousMessage\n\n\t\tthis.chunkID = server.chunkID\n\n\t\tthis.sendTime = h.parseDecimal(server.sendTime)\n\n\t\tthis.securedData = SecuredData.createRaw(content, meta, { type: \"message\" })\n\n\t\tthis.setDefaultData()\n\n\n\t\tthis.data.sender = sender.data\n\t\tthis.isOwnMessage = sender.isOwn()\n\n\t\tthis.setAttachmentInfo(\"files\")\n\t\tthis.setAttachmentInfo(\"voicemails\")\n\t\tthis.setImagesInfo()\n\t}\n\n\tprivate initializePending = (chat: Chat, message, attachments: attachments, id) => {\n\t\tthis.wasSent = false\n\n\t\tthis.chat = chat\n\t\tthis.attachments = attachments\n\n\t\tthis.clientID = id || h.generateUUID()\n\n\t\tconst meta = {\n\t\t\tcreateTime: new Date().getTime(),\n\t\t\tmessageUUID: this.clientID\n\t\t}\n\n\t\tthis.securedData = Message.createRawSecuredData(message, meta)\n\n\t\tthis.setDefaultData()\n\n\t\tthis.data.sender = userService.getOwn().data\n\t\tthis.isOwnMessage = true\n\n\t\tthis.data.images = attachments.images.map((image) => {\n\t\t\tif (!image.convertForGallery) {\n\t\t\t\treturn image\n\t\t\t}\n\n\t\t\treturn image.convertForGallery()\n\t\t})\n\n\t\tthis.data.files = attachments.files.map((file) => ({\n\t\t\t...file.getInfo(),\n\t\t\tgetProgress: () => {\n\t\t\t\treturn file.getProgress()\n\t\t\t}\n\t\t}))\n\n\t\tthis.data.voicemails = attachments.voicemails.map((voicemail) => ({\n\t\t\t...voicemail.getInfo(),\n\t\t\tgetProgress: () => {\n\t\t\t\treturn voicemail.getProgress()\n\t\t\t}\n\t\t}))\n\n\t\tthis.prepareAttachments()\n\t}\n\n\tstatic prepare = (uploads) => Bluebird.resolve(uploads).map((upload: any) => upload.prepare())\n\n\thasAttachments = () => {\n\t\treturn this.attachments.images.length !== 0 || this.attachments.files.length !== 0 || this.attachments.voicemails.length !== 0\n\t}\n\n\tisBlockedSince = () =>\n\t\tsettings.isBlockedSince(this.data.sender.id, this.getTime())\n\n\tisBlocked = () =>\n\t\tsettings.isBlocked(this.data.sender.id)\n\n\tprivate prepareAttachments = () => {\n\t\treturn Bluebird.all([\n\t\t\tMessage.prepare(this.attachments.files),\n\t\t\tMessage.prepare(this.attachments.images),\n\t\t\tMessage.prepare(this.attachments.voicemails)\n\t\t])\n\t}\n\n\tstatic setAttachmentsInfo = (securedData, attachments: attachments) => {\n\t\treturn Bluebird.try(async function () {\n\t\t\tconst imagesInfo = await Message.prepare(attachments.images)\n\t\t\tconst voicemailsInfo = await Message.prepare(attachments.voicemails)\n\t\t\tconst filesInfo = await Message.prepare(attachments.files)\n\n\t\t\tif (imagesInfo.length > 0 || filesInfo.length > 0 || voicemailsInfo.length > 0) {\n\t\t\t\tsecuredData.metaSetAttr(\"images\", extractImagesInfo(imagesInfo, \"meta\"))\n\t\t\t\tsecuredData.contentSetAttr(\"images\", extractImagesInfo(imagesInfo, \"content\"))\n\n\t\t\t\tsecuredData.metaSetAttr(\"files\", filesInfo.map((info) => info.meta))\n\t\t\t\tsecuredData.contentSetAttr(\"files\", filesInfo.map((info) => info.content))\n\n\t\t\t\tsecuredData.metaSetAttr(\"voicemails\", voicemailsInfo.map((info) => info.meta))\n\t\t\t\tsecuredData.contentSetAttr(\"voicemails\", voicemailsInfo.map((info) => info.content))\n\t\t\t} else if (typeof securedData.contentGet() !== \"string\") {\n\t\t\t\tsecuredData.contentSet(securedData.contentGet().message)\n\t\t\t}\n\t\t})\n\t}\n\n\tprivate setDefaultData = () => {\n\t\tconst content = this.securedData.contentGet()\n\n\t\tthis.data = {\n\t\t\ttext: typeof content === \"string\" ? content : content.message,\n\t\t\ttimestamp: this.getTime(),\n\t\t\tdate: new Date(this.getTime()),\n\n\t\t\tsent: this.wasSent,\n\n\t\t\tid: this.clientID,\n\t\t\tobj: this\n\t\t}\n\t}\n\n\tgetChunkID = () => {\n\t\treturn this.chunkID || this.chat.getLatestChunk()\n\t}\n\n\thasBeenSent = () => {\n\t\treturn this.wasSent\n\t}\n\n\tuploadAttachments = h.cacheResult<Bluebird<any>>((chunkKey) => {\n\t\treturn this.prepareAttachments().then(() => {\n\t\t\tconst attachments = [...this.attachments.images, ...this.attachments.files, ...this.attachments.voicemails]\n\n\t\t\treturn Bluebird.all(attachments.map((attachment) => {\n\t\t\t\treturn attachment.upload(chunkKey)\n\t\t\t}))\n\t\t}).then((imageKeys) => {\n\t\t\treturn h.array.flatten(imageKeys)\n\t\t})\n\t})\n\n\tsendContinously = h.cacheResult<any>(() => {\n\t\treturn h.repeatUntilTrue(Bluebird, () => {\n\t\t\treturn this.send()\n\t\t}, 2000)\n\t})\n\n\tsend = () => {\n\t\tif (this.wasSent) {\n\t\t\tthrow new Error(\"trying to send an already sent message\")\n\t\t}\n\n\t\treturn Bluebird.try(async () => {\n\t\t\tawait socket.awaitConnection()\n\n\t\t\tconst messageIDs = this.chat.getMessages()\n\n\t\t\tconst messages = messageIDs.filter(({ id }) =>\n\t\t\t\tMessageLoader.isLoaded(id)\n\t\t\t).map(({ id }) =>\n\t\t\t\tMessageLoader.getLoaded(id)\n\t\t\t)\n\n\t\t\tconst unsentMessages = messages.filter((m) => !m.hasBeenSent())\n\t\t\tconst messageIndex = unsentMessages.findIndex((m) => m === this)\n\n\t\t\tif (unsentMessages[messageIndex - 1]) {\n\t\t\t\tawait unsentMessages[messageIndex - 1].sendContinously()\n\t\t\t}\n\n\t\t\tconst chunk = await ChunkLoader.get(this.chat.getLatestChunk())\n\n\t\t\tthis.securedData.setParent(chunk.getSecuredData())\n\n\t\t\tawait Message.setAttachmentsInfo(this.securedData, this.attachments)\n\n\t\t\tconst chunkKey = chunk.getKey()\n\n\t\t\tconst sentMessages = messages.filter((m) => m.hasBeenSent())\n\n\t\t\tconst newest = h.array.last(sentMessages)\n\n\t\t\tif (newest && newest.getChunkID() === this.chat.getLatestChunk()) {\n\t\t\t\tthis.securedData.setAfterRelationShip(newest.getSecuredData())\n\t\t\t}\n\n\t\t\tconst signAndEncryptPromise = this.securedData._signAndEncrypt(userService.getOwn().getSignKey(), chunkKey)\n\t\t\tconst keys = await this.uploadAttachments(chunkKey)\n\t\t\tconst request = await signAndEncryptPromise\n\n\t\t\tif (this.chat.isDraft()) {\n\t\t\t\tconst {\n\t\t\t\t\treceiverKeys, keys, chunk: initialChunk\n\t\t\t\t} = chunk.chunkData\n\t\t\t\tconst response = await socket.emit(\"chat.create\", {\n\t\t\t\t\tinitialChunk,\n\t\t\t\t\tfirstMessage: request,\n\t\t\t\t\treceiverKeys,\n\t\t\t\t\tkeys\n\t\t\t\t});\n\n\t\t\t\tconst chatInfo = response.chat.chat\n\t\t\t\tconst messageInfo = response.chat.messages[0]\n\t\t\t\tconst chunkInfo = response.chat.chunks[0]\n\n\t\t\t\tchunk.create(chunkInfo)\n\t\t\t\tthis.chat.create(chatInfo)\n\n\t\t\t\tthis.sendSuccess()\n\t\t\t\tthis.setServerInfo(messageInfo.server)\n\n\t\t\t\treturn true\n\t\t\t}\n\n\t\t\tconst response = await socket.emit(\"chat.message.create\", {\n\t\t\t\tchunkID: chunk.getID(),\n\t\t\t\tmessage: request,\n\t\t\t\tkeys: keys.map(keyStore.upload.getKey)\n\t\t\t})\n\n\t\t\tif (response.success) {\n\t\t\t\tthis.sendSuccess()\n\t\t\t}\n\n\t\t\tif (response.server) {\n\t\t\t\tthis.setServerInfo(response.server)\n\t\t\t}\n\n\t\t\treturn response.success\n\t\t}).catch(socket.errors.Disconnect, (e) => {\n\t\t\tconsole.warn(e)\n\t\t\treturn false\n\t\t}).catch(socket.errors.Server, () => {\n\t\t\treturn false\n\t\t})\n\t}\n\n\tsendSuccess = () => {\n\t\tthis.wasSent = true\n\t\tthis.data.sent = true\n\n\t\tthis.setAttachmentInfo(\"files\")\n\t\tthis.setAttachmentInfo(\"voicemails\")\n\t\tthis.setImagesInfo()\n\t}\n\n\tsetServerInfo = ({ sendTime, id, chunkID, previousMessage }) => {\n\t\tthis.sendTime = h.parseDecimal(sendTime)\n\t\tthis.serverID = h.parseDecimal(id)\n\t\tthis.chunkID = h.parseDecimal(chunkID)\n\t\tthis.previousID = previousMessage\n\t\tthis.data.timestamp = this.getTime()\n\t}\n\n\tgetSecuredData = () => {\n\t\treturn this.securedData\n\t}\n\n\tgetServerID = () => {\n\t\treturn this.serverID\n\t}\n\n\tgetPreviousID = () => {\n\t\treturn this.previousID\n\t}\n\n\tgetClientID = () => {\n\t\treturn this.clientID\n\t}\n\n\tgetTopicID = () => {\n\t\treturn this.chunkID\n\t}\n\n\tgetTime = () => {\n\t\tif (this.getServerID()) {\n\t\t\treturn this.sendTime\n\t\t}\n\n\t\treturn h.parseDecimal(this.securedData.metaAttr(\"createTime\"))\n\t}\n\n\tisOwn = () => {\n\t\treturn this.isOwnMessage\n\t}\n\n\tverifyParent = (chunk) => {\n\t\tthis.securedData.checkParent(chunk.getSecuredData())\n\t}\n\n\tgetText = () => {\n\t\treturn this.data.text\n\t}\n\n\tprivate setAttachmentInfo = (attr) => {\n\t\tconst fullContent = this.securedData.contentGet()\n\n\t\tif (typeof fullContent === \"string\") {\n\t\t\treturn\n\t\t}\n\n\t\tconst content = fullContent[attr]\n\t\tconst meta = this.securedData.metaAttr(attr)\n\n\t\tif (!content) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.data[attr] = content.map((file, index) => ({\n\t\t\t...file,\n\t\t\t...meta[index],\n\t\t\tloaded: false\n\t\t}))\n\n\t\tBluebird.resolve(this.data[attr]).filter((ele: any) => {\n\t\t\treturn blobService.isBlobLoaded(ele.blobID)\n\t\t}).each((loadedAttachment: any) => {\n\t\t\tloadedAttachment.loaded = true\n\t\t})\n\t}\n\n\tdownloadVoicemail = (voicemailDownloadProgress: Progress) => {\n\t\treturn Bluebird.resolve(this.data.voicemails).each((voicemail: any) => {\n\t\t\tconst progress = new Progress()\n\n\t\t\tvoicemailDownloadProgress.addDepend(progress)\n\n\t\t\treturn blobService.getBlobUrl(voicemail.blobID, voicemailDownloadProgress, voicemail.size).then((url) => {\n\t\t\t\tvoicemail.url = url\n\t\t\t\tvoicemail.loaded = true\n\t\t\t})\n\t\t})\n\t}\n\n\tprivate setImagesInfo = () => {\n\t\tconst content = this.securedData.contentGet()\n\n\t\tconst imagesMeta = this.securedData.metaAttr(\"images\") || []\n\n\t\tif (typeof content === \"string\") {\n\t\t\tthis.data.images = imagesMeta\n\n\t\t\treturn\n\t\t}\n\n\t\tconst imagesContent = content.images\n\n\t\tthis.data.images = imagesMeta.map((imageMeta, index) => {\n\t\t\tconst imageContent = imagesContent[index]\n\n\t\t\tconst data =  h.objectMap(imageMeta, (val, key) => {\n\t\t\t\treturn {\n\t\t\t\t\t...val,\n\t\t\t\t\t...imageContent[key]\n\t\t\t\t}\n\t\t\t})\n\n\t\t\treturn data\n\t\t})\n\t}\n\n\tstatic createRawSecuredData(message, meta, chunk?: Chunk) {\n\t\tconst secured = SecuredData.createRaw({ message }, meta, {\n\t\t\ttype: \"message\",\n\t\t})\n\n\t\tif (chunk) {\n\t\t\tsecured.setParent(chunk.getSecuredData())\n\t\t}\n\n\t\treturn secured\n\t}\n\n\n\n\tstatic idFromData(server) {\n\t\tconst serverID = h.parseDecimal(server.id)\n\t\tconst clientID = server.uuid\n\n\t\treturn {\n\t\t\tserverID,\n\t\t\tclientID\n\t\t}\n\t}\n}\n\ntype MessageCache = {\n\tcontent: any,\n\tmeta: any,\n\tserver: any\n}\n\nconst loadMessageSender = senderID =>\n\tuserService.get(senderID)\n\t\t.then(sender => sender.loadBasicData().thenReturn(sender))\n\nexport default class MessageLoader extends ObjectLoader<Message, MessageCache>({\n\tcacheName: \"message\",\n\tgetID: ({ server }) => server.uuid,\n\tdownload: id => socket.emit(\"chat.message.get\", { id }),\n\tload: (messageResponse): Bluebird<MessageCache> => {\n\t\tconst { content, meta, server } = messageResponse\n\n\t\tconst securedData = SecuredData.load(content, meta, { type: \"message\" })\n\t\tconst senderID = server.sender\n\n\t\t// !! Typescript is broken for async arrow functions without a this context !!\n\t\treturn Bluebird.try<MessageCache>(async function () {\n\t\t\tconst sender = await loadMessageSender(senderID)\n\n\t\t\tawait Bluebird.all([\n\t\t\t\tsecuredData.decrypt(),\n\t\t\t\tsecuredData.verify(sender.getSignKey())\n\t\t\t])\n\n\t\t\treturn {\n\t\t\t\tcontent: securedData.contentGet(),\n\t\t\t\tmeta: securedData.metaGet(),\n\t\t\t\tserver: messageResponse.server,\n\t\t\t}\n\t\t})\n\t},\n\trestore: (messageInfo: MessageCache) =>\n\t\tloadMessageSender(messageInfo.server.sender)\n\t\t\t.then((sender) => new Message({ ...messageInfo, sender })),\n}) {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/messages/message.ts","import Cache from \"./Cache\";\nimport Storage from \"./Storage\";\n\nexport function checkLocalStorage() {\n\ttry {\n\t\tlocalStorage.setItem(\"localStorageTest\", \"localStorageTest\");\n\t\tlocalStorage.removeItem(\"localStorageTest\");\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n\nconst storages: Storage[] = [];\n\nexport const storageInfo = {\n\tCache: new Cache(\"localStorage\"),\n\thasLocalStorage: checkLocalStorage(),\n\tbroken: false\n}\n\nexport function promoteMainWindow() {\n\t(<any>window).top.whispeerGetStorage = function (prefix: string) {\n\t\treturn this.storages[prefix];\n\t};\n}\n\nexport function withPrefix(prefix: string): Storage {\n\tif (!storages[prefix]) {\n\t\ttry {\n\t\t\tstorages[prefix] = new Storage(prefix);\n\t\t} catch(e) {\n\t\t\tstorageInfo.broken = true;\n\t\t}\n\t}\n\n\treturn storages[prefix];\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/storage.service.ts","import * as Bluebird from \"bluebird\"\nimport socketService from \"../services/socket.service\"\nimport sessionService from \"../services/session.service\"\n\nimport UserLoader from \"./user\"\n\nconst sjcl = require(\"sjcl\")\nconst initService = require(\"services/initService\")\n\nlet userService\n\nfunction loadUser(identifier) {\n\treturn UserLoader.get(identifier)\n}\n\nuserService = {\n\t/** search your friends */\n\tqueryFriends: function (query) {\n\t\treturn Bluebird.try(function () {\n\t\t\treturn socketService.emit(\"user.searchFriends\", {\n\t\t\t\ttext: query,\n\t\t\t\tknown: []\n\t\t\t})\n\t\t}).then((data) => {\n\t\t\treturn data.results\n\t\t}).map((user: any) => {\n\t\t\treturn UserLoader.load(user)\n\t\t})\n\t},\n\n\t/** search for a user\n\t* @param query query string to search for\n\t* @param cb user objects\n\t*/\n\tquery: function (query, cb) {\n\t\treturn initService.awaitLoading().then(function () {\n\t\t\treturn socketService.definitlyEmit(\"user.search\", {\n\t\t\t\ttext: query,\n\t\t\t\tknown: []\n\t\t\t})\n\t\t}).then((data) => {\n\t\t\treturn data.results\n\t\t}).map((user) => {\n\t\t\treturn UserLoader.load(user)\n\t\t}).nodeify(cb)\n\t},\n\n\t/** load a user\n\t* @param identifier identifier of the user (id, nickname or mail)\n\t* @param cb called with results\n\t* this function is asynchronous and returns immediatly. requests are also batched.\n\t*/\n\tget: function (identifier, cb) {\n\t\treturn loadUser(identifier).nodeify(cb)\n\t},\n\n\t/** load a user\n\t* @param identifiers identifier array of the users (id, nickname or mail)\n\t* @param cb called with results\n\t* this function is asynchronous and returns immediatly. requests are also batched.\n\t*/\n\tgetMultiple: function getMultipleF(identifiers, cb) {\n\t\treturn Bluebird.resolve(identifiers).map(function (id) {\n\t\t\treturn loadUser(id)\n\t\t}).nodeify(cb)\n\t},\n\n\t/** gets multiple users and loads their basic data.\n\t* @param identifiers identifier of users to load\n\t* @param cb called with users data.\n\t*/\n\tgetMultipleFormatted: function (identifiers, cb) {\n\t\treturn Bluebird.try(function () {\n\t\t\treturn userService.getMultiple(identifiers)\n\t\t}).map(function (user: any) {\n\t\t\treturn user.loadBasicData().thenReturn(user)\n\t\t}).then(function (users) {\n\t\t\treturn users.map(function (user) {\n\t\t\t\treturn user.data\n\t\t\t})\n\t\t}).nodeify(cb)\n\t},\n\n\t/** get own user. synchronous */\n\tgetOwn: () => UserLoader.getLoaded(sessionService.getUserID()),\n\n\tgetOwnAsync: () => {\n\t\treturn UserLoader.get(sessionService.getUserID())\n\t}\n}\n\ninitService.registerCacheCallback(function () {\n\treturn UserLoader.get(sessionService.getUserID()).catch(function (e) {\n\t\tif (e instanceof sjcl.exception.corrupt) {\n\t\t\talert(\"Password did not match. Logging out\")\n\t\t\tsessionService.logout()\n\t\t\treturn new Bluebird(function () {})\n\t\t}\n\n\t\treturn Bluebird.reject(e)\n\t})\n})\n\ninitService.registerCallback(function () {\n\treturn UserLoader.get(sessionService.getUserID()).catch(function (e) {\n\t\tif (e instanceof sjcl.exception.corrupt) {\n\t\t\talert(\"Password did not match. Logging out\")\n\t\t\tsessionService.logout()\n\t\t\treturn new Bluebird(function () {})\n\t\t}\n\n\t\treturn Bluebird.reject(e)\n\t})\n})\n\nexport default userService\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/users/userService.ts","import * as Bluebird from \"bluebird\"\n\nimport socketService from \"../services/socket.service\"\nimport Cache from \"../services/Cache\"\nimport errorService from \"../services/error.service\"\n\n// What do we want to achieve and how:\n\n// - Group multiple requests together -> download can do that for itself\n// - Add cache info so server does not resend full data (esp. for trustManager) -> activeInstance\n// - merge new and active -> restore has active and response\n// - cache first then update\n\nexport enum UpdateEvent {\n\twake,\n\tblink\n}\n\nconst LONG_APP_PAUSE = 2 * 60 * 1000\nconst LONG_DISCONNECT = 60 * 1000\n\ntype hookType<ObjectType, CachedObjectType> = {\n\tdownload: (id: string, activeInstance: Optional<ObjectType>) => Bluebird<any>,\n\tload: (response: any, activeInstance: Optional<ObjectType>) => Bluebird<CachedObjectType>,\n\trestore: (response: CachedObjectType, activeInstance: Optional<ObjectType>) => Bluebird<ObjectType> | ObjectType,\n\tshouldUpdate: (event: UpdateEvent, activeInstance: ObjectType, lastUpdated: number) => Bluebird<boolean>,\n\tgetID: (response: any) => string,\n\tcacheName: string,\n}\n\ntype Optional<t> = t | null\n\nfunction createLoader<ObjectType, CachedObjectType>({ download, load, restore, getID, cacheName, shouldUpdate }: hookType<ObjectType, CachedObjectType>) {\n\tlet loading: { [s: string]: Bluebird<ObjectType> } = {}\n\tlet byId: { [s: string]: {\n\t\tinstance: ObjectType,\n\t\tlastUpdated: number,\n\t\tupdating: boolean\n\t} } = {}\n\n\tconst cache = new Cache(cacheName)\n\n\tconst considerLoaded = (id) => {\n\t\tloading = { ...loading }\n\t\tdelete loading[id]\n\t}\n\n\tconst cacheInMemory = (id, instance: ObjectType, lastUpdated) => {\n\t\tbyId = { ...byId, [id]: { instance, lastUpdated, updating: false } }\n\t}\n\n\tconst loadFromCache = (id) => {\n\t\tlet lastUpdated: number = Date.now()\n\n\t\treturn cache.get(id)\n\t\t\t.then((cacheResponse) => {\n\t\t\t\tlastUpdated = cacheResponse.created\n\t\t\t\treturn cacheResponse.data\n\t\t\t})\n\t\t\t.then((cachedData) => restore(cachedData, null))\n\t\t\t.then((instance) => {\n\t\t\t\tcacheInMemory(id, instance, lastUpdated)\n\t\t\t\tconsiderLoaded(id)\n\t\t\t\tscheduleInstanceUpdate(UpdateEvent.wake, id)\n\t\t\t\treturn instance\n\t\t\t})\n\t}\n\n\tconst serverResponseToInstance = (response, id, activeInstance: Optional<ObjectType>) =>\n\t\tload(response, activeInstance)\n\t\t\t.then((cacheableData) => cache.store(id, cacheableData).thenReturn(cacheableData))\n\t\t\t.then((cachedData) => restore(cachedData, activeInstance))\n\t\t\t.then((instance) => {\n\t\t\t\tif (activeInstance && activeInstance !== instance) {\n\t\t\t\t\tconsole.warn(\"Restore should update active instance\")\n\t\t\t\t}\n\t\t\t\tcacheInMemory(id, instance, Date.now())\n\n\t\t\t\treturn instance\n\t\t\t})\n\t\t\t.finally(() => considerLoaded(id))\n\n\tconst updateInstance = (id, instance: ObjectType) =>\n\t\tdownload(id, instance).then((response) =>\n\t\t\tserverResponseToInstance(response, id, instance)\n\t\t)\n\n\tconst scheduleInstanceUpdate = (event: UpdateEvent, id) => {\n\t\tconst { instance, lastUpdated, updating } = byId[id]\n\n\t\tif (updating) {\n\t\t\tconsole.info(`Not updating instance because update is already running ${cacheName}/${id}`)\n\t\t\treturn\n\t\t}\n\n\t\tbyId[id].updating = true\n\n\t\tshouldUpdate(event, instance, lastUpdated).then((shouldUpdate) => {\n\t\t\tif (shouldUpdate) {\n\t\t\t\tconsole.info(`Schedule ${cacheName} instance ${id} update with event ${UpdateEvent[event]}`)\n\t\t\t\treturn updateInstance(id, instance).then(() =>\n\t\t\t\t\tbyId[id].lastUpdated = Date.now()\n\t\t\t\t)\n\t\t\t}\n\t\t}).catch(errorService.criticalError).finally(() => byId[id].updating = false)\n\n\t\treturn\n\t}\n\n\tconst scheduleInstancesUpdate = (event: UpdateEvent) => {\n\t\tconsole.info(`Schedule ${cacheName} instances update with event ${UpdateEvent[event]}`)\n\n\t\tObject.keys(byId)\n\t\t\t.forEach((id) => scheduleInstanceUpdate(event, id) )\n\t}\n\n\tlet lastHeartbeat = Date.now()\n\n\tsocketService.listen(() => lastHeartbeat = Date.now(), \"heartbeat\")\n\n\tsocketService.on(\"connect\", () => {\n\t\tconsole.info(`connect at ${Date.now()} after ${Date.now() - lastHeartbeat}`)\n\n\t\tif (Date.now() - lastHeartbeat > LONG_DISCONNECT) {\n\t\t\tscheduleInstancesUpdate(UpdateEvent.wake)\n\t\t} else {\n\t\t\tscheduleInstancesUpdate(UpdateEvent.blink)\n\t\t}\n\n\t\tlastHeartbeat = Date.now()\n\t})\n\n\tlet pauseStarted = 0\n\n\tdocument.addEventListener(\"pause\", () => pauseStarted = Date.now(), false);\n\tdocument.addEventListener(\"resume\", () => {\n\t\tconsole.info(`ended pause at ${Date.now()} after ${Date.now() - pauseStarted}`)\n\n\t\tif (Date.now() - pauseStarted > LONG_APP_PAUSE) {\n\t\t\tscheduleInstancesUpdate(UpdateEvent.wake)\n\t\t} else {\n\t\t\tscheduleInstancesUpdate(UpdateEvent.blink)\n\t\t}\n\t}, false);\n\n\treturn class ObjectLoader {\n\t\tstatic getLoaded(id): ObjectType {\n\t\t\tif (!ObjectLoader.isLoaded(id)) {\n\t\t\t\tthrow new Error(`Not yet loaded: ${id}`)\n\t\t\t}\n\n\t\t\treturn byId[id].instance\n\t\t}\n\n\t\tstatic isLoaded(id) {\n\t\t\treturn byId.hasOwnProperty(id)\n\t\t}\n\n\t\tstatic load(source): Bluebird<ObjectType> {\n\t\t\tconst id = getID(source)\n\n\t\t\tif (byId[id]) {\n\t\t\t\tserverResponseToInstance(source, id, byId[id].instance)\n\n\t\t\t\treturn Bluebird.resolve(byId[id].instance)\n\t\t\t}\n\n\t\t\tif (!loading[id]) {\n\t\t\t\tloading = {\n\t\t\t\t\t...loading,\n\t\t\t\t\t[id]: loadFromCache(id)\n\t\t\t\t\t\t.catch(() => serverResponseToInstance(source, id, null))\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t return loading[id]\n\t\t}\n\n\t\tstatic updateCache(id, cacheableData: CachedObjectType) {\n\t\t\treturn cache.store(id, cacheableData)\n\t\t}\n\n\t\t// Throws\n\t\tstatic getFromCache(id): Bluebird<ObjectType> {\n\t\t\tif (byId[id]) {\n\t\t\t\treturn Bluebird.resolve(byId[id].instance)\n\t\t\t}\n\n\t\t\treturn loadFromCache(id)\n\t\t}\n\n\t\tstatic get(id): Bluebird<ObjectType> {\n\t\t\tif (typeof id === \"undefined\" || id === null) {\n\t\t\t\tthrow new Error(`Can't get object with id ${id} - ${cacheName}`)\n\t\t\t}\n\n\t\t\tif (byId[id]) {\n\t\t\t\treturn Bluebird.resolve(byId[id].instance)\n\t\t\t}\n\n\t\t\tif (!loading[id]) {\n\t\t\t\tlet promise = loadFromCache(id)\n\t\t\t\t\t.catch(() => download(id, null).then((response) => serverResponseToInstance(response, id, null))\n\t\t\t\t)\n\n\t\t\t\tloading = {\n\t\t\t\t\t...loading,\n\t\t\t\t\t[id]: promise\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t return loading[id]\n\t\t}\n\n\t\tstatic getAll = () => {\n\t\t\treturn byId\n\t\t}\n\n\t\tstatic removeLoaded = (id) => delete byId[id]\n\n\t\tstatic addLoaded = (id, obj: ObjectType) => {\n\t\t\tbyId[id] = { instance: obj, lastUpdated: Date.now(), updating: false }\n\t\t}\n\t}\n}\n\nexport default createLoader\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/services/mutableObjectLoader.ts"],"sourceRoot":""}