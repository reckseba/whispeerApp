webpackJsonp([12],{12:function(e,t,n){"use strict";function r(e){return s.b.get(e)}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"ɵ0",function(){return l}),n.d(t,"ɵ1",function(){return f}),n.d(t,"ɵ2",function(){return d}),n.d(t,"ɵ3",function(){return h}),n.d(t,"ɵ4",function(){return p}),n.d(t,"ɵ5",function(){return g}),n.d(t,"ɵ6",function(){return y});var i=n(3),o=(n.n(i),n(14)),a=n(26),s=n(297),u=n(52),c=n(27),l=function(e){return i.try(function(){return o.default.emit("user.searchFriends",{text:e,known:[]})}).then(function(e){return e.results}).map(function(e){return s.b.load(e)})},f=function(e,t){return c.awaitLoading().then(function(){return o.default.definitlyEmit("user.search",{text:e,known:[]})}).then(function(e){return e.results}).map(function(e){return s.b.load(e)}).nodeify(t)},d=function(e,t){return r(e).nodeify(t)},h=function(e,t){return i.resolve(e).map(function(e){return r(e)}).nodeify(t)},p=function(e,t){return i.try(function(){return m.getMultiple(e)}).map(function(e){return e.loadBasicData().thenReturn(e)}).then(function(e){return e.map(function(e){return e.data})}).nodeify(t)},g=function(){return s.b.getLoaded(a.default.getUserID())},y=function(){return s.b.get(a.default.getUserID())},m={queryFriends:l,query:f,get:d,getMultiple:h,getMultipleFormatted:p,getOwn:g,getOwnAsync:y};c.registerCallback(function(){return s.b.get(a.default.getUserID()).catch(function(e){return e instanceof u.exception.corrupt?(alert("Password did not match. Logging out"),a.default.logout(),new i(function(){})):i.reject(e)})}),t.default=m},120:function(e,t,n){"use strict";function r(){S.friendsCount=m.length,S.requestsCount=v.length,S.requestedCount=b.length}function i(e,t){I[e]=t,u.notify(t,"online:"+e)}function o(e){var t,i,o=n(12).default;return d.try(function(){return u.awaitLoading()}).then(function(){return o.get(e)}).then(function(e){return t=e,function(e,t){var n;return p.sym.asymEncryptKey(e.getFriendsKey(),t.getCryptKey()).then(function(r){n=r;var i=e.getMainKey();return s.metaSetAttr(t.getID(),n),d.all([f.load(void 0,{user:t.getID()},{type:"friendShip"}).sign(e.getSignKey()),s.sign(e.getSignKey()),p.sym.symEncryptKey(n,i)])}).spread(function(e,t){return{data:{signedList:t,meta:e,key:p.upload.getKey(n)},key:n}})}(o.getOwn(),t)}).then(function(e){i=e.key;var t=o.getOwn().getFriendsKey();return e.data.decryptors=p.upload.getDecryptors([t],[i]),h.emit("friends.add",e.data)}).then(function(n){n.success&&(t.setFriendShipKey(i),n.friends?(m.push(e),c.removeArray(v,e),u.notify(e,"new")):(b.push(e),u.notify(e,"newRequested")),r())})}function a(){var e=n(12).default;return d.try(function(){return e.getMultiple(D)}).then(function(e){return e.reduce(function(e,t){return e.then(function(){return function(e){var t=n(12).default;return d.try(function(){return d.all([t.get(e),h.emit("friends.getSignedData",{uid:e})])}).spread(function(e,n){var r=n.signedData;if(c.parseDecimal(r.user)!==t.getOwn().getID()||"false"===r.initial)throw new Error("invalid signed removal");return f.load(void 0,r,{type:"removeFriend"}).verify(e.getSignKey())}).then(function(){return u.removeFriend(e)})}(t.getID())})},d.resolve())})}var s,u,c=n(7).default,l=n(17),f=n(31).default,d=n(3),h=n(14).default,p=n(36).default,g=n(27),y=n(48).default,m=[],v=[],b=[],w=[],D=[],_=[],I={},k=!1,S={requestsCount:0,friendsCount:0,requestedCount:0};h.channel("friendRequest",function(e,t){var n=c.parseDecimal(t.uid);c.containsOr(n,v,m,b)||(v.push(n),r(),u.notify(n,"newRequest"))}),h.channel("friendAccept",function(e,t){var n=c.parseDecimal(t.uid);c.containsOr(n,v,m)||(m.push(n),c.removeArray(b,n),r(),u.notify(n,"new"),i(n,2))}),h.channel("friendOnlineChange",function(e,t){i(t.uid,t.status)});var E;l.extend(u={isLoaded:function(){return k},ensureIsLoaded:function(e){if(!u.isLoaded())throw new Error("friends service not yet loaded! Method: "+e)},awaitLoading:function(e){return E.nodeify(e)},getUserFriends:function(e,t){return d.try(function(){return h.emit("friends.getUser",{userid:e})}).then(function(e){return e.friends}).nodeify(t)},removeFriend:function(e,t){if(u.ensureIsLoaded("removeFriend"),-1===m.indexOf(e)&&-1===D.indexOf(e))throw new Error("not a friend!");var o,a=n(12).default,l=n(240),g=a.getOwn(),y=l.inWhichCircles(e);return d.try(function(){return a.get(e)}).then(function(e){return o=e,function(e,t){return d.try(function(){var n=f.load(void 0,{initial:-1===D.indexOf(e.getID()),user:t.getID()},{type:"removeFriend"}).sign(e.getSignKey());s.metaRemoveAttr(t.getID());var r=s.sign(e.getSignKey());return d.all([n,r])}).spread(function(t,n){return e.generateNewFriendsKey().then(function(e){return{signedRemoval:t,updatedSignedList:n,signedKeys:e.updatedSignedKeys,newFriendsKey:e.newFriendsKey}})})}(g,o)}).then(function(t){return h.emit("friends.remove",{uid:e,signedRemoval:t.signedRemoval,signedList:t.updatedSignedList,signedKeys:t.signedKeys,newFriendsKey:p.upload.getKey(t.newFriendsKey)})}).then(function(t){if(t.success)return c.removeArray(m,e),c.removeArray(D,e),r(),u.notify(e,"remove"),i(e,-1),l.loadAll();throw new Error("could not remove friends")}).then(function(){return d.all(y.map(function(t){return t.removePersons([e])}))}).then(function(){return g.rebuildProfiles()}).nodeify(t)},friendship:function(e,t){return c.containsOr(e,m,b)?d.resolve().nodeify(t):o(e).nodeify(t)},ignoreFriendShip:function(e,t){return d.try(function(){if(v.indexOf(e)>-1&&!c.containsOr(e,m,b))return h.emit("friends.ignore",{uid:e});throw new Error("no request Oo")}).then(function(){w.push(e),c.removeArray(v,e),u.notify(e,"ignore"),r()}).nodeify(t)},acceptFriendShip:function(e,t){if(v.indexOf(e)>-1&&!c.containsOr(e,m))return o(e).nodeify(t)},didIRequest:function(e){return u.ensureIsLoaded("didIRequest"),c.containsOr(e,m,b)},didOtherRequest:function(e){return u.ensureIsLoaded("didOtherRequest"),c.containsOr(e,m,v)},areFriends:function(e){return u.ensureIsLoaded("areFriends"),c.containsOr(e,m)},noRequests:function(e){return u.ensureIsLoaded("noRequests"),!c.containsOr(e,m,b,v)},getRequestStatus:function(e){return u.ensureIsLoaded("getRequestStatus"),m.indexOf(e)>-1?"friends":b.indexOf(e)>-1?"requested":v.indexOf("uid")>-1?"accept":"request"},getRequestsWithBlocked:function(){return u.ensureIsLoaded("getRequests"),v.slice()},getRequests:function(){return u.getRequestsWithBlocked().filter(function(e){return!y.isBlocked(e)})},getFriends:function(){return u.ensureIsLoaded("getFriends"),m.slice()},getRequested:function(){return u.ensureIsLoaded("getRequested"),b.slice()},getUserFriendShipKey:function(e){return u.ensureIsLoaded("getUserFriendShipKey"),s.metaAttr(e)},getUserForKey:function(e){u.ensureIsLoaded("getUserForKey");var t,n=s.metaGet();return c.objectEach(n,function(n,r){r===e&&(t=c.parseDecimal(n))}),t},getAllFriendShipKeys:function(){u.ensureIsLoaded("getAllFriendShipKeys");var e=s.metaGet(),t=[];return c.objectEach(e,function(e,n){c.isInt(e)&&t.push(n)}),t},load:function(){var e=n(12).default;return h.definitlyEmit("friends.all",{}).then(function(t){m=t.friends.map(c.parseDecimal),v=t.requests.map(c.parseDecimal),b=t.requested.map(c.parseDecimal),w=t.ignored.map(c.parseDecimal),D=t.removed.map(c.parseDecimal),_=t.deleted.map(c.parseDecimal),r();var n=(s=f.load(void 0,t.signedList||{},{type:"signedFriendList"})).metaKeys().map(c.parseDecimal);if(!c.arrayEqual(n,b.concat(m).concat(D).concat(_)))throw new Error("unmatching arrays");return e.getOwnAsync().thenReturn(t)}).then(function(t){if(t.signedList)return s.verify(e.getOwn().getSignKey(),"user")}).then(function(){k=!0;if(s.metaKeys().map(c.parseDecimal).forEach(function(e){p.security.addEncryptionIdentifier(s.metaAttr(e))}),D.length>0)return a()})},onlineStatus:function(e){return-1===m.indexOf(e)?-1:I[e]||0},data:S}),E=g.awaitLoading().then(function(){return u.load()}),g.awaitLoading().then(function(){return d.delay(500)}).then(function(){return h.definitlyEmit("friends.getOnline",{})}).then(function(e){c.objectEach(e.online,function(e,t){i(e,t)})}),h.channel("notify.signedList",function(e,t){if(s.metaAttr("_signature")!==t._signature){var r=n(12).default,i=f.load(void 0,t,{type:"signedFriendList"});d.try(function(){return i.verify(r.getOwn().getSignKey(),null,"user")}).then(function(){s=i})}}),e.exports=u},121:function(e,t,n){"use strict";n.d(t,"a",function(){return k});var r=n(3),i=(n.n(r),n(14)),o=n(65),a=n(128),s=n(124),u=n(7),c=n(37),l=n(36),f=n(17),d=n(48),h=n(26),p=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),g=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},y=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},m=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},v=n(27),b=new c.a("unsentMessages",{maxEntries:-1,maxBlobSize:-1}),w=[],D=function(e,t,n){var r=e.findIndex(function(e){return e.time>n});return-1===r?e.concat([{id:t,time:n}]):e.slice(0,r).concat([{id:t,time:n}],e.slice(r))},_=function(){var e=s.b.getAll()||{};return Object.keys(e).map(function(t){return e[t]}).filter(function(e){return!e.hasBeenSent()}).filter(function(e){return e.hasAttachments()})};window.addEventListener("beforeunload",function(e){if(_().length>0){return(e||window.event).returnValue="Unsent files and images. Leave page anyway?","Unsent files and images. Leave page anyway?"}});var I=function(e,t){return r.all([a.b.get(e.getChunkID()),a.b.get(t)]).then(function(t){var n=t[0],r=t[1];return e.verifyParent(n),a.a.loadChunkChain(r,n).thenReturn([r,n])}).then(function(e){e[0].ensureChunkChain(e[1])})},k=function(e){function t(t,n){var o=t.id,c=t.latestMessage,f=t.latestChunk,p=t.unreadMessageIDs,v=e.call(this)||this;return v.messages=[],v.chatUpdates=[],v.chunkIDs=[],v.loadMissingMessagesPromise=r.resolve(),v.waitingMissingMessages=!1,v.unreadMessageIDs=[],v.draft=!1,v.newMessage="",v.getInfo=function(){return{id:v.id,unreadMessageIDs:v.unreadMessageIDs,latestMessageID:v.getLatestSentMessage(),latestChunkID:v.getLatestChunk()}},v.store=function(){if(!v.draft){var e=v.getInfo();u.default.deepEqual(v.lastStoredInfo,e)||(v.lastStoredInfo=e,P.updateCache(v.id,e))}},v.create=function(e){var t=e.id,n=e.latestChunkID;v.draft=!1,v.id=t,v.chunkIDs=[n],P.addLoaded(t,v),P.removeLoaded(-1)},v.allPartnersBlocked=function(){var e=v.getReceiverIDsWithoutSelf();if(0!==e.length)return!e.find(function(e){return!d.default.isBlocked(e)})},v.isBlocked=function(){if(v.getReceiverIDs().length>2)return!1;var e=v.getReceiverIDs().find(function(e){return e!==h.default.getUserID()});return d.default.isBlocked(e)},v.update=function(e){var t=e.latestChunk,n=e.latestMessage;v.unreadMessageIDs=e.unreadMessageIDs,v.addChunkID(t.getID(),!1),n&&v.addMessage(n,!1)},v.getID=function(){return v.id},v.isMessageUnread=function(e){return v.unreadMessageIDs.indexOf(e.getClientID())>-1},v.removeMessageID=function(e){v.messages=v.messages.filter(function(t){return e!==t.id})},v.addMessage=function(e,t){void 0===t&&(t=!0),v.addMessageID(e.getClientID(),e.getTime(),t),v.scheduleLoadMissingMessages()},v.addMessageID=function(e,t,n){void 0===n&&(n=!0);v.messages.find(function(t){return t.id===e})||(v.messages=D(v.messages,e,t),n&&v.store())},v.verifyMessageAssociations=function(e){return I(e,u.default.array.last(v.chunkIDs))},v.addChunkID=function(e,t){void 0===t&&(t=!0),v.chunkIDs.indexOf(e)>-1||(v.chunkIDs=v.chunkIDs.concat([e]).sort(function(e,t){return e-t}),t&&v.store())},v.hasMessage=function(e){return v.messages.find(function(t){return t.id===e})},v.loadPreviousMessagesFromCache=function(e,t){void 0===t&&(t=20);var n=[];return r.try(function(){return y(v,void 0,void 0,function(){var r,i,o;return m(this,function(a){switch(a.label){case 0:r=e,i=0,a.label=1;case 1:return i<t?r.getPreviousID()?[4,s.b.getFromCache(r.getPreviousID())]:[2,n]:[3,5];case 2:return o=a.sent(),[4,this.verifyMessageAssociations(o)];case 3:if(a.sent(),this.hasMessage(o.getClientID()))return[2,n];n.push(o),r=o,a.label=4;case 4:return i+=1,[3,1];case 5:return[2,n]}})})}).catch(function(){return n}).then(function(e){return e.forEach(function(e){return v.addMessage(e)}),e})},v.loadMissingMessages=function(){return r.try(function(){return y(v,void 0,void 0,function(){var e,t,n,i,o,a,u=this;return m(this,function(c){switch(c.label){case 0:e=[1,3,10,20],t=0,i=function(){var e,t,i;return m(this,function(a){switch(a.label){case 0:return(e=o.messages.map(function(e){return s.b.getLoaded(e.id)}).filter(function(e){return e.hasBeenSent()})).length<2?[2,{value:void 0}]:(t=e.map(function(e){return e.getClientID()}),i=e.filter(function(e){return-1===t.indexOf(e.getPreviousID())}).sort(function(e,t){return e.getTime()-t.getTime()}),e.filter(function(e){return!e.getPreviousID()}).length>1?(console.warn("Got more than one last message in chat. Aborting!"),[2,{value:void 0}]):1===i.length?(console.warn("No more missing messages"),[2,{value:void 0}]):(console.warn("Loading batch size "+n+" messages. Missing "+i.length),[4,r.all(i.map(function(e){return u.loadOlderMessages(e,n)}))]));case 1:return a.sent(),[2]}})},o=this,c.label=1;case 1:return(n=e[t++])?[5,i()]:[3,3];case 2:return"object"==typeof(a=c.sent())?[2,a.value]:[3,1];case 3:return[2]}})})})},v.scheduleLoadMissingMessages=function(){if(!(v.messages.length<2||v.waitingMissingMessages))return v.waitingMissingMessages=!0,console.warn("Scheduling missing message check"),v.loadMissingMessagesPromise=v.loadMissingMessagesPromise.delay(50).finally(function(){return v.waitingMissingMessages=!1,v.loadMissingMessages()}),v.loadMissingMessagesPromise},v.loadInitialMessages=u.default.cacheResult(function(){return v.loadMoreMessages()}),v.getUnreadMessageIDs=function(){return v.unreadMessageIDs},v.isAdmin=function(e){return a.b.getLoaded(v.getLatestChunk()).isAdmin(e)},v.amIAdmin=function(){var e=a.b.getLoaded(v.getLatestChunk());return!v.isDraft()&&e.amIAdmin()},v.getReceivers=function(){return a.b.getLoaded(v.getLatestChunk()).getReceivers()},v.getReceiverIDs=function(){return a.b.getLoaded(v.getLatestChunk()).getReceiverIDs()},v.getReceiverIDsWithoutSelf=function(){return v.getReceiverIDs().filter(function(e){return e!==h.default.getUserID()})},v.getTitle=function(){return a.b.getLoaded(v.getLatestChunk()).getTitle()},v.getPartners=function(){return a.b.getLoaded(v.getLatestChunk()).getPartners()},v.removeReceiver=function(e){var t=a.b.getLoaded(v.getLatestChunk()).getReceiver().filter(function(t){return t!==e.getID()});return v.createSuccessor(t,{})},v.addAdmin=function(e){var t=a.b.getLoaded(v.getLatestChunk()).getAdmins();return t.indexOf(e.getID())>-1?r.resolve():v.setAdmins(t.concat([e.getID()]))},v.getAdmins=function(){return a.b.getLoaded(v.getLatestChunk()).getAdmins()},v.setAdmins=function(e){var t=a.b.getLoaded(v.getLatestChunk());return v.createSuccessor(t.getReceiver(),{admins:e})},v.addReceivers=function(e,t){void 0===t&&(t=!1);var n=a.b.getLoaded(v.getLatestChunk()).getReceiver();return v.createSuccessor(n.concat(e),{canReadOldMessages:t})},v.loadAllChunks=function(){return i.default.definitlyEmit("chat.getChunks",{id:v.id}).then(function(e){return e.chunks}).map(function(e){return a.b.load(e)})},v.encryptAllChunksForReceiver=function(e,t){return v.loadAllChunks().then(function(n){n.sort(function(e,t){return e.getID()-t.getID()}),n.forEach(function(e,t){if(n[t+1]&&n[t+1].getPredecessorID()!==e.getID())throw new Error("chunk chain invalid")});var i=t.map(function(t){return e.receiverKeys[t]}),o=n.map(function(e){return e.getSecuredData().metaAttr("_key")}).filter(function(e,t,n){return n.indexOf(e)===t});return r.all(i.map(function(e){return r.all(o.map(function(t){return l.default.sym.symEncryptKey(t,e)}))})).thenReturn([o,i])}).then(function(t){return g({},e,{previousChunksDecryptors:l.default.upload.getDecryptors(t[0],t[1])})})},v.createSuccessor=function(e,t){var n=a.b.getLoaded(v.getLatestChunk()),r=t.canReadOldMessages,o=void 0!==r&&r,s=t.title,u=void 0===s?n.getTitle():s,c=t.admins,l=void 0===c?n.getAdmins():c;if(!n.amIAdmin())throw new Error("Not an admin of this chunk");var f=e.filter(function(e){return-1===n.getReceiver().indexOf(e)}),d=n.getReceiver().filter(function(t){return-1===e.indexOf(t)});if(d.length>0&&o)throw new Error("Can not remove receiver and allow reading of old messages");return n.getSuccessor().then(function(t){if(t)throw new Error("TODO: Chunk has a successor. Try again?");return a.a.createRawData(e,{content:{title:u},meta:{admins:l},predecessorChunk:n,givenKey:!(f.length>0||d.length>0)&&n?n.getKey():null})}).then(function(e){return o&&0!==f.length?v.encryptAllChunksForReceiver(e,f):e}).then(function(e){var t=e.chunk,r=e.keys,a=e.receiverKeys,s=e.previousChunksDecryptors;return i.default.emit("chat.chunk.create",{predecessorID:n.getID(),chunk:t,keys:r,receiverKeys:a,previousChunksDecryptors:s,canReadOldMessages:o})}).then(function(e){return a.b.load(e.chunk)}).then(function(e){v.addChunkID(e.getID())})},v.setTitle=function(e){var t=a.b.getLoaded(v.getLatestChunk());return v.createSuccessor(t.getReceiverIDs(),{title:e})},v.sendUnsentMessage=function(e,t){if(!(t.length>0))return v.sendMessage(e.message,{images:[],files:[],voicemails:[]},e.id)},v.storeMessage=function(e,t,n){return n?r.resolve():v.draft?r.resolve():e.hasAttachments()?r.resolve():r.try(function(){return b.store(e.getClientID(),{chatID:v.getID(),id:e.getClientID(),message:t})})},v.isDraft=function(){return v.draft},v.sendMessage=function(e,t,n){var r=new s.a(e,v,t,n);return s.b.addLoaded(r.getClientID(),r),v.addMessageID(r.getClientID(),Number.MAX_SAFE_INTEGER),v.storeMessage(r,e,n).finally(function(){var e=r.sendContinously();return e.then(function(){return v.removeMessageID(r.getClientID()),v.addMessage(r),b.delete(r.getClientID())}),e.catch(function(e){console.error(e),alert("An error occured sending a message!"+e.toString())}),e})},v.id=o,v.draft=n,v.update({latestChunk:f,latestMessage:c,unreadMessageIDs:p}),v}return p(t,e),t.prototype.isUnread=function(){return w.indexOf(this.id)>-1},t.prototype.loadOlderMessages=function(e,t){var n=this;return void 0===t&&(t=20),r.try(function(){return y(n,void 0,void 0,function(){var n,o,c,l,f,d,h,p=this;return m(this,function(g){switch(g.label){case 0:return e?[4,this.loadPreviousMessagesFromCache(e,t)]:[3,2];case 1:if(n=g.sent(),(t-=n.length)<1)return[2];n.length>0&&(e=u.default.array.last(n)),g.label=2;case 2:return[4,i.default.definitlyEmit("chat.getMessages",{id:this.getID(),oldestKnownMessage:e?e.getServerID():0,limit:t})];case 3:return o=g.sent(),c=o.messages,l=o.chunks,f=void 0===l?[]:l,d=o.remainingMessagesCount,[4,r.all(f.map(function(e){return a.b.load(e)}))];case 4:return g.sent(),[4,r.all(c.map(function(e){return s.b.load(e)}))];case 5:return h=g.sent(),[4,r.all(h.map(function(e){return p.verifyMessageAssociations(e)}))];case 6:return g.sent(),h.forEach(function(e){return p.addMessage(e)}),[2,d]}})})})},t.prototype.loadMoreMessages=function(){if(this.draft)return r.resolve(0);var e=0===this.messages.length?null:s.b.getLoaded(this.messages[0].id);return this.loadOlderMessages(e)},t.prototype.getMessages=function(){return this.messages},t.prototype.getChatUpdates=function(){return this.chatUpdates},t.prototype.getLatestChatUpdate=function(){if(this.chatUpdates.length>0)return u.default.array.last(this.chatUpdates).id},t.prototype.getLatestChunk=function(){return u.default.array.last(this.chunkIDs)},t.prototype.getLatestMessage=function(){if(this.messages.length>0)return u.default.array.last(this.messages).id},t.prototype.getLatestSentMessage=function(){var e=this.messages.map(function(e){return s.b.getLoaded(e.id)}).filter(function(e){return e.hasBeenSent()});if(e.length>0)return u.default.array.last(e).getClientID()},t.prototype.localMarkRead=function(){var e=this;0===this.unreadMessageIDs.length&&-1===w.indexOf(this.id)||(this.unreadMessageIDs=[],w=w.filter(function(t){return t!==e.id}),this.notify(this.getID(),"read"),this.store())},t.prototype.markRead=function(){return this.localMarkRead(),this.draft?r.resolve():i.default.definitlyEmit("chat.markRead",{id:this.id})},t.prototype.addUnreadMessage=function(e){-1===this.unreadMessageIDs.indexOf(e)&&this.unreadMessageIDs.push(e),-1===w.indexOf(this.id)&&w.push(this.id),this.store()},t.getUnreadChatIDs=function(){return w},t}(f.default),S=function(e){return i.default.definitlyEmit("chat.getMultiple",{ids:e}).then(function(t){var n=t.chats;return e.map(function(e){return n.find(function(t){return u.default.parseDecimal(t.chat.id)===u.default.parseDecimal(e)})})})},E=u.default.delayMultiplePromise(r,50,S,10),P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t}(Object(o.c)({download:function(e){return E(e).then(function(t){if(u.default.parseDecimal(t.chat.id)!==u.default.parseDecimal(e))throw new Error("Chat ID incorrect after loading. Should be "+e+" but is "+t.chat.id);return t})},load:function(e,t){if(t&&u.default.deepEqual(t.getInfo(),e.chat))return r.resolve(o.a);var n=r.all(e.chunks.map(function(e){return a.b.load(e)})),i=r.all(e.messages.map(function(e){return s.b.load(e)})),c=e.chat,l=c.id,f=c.latestMessageID,d=c.latestChunkID,h=c.unreadMessageIDs;return r.all([n,i]).thenReturn({id:l,latestMessageID:f,latestChunkID:d,unreadMessageIDs:h})},getID:function(e){return e.chat.id},restore:function(e,t){return r.try(function(){return y(this,void 0,void 0,function(){var n,r,i,o,u,c,l;return m(this,function(f){switch(f.label){case 0:return n=e.id,r=e.latestMessageID,i=e.latestChunkID,o=e.unreadMessageIDs,r?[4,s.b.get(r)]:[3,2];case 1:return c=f.sent(),[3,3];case 2:c=null,f.label=3;case 3:return u=c,[4,a.b.get(i)];case 4:return l=f.sent(),u?[4,I(u,l.getID())]:[3,6];case 5:f.sent(),f.label=6;case 6:return t?(t.update({unreadMessageIDs:o,latestMessage:u,latestChunk:l}),[2,t]):[2,new k({id:n,latestMessage:u,latestChunk:l,unreadMessageIDs:o})]}})})})},shouldUpdate:function(e,t){return r.resolve(!t.isDraft())},cacheName:"chat"}));t.b=P;var C=function(e){var t=P.getAll();Object.keys(t).forEach(function(n){var r=t[n].instance;-1===e.indexOf(r.getID())&&r.localMarkRead()}),w=e};i.default.channel("unreadChats",function(e,t){e&&console.warn(e),t.unreadChatIDs?C(t.unreadChatIDs):console.warn("got no chat ids from socket channel")});var O=function(){if(!((new Date).getTime()-0<5e3))return v.awaitLoading().then(function(){return r.delay(500)}).then(function(){return i.default.awaitConnection()}).then(function(){return i.default.definitlyEmit("chat.getUnreadIDs",{})}).then(function(e){e.chatIDs?C(e.chatIDs):console.warn("got no chat ids from socket request")})};i.default.on("connect",function(){O()}),v.listen(function(){O()},"initDone")},124:function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r=n(3),i=(n.n(r),n(31)),o=n(7),a=n(14),s=n(97),u=n(128),c=n(64),l=n(88),f=n(48),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},p=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},g=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},y=n(12).default,m=n(36).default,v=function(e,t){return e.map(function(e){return o.default.objectMap(e,function(e){return e[t]})})},b=function(){function e(t,n,s,d){var v=this;this.initialize=function(t){var n=t.meta,r=t.content,a=t.server,s=t.sender;v.wasSent=!0;var u=e.idFromData(a),c=u.clientID;v.serverID=u.serverID,v.clientID=c,v.previousID=a.previousMessage,v.chunkID=a.chunkID,v.sendTime=o.default.parseDecimal(a.sendTime),v.securedData=new i.SecuredData(r,n,{type:"message"},!0),v.setDefaultData(),v.data.sender=s.data,v.isOwnMessage=s.isOwn(),v.setAttachmentInfo("files"),v.setAttachmentInfo("voicemails"),v.setImagesInfo()},this.initializePending=function(t,n,r,i){v.wasSent=!1,v.chat=t,v.attachments=r,v.clientID=i||o.default.generateUUID();var a={createTime:(new Date).getTime(),messageUUID:v.clientID};v.securedData=e.createRawSecuredData(n,a),v.setDefaultData(),v.data.sender=y.getOwn().data,v.isOwnMessage=!0,v.data.images=r.images.map(function(e){return e.convertForGallery?e.convertForGallery():e}),v.data.files=r.files.map(function(e){return h({},e.getInfo(),{getProgress:function(){return e.getProgress()}})}),v.data.voicemails=r.voicemails.map(function(e){return h({},e.getInfo(),{getProgress:function(){return e.getProgress()}})}),v.prepareAttachments()},this.hasAttachments=function(){return 0!==v.attachments.images.length||0!==v.attachments.files.length||0!==v.attachments.voicemails.length},this.isBlockedSince=function(){return f.default.isBlockedSince(v.data.sender.id,v.getTime())},this.isBlocked=function(){return f.default.isBlocked(v.data.sender.id)},this.hasFiles=function(){return v.data.files&&v.data.files.length>0},this.hasVoicemail=function(){return v.data.voicemails&&v.data.voicemails.length>0},this.hasText=function(){return v.data.text&&v.data.text.length>0},this.hasImages=function(){return v.data.images&&v.data.images.length>0},this.prepareAttachments=function(){return r.all([e.prepare(v.attachments.files),e.prepare(v.attachments.images),e.prepare(v.attachments.voicemails)])},this.setDefaultData=function(){var e=v.securedData.contentGet();v.data={text:"string"==typeof e?e:e.message,timestamp:v.getTime(),date:new Date(v.getTime()),sent:v.wasSent,id:v.clientID,obj:v}},this.getChunkID=function(){return v.chunkID||v.chat.getLatestChunk()},this.hasBeenSent=function(){return v.wasSent},this.uploadAttachments=o.default.cacheResult(function(e){return v.prepareAttachments().then(function(){var t=v.attachments.images.concat(v.attachments.files,v.attachments.voicemails);return r.all(t.map(function(t){return t.upload(e)}))}).then(function(e){return o.default.array.flatten(e)})}),this.sendContinously=o.default.cacheResult(function(){return o.default.repeatUntilTrue(r,function(){return v.send()},2e3)}),this.send=function(){if(v.wasSent)throw new Error("trying to send an already sent message");return r.try(function(){return p(v,void 0,void 0,function(){var t,n,r,i,s,c,l,f,d,h,p,v,b,w,_,I,k,S,E,P,C=this;return g(this,function(g){switch(g.label){case 0:return[4,a.default.awaitConnection()];case 1:return g.sent(),t=this.chat.getMessages(),n=t.filter(function(e){return D.isLoaded(e.id)}).map(function(e){return D.getLoaded(e.id)}),r=n.filter(function(e){return!e.hasBeenSent()}),i=r.findIndex(function(e){return e===C}),r[i-1]?[4,r[i-1].sendContinously()]:[3,3];case 2:g.sent(),g.label=3;case 3:return[4,u.b.get(this.chat.getLatestChunk())];case 4:return s=g.sent(),this.securedData.setParent(s.getSecuredData()),[4,e.setAttachmentsInfo(this.securedData,this.attachments)];case 5:return g.sent(),c=s.getKey(),l=n.filter(function(e){return e.hasBeenSent()}),(f=o.default.array.last(l))&&f.getChunkID()===this.chat.getLatestChunk()&&this.securedData.setAfterRelationShip(f.getSecuredData()),d=this.securedData.signAndEncrypt(y.getOwn().getSignKey(),c),[4,this.uploadAttachments(c)];case 6:return h=g.sent().map(m.upload.getKey),[4,d];case 7:return p=g.sent(),this.chat.isDraft()?(v=s.chunkData,b=v.receiverKeys,w=v.keys,_=v.chunk,[4,a.default.emit("chat.create",{initialChunk:_,firstMessage:p,receiverKeys:b,keys:w.concat(h)})]):[3,9];case 8:return I=g.sent(),k=I.chat.chat,S=I.chat.messages[0],E=I.chat.chunks[0],s.create(E),this.chat.create(k),this.sendSuccess(),this.setServerInfo(S.server),[2,!0];case 9:return[4,a.default.emit("chat.message.create",{chunkID:s.getID(),message:p,keys:h})];case 10:return(P=g.sent()).success&&this.sendSuccess(),P.server&&(this.setServerInfo(P.server),this.store(this.securedData.contentGet(),this.securedData.metaGet(),P.server)),[2,P.success]}})})}).catch(a.default.errors.Disconnect,function(e){return console.warn(e),!1}).catch(a.default.errors.Server,function(){return!1})},this.store=function(e,t,n){D.updateCache(v.getClientID(),{content:e,meta:t,server:n})},this.sendSuccess=function(){v.wasSent=!0,v.data.sent=!0,v.setAttachmentInfo("files"),v.setAttachmentInfo("voicemails"),v.setImagesInfo()},this.setServerInfo=function(e){var t=e.id,n=e.chunkID,r=e.previousMessage;v.sendTime=o.default.parseDecimal(e.sendTime),v.serverID=o.default.parseDecimal(t),v.chunkID=o.default.parseDecimal(n),v.previousID=r,v.data.timestamp=v.getTime()},this.getSecuredData=function(){return v.securedData},this.getServerID=function(){return v.serverID},this.getPreviousID=function(){return v.previousID},this.getClientID=function(){return v.clientID},this.getTopicID=function(){return v.chunkID},this.getTime=function(){return v.getServerID()?v.sendTime:o.default.parseDecimal(v.securedData.metaAttr("createTime"))},this.isOwn=function(){return v.isOwnMessage},this.verifyParent=function(e){v.securedData.checkParent(e.getSecuredData())},this.getText=function(){return v.data.text},this.setAttachmentInfo=function(e){var t=v.securedData.contentGet();if("string"!=typeof t){var n=t[e],i=v.securedData.metaAttr(e);n&&(v.data[e]=n.map(function(e,t){return h({},e,i[t],{loaded:!1})}),r.resolve(v.data[e]).filter(function(e){return c.a.isBlobLoaded(e.blobID)}).each(function(e){e.loaded=!0}))}},this.downloadVoicemail=function(e){return r.resolve(v.data.voicemails).each(function(t){var n=new l.a;return e.addDepend(n),c.a.getBlobUrl(t.blobID,t.type,t.size,e).then(function(e){t.url=e,t.loaded=!0})})},this.setImagesInfo=function(){var e=v.securedData.contentGet(),t=v.securedData.metaAttr("images")||[];if("string"!=typeof e){var n=e.images;v.data.images=t.map(function(e,t){var r=n[t];return o.default.objectMap(e,function(e,t){return h({},e,r[t])})})}else v.data.images=t},n?this.initializePending(n,t,s,d):this.initialize(t)}return e.createRawSecuredData=function(e,t,n){var r=new i.SecuredData({message:e},t,{type:"message"},!0);return n&&r.setParent(n.getSecuredData()),r},e.idFromData=function(e){return{serverID:o.default.parseDecimal(e.id),clientID:e.uuid}},e.prepare=function(e){return r.resolve(e).map(function(e){return e.prepare()})},e.setAttachmentsInfo=function(t,n){return r.try(function(){return p(this,void 0,void 0,function(){var r,i,o;return g(this,function(a){switch(a.label){case 0:return[4,e.prepare(n.images)];case 1:return r=a.sent(),[4,e.prepare(n.voicemails)];case 2:return i=a.sent(),[4,e.prepare(n.files)];case 3:return o=a.sent(),r.length>0||o.length>0||i.length>0?(t.metaSetAttr("images",v(r,"meta")),t.contentSetAttr("images",v(r,"content")),t.metaSetAttr("files",o.map(function(e){return e.meta})),t.contentSetAttr("files",o.map(function(e){return e.content})),t.metaSetAttr("voicemails",i.map(function(e){return e.meta})),t.contentSetAttr("voicemails",i.map(function(e){return e.content}))):"string"!=typeof t.contentGet()&&t.contentSet(t.contentGet().message),[2]}})})})},e}(),w=function(e){return y.get(e).then(function(e){return e.loadBasicData().thenReturn(e)})},D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t}(Object(s.a)({cacheName:"message",getID:function(e){return e.server.uuid},download:function(e){return a.default.definitlyEmit("chat.message.get",{id:e})},load:function(e){var t=e.server,n=i.default.load(e.content,e.meta,{type:"message"}),o=t.sender;return r.try(function(){return p(this,void 0,void 0,function(){var t;return g(this,function(i){switch(i.label){case 0:return[4,w(o)];case 1:return t=i.sent(),[4,r.all([n.decrypt(),n.verify(t.getSignKey())])];case 2:return i.sent(),[2,{content:n.contentGet(),meta:n.metaGet(),server:e.server}]}})})})},restore:function(e){return w(e.server.sender).then(function(t){return new b(h({},e,{sender:t}))})}}));t.b=D},128:function(e,t,n){"use strict";var r=n(7),i=n(17),o=n(31),a=n(3),s=n(14),u=n(97),c=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},l=function(){return function(e){var t=e.content,n=e.server,i=e.meta,a=e.sender,s=this;this.setState=function(e){s.state=c({},s.state,e)},this.getID=function(){return s._id},this.getTime=function(){return r.default.parseDecimal(s.securedData.metaAttr("time"))},this.isAfter=function(e){return!e||e.getTime()<s.getTime()},this.ensureParent=function(e){s.securedData.checkParent(e.getSecuredData())},this.ensureIsAfterTopicUpdate=function(e){s.securedData.checkAfter(e.getSecuredData())},this.getUserID=function(){return s.userID},this.getSecuredData=function(){return s.securedData},this.getMetaUpdate=function(){return s.securedData.metaAttr("metaUpdate")};var t=t,i=i;this._id=n.id,this.securedData=new o.SecuredData(t,i,{type:"topicUpdate"},!0),this.userID=i.userID,this.state={loading:!1,timestamp:r.default.parseDecimal(i.time),title:t.title,sender:a}}}();n.d(t,"a",function(){return I});var f=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),d=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},h=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},g=this,y=n(239),m=n(16),v=n(12).default,b=n(36).default,w=n(26).default,D=m("whispeer:chunk"),_={type:"topic",alternativeType:"chatChunk"},I=function(e){function t(t,n){var i=t.content,u=t.server,c=t.meta,l=t.receiverObjects,f=e.call(this)||this;f.chunkData=n,f.title="",f.create=function(e){var t=e.server,n=t.id,r=t.chatID;f.id=n,f.chatID=r,S.addLoaded(n,f),S.removeLoaded(-1)},f.getChatID=function(){return f.chatID},f.getSecuredData=function(){return f.securedData},f.getHash=function(){return f.securedData.getHash()},f.getID=function(){return r.default.parseDecimal(f.id)},f.getTime=function(){return f.createTime?f.createTime:f.getSecuredData().metaAttr("createTime")},f.getKey=function(){return f.securedData.metaAttr("_key")},f.setLatestTitleUpdate=function(e){f.titleUpdate=e},f.ensureChunkChain=function(e){if(f.getID()!==e.getID()){var t=f.getPredecessorID();if(!t||!S.isLoaded(t))throw new Error("Chunk chain broken "+t);var n=S.getLoaded(t);n.verifyParent(f),n.ensureChunkChain(e)}},f.verifyParent=function(e){e.getSecuredData().checkParent(f.getSecuredData())},f.getReceivers=function(){return f.receiverObjects},f.getPartners=function(){return f.receiverObjects.filter(function(e){return!e.user.isOwn()||1===f.receiverObjects.length})},f.getPartnerDisplay=function(e){void 0===e&&(e=3);var t=f.getPartners();return t.length<=e?t:t.slice(0,e-1)},f.getReceiver=function(){return f.receiver},f.getAdmins=function(){return f.admins},f.getReceiverIDs=function(){return f.receiver},f.getTitle=function(){return f.titleUpdate?f.titleUpdate.state.title:f.title},f.setTitle=function(e){f.title=e},f.isAdmin=function(e){return f.getAdmins().indexOf(e.getID())>-1},f.amIAdmin=function(){return f.isAdmin(v.getOwn())},f.getCreator=function(){return r.default.parseDecimal(f.securedData.metaAttr("creator"))},f.hasPredecessor=function(){return!!f.predecessorID},f.getPredecessorID=function(){return f.hasPredecessor()?r.default.parseDecimal(f.predecessorID):null},f.getPredecessor=function(){return f.hasPredecessor()?S.get(f.getPredecessorID()).catch(function(e){return console.log(e),null},s.default.errors.Server):a.resolve(null)},f.setSuccessor=function(e){f.successorID=e,D("Set successor of chunk ",f.getID()," succ: ",e),f.notify({successorID:e},"successor")},f.hasKnownSuccessor=function(){return!!f.successorID},f.getLoadedSuccessor=function(){if(f.hasKnownSuccessor())return S.getLoaded(f.successorID)},f.getSuccessor=function(){return f.successorID?S.get(f.successorID):s.default.definitlyEmit("chat.chunk.successor",{id:f.getID()}).then(function(e){if(e.chunk)return S.load(e.chunk).then(function(e){if(e.getPredecessorID()!==f.getID())throw new Error("server returned invalid successor chunk");return e})})};var d=y.validate("topic",c);if(d)throw d;c.receiver.sort(),f.securedData=o.default.createRaw(i,c,_),f.id=u.id,f.chatID=u.chatID,f.predecessorID=u.predecessorID,f.createTime=u.createTime,f.receiver=f.securedData.metaAttr("receiver").map(r.default.parseDecimal);var h=f.securedData.metaAttr("admins"),p=f.securedData.metaAttr("creator");f.admins=(h||[p]).map(r.default.parseDecimal),f.title=f.securedData.hasContent()?f.securedData.contentGet().title:"",f.receiverObjects=l;var g=f.getPredecessorID();return g&&S.isLoaded(g)&&S.getLoaded(g).setSuccessor(f.getID()),f}return f(t,e),t.loadChunkChain=function(e,n){return e.getID()===n.getID()?a.resolve():e.getPredecessorID()===n.getID()?a.resolve():e.getPredecessor().then(function(e){if(e&&e.getID()!==n.getID())return t.loadChunkChain(e,n)})},t.createRawData=function(e,n){var i=this,s=n.content,u=void 0===s?{}:s,c=n.meta,l=void 0===c?{}:c,f=n.givenKey,g=n.predecessorChunk;return a.try(function(){return h(i,void 0,void 0,function(){var n,i,a,s,c,h,y,m,b,D,_;return p(this,function(p){switch(p.label){case 0:return-1===(n=e.map(function(e){return r.default.parseDecimal(e)})).indexOf(w.getUserID())&&n.push(w.getUserID()),[4,v.getMultiple(n)];case 1:return i=p.sent(),a=i.filter(function(e){return!e.isOwn()}),s={cryptInfo:{receiverKeys:{},keys:[]},chunkKey:f},f?(m=s,[3,4]):[3,2];case 2:return[4,t.cryptInfo(a)];case 3:m=p.sent(),p.label=4;case 4:return c=m,h=c.cryptInfo,y=c.chunkKey,n.sort(),b=d({},l,{createTime:(new Date).getTime(),receiver:n,creator:v.getOwn().getID()}),D=o.default.createRaw(u,b,{type:"topic"}),g&&D.setParent(g.getSecuredData()),[4,D.signAndEncrypt(v.getOwn().getSignKey(),y)];case 5:return _=p.sent(),[2,Object.assign({chunk:_},h)]}})})})},t.createChunkKey=function(){return b.sym.generateKey(null,"chunkMain").then(function(e){return b.sym.symEncryptKey(e,v.getOwn().getMainKey()).thenReturn(e)})},t.cryptInfo=function(e){return h(g,void 0,void 0,function(){var n,r,i,o,s;return p(this,function(u){switch(u.label){case 0:return n={},[4,t.createChunkKey()];case 1:return r=u.sent(),[4,a.all(e.map(function(e){var t=e.getCryptKey();return b.sym.asymEncryptKey(r,t)}))];case 2:return i=u.sent(),o=b.upload.getKeys(i),e.forEach(function(e,t){n[e.getID()]=i[t]}),s={keys:o.concat([b.upload.getKey(r)]),receiverKeys:n},[2,{cryptInfo:s,chunkKey:r}]}})})},t}(i.default);i.default.extend(I);var k=function(e){return a.try(function(){return h(g,void 0,void 0,function(){var t,n,r,i,s;return p(this,function(u){switch(u.label){case 0:return e?(t=e.content,n=e.meta,r=e.server,i=o.default.load(t,n,{type:"topicUpdate"}),[4,v.get(n.userID)]):[2];case 1:return s=u.sent(),[4,a.all([i.decrypt(),i.verify(s.getSignKey())])];case 2:return u.sent(),[2,{content:i.contentGet(),meta:i.metaGet(),server:r}]}})})})},S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return f(t,e),t}(Object(u.a)({cacheName:"chunk",download:function(e){return s.default.definitlyEmit("chat.chunk.get",{id:e})},restore:function(e){var t=e.meta,n=e.content,i=e.server,o=e.titleUpdate;return a.try(function(){return h(this,void 0,void 0,function(){var e,a,s,u,c,f,d,h;return p(this,function(p){switch(p.label){case 0:return e=v.getMultipleFormatted(t.receiver.sort().map(r.default.parseDecimal)),[4,v.get(t.creator)];case 1:return(a=p.sent()).isNotExistingUser()||b.security.addEncryptionIdentifier(t._key),u=I.bind,c={meta:t,content:n,server:i},[4,e];case 2:return s=new(u.apply(I,[void 0,(c.receiverObjects=p.sent(),c)])),o?(d=l.bind,h={content:o.content,meta:o.meta,server:o.server},[4,v.get(o.meta.userID)]):[3,4];case 3:f=new(d.apply(l,[void 0,(h.sender=p.sent(),h)])),s.setLatestTitleUpdate(f),p.label=4;case 4:return[2,s]}})})})},load:function(e){var t=e.content,n=e.meta,r=e.server,i=e.latestTitleUpdate;return a.try(function(){return h(this,void 0,void 0,function(){var e,a,s;return p(this,function(u){switch(u.label){case 0:return e=o.default.load(t,n,_),[4,v.get(e.metaAttr("creator"))];case 1:return a=u.sent(),[4,k(i)];case 2:return s=u.sent(),[4,e.verify(a.getSignKey())];case 3:return u.sent(),[4,e.decrypt()];case 4:return u.sent(),[2,{content:e.contentGet(),meta:e.metaGet(),server:r,titleUpdate:s}]}})})})},getID:function(e){return e.server.id}}));t.b=S},131:function(e,t,n){"use strict";n.d(t,"b",function(){return f});var r=n(3),i=(n.n(r),n(90)),o=n(37),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},u=this,c=new i.File,l=function(){return window.device&&"Android"===window.device.platform},f=function(){var e=window,t=e.Zone.__symbol__("OriginalDelegate");e.FileReader[t]&&(console.warn("Fixing file reader!"),e.FileReader=e.FileReader[t])},d=null,h=function(){if(!d){var e=c.cacheDirectory,t=e+"blobCache/";d=r.resolve(c.checkDir(e,"blobCache")).then(function(e){return t}).catch(function(n){return c.createDir(e,"blobCache",!0).then(function(e){return t}).catch(function(e){throw new Error("Could not create blob cache directory.")})})}return d},p=function(){h().then(function(){return c.listDir(c.cacheDirectory,"blobCache")}).filter(function(e){return e.isFile&&e.name.endsWith(".blob")}).map(function(e){return new r(function(t,n){return e.remove(t,n)})})};document.addEventListener("deviceready",p,!1);var g=function(e,t,n){return f(),c.readAsArrayBuffer(e,t).then(function(e){return new Blob([e],{type:n})})},y=function(e,t,n){return f(),c.writeFile(e,t,n)},m=function(e,t){return c.checkFile(e,t).catch(function(e){return 1!==e.code&&r.reject(e)})},v=function(e){return e+".aac"},b=!1,w=0,D=function(){return new r(function(e){var t=setInterval(function(){0===w&&(e(),clearInterval(t))},10)}).timeout(3e4).catch(r.TimeoutError,function(){})},_={clear:function(){return r.try(function(){return a(u,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return b=!0,[4,D()];case 1:return e.sent(),[4,c.removeRecursively(c.cacheDirectory,"blobCache").catch(function(e){return console.warn("Cannot remove cache, resolving promise anyway."),!0})];case 2:return e.sent(),[2]}})})}).finally(function(){return b=!1})},moveFileToBlob:function(e,t,n){return r.try(function(){return a(u,void 0,void 0,function(){var r,i;return s(this,function(o){switch(o.label){case 0:if(b)throw new Error("Cannot get blob, currently clearing cache.");return[4,h()];case 1:return r=o.sent(),i=v(n),[2,c.moveFile(e,t,r,i)]}})})})},readFileAsArrayBuffer:function(e,t){return r.resolve(c.readAsArrayBuffer(e,t))},store:function(e){return r.try(function(){return a(u,void 0,void 0,function(){var t,n,r,i;return s(this,function(o){switch(o.label){case 0:if(b)throw new Error("Cannot store blob, currently clearing cache.");if(w++,t=e.getBlobID(),!e.isDecrypted())throw new Error("trying to store an undecrypted blob");return[4,h()];case 1:return n=o.sent(),r=v(t),[4,m(n,r)];case 2:return(i=o.sent())?[3,4]:[4,y(n,r,e.getBlobData())];case 3:o.sent(),o.label=4;case 4:return[2,""+n+r]}})})}).catch(function(e){return console.warn("Storing blob failed"),r.reject(e)}).finally(function(){return w--})},getBlobUrl:function(e){return r.try(function(){return a(u,void 0,void 0,function(){var t,n,r;return s(this,function(i){switch(i.label){case 0:if(b)throw new Error("Cannot get blob URL, currently clearing cache.");return[4,h()];case 1:return t=i.sent(),n=v(e),[4,m(t,n)];case 2:if(!(r=i.sent()))throw new Error("cannot get blob url, blob does not exist: "+n);return[2,""+t+n]}})})})},copyBlobToDownloads:function(e,t){return r.try(function(){return a(u,void 0,void 0,function(){var n,r,i,o,a;return s(this,function(s){switch(s.label){case 0:return[4,h()];case 1:return n=s.sent(),r=v(e),i=l()?c.externalRootDirectory+"Download/":""+c.documentsDirectory,[4,m(n,r)];case 2:return o=s.sent(),[4,m(i,t)];case 3:if(a=s.sent(),!o)throw new Error("cannot copy blob, blob does not exist: "+t);return a?[4,c.removeFile(i,t)]:[3,5];case 4:s.sent(),s.label=5;case 5:return[4,c.copyFile(n,r,i,t)];case 6:return s.sent(),[2,""+i+t]}})})})},getFileMimeType:function(e){return r.resolve(c.resolveLocalFilesystemUrl(e)).then(function(e){return new r(function(t,n){return e.file(t,n)}).then(function(e){return e.type})})},isLoaded:function(e){return _.getBlobUrl(e).then(function(){return!0}).catch(function(){return!1})},get:function(e){return r.try(function(){return a(u,void 0,void 0,function(){var t,n,r;return s(this,function(i){switch(i.label){case 0:if(b)throw new Error("Cannot get blob, currently clearing cache.");return[4,h()];case 1:return t=i.sent(),n=v(e),[4,g(t,n,"")];case 2:return r=i.sent(),[2,{blob:r,blobID:e,decrypted:!0,meta:{}}]}})})})}};t.a=_,new o.a("blobs").deleteAll().catch(function(){return console.warn("Could not delete legacy blobs from idb cache")})},14:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(341),o=n(3),a=n(17),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(e){function t(t,n,r){var i=e.call(this)||this;return i._doneBytes=0,i.upload=function(){return i._uploadingPromise||(i._uploadingPromise=i._uploadPartUntilDone()),i._uploadingPromise},i._uploadPartUntilDone=function(){return i._doneBytes===i._blob.size?o.resolve():i._uploadPart().then(function(){return i._uploadPartUntilDone()})},i._blob=n,i._blobid=r,i._socket=t,i._reset(),i}return s(t,e),t.prototype._reset=function(){this._doneBytes=0,this._partSize=t.STARTPARTSIZE},t.sliceBlob=function(e,t,n){return"function"==typeof e.slice?e.slice(t,n):"function"==typeof e.webkitSlice?e.webkitSlice(t,n):"function"==typeof e.mozSlice?e.mozSlice(t,n):e},t.prototype._halfSize=function(){this._partSize=Math.max(this._partSize/2,t.MINIMUMPARTSIZE)},t.prototype._doubleSize=function(){this._partSize=Math.min(2*this._partSize,t.MAXIMUMPARTSIZE)},t.prototype._uploadPart=function(){var e,n=this,r=(new Date).getTime();return this._socket.awaitConnection().then(function(){var r=t.sliceBlob(n._blob,n._doneBytes,n._doneBytes+n._partSize);return n._socket.emit("blob.uploadBlobPart",{blobid:n._blobid,blobPart:r,doneBytes:n._doneBytes,size:e=r.size,lastPart:n._blob.size===n._doneBytes+e})}).then(function(i){if(i.reset)return console.warn("Restarting Upload"),n._reset();(new Date).getTime()-r>t.MAXIMUMTIME?n._halfSize():n._doubleSize(),n._doneBytes+=e,n.notify(n._doneBytes,"progress")}).catch(function(e){return console.error(e),n._halfSize(),o.delay(5e3)})},t.MAXIMUMPARTSIZE=1e6,t.STARTPARTSIZE=5e3,t.MINIMUMPARTSIZE=1e3,t.MAXIMUMTIME=2e3,t}(a.default),c=n(49);n.d(t,"DisconnectError",function(){return y}),n.d(t,"ServerError",function(){return m}),n.d(t,"ɵ0",function(){return v}),n.d(t,"ɵ1",function(){return b});var l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),f=n(16),d=n(95),h=f("whispeer:socket"),p=f("whispeerBlob:any"),g=f("whispeer:socket:error"),y=r.default.createErrorType("disconnectedError"),m=r.default.createErrorType("serverError"),v=function(e){var t=(new Date).toLocaleTimeString()+":"+e+"("+Math.random()+")";return f.enabled("whispeer:socket")&&console.time(t),t},b=function(e){f.enabled("whispeer:socket")&&console.timeEnd(e)},w={timer:v,timerEnd:b},D=function(e){function t(){var t=e.call(this)||this;return t._interceptors=[],t._domain=(d.https?"https://":"http://")+d.ws+":"+d.wsPort,t._autoReconnect=d.socket.autoReconnect,t._autoConnect=d.socket.autoConnect,t._lastRequestTime=0,t._loading=0,t.uploadObserver=new a.default,t._uploadingCounter=0,t.errors={Disconnect:y,Server:m},t.uploadBlob=function(e,n,r,i){if(!(t._uploadingCounter>3)){t._uploadingCounter++;var o=new u(t,e,n);o.listen(function(e){r.progress(e)},"progress");return o.upload().then(function(){t._uploadingCounter--,t.uploadObserver.notify(n,"uploadFinished"),t.uploadObserver.notify(n,"uploadFinished:"+n)}).nodeify(i)}t.uploadObserver.listenOnce(function(){t.uploadBlob(e,n,r,i)},"uploadFinished")},t._autoConnect&&t._connect(),t._autoConnect&&t._autoReconnect&&window.setInterval(function(){try{t._socket.connected||t._socket.connect()}catch(e){g(e)}},1e4),t}return l(t,e),t.prototype._connect=function(){var e=this;this._socket=Object(i.connect)(this._domain,d.socket.options),this._socket.on("disconnect",function(){h("socket disconnected"),e._loading=0,e._uploadingCounter=0}),this._socket.on("connect",function(){h("socket connected"),e.emit("whispeerPing",{}),e._socket.io.engine.on("heartbeat",function(){e.notify(null,"heartbeat")})})},t.prototype._emit=function(e,t){var n=this;return new o(function(r,i){var o=function(){i(new y("Disconnected while sending"))};n._socket.once("disconnect",o),n._socket.emit(e,t,function(e){n._socket.off("disconnect",o),r(e)})})},t.prototype.getLoadingCount=function(){return this._loading},t.prototype.lastRequestTime=function(){return this._lastRequestTime},t.prototype.send=function(e){this._socket.send(e)},t.prototype.addInterceptor=function(e){this._interceptors.push(e)},t.prototype.isConnected=function(){return this._socket.connected},t.prototype.emit=function(e,t,n){var r=this;if(!this.isConnected())throw new y("no connection");var i=w.timer("request on "+e),o=0===e.indexOf("blob");return t.version="0.0.3",t.clientInfo={type:"messenger",version:"0.3.12",commit:"91a8714\n"},o?p("Request on "+e,t):h("Request on "+e,t),this._interceptors.forEach(function(e){e.transformRequest&&(t=e.transformRequest(t))}),this._loading++,this.notify(null,"request"),this._emit(e,t).timeout(6e4).then(function(n){if(o?p("Answer on "+e,n):h("Answer on "+e,n),w.timerEnd(i),n.alert&&alert(n.alert),r._lastRequestTime=n.serverTime,r._interceptors.forEach(function(e){e.transformResponse&&(n=e.transformResponse(n,t))}),n.error)throw g(n),new m("server returned an error!",{response:n});return Object(c.c)()||n.isBusiness&&Object(c.a)(),n}).finally(function(){r._loading--,r.notify(null,"response")}).nodeify(n)},t.prototype.awaitNoRequests=function(){var e=this;return 0===this._loading?o.resolve():new o(function(t){e.listen(function(){0===e._loading&&t()},"response")})},t.prototype.awaitConnection=function(){var e=this;return new o(function(t){e.isConnected()?t():e.once("connect",t)})},t.prototype.on=function(e,t){return this._socket.on(e,t)},t.prototype.once=function(e,t){return this._socket.once(e,t)},t.prototype.definitlyEmit=function(e,t){var n=this;return this.awaitConnection().then(function(){return n.emit(e,t).timeout(1e4)}).catch(function(r){return console.error(r),o.delay(500).then(function(){return n.definitlyEmit(e,t)})})},t.prototype.channel=function(e,t){this._socket.on(e,function(n){h("received data on "+e),h(n),t(null,n)})},t.errors={Disconnect:y,Server:m},t}(a.default);t.default=new D},150:function(e,t,n){"use strict";function r(e,t,n){var r={signature:u.bits2hex(e),signatureHash:u.bits2hex(t),key:n};return s.hash.hashObjectOrValueHex(r,o.hashVersion)}var i=n(7).default,o=n(95),a=n(17),s=n(32),u=n(196),c=n(3),l=!1,f=!1,d={};d.promise=new c(function(e){d.promiseResolve=e});var h={me:{maxCount:-1,saveID:!0},user:{maxCount:500,saveID:!0},post:{maxCount:100,saveID:!1}},p={signatureCache:"noCache",signedFriendList:"user",circle:"me",trustManager:"noCache",settings:"noCache",topicUpdate:"noCache",post:"post",postPrivate:"post",topic:"noCache",message:"noCache",profile:"noCache",signedKeys:"noCache",comment:"noCache",friendShip:"noCache",removeFriend:"noCache"},g=function(e,t){this._type=e,this._maxCount=t.maxCount,this._saveID=t.saveID,this._signatures={}};g.prototype.getType=function(){return this._type},g.prototype.getCacheEntry=function(e){var t={};return this._maxCount>-1&&(t.date=(new Date).getTime()),this._saveID&&e&&(t.id=e),t},g.prototype.allEntries=function(){return this.allSignatures().map(function(e){var t=i.deepCopyObj(this.getEntry(e));return t.signatureHash=e,t},this)},g.prototype.getEntry=function(e){return this._signatures[e]},g.prototype.joinEntries=function(e){e.forEach(function(e){var t=e.signatureHash;delete e.signatureHash,this._signatures[t]||(this._signatures[t]=e)},this)},g.prototype.deleteByID=function(e){this._saveID&&e&&this.allEntries().filter(function(t){return t.id===e}).forEach(function(e){this.deleteEntry(e.signatureHash)},this)},g.prototype.deleteEntry=function(e){delete this._signatures[e]},g.prototype.addSignature=function(e,t,n,o){if(!i.isRealID(n)||!i.isSignature(u.bits2hex(e)))throw new Error("invalid input");var a=r(e,t,n);f=!0,this.deleteByID(o),this._signatures[a]=this.getCacheEntry(o),this.cleanUp()},g.prototype.hasEntry=function(e){return!!this._signatures[e]},g.prototype.hasSignature=function(e,t,n){var i=r(e,t,n);return this.hasEntry(i)},g.prototype.cleanUp=function(){if(-1!==this._maxCount){var e=this.allEntries();e.length<=this._maxCount||(console.log("Cleaning up database of type "+this._type+" ("+e.length+")"),e.sort(function(e,t){return e.date-t.date}),e.slice(0,e.length-this._maxCount).forEach(function(e){this.deleteEntry(e.signatureHash)},this))}},g.prototype.allSignatures=function(){return Object.keys(this._signatures)};var y=[];i.objectEach(h,function(e,t){h[e]=new g(e,t),y.push(h[e])});var m={awaitLoading:function(){return d.promise},isChanged:function(){return f},resetChanged:function(){f=!1},isLoaded:function(){return l},load:function(e,t){return e.internalHashVersion!==o.hashVersion?(console.warn("resetting signature cache to upgrade to new hash version"),void m.initialize(t)):e.me!==t?(console.warn("not my signature cache"),void m.initialize(t)):(e.databases.forEach(function(e){h[e.type]&&h[e.type].joinEntries(e.entries)}),void m.initialize(t))},initialize:function(){l=!0,d.promiseResolve()},getUpdatedVersion:function(){if(!l)return c.reject("Signature Cache not yet loaded!");var e=y.map(function(e){return{type:e.getType(),entries:e.allEntries()}});return c.resolve({internalHashVersion:o.hashVersion,databases:e})},isValidSignatureInCache:function(e,t,n){var i=r(e,t,n);return y.filter(function(e){return e.hasEntry(i)}).length>0},addValidSignature:function(e,t,n,r,o){if(!i.isRealID(n)||!i.isSignature(u.bits2hex(e)))throw new Error("invalid input");var a=p[r];if(a){if("noCache"!==a){o&&(o=r+"-"+o);h[a].addSignature(e,t,n,o)}}else console.warn("unknown type: "+r)}};a.extend(m),e.exports=m},17:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"extend",function(){return s});var r=n(3),i=(n.n(r),n(7)),o=[],a=function(){function e(){this._listeners={},this._listenersOnce={}}return e.addAfterHook=function(e){o.push(e)},e.prototype.listenOnce=function(e,t){void 0===this._listenersOnce[t=t||"any"]&&(this._listenersOnce[t]=[]),this._listenersOnce[t].push(e)},e.prototype.listenPromise=function(e){var t=this;return new r(function(n){t.listenOnce(n,e)})},e.prototype.listen=function(e,t){void 0===this._listeners[t=t||"any"]&&(this._listeners[t]=[]),this._listeners[t].push(e)},e.prototype.notify=function(e,t,n){t=t||"any",n||(n=function(){});var r=(this._listeners[t]||[]).concat(this._listenersOnce[t]||[]);this._listenersOnce[t]=[];var a=i.default.callEach(r,[e],n);return"any"!==t&&(a=n(this.notify(e),a)),i.default.callEach(o),a},e.extend=function(t){var n=new e;t.notify=n.notify.bind(n),t.listenOnce=n.listenOnce.bind(n),t.listenPromise=n.listenPromise.bind(n),t.listen=n.listen.bind(n)},e}();t.default=a;var s=function(e){a.extend(e)}},177:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(79),o=n(3),a=n(113),s=n(89),u=n(114),c=n(115),l=n(116),f=n(309),d=n(193),h=n(14),p=n(87),g=n(34),y=n(192),m=n(27),v=Object(p.a)("whispeer.session"),b=n(52),w=function(){return function(e,t,n){var r=this;this.navCtrl=e,this.platform=t,this.push=n,this.getOrCreatePushkey=function(){var e=v.get("pushKey");if(e)return b.codec.hex.toBits(e);var t=b.random.randomWords(8);return v.set("pushKey",b.codec.hex.fromBits(t)),t},this.getType=function(){var e=window.device.platform;return"Android"===e?"android":"iOS"===e?"ios":void 0},this.pushConfig={android:{senderID:"809266780938",icon:"ic_stat_icon",iconColor:"#5ab70d"},ios:{alert:!0,badge:!0,sound:!0}},this.registration=function(e){console.log("-> registration",e);var t=r.getType();o.all([v.awaitLoading(),m.awaitLoading(),h.default.awaitConnection()]).then(function(){var n=r.getOrCreatePushkey();if(t)return h.default.definitlyEmit("pushNotification.subscribe",{token:e.registrationId,key:b.codec.hex.fromBits(n),type:t})}).catch(g.default.criticalError)},this.getActiveNav=function(){return r.navCtrl.getActive().instance},this.isOnMessagesPage=function(){return r.getActiveNav()instanceof f.MessagesPage},this.isActiveChat=function(e){var t=r.getActiveNav().navParams.data.chatID;return parseInt(t,10)===parseInt(e,10)},this.goToChat=function(e){if(r.isOnMessagesPage()){if(r.isActiveChat(e))return;return Object(d.a)(r.navCtrl,"Messages",{chatID:e})}return r.navCtrl.push("Messages",{chatID:e})},this.goToUser=function(e){return r.navCtrl.push("Profile",{userId:e})},this.goToReference=function(e){"message"===e.type&&r.goToChat(e.chatID),"contactRequest"===e.type&&r.goToUser(e.id)},this.notification=function(e){if(console.info("Got Push notification with data",e),e&&e.additionalData){var t=e.additionalData;o.all([v.awaitLoading(),m.awaitLoading()]).then(function(){!t.foreground&&t.reference&&r.goToReference(t.reference);var e=v.get("pushKey");if(t.encryptedContent&&e&&("object"==typeof t.encryptedContent&&(t.encryptedContent=JSON.stringify(t.encryptedContent)),e=b.codec.hex.toBits(e),t.content=JSON.parse(b.json.decrypt(e,t.encryptedContent))),t.content){var n=t.content.message;return n&&(delete n.meta.sender,delete n.meta.sendTime,delete n.meta.topicid,delete n.meta.messageid),y.a.addSocketData(t.content)}}).then(function(){return r.pushInstance.finish()}).then(function(){return console.info("push done at "+new Date)},function(){return console.warn("Finishing push failed!")})}},this.unregister=function(){r.pushInstance&&(r.pushInstance.unregister(),r.pushInstance=null)},this.register=function(){try{console.info("Registering for Push"),r.pushInstance=r.push.init(r.pushConfig),r.pushInstance.on("registration").subscribe(r.registration),r.pushInstance.on("notification").subscribe(r.notification),r.platform.resume.subscribe(function(){console.warn("Resume app"),r.pushInstance.clearAllNotifications()})}catch(e){console.warn("Push is not available!")}}}}(),D=n(49),_=n(315),I=n(26);n.d(t,"MyApp",function(){return O}),n.d(t,"ɵ0",function(){return C});var k=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},S=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},E=200,P=function(e){var t=document.getElementsByTagName("ion-nav")[0];return t instanceof HTMLElement&&(t.style.height=e?"calc(100% - "+e+"px)":""),!0},C=P,O=function(){function e(e,t,n,r,i,a){var s=this;this.splashScreen=t,this.statusBar=n,this.globalization=r,this.push=i,this.keyboard=a,this.rootPage="Home",this.showTutorial=function(){var e=s.nav.getActive();return!(!e||!e.instance)&&(!e.instance.tutorialDisabled&&_.a.tutorialVisible)},this.slideNumber=1,this.lang="de",e.ready().then(function(){s.statusBar.styleLightContent();var t=new w(s.nav,e,s.push);e.is("ios")&&(s.keyboard.disableScroll(!0),window.addEventListener("native.keyboardshow",function(e){return P(e.keyboardHeight)}),window.addEventListener("native.keyboardhide",function(){return P(0)})),h.default.addInterceptor({transformResponse:function(e){if(Object(D.c)()&&e.logedin&&!e.error){var t=s.nav.getActive(),n=t&&"SalesPage"===t.component.name;n&&e.isBusiness&&(s.nav.remove(0,s.nav.length()-1),s.nav.setRoot("Home")),n||e.isBusiness||(s.nav.remove(0,s.nav.length()-1),s.nav.setRoot("Sales"))}return e}}),I.default.isLoggedin()&&t.register(),I.default.listen(function(){return t.register()},"login"),I.default.listen(function(){return t.unregister()},"logout"),I.default.bootLogin().then(function(e){o.delay(E).then(function(){return s.splashScreen.hide()}),!e&&s.nav.length()>0&&(s.nav.remove(0,s.nav.length()-1),s.nav.setRoot("Login")),s.initializeTutorialWithLanguage()})})}return e.prototype.advance=function(){this.slideNumber++,8===this.slideNumber&&(this.slideNumber=1,_.a.skip())},e.prototype.currentSlide=function(){return"assets/img/"+this.lang+"/tutorial_"+this.slideNumber+".png"},e.prototype.tutorialClicked=function(e){var t=e.offsetX,n=e.offsetY,r=e.target,i=r.offsetHeight,o=r.offsetWidth;if("IMG"!==r.nodeName)return this.advance();var a=t/o,s=n/i;.73<a&&a<.98&&.03<s&&s<.1&&1===this.slideNumber?_.a.skip():this.advance()},e.prototype.initializeTutorialWithLanguage=function(){var e=this;this.globalization.getPreferredLanguage().then(function(t){var n=-1===t.value.toLowerCase().indexOf("de");e.lang=n?"en":"de"}).catch(function(){console.warn("Cannot get language from device, remaining with default language")}).then(function(){_.a.checkVisibility()})},k([Object(r.ViewChild)("navigation"),S("design:type",i.i)],e.prototype,"nav",void 0),e=k([Object(r.Component)({templateUrl:"app.html"}),S("design:paramtypes",[i.k,a.SplashScreen,s.StatusBar,u.Globalization,c.Push,l.Keyboard])],e)}()},192:function(e,t,n){"use strict";var r=n(7),i=n(17),o=n(3),a=n(34),s=n(14),u=n(37),c=n(26),l=n(128),f=n(121),d=n(124),h=n(65),p=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),g=function(){function e(e){this.chatIDs=e}return e.prototype.get=function(){return this.chatIDs},e.prototype.set=function(e){this.chatIDs=e},e}(),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t}(Object(h.c)({download:function(){return s.default.definitlyEmit("chat.getAllIDs",{}).then(function(e){return e.chatIDs})},load:function(e){return o.resolve(e)},getID:function(){return c.default.getUserID()},restore:function(e,t){var n=e.findIndex(function(e){return f.b.isLoaded(e)}),r=-1===n?[]:e.slice(0,n);return o.all(r.map(function(e){return f.b.get(e)})).then(function(){return t?(t.set(e),t):new g(e)})},shouldUpdate:function(){return o.resolve(!0)},cacheName:"chatList"})),m=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},v=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},b=n(27);new u.a("messageSend").deleteAll();var w=0,D={notify:null,allChatsLoaded:!1,prependChatID:function(e){if(y.isLoaded(c.default.getUserID())){var t=y.getLoaded(c.default.getUserID()),n=t.get();t.set([e].concat(n.filter(function(t){return t!==e})))}},addSocketData:function(e){var t=this;return e?o.try(function(){return m(t,void 0,void 0,function(){var t,n,r;return v(this,function(i){switch(i.label){case 0:return e.chat?(console.warn("Add chat"),[4,f.b.load(e.chat)]):[3,2];case 1:n=i.sent(),D.prependChatID(n.getID()),i.label=2;case 2:return e.chunk?(console.warn("Add chunk"),[4,l.b.load(e.chunk)]):[3,5];case 3:return t=i.sent(),[4,f.b.get(t.getChatID())];case 4:(n=i.sent()).addChunkID(t.getID()),D.prependChatID(n.getID()),i.label=5;case 5:return e.message?(console.warn("Add message"),[4,l.b.get(e.message.server.chunkID)]):[3,9];case 6:return t=i.sent(),[4,f.b.get(t.getChatID())];case 7:return n=i.sent(),[4,d.b.load(e.message)];case 8:r=i.sent(),n.addMessage(r),r.isOwn()?n.getLatestMessage()===r.getClientID()&&n.localMarkRead():n.addUnreadMessage(r.getServerID()),D.prependChatID(n.getID()),D.notify({message:r,chat:n,chunk:t},"message"),i.label=9;case 9:return[4,o.resolve()];case 10:return i.sent(),[2]}})})}):o.resolve()},getChatIDs:function(){var e=c.default.getUserID();return y.isLoaded(e)?y.getLoaded(e).get():[]},setActiveChat:function(e){w=e},isActiveChat:function(e){return e===w},loadMoreChats:r.default.cacheUntilSettled(function(e){return void 0===e&&(e=20),b.awaitLoading().then(function(){return y.get(c.default.getUserID())}).then(function(){var t=D.getChatIDs().filter(function(e){return!f.b.isLoaded(e)});return 0===t.length&&(D.allChatsLoaded=!0),t.slice(0,e)}).map(function(e){return f.b.get(e)})}),sendUnsentMessages:function(){return new u.a("unsentMessages",{maxEntries:-1,maxBlobSize:-1}).all().map(function(e){var t=JSON.parse(e.data);return D.getChat(t.chatID).then(function(n){return n.sendUnsentMessage(t,e.blobs)})})},getChat:function(e,t){return o.try(function(){return f.b.get(e)}).nodeify(t)},getUserChat:function(e,t){return b.awaitLoading().then(function(){return s.default.definitlyEmit("chat.getChatWithUser",{userID:e})}).then(function(e){return!!e.chatID&&e.chatID}).nodeify(t)}};i.default.extend(D),s.default.channel("notify.chat",function(e,t){e?a.default.criticalError(e):D.addSocketData(t)}),b.awaitLoading().then(function(){D.sendUnsentMessages()});t.a=D},193:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e,t,n,r,i){void 0===r&&(r=1),e.push(t,n,i).then(function(){e.remove(e.length()-r-1,r)})}},196:function(e,t,n){"use strict";var r=n(52),i=n(7).default,o=n(50),a={hash:function(e){return a.bits2hex(r.hash.sha256.hash(e))},hashPW:function(e,t){return a.bits2hex(r.hash.sha256.hash(e+t))},getCurveName:function(e){var t;for(t in r.ecc.curves)if(r.ecc.curves.hasOwnProperty(t)&&r.ecc.curves[t]===e)return t;throw new Error("curve not existing")},getCurve:function(e){if("string"==typeof e&&"c"===e.substr(0,1)||(e="c"+e),r.ecc.curves[e])return r.ecc.curves[e];throw new Error("invalidCurve")},hex2bits:function(e){if(e instanceof Array)return e;if(i.isHex(e))return r.codec.hex.toBits(e);throw new o.InvalidHexError},bits2hex:function(e){return"string"==typeof e?e:r.codec.hex.fromBits(e)},sjclPacket2Object:function(e){var t={ct:a.bits2hex(e.ct),iv:a.bits2hex(e.iv)};return e.salt&&(t.salt=a.bits2hex(e.salt)),t},Object2sjclPacket:function(e){return"string"==typeof e.salt&&(e.salt=a.hex2bits(e.salt)),"string"==typeof e.iv&&(e.iv=a.hex2bits(e.iv)),"string"==typeof e.ct&&(e.ct=a.hex2bits(e.ct)),r.json.encode(e)}};e.exports=a},197:function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(7),i=n(31),o=n(3),a=(n.n(o),n(97)),s=n(17),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),c=n(239),l={type:"profile",removeEmpty:!0,encryptDepth:1},f=function(e){function t(t,n){var a=e.call(this)||this;return a.checkProfile=function(){var e=c.validate("profile",a.securedData.contentGet());if(e)throw e},a.getID=function(){if(a.id)return a.isPublicProfile?"public-"+a.id:"private-"+a.id},a.sign=function(e,t){if(!a.isPublicProfile)throw new Error("please encrypt private profiles!");return a.securedData.sign(e).then(function(e){return{content:a.securedData.contentGet(),meta:e}}).nodeify(t)},a.signAndEncrypt=function(e,t){if(a.isPublicProfile)throw new Error("no encrypt for public profiles!");return a.securedData.signAndEncrypt(e,t)},a.updated=function(){return a.securedData.updated()},a.changed=function(){return a.securedData.isChanged()},a.setFullProfile=function(e){a.securedData.contentSet(e)},a.setAttribute=function(e,t){return a.securedData.contentSetAttr(e,t),o.resolve()},a.removeAttribute=function(e){a.securedData.contentRemoveAttr(e)},a.getFull=function(){return a.securedData.contentGet()},a.getAttribute=function(e){return r.default.deepGet(a.securedData.contentGet(),e)},n=n||{},a.isPublicProfile=!0===n.isPublicProfile,a.securedData=new i.SecuredData(t.content,t.meta,l,!0),a.checkProfile(),t.profileid&&(a.id=t.profileid),a}return u(t,e),t}(s.default);t.b=f;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t}(Object(a.a)({cacheName:"profile",getID:function(e){return e.signKey+"-"+e.meta._signature},download:function(){throw new Error("profile get by id is not implemented")},load:function(e){var t=e.content,n=e.meta,r=e.isPublic,a=e.signKey,s=r?new i.SecuredData(t,n,l,!0):i.default.load(t,n,l);return o.all([s.verifyAsync(a),r?null:s.decrypt()]).then(function(){return{profile:{content:s.contentGet(),meta:s.metaGet()},options:{signKey:a,isPublic:r}}})},restore:function(e){return new f(e.profile,e.options)}}))},205:function(e,t,n){"use strict";var r=n(14),i=n(26),o=function(){function e(){var e=this;this.config={},this.loadToggles=function(){return r.default.definitlyEmit("featureToggles",{}).then(function(t){return t.toggles?e.config=t.toggles:null})},i.default.bootLogin().then(function(){return e.loadToggles()}),i.default.awaitLogin().then(function(){return e.loadToggles()})}return e.prototype.isFeatureEnabled=function(e){return!!this.config.hasOwnProperty(e)&&!1!==this.config[e]},e.prototype.getFeatureConfig=function(e){return this.config[e]},e}();t.a=new o},218:function(e,t){function n(e){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+e+"'.")})}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=218},220:function(e,t,n){"use strict";var r=n(3),i=(n.n(r),n(14)),o=n(37),a=n(7),s=n(16),u=n(32),c=6048e5,l=s("whispeer:keyStore"),f=20,d=function(){function e(){var e=this;this.MAXCACHETIME=c,this.cleanCache=function(){return e.keyCache.all().each(function(t){var n=JSON.parse(t.data);n.removeAfter<(new Date).getTime()&&(l("remove by time: "+n.removeAfter),e.keyCache.delete(t.id.split("/")[1]))})},this.removeByObjectId=function(t,n){return e.keyCache.all().each(function(r){var i=JSON.parse(r.data);if(n===i.objectID&&t!==i.key.realid)return l("remove by object id: "+n),e.keyCache.delete(e.idTransform(t))})},this.loadKeys=function(e,t){return r.try(function(){return 0===e.filter(function(e){return!u.upload.isKeyLoaded(e)}).length?e:i.default.definitlyEmit("key.getMultiple",{loaded:[],realids:e}).thenReturn(e)}).nodeify(t)},this.getKey=function(t,n){if("string"!=typeof t)throw new Error("not a valid key realid: "+t);return u.upload.isKeyLoaded(t)?r.resolve().nodeify(n):(l("loading key: "+t),e.keyCache.get(e.idTransform(t)).then(function(n){n.data.removeAfter<(new Date).getTime()&&(l("Remove Key from Cache "+t),e.keyCache.delete(t)),u.upload.addKey(n.data.key)}).catch(function(){return l("key cache miss: "+t),e.delayAsync(t)}).nodeify(n))},this.cacheKey=function(t,n,r){return r=Math.min(r,c),e.removeByObjectId(t,n).then(function(){var i=u.upload.getExistingKey(t);if(i)return e.keyCache.store(e.idTransform(t),{key:i,objectID:n,removeAfter:(new Date).getTime()+r});l("Could not cache key yet "+t)})},window.setTimeout(this.cleanCache,3e4),window.setInterval(this.cleanCache,6e5),this.keyCache=new o.a("keys"),this.delay=a.default.delayMultiple(f,this.loadKeys),this.delayAsync=r.promisify(this.delay)}return e.prototype.idTransform=function(e){return e},e}();t.a=new d},235:function(e,t,n){"use strict";var r=n(52);e.exports={getCurveName:function(e){var t;for(t in r.ecc.curves)if(r.ecc.curves.hasOwnProperty(t)&&r.ecc.curves[t]===e)return t;throw"curve not existing"},getCurve:function(e){if("string"==typeof e&&"c"===e.substr(0,1)||(e="c"+e),r.ecc.curves[e])return r.ecc.curves[e];throw new Error("invalid curve")},isHex:function(e){return e&&"string"==typeof e&&!!e.match(/^[A-Fa-f0-9]*$/)},hex2bits:function(e){return e instanceof Array?e:r.codec.hex.toBits(e)},bits2hex:function(e){return"string"==typeof e?e:r.codec.hex.fromBits(e)}}},236:function(e,t,n){"use strict";var r=function(){function e(e,t){this.name=e,t&&function(e,t){Object.getOwnPropertyNames(t).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}(this,t),Object.freeze&&Object.freeze(this)}return e.prototype.toString=function(){return"|"+this.name+"|"},e}(),i=function(){function e(e){Array.isArray(e)?e.forEach(function(e){this[e]=new r(e)},this):Object.keys(e).forEach(function(t){this[t]=new r(t,e[t])},this)}return e.prototype.toString=function(e){if(this.contains(e))return e.toString();throw new Error("symbol not part of this enum")},e.prototype.fromString=function(e){if("|"===e.substr(0,1)&&"|"===e.substr(-1,1)){var t=this[e.substring(1,e.length-1)];if(t instanceof r)return t}return null},e.prototype.symbols=function(){var e=this;return Object.keys(this).map(function(t){return e[t]})},e.prototype.symbolPosition=function(e){return this.symbols().indexOf(e)},e.prototype.contains=function(e){return this[e.name]===e},e}();t.a=i},238:function(e,t,n){"use strict";var r=n(3),i=n(120),o=n(36).default;e.exports=function(){var e;return i.awaitLoading().then(function(){return e=i.getAllFriendShipKeys(),o.upload.preLoadMultiple(e)}).then(function(){var t=e.filter(function(e){return!o.upload.isKeyLoaded(e)});return 0===t.length||t.reduce(function(e,t){return e.then(function(){return function(e,t){var n;return r.try(function(){return n=t.getUserForKey(e),t.removeFriend(n)}).then(function(){return t.friendship(n)}).then(function(){console.log("fixed invalid key: "+e)})}(t,i)})},r.resolve())}).then(function(){return!0})}},239:function(e,t,n){"use strict";!function(){var t,r={},i={addAttribute:function(e,t){},register:function(e,t){if(r[e])throw new Error("double registered validations: "+e);r[e]=t},validate:function(e,t){if(r[e]){var n=function(e,t){if(!e)throw new Error("unregistered validation")}(r[e]);return n&&console.error(n),n}throw new Error("unregistered validation: "+e)}},o=[];o.push(n(382)),o.push(n(7)),o.push(n(383)),o.push(n(384)),o.push(n(385)),o.push(n(386)),o.push(n(387)),o.push(n(388)),o.push(n(389)),function(e,n,r,o,a,s,u,c,l){t=n,i.register("profile",r),i.register("profileEncrypted",o),i.register("post",a),i.register("message",s),i.register("topic",u),i.register("topicCreate",c),i.register("circle",l)}.apply(null,o),e.exports=i}()},240:function(e,t,n){"use strict";function r(e,t,n){return l.resolve(t).map(s.parseDecimal).map(function(e){if(!g.getUserFriendShipKey(e))throw new Error("no friend key for user: "+e);return g.getUserFriendShipKey(e)}).map(function(t){return d.sym.symEncryptKey(e,t).thenReturn(t)}).nodeify(n)}function i(e){return d.sym.generateKey(null,"CircleKey").then(function(e){var t=n(12).default.getOwn().getMainKey();return d.sym.symEncryptKey(e,t).thenReturn(e)}).nodeify(e)}function o(e){var t=new b(e),n=t.getID();if(!y[n])return y[n]=t,m.push(t),v.push(t.data),t}var a,s=n(7).default,u=n(17),c=n(31).default,l=n(3),f=n(14).default,d=n(36).default,h=n(27),p=n(48).default,g=n(120),y={},m=[],v=[],b=function(e){var t=e.id,o=this,a=[],h=c.load(e.content,e.meta,{type:"circle"}),g=h.metaAttr("users").map(s.parseDecimal);this.getID=function(){return t},this.getUserIDs=function(){return g},this.hasUser=function(e){return-1!==g.indexOf(s.parseDecimal(e))},this.getKey=function(){return h.metaAttr("circleKey")},this.remove=function(e){return p.removeCircle().then(function(){return f.emit("circle.delete",{remove:{circleid:t}})}).then(function(){var e=y[t];delete y[t],s.removeArray(m,e),s.removeArray(v,e.data)}).nodeify(e)},this.setUser=function(e,u){var c,p,y=h.metaAttr("circleKey"),m=!1;return l.try(function(){return e=e.map(s.parseDecimal),(m=s.arraySubtract(g,e).length>0)?i():y}).then(function(e){return c=e,m?d.sym.symEncryptKey(y,c).thenReturn(c):c}).then(function(t){return m?r(t,e):r(t,s.arraySubtract(e,g))}).then(function(t){p=t,h.metaSet({users:e,circleKey:c});var r=n(12).default;return h.getUpdatedData(r.getOwn().getSignKey())}).then(function(e){var n={id:t,content:e.content,meta:e.meta};return m?(n.decryptors=d.upload.getDecryptors([y],[c]),n.key=d.upload.getKey(c)):n.decryptors=d.upload.getDecryptors([c],p),f.emit("circle.update",{update:n})}).then(function(){if(g=e,a=a.filter(function(t){return e.indexOf(t.id)>-1}),o.data.persons=a,o.data.userids=g,m){return n(12).default.getOwn().uploadChangedProfile()}}).then(function(){return o.loadPersons()}).nodeify(u)},this.removePersons=function(e,t){e=e.map(s.parseDecimal).filter(function(e){return g.indexOf(e)>-1});var n=g.filter(function(t){return-1===e.indexOf(t)});this.setUser(n,t)},this.addPersons=function(e,t){return l.resolve(e).bind(this).filter(function(e){return-1===g.indexOf(e)}).then(function(e){this.setUser(e.concat(g),t)})},this.load=function(e){var r=n(12).default;return l.all([h.decrypt(),h.verify(r.getOwn().getSignKey(),void 0,t)]).spread(function(e){d.security.addEncryptionIdentifier(h.metaAttr("circleKey")),o.data.name=e.name}).nodeify(e)},this.loadPersons=function(e,t){return t=t||20,t=Math.min(s.parseDecimal(t),20),a.length>=g.length?l.resolve().nodeify(e):l.try(function(){var e=a.map(function(e){return e.id}),r=g.filter(function(t){return-1===e.indexOf(t)});return n(12).default.getMultiple(r.slice(0,t))}).map(function(e){return a.push(e.data),e.loadBasicData().thenReturn(e)}).nodeify(e)},this.data={id:t,userids:g,name:"",image:"assets/img/circle.png",persons:a},u.extend(this)},w={data:{loaded:!1,loading:!1,circles:v},get:function(e){return y[e]},inWhichCircles:function(e){return e=s.parseDecimal(e),m.filter(function(t){return t.hasUser(e)})},create:function(e,t){return t=(t||[]).map(s.parseDecimal),i().then(function(i){return r(i,t).then(function(){var r=n(12).default.getOwn(),o=r.getMainKey();return c.createAsync({name:e},{users:t,circleKey:i},{type:"circle"},r.getSignKey(),o)}).then(function(e){var t=d.upload.getKey(i);return f.emit("circle.create",{circle:{key:t,content:e.content,meta:e.meta}})}).then(function(e){var t=o(e.created);return t.load().thenReturn(t)})})},reset:function(){y={},m=[],w.data.circles=v=[],w.data.loading=!1,w.data.loaded=!1},loadAll:function(e){return a||(a=l.try(function(){return w.data.loading=!1,h.awaitLoading()}).then(function(){return f.definitlyEmit("circle.all",{})}).then(function(e){if(e.circles)return e.circles;throw new Error("server did not return circles")}).map(function(e){var t=o(e);return l.fromCallback(function(e){t.load(e)})}).then(function(){w.data.loading=!1,w.data.loaded=!0,w.notify("","loaded")})),a.nodeify(e)}};u.extend(w),e.exports=w},241:function(e,t,n){"use strict";function r(e){var t=!1;if(0===e.indexOf("num::")&&(t=!0,e=e.substr(5)),e.length%128!=2)throw new c.InvalidDataError("padding size invalid");var n=e.indexOf("::");if(-1===n)throw new c.InvalidDataError("no padding seperator found");var r=e.substr(n+2);return t?u.parseDecimal(r):r}function i(e){u.objectEach(e,function(t,n){"object"===(void 0===n?"undefined":o(n))?i(n):"string"==typeof n&&(e[t]=function(e){for(;"string"==typeof e&&e.lastIndexOf("::")>-1;)e=r(e);return e}(n))})}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=n(48).default,s=n(3),u=n(7).default,c=n(50);e.exports=function(){return s.try(function(){var e=a.getContent();return i(e),u.deepEqual(e,a.getContent())?s.resolve(!0):(a.setContent(e),a.uploadChangedData().thenReturn(!0))})}},242:function(e,t,n){"use strict";var r=n(3);e.exports=function(e,t){return r.try(function(){}).then(function(){return!0}).nodeify(t)}},26:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"SessionService",function(){return d});var r=n(3),i=(n.n(r),n(131)),o=n(17),a=n(37),s=n(36),u=n(49),c=n(87),l=n(7),f=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sid="",t.loggedin=!1,t.sessionStorage=Object(c.a)("whispeer.session"),t.loginPromise=new r(function(e){t.loginResolve=e}),t.saveSession=function(){t.sessionStorage.set("sid",t.sid),t.sessionStorage.set("userid",t.userid),t.sessionStorage.set("loggedin",!0)},t.setLoginData=function(e,n){t.sid=e,t.userid=parseInt(n,10),t.loggedin=!0,t.loginResolve()},t.awaitLogin=function(){return t.loginPromise},t.setPassword=function(e){s.default.security.setPassword(e),t.sessionStorage.set("password",e)},t.bootLogin=l.default.cacheResult(function(){return t.loadLogin()}),t.loadLogin=function(){return t.sessionStorage.awaitLoading().then(function(){var e="true"===t.sessionStorage.get("loggedin")&&t.sessionStorage.get("password");return t.sessionStorage.get("business")&&!Object(u.c)()&&Object(u.a)(),e?(t.notify(null,"login"),t.setPassword(t.sessionStorage.get("password")),t.setLoginData(t.sessionStorage.get("sid"),t.sessionStorage.get("userid")),!0):t.clear().thenReturn(!1)})},t.getSID=function(){return t.sid},t.getUserID=function(){return t.userid},t.isOwnUserID=function(e){return parseInt(e,10)===t.userid},t.clear=function(){return t.notify(null,"logout"),r.all([i.a.clear(),t.sessionStorage.clear(),r.resolve(a.a.deleteDatabase())].map(function(e){return e.reflect()}))},t.logout=function(){t.clear().finally(u.f)},t.isLoggedin=function(){return t.loggedin},t}return f(t,e),t}(o.default);t.default=new d},27:function(e,t,n){"use strict";function r(){a.security.blockPrivateActions();var e=c.resolve().then(function(){return function(e){s.enabled(l)&&console.time("init: "+e)}("runInitCallbacks"),c.all(f.map(function(e){return e()}))}).then(function(){!function(e){s.enabled(l)&&console.timeEnd("init: "+e)}("runInitCallbacks"),a.security.allowPrivateActions();return n(379)(),i.notify("","initDone"),null});return e.catch(o.criticalError),e}console.warn("Whispeer startup at "+Date.now()),console.time("Spinner on Home");var i,o=n(34).errorServiceInstance,a=n(32),s=n(16),u=n(17),c=n(3),l="whispeer:initService",f=[],d=n(26).default.awaitLogin().then(function(){return r()});u.extend(i={awaitLoading:function(){return d},registerCallback:function(e){f.push(e)}}),e.exports=i},276:function(e,t,n){function r(e){var t=i[e];return t?n.e(t[1]).then(function(){return n(t[0])}):Promise.reject(new Error("Cannot find module '"+e+"'."))}var i={"../pages/blocked-users/blockedUsers.module.ngfactory":[436,6],"../pages/contact-requests/contact-requests.module.ngfactory":[437,9],"../pages/contacts/contacts.module.ngfactory":[438,3],"../pages/home/home.module.ngfactory":[439,5],"../pages/login/login.module.ngfactory":[440,10],"../pages/messages/add/add.module.ngfactory":[441,4],"../pages/messages/details/details.module.ngfactory":[442,8],"../pages/messages/messages.module.ngfactory":[443,1],"../pages/new-message/new-message.module.ngfactory":[444,0],"../pages/profile/profile.module.ngfactory":[445,2],"../pages/sales/sales.module.ngfactory":[446,11],"../pages/settings/settings.module.ngfactory":[447,7]};r.keys=function(){return Object.keys(i)},r.id=276,e.exports=r},295:function(e,t,n){"use strict";var r=n(3),i=(n.n(r),n(7)),o=n(88),a=n(64),s=n(131),u=n(96),c=n(310),l=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},f={encrypt:!0,extraInfo:{}},d=new u.a(5e5);d.start();var h=function(){function e(t,n){var r=this;this.file=t,this.getProgress=function(){return r.progress.getProgress()},this.uploadAndEncryptPreparedBlob=function(e,t){return r.progress.addDepend(t.uploadProgress),r.progress.addDepend(t.encryptProgress),d.enqueue(t.getSize(),function(){return t.encryptAndUpload(e)})},this.uploadPreparedBlob=function(e){return r.progress.addDepend(e.uploadProgress),e.upload()},this.upload=function(e){if(!r.blob)throw new Error("usage error: prepare was not called!");return c.a.enqueue(1,function(){return console.info("Uploading blob"),r.options.encrypt?r.uploadAndEncryptPreparedBlob(e,r.blob):r.uploadPreparedBlob(r.blob)}).then(function(e){if(r.file.originalUrl){var t=Object(a.b)(r.file.originalUrl);return s.a.moveFileToBlob(t.directory,t.name,r.blob.getBlobID()).then(function(){return e})}return e})},this.prepare=i.default.cacheResult(function(){return e.blobToDataSet(r.blob).then(function(e){return e.content=l({},e.content,r.getInfo()),e})}),this.getInfo=function(){return l({name:r.file.name,size:r.file.size,type:r.file.type},r.options.extraInfo)},this.getFile=function(){return r.file},this.getName=function(){return r.file.name},this.progress=new o.a,this.blob=a.a.createBlob(t),this.options=n||f}return e.blobToDataSet=function(e){return r.all([e.preReserveID(),e.getHash()]).spread(function(t,n){return{blob:e,content:{blobHash:n},meta:{blobID:t}}})},e.fileCallback=function(e){return function(t){e(Array.prototype.slice.call(t.target.files));try{t.target.value=null}catch(e){console.log(e)}}},e}();t.a=h},297:function(e,t,n){"use strict";function r(e,t,n){var i={};if(void 0===t||void 0===n)throw new Error("dafuq");return u.default.objectEach(t,function(t,o){n[t]&&(void 0!==o.encrypt?(!o.encrypt||o.visibility.indexOf(e)>-1)&&(i[t]=n[t]):i[t]=r(e,o,n[t]))}),i}function i(e,t){var n={};if(void 0===e||void 0===t)throw new Error("dafuq");return u.default.objectEach(e,function(e,r){t[e]&&(void 0!==r.encrypt?r.encrypt||(n[e]=t[e]):n[e]=i(r,t[e]))}),n}function o(e,t,n){return void 0===n&&(n=!1),h.a.load(x({},e,{isPublic:n,signKey:t}))}var a=n(34),s=n(14),u=n(7),c=n(3),l=n(313),f=n(26),d=n(64),h=n(197),p=n(48),g=n(36),y=n(50),m=n(240),v=n(390),b=new(function(){function e(){var e=this;this.alwaysAvailableFilter=["allfriends"],this.getFiltersByID=function(t){return c.resolve(t).map(e.getFilterByID.bind(e))}}return e.prototype.alwaysFilterToKey=function(e){var t=n(12).default;switch(e){case"allfriends":return t.getOwn().getFriendsKey();case"everyone":throw new Error("should never be here");default:throw new y.InvalidFilter("unknown always value")}},e.prototype.circleFilterToKey=function(e){return c.try(function(){return m.loadAll()}).then(function(){return m.get(e).getKey()})},e.prototype.userFilterToKey=function(e){return c.try(function(){return n(12).default.get(e)}).then(function(e){return e.getContactKey()})},e.prototype.friendsFilterToKey=function(e){return c.try(function(){return n(12).default.get(e)}).then(function(e){return e.getFriendsKey()})},e.prototype.filterToKeys=function(e,t){var r=this;return c.try(function(){var t=n(12).default,i=e.map(function(e){var t=e.split(":");switch(t[0]){case"friends":return r.friendsFilterToKey(t[1]);case"always":return r.alwaysFilterToKey(t[1]);case"circle":return r.circleFilterToKey(t[1]);case"user":return r.userFilterToKey(t[1]);default:throw new y.InvalidFilter("unknown group")}});return i.push(t.getOwn().getMainKey()),c.all(i)}).nodeify(t)},e.prototype.getCircleByID=function(e){return m.loadAll().then(function(){var t=m.get(e).data;return{name:t.name,id:"circle:"+t.id,sref:"app.circles.show({circleid: "+t.id+"})",count:t.userids.length}})},e.prototype.getFriendsFilterByID=function(e){return n(12).default.get(e).then(function(e){return{name:v.getLocalizedString("directives.friendsOf",{name:e.data.name}),id:"friends:"+e.data.id,sref:"app.user({identifier: "+e.data.id+"})"}})},e.prototype.getAlwaysByID=function(e){var t=n(12).default;if("allfriends"!==e)throw new Error("Invalid Always id");var r=t.getOwn().getFriendsKey();return{name:v.getLocalizedString("directives.allfriends"),id:"always:"+e,sref:"app.friends",count:g.default.upload.getKeyAccessCount(r)-1}},e.prototype.getFilterByID=function(e){var t=this;return c.try(function(){var n=e.indexOf(":"),r=e.substr(0,n+1),i=e.substr(n+1);return"always:"===r?t.getAlwaysByID(i):"circle:"===r?t.getCircleByID(i):"friends:"===r?t.getFriendsFilterByID(i):void 0})},e.prototype.getAllFilters=function(){var e=this,t=this.alwaysAvailableFilter.map(function(t){return e.getAlwaysByID(t)});return m.loadAll().then(function(){var e=m.data.circles.map(function(e){return{name:e.name,id:"circle:"+e.id,count:e.userids.length}});return t.concat(e)})},e}()),w=n(49),D=n(65),_=n(220),I=n(97),k=n(31),S=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),E=n(32),P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return S(t,e),t}(Object(I.a)({cacheName:"signedKeys",getID:function(e){return e.signKey+"-"+e.signedKeys._signature},download:function(){throw new Error("profile get by id is not implemented")},load:function(e){var t=e.signKey,n=k.default.load(void 0,e.signedKeys,{type:"signedKeys"});return n.verifyAsync(t).then(function(){return n.metaGet()})},restore:function(e){var t=new k.SecuredData(void 0,e,{type:"signedKeys"},!0),n=t.metaAttr("friends"),r=t.metaAttr("crypt");return E.security.addEncryptionIdentifier(n),E.security.addEncryptionIdentifier(r),t}})),C=n(91);n.d(t,"a",function(){return H});var O=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),x=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},A=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},M=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},R=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]]);return n},j=n(27),L=n(32),T=n(120),F=["location","birthday","relationship","education","work","gender","languages"],K={location:{},birthday:{},relationship:{},education:[],work:{},gender:{},languages:[]},B=function(){function e(e,t,n){var o=this;this.profiles={private:[],me:null,public:null},this.addFriendState=new l.a,this.ignoreFriendState=new l.a,this.data={},this.update=function(e){var t=e.mail,n=e.migrationState,r=e.profiles;o.mutualFriends=e.mutualFriends,o.mail=t,o.migrationState=n,o.profiles=r,o.data.mutualFriends=o.mutualFriends,o.setNames(),F.map(function(e){o.data.advanced[e]=o.getAdvancedAttribute(e)})},this.setNames=function(){var e=o.getName();o.data.name=e.name,o.data.names=e,o.data.basic.shortname=e.shortname},this.isBlocked=function(){return p.default.isBlocked(o.id)},this.setData=function(){o.data={notExisting:!1,user:o,id:o.id,trustLevel:0,signatureValid:!0,fingerprint:L.format.fingerPrint(o.signKey),addFriendState:o.addFriendState.data,ignoreFriendState:o.ignoreFriendState.data,me:o.isOwn(),other:!o.isOwn(),online:T.onlineStatus(o.getID())||0,basic:{age:"?",location:"?",mutualFriends:[],url:"user/"+o.nickname,image:"assets/img/user.png"},advanced:{}}},this.attachListener=function(){o.isOwn()?o.friendsKey=o.signedKeys.metaAttr("friends"):T.awaitLoading().then(function(){T.didOtherRequest(o.id)&&(o.friendsKey=o.signedKeys.metaAttr("friends")),T.didIRequest(o.id)&&(o.friendShipKey=T.getUserFriendShipKey(o.id))}),T.listen(function(e){o.data.online=e},"online:"+o.getID()),T.awaitLoading().then(function(){o.data.added=T.didIRequest(o.getID()),o.data.isMyFriend=T.areFriends(o.getID()),T.listen(function(){o.data.added=T.didIRequest(o.getID()),o.data.isMyFriend=T.areFriends(o.getID())})}),p.default.listen(function(){return o.setNames()},"updated")},this.generateNewFriendsKey=function(){var e;return c.try(function(){if(!o.isOwn())throw new Error("not my own user");return L.sym.generateKey(null,"friends")}).then(function(t){e=t;var n=T.getAllFriendShipKeys().map(function(t){return L.sym.symEncryptKey(e,t)});return c.all([c.all(n),L.sym.symEncryptKey(e,o.mainKey),L.sym.symEncryptKey(o.friendsKey,e)])}).then(function(){return o.signedKeys.metaSetAttr("friends",e),o.signedKeys.getUpdatedData(o.signKey)}).then(function(t){return o.friendsKey=e,{updatedSignedKeys:t,newFriendsKey:e}})},this.setFriendShipKey=function(e){o.friendShipKey||(o.friendShipKey=e)},this.getProfileAttribute=function(e){if(o.profiles.me)return o.profiles.me.getAttribute(e);var t=o.profiles.private.concat([o.profiles.public]).map(function(t){return t.getAttribute(e)}).filter(function(e){return void 0!==e&&""!==e});return 0===t.length?"":(t.sort(function(e,t){return"object"==typeof e&&"object"==typeof t?Object.keys(t).length-Object.keys(e).length:0}),t[0])},this.rebuildProfiles=function(){var e,t;return c.try(function(){if(!o.isOwn())throw new Error("update on another user failed");return t=p.default.getBranch("privacy"),e=function(e){var t=[];return F.forEach(function(n){e[n].encrypt&&(t=t.concat(e[n].visibility))}),e.basic.firstname.encrypt&&(t=t.concat(e.basic.firstname.visibility)),e.basic.lastname.encrypt&&(t=t.concat(e.basic.lastname.visibility)),u.default.arrayUnique(t)}(t),b.filterToKeys(e)}).then(function(n){var a=o.profiles.me.getFull(),s=u.default.joinArraysToObject({name:e,key:n.slice(0,n.length-1)}),l=new h.b({content:i(t,a)},{isPublicProfile:!0}).sign(o.getSignKey()),f=s.map(function(e){return new h.b({content:r(e.name,t,a)}).signAndEncrypt(o.getSignKey(),e.key)});return c.all([l,c.all(f)])}).spread(function(e,t){return{pub:e,priv:t}})},this.setMail=function(e,t){return e===o.mail?c.resolve().nodeify(t):s.default.emit("user.mailChange",{mail:e}).then(function(){o.mail=e}).nodeify(t)},this.uploadChangedProfile=function(e){return c.try(function(){return c.all([o.rebuildProfiles(),o.profiles.me.signAndEncrypt(o.getSignKey(),o.getMainKey())])}).spread(function(e,t){return e.me=t,s.default.emit("user.profile.update",e)}).then(function(){return o.profiles.me.updated(),o.loadBasicData()}).nodeify(e)},this.setProfileAttribute=function(e,t){return o.profiles.me.setAttribute(e,t)},this.removeProfileAttribute=function(e){return o.profiles.me.removeAttribute(e)},this.getFingerPrint=function(){return L.format.fingerPrint(o.getSignKey())},this.setAdvancedProfile=function(e,t){return c.resolve(F).map(function(t){return o.profiles.me.setAttribute(t,e[t])}).nodeify(t)},this.verifyFingerPrint=function(e){return c.try(function(){if(e!==L.format.fingerPrint(o.getSignKey()))throw new Error("wrong code");return C.default.verifyUser(o)}).then(function(){o.data.trustLevel=2})},this.createBackupKey=function(){var e;return c.try(function(){return j.awaitLoading()}).then(function(){return L.sym.createBackupKey(o.mainKey)}).then(function(t){return e=t.outerKey,s.default.emit("user.backupKey",{innerKey:t.innerKey,decryptors:t.decryptors})}).then(function(t){if(t.error)throw new Error("server error");return L.format.base32(e)})},this.getTrustLevel=function(){var e=C.default.getKeyData(o.getSignKey());return e.isOwn()?-1:e.isVerified()?2:e.isWhispeerVerified()||e.isNetworkVerified()?1:0},this.changePassword=function(e,t){return c.try(function(){if(!o.isOwn())throw new Error("not my own user");return c.all([L.security.makePWVerifiable({main:o.mainKey,sign:o.signKey},e),L.random.hex(16),L.sym.pwEncryptKey(o.mainKey,e),c.try(function(){return new c(function(e){var t=indexedDB.deleteDatabase("whispeerCache");t.onerror=e,t.onsuccess=e})})])}).spread(function(t,n,r){return s.default.emit("user.changePassword",{signedOwnKeys:t,password:{salt:n,hash:L.hash.hashPW(e,n)},decryptor:r})}).then(function(){f.default.setPassword(e)}).nodeify(t)},this.loadFullData=function(){return o.loadBasicData()},this.getFriends=function(e){return T.getUserFriends(o.getID(),e)},this.loadImage=function(){var e=o.getProfileAttribute("imageBlob");if(e)return d.a.getBlobUrl(e.blobid,e.type||"image/png",0).then(function(e){return Object(w.d)()?e.replace("file://",""):e}).then(function(e){o.data.basic.image=e}).catch(function(e){return a.default.criticalError(e)});o.data.basic.image="assets/img/user.png"},this.loadBasicData=function(){return o.data.trustLevel=o.getTrustLevel(),o.loadImage(),c.resolve()},this.setMigrationState=function(e,t){return s.default.emit("user.setMigrationState",{migrationState:e}).nodeify(t)},this.getMigrationState=function(){return c.resolve(o.migrationState)},this.isOwn=function(){return o.getID()===f.default.getUserID()},this.getNickOrMail=function(){return o.nickname||o.mail},this.getMainKey=function(){return o.mainKey},this.getSignKey=function(){return o.signKey},this.getCryptKey=function(){return o.cryptKey},this.getFriendShipKey=function(){return o.friendShipKey},this.getContactKey=function(){return o.friendShipKey||o.cryptKey},this.getFriendsKey=function(){return o.friendsKey},this.getID=function(){return parseInt(o.id,10)},this.getNickname=function(){return o.nickname},this.getMail=function(){return o.mail},this.getSearchName=function(){var e=o.getProfileAttribute("basic")||{},t=[o.getNickname()];return e.firstname&&t.push(e.firstname),e.lastname&&t.push(e.lastname),t.join(" ").toLowerCase()},this.getLongName=function(){var e=o.getProfileAttribute("basic")||{},t=o.getNickname();return e.firstname&&e.lastname?e.firstname+" "+e.lastname:e.firstname||e.lastname?e.firstname||e.lastname:t},this.getName=function(){var e=o.getProfileAttribute("basic")||{},t=o.getNickname();return o.isBlocked()?{name:t,originalName:o.getLongName(),searchName:o.getSearchName(),firstname:"",lastname:"",nickname:t,shortname:t}:{name:o.getLongName(),searchName:o.getSearchName(),firstname:e.firstname||"",lastname:e.lastname||"",nickname:t,shortname:e.firstname||e.lastname||t}},this.ignoreFriendShip=function(){o.ignoreFriendState.pending(),o.isOwn()?o.ignoreFriendState.failed():T.ignoreFriendShip(o.getID(),a.default.failOnError(o.ignoreFriendState))},this.acceptFriendShip=function(){o.addFriendState.pending(),o.isOwn()?o.addFriendState.failed():T.acceptFriendShip(o.getID(),a.default.failOnError(o.addFriendState))},this.isNotExistingUser=function(){return!1},this.removeAsFriend=function(){o.isOwn()?o.addFriendState.failed():T.removeFriend(o.getID(),a.default.criticalError)},this.addAsFriend=function(){o.addFriendState.pending(),o.isOwn()?o.addFriendState.failed():T.friendship(o.getID(),a.default.failOnError(o.addFriendState))},this.id=u.default.parseDecimal(e.id),this.mainKey=e.mainKey,this.signedKeys=t,this.signKey=this.signedKeys.metaAttr("sign"),this.cryptKey=this.signedKeys.metaAttr("crypt"),this.nickname=e.nickname;var g=e.mutualFriends,y=e.mail,m=e.migrationState,v=void 0===m?0:m;this.setData(),this.update({mutualFriends:g,mail:y,migrationState:v,profiles:n}),this.attachListener()}return e.prototype.getAdvancedAttribute=function(e){var t=this.getProfileAttribute(e);return"gender"===e&&"string"==typeof t?u.default.deepCopyObj({gender:t}):u.default.deepCopyObj(t||K[e],3)},e}(),U=function(e,t,n){return c.try(function(){return A(this,void 0,void 0,function(){var r,i,a,s,u;return M(this,function(l){switch(l.label){case 0:return r={public:null,private:null,me:null},n?[3,5]:e.profile.pub?(e.profile.pub.profileid=e.profile.pub.profileid||e.id,i=r,[4,o(e.profile.pub,t,!0)]):[3,2];case 1:i.public=l.sent(),l.label=2;case 2:return r.private=[],e.profile.priv&&e.profile.priv instanceof Array?(a=e.profile.priv,s=r,[4,c.resolve(a).map(function(e){return o(e,t)})]):[3,4];case 3:s.private=l.sent(),l.label=4;case 4:return[3,7];case 5:return u=r,[4,o(e.profile.me,t)];case 6:u.me=l.sent(),l.label=7;case 7:return[2,r]}})})})},N="Deleted user",H=function(){return function(e){this.isBlocked=function(){return!1},this.getID=function(){return-1},this.generateNewFriendsKey=function(){return c.reject(new Error("not my own user"))},this.isNotExistingUser=function(){return!0},this.loadBasicData=function(){return c.resolve()},this.loadFullData=function(){return c.resolve()},this.isOwn=function(){return!1},this.rebuildProfiles=function(){throw new Error("not implemented for NotExistingUser")},this.getFingerPrint=function(){throw new Error("not implemented for NotExistingUser")},this.createBackupKey=function(){throw new Error("not implemented for NotExistingUser")},this.getTrustLevel=function(){throw new Error("not implemented for NotExistingUser")},this.loadImage=function(){throw new Error("not implemented for NotExistingUser")},this.getMigrationState=function(){throw new Error("not implemented for NotExistingUser")},this.getNickOrMail=function(){throw new Error("not implemented for NotExistingUser")},this.getMainKey=function(){throw new Error("not implemented for NotExistingUser")},this.getSignKey=function(){throw new Error("not implemented for NotExistingUser")},this.getCryptKey=function(){throw new Error("not implemented for NotExistingUser")},this.getFriendShipKey=function(){throw new Error("not implemented for NotExistingUser")},this.getContactKey=function(){throw new Error("not implemented for NotExistingUser")},this.getFriendsKey=function(){throw new Error("not implemented for NotExistingUser")},this.getNickname=function(){throw new Error("not implemented for NotExistingUser")},this.getMail=function(){throw new Error("not implemented for NotExistingUser")},this.getName=function(){throw new Error("not implemented for NotExistingUser")},this.ignoreFriendShip=function(){throw new Error("not implemented for NotExistingUser")},this.acceptFriendShip=function(){throw new Error("not implemented for NotExistingUser")},this.removeAsFriend=function(){throw new Error("not implemented for NotExistingUser")},this.addAsFriend=function(){throw new Error("not implemented for NotExistingUser")},this.data={trustLevel:-1,notExisting:!0,basic:{shortname:N,image:"assets/img/user.png"},name:N,user:this},"number"==typeof e&&(this.data.id=e)}}(),z=function(e,t){return X.get(f.default.getUserID()).then(function(n){if(!n||n.getNickOrMail()!==t)throw new Error("user changed so no improvement update!");return c.all(e.map(function(e){return L.sym.symEncryptKey(e,n.getMainKey())}))}).then(function(){return s.default.emit("key.addFasterDecryptors",{keys:L.upload.getDecryptors(e)})})},q=function(e){var t=[];L.addImprovementListener(function(n){t.push(n),1===t.length&&c.delay(5e3).then(function(){var n=t;return t=[],z(n,e)}).catch(a.default.criticalError)})},V=function(e){return s.default.definitlyEmit("user.getMultiple",{identifiers:e}).then(function(e){return e.users})},G=u.default.delayMultiplePromise(c,1e3,V,20),W=u.default.delayMultiplePromise(c,50,V,10),J=function(e,t){var n=t.priv||[];return h.a.isLoaded(e+"-"+t.pub.meta._signature)&&n.reduce(function(t,n){return t&&h.a.isLoaded(e+"-"+n.meta._signature)},!0)},Z=function(e,t){if(t instanceof H||e.userNotExisting)return!1;var n=t.getID();if(f.default.isOwnUserID(n))return!1;var r=t.getSignKey(),i=e.signedKeys,o=e.profile,a=R(e,["signedKeys","profile"]);return!!P.isLoaded(r+"-"+i._signature)&&(!!J(r,o)&&(3===Object.keys(a).length&&(a.id===t.id&&a.nickname===t.nickname&&u.default.deepEqual(a.mutualFriends,t.mutualFriends))))},X=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t}(Object(D.c)({download:function(e,t){return s.default.awaitConnection().then(function(){return t?G(e):W(e)})},load:function(e,t){return c.resolve(t&&Z(e,t)?D.a:e)},restore:function(e,t){return t?t instanceof H&&e.userNotExisting?t:t instanceof B&&!e.userNotExisting?c.try(function(){return A(this,void 0,void 0,function(){var n,r,i,o,a,s,u;return M(this,function(c){switch(c.label){case 0:return n=t.getID(),r=f.default.isOwnUserID(n),i=t.getSignKey(),o=e.mutualFriends,a=e.mail,s=e.migrationState,[4,U(e,i,r)];case 1:return u=c.sent(),t.update({mutualFriends:o,mail:a,migrationState:s,profiles:u}),[2,t]}})})}):(console.warn("previous instance is not a user but current data is. Reloading"),Object(w.h)(),t):c.try(function(){return A(this,void 0,void 0,function(){var t,n,r,i,o,a;return M(this,function(s){switch(s.label){case 0:return e.userNotExisting?[2,new H(e.identifier)]:!0===e.error?[2,new H]:(t=u.default.parseDecimal(e.id),(n=f.default.isOwnUserID(t))&&function(e){var t=e.nickname,n=e.mainKey,r=e.signedKeys.sign;L.setKeyGenIdentifier(t),q(t),L.sym.registerMainKey(n),L.security.verifyWithPW(e.signedOwnKeys,{main:n,sign:r}),L.security.addEncryptionIdentifier(n),L.security.addEncryptionIdentifier(r),C.default.setOwnSignKey(r),c.all([_.a.getKey(r),_.a.getKey(n)]).then(function(){_.a.cacheKey(r,"user-sign-"+t,_.a.MAXCACHETIME),_.a.cacheKey(n,"user-main-"+t,_.a.MAXCACHETIME)})}(e),r=e.signedKeys.sign,i=e.nickname,n||C.default.addNewUsers({key:r,userid:t,nickname:i}),[4,P.load({signedKeys:e.signedKeys,signKey:r})]);case 1:return o=s.sent(),[4,U(e,r,n)];case 2:return a=s.sent(),[2,new B(e,o,a)]}})})})},shouldUpdate:function(e,t){return f.default.isOwnUserID(t.getID())?c.delay(5e3).thenReturn(!0):e===D.b.wake?c.delay(1e4).thenReturn(!0):c.resolve(!1)},getID:function(e){return e.id.toString()},cacheName:"user"}));t.b=X},309:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"MessagesPage",function(){return G}),n.d(t,"ɵ0",function(){return T}),n.d(t,"ɵ1",function(){return K}),n.d(t,"ɵ2",function(){return U}),n.d(t,"ɵ3",function(){return H});var r,i=n(0),o=n(135),a=n(79),s=n(3),u=(n.n(s),n(427)),c=(n.n(u),n(428)),l=n.n(c),f=n(129),d=n(90),h=n(130),p=n(117),g=n(136),y=n(314),m=n(295),v=n(34),b=n(193),w=n(192),D=n(121),_=n(124),I=n(311),k=n(7),S=n(312),E=n(64),P=n(205),C=n(49),O=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},x=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){e[e.NotRecording=0]="NotRecording",e[e.Recording=1]="Recording",e[e.Paused=2]="Paused"}(r||(r={}));var A=new u.TypeState.FiniteStateMachine(r.NotRecording);A.fromAny(r).to(r.Recording),A.fromAny(r).to(r.NotRecording),A.from(r.Recording).to(r.Paused);var M=100,R={width:2560,height:1440,maximumImagesCount:6},j=Object(C.c)()?15:10,L=function(){return window.device&&"iOS"===window.device.platform},T=L,F=function(){return new s(function(e,t){return window.FilePicker.pickFile(e,t,"public.item")}).then(function(e){return"file://"+e})},K=F,B=function(){return new s(function(e,t){return window.fileChooser.open(e,t)}).then(function(e){return"file://"+e})},U=B,N=function(){return L()?F():B()},H=N,z=new d.File,q=n(432),V=n(27),G=function(){function e(e,t,n,i,o,a,u,c,l,f,d){var h=this;this.navCtrl=e,this.actionSheetCtrl=t,this.platform=n,this.imagePicker=i,this.camera=o,this.translate=a,this.media=u,this.alertController=c,this.navParams=l,this.element=f,this.androidPermissions=d,this.messagesLoading=!0,this.stopRecordingPromise=s.resolve(),this.recordings=[],this.firstRender=!0,this.newMessageText="",this.moreMessagesAvailable=!0,this.inViewMessages=[],this.oldScrollFromBottom=0,this.inputFocus=!1,this.recordingInfo={UUID:"",duration:0,startTime:0,updateInterval:0},this.mutationListener=function(e){var t=h.getFirstInViewMessageId();if(!t||h.oldScrollFromBottom<15)return h.stabilizeScroll();var n=document.querySelector('[data-messageid="'+t+'"]');if(e.some(function(e){return[].slice.call(e.addedNodes).some(function(e){return 2&n.compareDocumentPosition(e)})}))return h.stabilizeScroll();console.warn("Only elements below newest messages have changed not updating viewport")},this.keyboardChange=function(){h.stabilizeScroll()},this.sendVoicemail=function(){var e=new S.a(h.recordings);h.resetRecordingState(),e.awaitLoading().then(function(){return e.getRecordings()}).map(function(e){var t=e.url,n=e.duration,r=Object(E.b)(t),i=r.directory,o=r.name;return z.moveFile(h.platform.is("ios")?"file://"+i:i,o,z.cacheDirectory,o).then(function(){return{url:""+z.cacheDirectory+o,duration:n}})}).map(function(e){var t=e.duration;return h.getFile(e.url).then(function(e){return new m.a(e,{encrypt:!0,extraInfo:{duration:t}})})}).then(function(e){h.sendMessage({text:"",voicemails:e})}).catch(function(e){console.error("Sending voicemail failed",e)})},this.sameBurst=function(e,t){return Object(I.a)(e,t)},this.sendMessageToChat=function(){if(h.isRecordingUIVisible())return h.isRecording()&&h.toggleRecording(),h.stopRecordingPromise.then(function(){return h.sendVoicemail()});h.sendMessage({text:h.newMessageText}),h.newMessageText="",document.querySelector("textarea").focus(),h.change()},this.getFile=function(e,t){return s.resolve(z.resolveLocalFilesystemUrl(e)).then(function(e){return new s(function(t,n){return e.file(t,n)})}).then(function(n){if(n.originalUrl=e,h.platform.is("ios")&&(n.localURL=e.replace("file://","http://"+window.location.host)),n.size>1e3*j*1e3)throw h.showFileTooBigWarning(),new Error("File too big, not sending.");return t&&(n.type=t),n})},this.takeImage=function(){h.camera.getPicture(h.cameraOptions).then(function(e){return h.getFile(e,"image/png")}).then(function(e){return new y.a(e)}).then(function(e){h.sendMessage({images:[e],text:""})})},this.toggleInputFocus=function(){return h.inputFocus=!h.inputFocus},this.showCameraShortcut=function(){return!h.inputFocus&&0===h.newMessageText.length},this.isRecordingUIVisible=function(){return!A.is(r.NotRecording)},this.isPlayback=function(){return A.is(r.Paused)&&h.recordingPlayer.isPlaying()},this.isRecording=function(){return A.is(r.Recording)},this.isPaused=function(){return A.is(r.Paused)},this.getRecordingDir=function(){return h.platform.is("ios")?z.tempDirectory.replace(/^file:\/\//,""):z.externalRootDirectory},this.getRecordingFileName=function(){var e=h.platform.is("ios")?"m4a":"aac";return h.getRecordingDir()+"recording_"+h.recordingInfo.UUID+"."+e},this.formatTime=function(e){var t=k.default.pad(Math.floor(e%60),2);return k.default.pad(Math.floor(e/60),2)+":"+t},this.getCurrentDuration=function(e){return e?0:A.is(r.Recording)?h.recordingInfo.duration:0},this.getDuration=function(e){return h.recordingPlayer.getDuration()+h.getCurrentDuration()},this.toggleRecording=function(){if(!h.stopRecordingPromise.isPending())return A.is(r.Recording)?void(h.stopRecordingPromise=s.resolve().delay(M).then(function(){A.go(r.Paused),h.recordingFile.stopRecord(),h.recordingFile.release(),h.recordingFile=null,h.recordings.push({url:h.getRecordingFileName(),estimatedDuration:h.recordingInfo.duration}),clearInterval(h.recordingInfo.updateInterval),h.recordingInfo.duration=0,h.recordingPlayer=new S.a(h.recordings),S.a.setPlaybackBlocked(!1)})):h.startRecording()},this.resetRecordingState=function(){h.recordingFile&&(h.recordingFile.release(),h.recordingFile=null),S.a.setPlaybackBlocked(!1),clearInterval(h.recordingInfo.updateInterval),h.recordingPlayer.reset(),h.recordingPlayer=new S.a([]),h.recordings=[],A.go(r.NotRecording)},this.discardRecording=function(){return h.resetRecordingState()},this.getPosition=function(){return h.recordingPlayer?h.recordingPlayer.getPosition():0},this.togglePlayback=function(){return h.recordingPlayer?h.recordingPlayer.toggle():null},this.presentActionSheet=function(){var e={text:h.translate.instant("topic.takePhoto"),icon:h.platform.is("ios")?null:"camera",handler:function(){h.takeImage()}},t={text:h.translate.instant("topic.selectGallery"),icon:h.platform.is("ios")?null:"image",handler:function(){s.resolve(h.imagePicker.getPictures(R)).map(function(e){return h.getFile(e,"image/png")}).map(function(e){return new y.a(e)}).then(function(e){h.sendMessage({images:e,text:""})})}},n={text:h.translate.instant("topic.selectFile"),icon:h.platform.is("ios")?null:"document",handler:function(){N().then(function(e){return h.getFile(e)}).then(function(e){return new m.a(e,{encrypt:!0,extraInfo:{}})}).then(function(e){h.sendMessage({files:[e],text:""})})}},r={text:h.translate.instant("general.cancel"),icon:h.platform.is("ios")?null:"close",role:"cancel"},i=P.a.isFeatureEnabled("chat.fileTransfer")?[e,t,n,r]:[e,t,r];h.actionSheetCtrl.create({buttons:i}).present()},this.isInView=function(e,t){var n=e.getBoundingClientRect().top-t;return n>0&&n<h.content.nativeElement.clientHeight},this.updateElementsInView=k.default.debounce(function(){var e=document.querySelector(".header").clientHeight,t=Array.prototype.slice.call(h.content.nativeElement.querySelectorAll(".messages__wrap"));h.inViewMessages=t.filter(function(t){return h.isInView(t,e)})},20),this.onScroll=function(){h.oldScrollFromBottom=h.scrollFromBottom(),h.updateElementsInView(),h.checkLoadMoreMessages()},this.scrollFromBottom=function(){var e=h.content.nativeElement;return h.realScrollHeight(e)-e.scrollTop},this.stabilizeScrollIfHeightChanged=function(e,t){var n=h.realScrollHeight(h.content.nativeElement);return n!==e&&(console.warn("Height changed from "+e+" to "+n),h.oldScrollFromBottom=t,h.stabilizeScroll(),!0)},this.checkHeightChange=function(e,t,n){s.delay(25).then(function(){!h.stabilizeScrollIfHeightChanged(e,t)&&n>0&&h.checkHeightChange(e,t,n-25)})},this.stabilizeScroll=function(){var e=h.content.nativeElement,t=h.realScrollHeight(e);e.scrollTop=t-h.oldScrollFromBottom,h.checkHeightChange(t,h.oldScrollFromBottom,h.platform.is("ios")?300:50)},this.getFirstInViewMessageId=function(){var e=h.inViewMessages[0];if(e)return e.getAttribute("data-messageid")},this.ionViewDidEnter=function(){},this.getPartners=function(){return h.chat?h.chat.getPartners():[]},this.getMessages=function(){return h.messages=h.chat?h.chat.getMessages().map(function(e){return _.b.getLoaded(e.id)}):[]},this.getBurstClass=function(e,t){var n=Object(I.a)(e,h.messages[t-1]),r=Object(I.a)(e,h.messages[t+1]);return n&&r?"burst--middle":n?"burst--last":r?"burst--first":"burst--last burst--first"},this.getMessageItemClass=function(e,t){return[e.isOwn()?"burst--me":"burst--other",h.getBurstClass(e,t)].join(" ")},this.onElementInView=function(e){var t=e.target;q.is(h.lastMessageElement)&&(h.markRead(),t.removeEventListener("scroll",h.onElementInView))},this.loadMoreMessages=function(){return console.warn("load more messages"),h.messagesLoading=!0,h.chat.loadMoreMessages().then(function(e){return h.messagesLoading=!1,e})},this.markRead=function(){setTimeout(function(){console.log("mark topic read",h.chat.getID()),h.chat.markRead().catch(v.default.criticalError)},0)},this.sendMessage=function(e){var t=e.text,n=e.images,r=void 0===n?[]:n,i=e.files,o=void 0===i?[]:i,a=e.voicemails,s=void 0===a?[]:a;if(0!==t.length||0!==r.length||0!==o.length||0!==s.length){var u=h.chat.sendMessage(t,{images:r,files:o,voicemails:s});h.chat.isDraft()&&u.then(function(){return Object(b.a)(h.navCtrl,"Messages",{chatID:h.chat.getID()},1,{animate:!1})}),h.chat.newMessage="",h.markRead()}},this.cameraOptions={quality:50,destinationType:this.camera.DestinationType.FILE_URI,sourceType:this.camera.PictureSourceType.CAMERA,encodingType:this.camera.EncodingType.JPEG,mediaType:this.camera.MediaType.PICTURE,allowEdit:!this.platform.is("ios"),correctOrientation:!0},this.recordingPlayer=new S.a([]),A.on(r.NotRecording,function(){h.recordingFile&&(h.recordingFile.release(),h.recordingFile=null)}),A.onExit(r.Paused,function(e){return h.recordingPlayer.reset(),!0}),document.addEventListener("pause",function(){A.is(r.Recording)&&h.toggleRecording()},!1),document.addEventListener("resume",function(){h.isRecordingUIVisible()&&(h.recordingPlayer=new S.a(h.recordings))}),this.resizeEvents=this.platform.is("ios")?["resize","native.keyboardshow","native.keyboardhide"]:["resize"]}return e.prototype.ngAfterViewInit=function(){var e=this;this.resizeEvents.forEach(function(t){return window.addEventListener(t,e.keyboardChange)}),this.content.nativeElement.addEventListener("scroll",this.onScroll),this.mutationObserver=new MutationObserver(this.mutationListener),this.mutationObserver.observe(this.content.nativeElement,{childList:!0,subtree:!0})},e.prototype.ngOnDestroy=function(){var e=this;this.resizeEvents.forEach(function(t){return window.removeEventListener(t,e.keyboardChange)}),this.content.nativeElement.removeEventListener("scroll",this.onScroll),this.mutationObserver.disconnect()},e.prototype.ionViewDidLeave=function(){A.is(r.NotRecording)||this.discardRecording(),S.a.activePlayer&&S.a.activePlayer.reset()},e.prototype.showRecordIcon=function(){return!!P.a.isFeatureEnabled("chat.voiceMail")&&0===this.newMessageText.length},e.prototype.showFileTooBigWarning=function(){this.alertController.create({title:this.translate.instant("topic.fileTooBigTitle"),subTitle:this.translate.instant("topic.fileTooBigDetail",{max_size:j}),buttons:["OK"]}).present()},e.prototype.startRecording=function(){var e=this;this.recordingFile||this.androidPermissions.requestPermissions([this.androidPermissions.PERMISSION.RECORD_AUDIO,this.androidPermissions.PERMISSION.WRITE_EXTERNAL_STORAGE]).then(function(t){t.hasPermission&&(A.go(r.Recording),e.recordingInfo.UUID=l()(),e.recordingFile=e.media.create(e.getRecordingFileName()),e.recordingInfo.startTime=Date.now(),e.recordingFile.startRecord(),clearInterval(e.recordingInfo.updateInterval),e.recordingInfo.updateInterval=window.setInterval(function(){e.recordingInfo.duration=(Date.now()-e.recordingInfo.startTime)/1e3},100),S.a.activePlayer&&S.a.activePlayer.pause(),S.a.setPlaybackBlocked(!0))})},e.prototype.realScrollHeight=function(e){return e.scrollHeight-e.clientHeight},e.prototype.checkLoadMoreMessages=function(){var e=this;if(!this.messagesLoading&&this.moreMessagesAvailable&&this.loadMoreMessages){this.content.nativeElement.scrollTop<1e3&&(this.messagesLoading=!0,setTimeout(function(){e.loadMoreMessages().then(function(t){e.moreMessagesAvailable=0!==t,e.messagesLoading=!1})},0))}},e.prototype.isPreviousMissing=function(e){var t=this.getMessages();if(t[0]===e||!e.getPreviousID())return!1;var n=t[t.indexOf(e)-1];return(!n||n.getClientID()!==e.getPreviousID())&&-1===t.findIndex(function(t){return t.getClientID()===e.getPreviousID()})},e.prototype.ngOnChanges=function(e){var t=e.chat;t&&t.currentValue&&""===this.newMessageText&&(this.newMessageText=t.currentValue.newMessage)},e.prototype.change=function(){var e=this;setTimeout(function(){e.chat&&(e.chat.newMessage=e.newMessageText);var t=e.footer.nativeElement.getElementsByTagName("textarea")[0];t.style.minHeight="0",t.style.height="0";var n=Math.max(30,Math.min(t.scrollHeight,112));t.style.minHeight=n+"px",t.style.height=n+"px",e.stabilizeScroll()},100)},e.prototype.goToDetails=function(){this.chat&&this.navCtrl.push("Chat Details",{chatID:this.chat.getID()})},e.prototype.goToProfile=function(e){this.chat||this.navCtrl.push("Profile",{userId:e})},e.prototype.ngOnInit=function(){var e=this;if(this.chatID=parseFloat(this.navParams.get("chatID")),this.chatID<0&&!D.b.isLoaded(this.chatID))return this.navCtrl.setRoot("Home"),void this.navCtrl.popToRoot();V.awaitLoading().then(function(){return w.a.getChat(e.chatID)}).then(function(t){e.chat=t,t.loadInitialMessages().then(function(){e.messagesLoading=!1,e.chat.markRead().catch(v.default.criticalError)})})},e.prototype.ngAfterViewChecked=function(){this.registerMarkReadListener()},e.prototype.registerMarkReadListener=function(){if(this.chat&&this.chat.isUnread()){var e=this.element.nativeElement.querySelector(".messages__burst:last-child .messages__wrap:last-child");e&&e!==this.lastMessageElement&&(this.lastMessageElement=e,q.is(e)?this.markRead():document.querySelector(".messages__list").addEventListener("scroll",this.onElementInView))}},O([Object(i.ViewChild)("content"),x("design:type",i.ElementRef)],e.prototype,"content",void 0),O([Object(i.ViewChild)("footer"),x("design:type",i.ElementRef)],e.prototype,"footer",void 0),e=O([Object(i.Component)({selector:"page-messages",templateUrl:"messages.html"}),x("design:paramtypes",[a.i,a.a,a.k,f.ImagePicker,h.Camera,p.TranslateService,o.Media,a.b,a.j,i.ElementRef,g.AndroidPermissions])],e)}()},31:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"SecuredData",function(){return c}),n.d(t,"ɵ0",function(){return l}),n.d(t,"ɵ1",function(){return f}),n.d(t,"ɵ2",function(){return d}),n.d(t,"ɵ3",function(){return h}),n.d(t,"ɵ4",function(){return p});var r=n(3),i=(n.n(r),n(7)),o=n(32),a=n(50),s=n(95),u=["_signature","_hashObject"],c=function(){return function(e,t,n,c){var l=this;if(this.blockDisallowedAttributes=function(e){if(e._contentHash||e._key||e._signature||e._version)throw new Error("content hash/key should not be provided by outside world")},this.hasContent=function(){return l._hasContent},this.getHash=function(){return l._updated.meta._ownHash},this.getKey=function(){return l.original.meta._key},this.sign=function(e,t){var n=i.default.deepCopyObj(l._updated.meta),a=s.hashVersion;return r.try(function(){if(n._version=1,n._type=l.type,n._hashVersion=a,l.attributesNotVerified.forEach(function(e){delete n[e]}),l._updated.paddedContent||l._updated.content)return o.hash.hashObjectOrValueHexAsync(l._updated.paddedContent||l._updated.content).then(function(e){return n._contentHash=e,delete n._ownHash,o.hash.hashObjectOrValueHexAsync(n)}).then(function(e){n._ownHash=e})}).then(function(){return o.sign.signObject(n,e,a)}).then(function(e){return n._signature=e,n}).nodeify(t)},this.getUpdatedData=function(e,t){return l.verify(e).then(function(){return l._hasContent?(o.security.addEncryptionIdentifier(l.original.meta._key),l.signAndEncrypt(e,l.original.meta._key)):l.sign(e)}).nodeify(t)},this.signAndEncrypt=function(e,t){if(!l._hasContent)throw new Error("can only sign and not encrypt");if(l.original.meta._key&&l.original.meta._key!==t)throw new Error("can not re-encrypt an old object with new key!");return o.hash.addPaddingToObject(l._updated.content,128).then(function(n){return l._updated.paddedContent=n,l._updated.meta._key=o.correctKeyIdentifier(t),r.all([o.sym.encryptObject(n,t,l.encryptDepth),l.sign(e)])}).spread(function(e,t){return l._updated.meta=t,{content:e,meta:t}})},this.hasType=function(e){return e===l.type||!(!l.alternativeType||l.alternativeType!==e)},this.verifyAsync=function(e,t){return r.resolve().then(function(){var n=i.default.deepCopyObj(l.original.meta);if(l.attributesNotVerified.forEach(function(e){delete n[e]}),!l.hasType(n._type))throw new a.SecurityError("invalid object type. is: "+n._type+" should be: "+l.type);"number"==typeof n._hashVersion&&(n._hashVersion=i.default.parseDecimal(n._hashVersion));var r=1;return n._hashVersion?r=n._hashVersion:n._v2&&"false"!==n._v2&&(r=2),o.sign.verifyObject(l.original.meta._signature,n,e,r,t)}).then(function(e){if(!e)throw alert("Bug: signature did not match ("+l.original.meta._type+") Please report this bug!"),new a.SecurityError("signature did not match "+l.original.meta._type);return l.verifyContentHash()}).then(function(){return!0})},this.verify=function(e,t,n){return l.verifyAsync(e,n).nodeify(t)},this.updated=function(){l.changed=!1},this._decrypt=function(){return l.decryptionPromise||(l.decryptionPromise=o.sym.decryptObject(l.original.encryptedContent,l.encryptDepth,void 0,l.original.meta._key).then(function(e){return l.decrypted=!0,l.original.paddedContent=e,l.original.content=o.hash.removePaddingFromObject(e,128),l._updated.content=i.default.deepCopyObj(l.original.content),l.verifyContentHash()})),l.decryptionPromise},this.decrypt=function(e){return r.resolve().then(function(){if(l._hasContent&&!l.decrypted)return l._decrypt()}).then(function(){if(l._hasContent)return l.original.content}).nodeify(e)},this.verifyContentHash=function(){return l._hasContent&&l.decrypted?r.try(function(){return o.hash.hashObjectOrValueHexAsync(l.original.paddedContent||l.original.content)}).then(function(e){if(e!==l.original.meta._contentHash)throw new a.SecurityError("content hash did not match")}):r.resolve()},this.isChanged=function(){return l.changed},this.isEncrypted=function(){return!l.decrypted},this.isDecrypted=function(){return l.decrypted},this.contentGet=function(){return i.default.deepCopyObj(l._updated.content)},this.metaGet=function(){return i.default.deepCopyObj(l._updated.meta)},this.metaHasAttr=function(e){return l._updated.meta.hasOwnProperty(e)},this.metaKeys=function(){return Object.keys(l._updated.meta).filter(function(e){return"_"!==e[0]})},this.metaAttr=function(e){return i.default.deepCopyObj(l._updated.meta[e])},this.contentSet=function(e){l._hasContent=l.changed=!0,l._updated.content=e},this.contentSetAttr=function(e,t){if("object"!=typeof l._updated.content)throw new Error("our content is not an object");l._updated.content[e]=t,l.changed=!0},this.contentRemoveAttr=function(e){if("object"!=typeof l._updated.content)throw new Error("our content is not an object");delete l._updated.content[e],l.changed=!0},this.metaSet=function(e){l.blockDisallowedAttributes(e),l.changed=!0,l._updated.meta=e},this.metaRemoveAttr=function(e){if("_"===e[0])throw new Error("private attributes should not be provided by outside world");l.changed=!0,delete l._updated.meta[e]},this.metaSetAttr=function(e,t){if("_"===e[0])throw new Error("private attributes should not be provided by outside world");l.changed=!0,l._updated.meta[e]=t},this.metaAdd=function(e,t){l.changed=i.default.deepSetCreate(l._updated.meta,e,t)},this.setParent=function(e){l._updated.meta._parent=e.getHash()},this.checkParent=function(e){if(l._updated.meta._parent!==e.getHash())throw new a.SecurityError("wrong parent. is: "+l._updated.meta._parent+" should be: "+e.getHash())},this.getRelationshipCounter=function(){return i.default.parseDecimal(l._updated.meta._sortCounter||0)},this.setAfterRelationShip=function(e){l._updated.meta._sortCounter=e.getRelationshipCounter()+1},this.checkAfter=function(e){if(l.getRelationshipCounter()<e.getRelationshipCounter())throw new a.SecurityError("wrong ordering. "+l.getRelationshipCounter()+" should be after "+e.getRelationshipCounter())},this.checkBefore=function(e){if(l.getRelationshipCounter()>e.getRelationshipCounter())throw new a.SecurityError("wrong ordering. "+l.getRelationshipCounter()+" should be before "+e.getRelationshipCounter())},!n||"string"!=typeof n.type)throw new Error("need a type for security!");this.type=n.type,this.alternativeType=n.alternativeType,this.encryptDepth=n.encryptDepth||0,this.attributesNotVerified=n.attributesNotVerified||[],this.attributesNotVerified.filter(function(e){return e.match(/^A-z0-9$/)}),this.attributesNotVerified=u.concat(this.attributesNotVerified),this.decrypted=c,this._hasContent=!0,this.original={meta:t||{}},void 0===e?this._hasContent=!1:c?this.original.content=e:this.original.encryptedContent=e,this._updated=i.default.deepCopyObj(this.original)}}(),l=function(e,t,n,i,o){var a,s;return s=r.fromCallback(function(r){a=g.create(e,t,n,i,o,r)}),{promise:s,data:a}},f=function(e,t,n,i,o){return r.fromCallback(function(r){g.create(e,t,n,i,o,r)})},d=function(e,t,n,i,o,a){var s=g.createRaw(e,t,n);return r.resolve().delay(1).then(function(){return s.signAndEncrypt(i,o)}).nodeify(a),s},h=function(e,t,n){return new c(e,t,n,!1)},p=function(e,t,n){return new c(e,t,n,!0)},g={createPromisified:l,createAsync:f,create:d,load:h,createRaw:p};t.default=g},310:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=new(n(96).a)(1);r.start()},311:function(e,t,n){"use strict";n.d(t,"c",function(){return i}),n.d(t,"b",function(){return a}),n.d(t,"a",function(){return c});var r=n(7),i=function(e,t){if(!e||!t)return!1;var n=new Date(r.default.parseDecimal(e.getTime())),i=new Date(r.default.parseDecimal(t.getTime()));return n.getDate()===i.getDate()&&(n.getMonth()===i.getMonth()&&n.getFullYear()===i.getFullYear())},o=function(e,t){return e.data.sender.id===t.data.sender.id},a=function(e,t){return e&&t&&e.getChunkID()===t.getChunkID()},s=function(e,t){return Math.abs(r.default.parseDecimal(e.getTime())-r.default.parseDecimal(t.getTime()))},u=function(e,t){return e.getPreviousID()===t.getClientID()||t.getPreviousID()===e.getClientID()},c=function(e,t){return a(e,t)&&o(e,t)&&u(e,t)&&i(e,t)&&s(e,t)<6e5}},312:function(e,t,n){"use strict";var r=n(3),i=(n.n(r),!1),o=function(){function e(e){var t=this;this.playing=!1,this.loaded=!1,this.recordings=[],this.recordPlayingIndex=0,this.loadingPromises=[],this.positionRAFListener=[],this.positionListener=function(){var e=t.getPosition();t.positionRAFListener.forEach(function(t){return t(e)}),t.isPlaying()&&window.requestAnimationFrame(t.positionListener)},this.onPositionUpdateRAF=function(e){return t.positionRAFListener.push(e)},this.seekTo=function(e){var n=e,r=t.recordings.findIndex(function(e){var t=e.duration;return n<t||(n-=t,!1)});-1!==r&&(t.recordPlayingIndex=r,t.recordings[t.recordPlayingIndex].audio.currentTime=n,t.positionListener(),t.isPlaying()&&(t.recordings.forEach(function(e,t){var n=e.audio;t!==r&&(n.pause(),n.currentTime=0)}),t.recordings[t.recordPlayingIndex].audio.play()))},this.awaitLoading=function(){return r.all(t.loadingPromises)},this.isLoaded=function(){return t.loaded},this.onEnded=function(){if(t.isPlaying()){if(t.recordPlayingIndex+=1,t.recordPlayingIndex>=t.recordings.length)return void t.reset();t.recordings[t.recordPlayingIndex].audio.play(),r.resolve().then(function(){})}},e.map(function(e){return t.addRecording(e.url,e.estimatedDuration)})}return e.prototype.play=function(){i||(e.activePlayer&&e.activePlayer.pause(),this.recordings[this.recordPlayingIndex].audio.play(),e.activePlayer=this,this.playing=!0,this.loaded=!0,this.positionListener())},e.prototype.pause=function(){this.recordings[this.recordPlayingIndex].audio.pause(),e.activePlayer=null,this.playing=!1},e.prototype.toggle=function(){this.playing?this.pause():this.play()},e.prototype.isPlaying=function(){return this.playing},e.prototype.isPaused=function(){return!this.playing},e.prototype.getDuration=function(e){return this.recordings.slice(0,e).reduce(function(e,t){return e+t.audio.duration||t.duration},0)},e.prototype.getPosition=function(){return this.getDuration(this.recordPlayingIndex)+this.recordings[this.recordPlayingIndex].audio.currentTime},e.prototype.reset=function(){this.recordings.forEach(function(e){var t=e.audio;t.pause(),t.currentTime=0}),this.recordPlayingIndex=0,e.activePlayer&&this!==e.activePlayer&&e.activePlayer.reset(),e.activePlayer=null,this.playing=!1},e.prototype.addRecording=function(e,t){var n=new Audio(e.replace("file://","")),i={url:e,audio:n,duration:t};n.addEventListener("ended",this.onEnded);var o=new r(function(e){return n.addEventListener("loadedmetadata",e)});this.loadingPromises.push(o),this.recordings.push(i)},e.prototype.destroy=function(){this.recordings.forEach(function(e){var t=e.audio,n=e.url;t.src="",t.load(),console.warn("TODO: delete file:",n)})},e.prototype.getRecordings=function(){return this.recordings.slice()},e.activePlayer=null,e.setPlaybackBlocked=function(e){return i=e},e}();t.a=o},313:function(e,t,n){"use strict";var r=new(n(236).a)(["INIT","PENDING","SUCCESS","FAILED"]),i=function(){function e(){this._state=r.INIT,this.data={init:!0,pending:!1,success:!1,failed:!1}}return e.prototype._turnOneDataTrue=function(){r.symbols().forEach(function(e){var t=e.name.toLowerCase();this.data[t]=this._state===e},this)},e.prototype.success=function(){this._state===r.PENDING&&(this._state=r.SUCCESS,this._turnOneDataTrue())},e.prototype.failed=function(){this._state===r.PENDING&&(this._state=r.FAILED,this._turnOneDataTrue())},e.prototype.reset=function(){this._state=r.INIT,this._turnOneDataTrue()},e.prototype.pending=function(){this._state=r.PENDING,this._turnOneDataTrue()},e.prototype.isPending=function(){return this._state===r.PENDING},e.prototype.isSuccess=function(){return this._state===r.SUCCESS},e.prototype.isFailed=function(){return this._state===r.FAILED},e.prototype.isInit=function(){return this._state===r.INIT},e.prototype.getState=function(){return this._state},e.prototype.getPossibleStates=function(){return r},e}();t.a=i},314:function(e,t,n){"use strict";var r=n(3),i=n(7),o=n(17),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(o.default)),u=n(295),c=n(64),l=n(96),f=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),d=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},h=n(431),p=r.promisify(i.default.canvasToBlob.bind(i.default)),g=!1,y={minimumSizeDifference:1024,sizes:[{name:"lowest",restrictions:{maxWidth:640,maxHeight:480}},{name:"middle",restrictions:{maxWidth:1280,maxHeight:720}},{name:"highest",restrictions:{maxWidth:2560,maxHeight:1440}}],gifSizes:[{name:"lowest",restrictions:{maxWidth:640,maxHeight:480}},{name:"highest"}],gif:!0,encrypt:!0,extraInfo:{}};s.mobile&&(y.sizes=y.sizes.filter(function(e){return"highest"!==e.name}));var m=new l.a(3);m.start();var v=new l.a(1);v.start();var b=function(e,t){return e.blob.getSize()-t.blob.getSize()},w=function(e,t){return b(t,e)},D=function(e){function t(n,o){var a=e.call(this,n,o||y)||this;if(a.rotation="0",a.convertForGallery=function(){return{upload:a,highest:{loading:!1,loaded:!0,url:a.getUrl()},lowest:{loading:!1,loaded:!0,url:a.getUrl()}}},a.rotate=function(){return a.generatePreviews().then(function(e){var t="0";switch(a.rotation){case"0":t="90";break;case"90":t="180";break;case"180":t="270"}return a.rotation=t,a.previewUrl=i.default.toUrl(e[t]),e[t]})},a.generatePreviews=i.default.cacheResult(function(){return g?r.reject(new Error("Previews are disabled")):t.imageLibLoad(i.default.toUrl(a.file),{maxHeight:200,canvas:!0}).then(function(e){return r.all([p(e,"image/jpeg"),p(t.rotate90(e),"image/jpeg"),p(t.rotate180(e),"image/jpeg"),p(t.rotate270(e),"image/jpeg")])}).spread(function(e,t,n,r){return a.previewUrl=i.default.toUrl(e),{0:e,90:t,180:n,270:r}})}),a.getPreviewUrl=function(){return a.previewUrl||a.getUrl()},a.getUrl=function(){return g||a.generatePreviews(),a.url=a.url||i.default.toUrl(a.file),a.previewUrl=a.previewUrl||a.url,a.url},a.upload=function(e){if(!a.blobs)throw new Error("usage error: prepare was not called!");if(a.options.encrypt&&!e)throw new Error("No encryption key given");return m.enqueue(1,function(){return r.resolve(a.blobs).bind(a).map(function(t){return console.info("Uploading blob"),a.options.encrypt?a.uploadAndEncryptPreparedBlob(e,t.blob):a.uploadPreparedBlob(t.blob)})})},a._createSizeData=function(e){return v.enqueue(1,function(){return a._resizeFile(e).then(function(n){return t.blobToDataSet(c.a.createBlob(n.blob)).then(function(t){return t.content.gif=a.isGif,t.content.width=n.width,t.content.height=n.height,d({},t,{size:e})})})})},a.prepare=i.default.cacheResult(function(){a.isGif=!!a.file.type.match(/image.gif/i);return r.resolve(a.isGif?a.options.gifSizes:a.options.sizes).map(a._createSizeData).then(a._removeUnnededBlobs)}),a._removeUnnededBlobs=function(e){var t,n={};return a.blobs=e.sort(w).filter(function(e){var r=!t||a.isGif||b(t,e)>a.options.minimumSizeDifference;return r&&(t=e),n[e.size.name]=t,r}),n},a.getImage=i.default.cacheResult(function(){return t.imageLibLoad(a.getUrl())}),a._resizeFile=function(e){var n=d({},e.restrictions||{},{canvas:!0});return a.getImage().then(function(r){if(a.isGif&&!e.restrictions)return{blob:a.file,width:r.width,height:r.height};n.square&&(r=h.scale(r,{contain:!0,aspectRatio:1}));var i=t.rotate(h.scale(r,n),a.rotation);return p(i,"image/jpeg").then(function(e){return{blob:e,width:i.width,height:i.height}})})},!t.isImage(n))throw new Error("not an image!");if(n.type.match(/image.gif/)&&!a.options.gif)throw new Error("no gifs supported!");return a}return f(t,e),t.isImage=function(e){return e.type.match(/image.*/)},t.imageLibLoad=function(e,t){return new r(function(n,r){h(e,function(e){"error"===e.type?r(e):n(e)},t)})},t.rotate=function(e,n){switch(n){case"0":return e;case"90":return t.rotate90(e);case"180":return t.rotate180(e);case"270":return t.rotate270(e)}return e},t.rotateInternal=function(e,t,n){var r=document.createElement("canvas");n?(r.width=t.height,r.height=t.width):(r.width=t.width,r.height=t.height);var i=r.width-r.height,o=r.getContext("2d");if(null===o)throw new Error("could not initialize canvas context");return o.translate(r.width/2,r.height/2),o.rotate(e),o.translate(-r.width/2,-r.height/2),o.drawImage(t,n?i/2:0,n?-i/2:0),r},t.rotate90=function(e){var n=Math.PI/2;return t.rotateInternal(n,e,!0)},t.rotate180=function(e){var n=Math.PI;return t.rotateInternal(n,e,!1)},t.rotate270=function(e){var n=3*Math.PI/2;return t.rotateInternal(n,e,!0)},t}(u.a);t.a=D},315:function(e,t,n){"use strict";var r;!function(e){var t=4;e.tutorialVisible=!1,e.skip=function(){e.tutorialVisible=!1,localStorage.setItem("tutorialPassed",""+t)},e.checkVisibility=function(){var n=parseInt(localStorage.getItem("tutorialPassed"),10);e.tutorialVisible=isNaN(n)||n<t},e.resetVisibility=function(){console.log("resetting visibility"),localStorage.setItem("tutorialPassed","0"),e.tutorialVisible=!0}}(r||(r={})),t.a=r},316:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(40),i=n(329),o=(n.n(i),n(145)),a=(n.n(o),n(333)),s=(n.n(a),n(334)),u=(n.n(s),n(0));Object(u.enableProdMode)(),Object(r.platformBrowser)().bootstrapModuleFactory(s.AppModuleNgFactory)},32:function(e,t,n){"use strict";function r(e){return x.codec.hex.fromBits(x.hash.sha256.hash(e))}function i(e){return r(e._point.toBits())}function o(e){if(e instanceof Array)return r(e);throw new j.InvalidDataError("invalid key data")}function a(){return window.msCrypto&&window.msCrypto.subtle?window.msCrypto.subtle:!!window.crypto&&(window.crypto.subtle?window.crypto.subtle:!!window.crypto.webkitSubtle&&window.crypto.webkitSubtle)}function s(e){var t=e.split(":")[1];X.push(t)}function u(e){var t=e.split(":")[1];return X.indexOf(t)>-1}function c(e,t){return function(n){var r=new x.bn(O.bits2hex(n));return new e.secretKey(t,r)}}function l(e){return"object"!==(void 0===e?"undefined":P(e))?0:Object.keys(e).reduce(function(t,n){return t+1+l(e[n])},0)}function f(e,t){var n,r=t.length;if(t=x.codec.utf8String.toBits(t),e instanceof ArrayBuffer){var i=new Uint8Array(e);if(n=x.codec.arrayBuffer.toBits(new Uint8Array(i.subarray(0,r)).buffer),x.bitArray.equal(t,n))return new Uint8Array(i.subarray(r)).buffer}else if(n=x.bitArray.bitSlice(e,0,8*r),x.bitArray.equal(t,n))return x.bitArray.bitSlice(e,8*r);throw new j.DecryptionError("invalid prefix (should be: "+t+")")}function d(e){var t=Z+":"+O.bits2hex(e);if(V[t]||G[t]||W[t])throw new j.SecurityError("key already existing with same content ... this should never happen!");return t}function h(e){var t=e.split(":");if(2!==t.length)throw new j.InvalidDataError("Key id does not match format!");return 0===t[0].length?Z+":"+t[1]:e}function p(e){return"symKey"===e.type?V[e.decryptorid]:"cryptKey"===e.type?G[e.decryptorid]:null}function g(e,t){return b(e,t)}function y(e){return L.try(function(){return new k}).then(function(t){return V[t.getRealID()]?y(e):(V[t.getRealID()]=t,q.push(t),s(t.getRealID()),t.setComment(e),V[t.getRealID()])})}function m(e){if(e&&e.realid){if(!G[e.realid]){var t=new S(e);G[e.realid]=t}return G[e.realid]}}function v(e){if(e&&e.realid){if(!W[e.realid]){var t=new E(e);W[e.realid]=t}return W[e.realid]}}var b,w,D,_,I,k,S,E,P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C=n(7).default,O=n(196),x=n(52),A=n(370),M=n(371),R=n(374),j=n(50),L=n(3),T=n(16),F=n(149),K=T("whispeer:keyStore"),B=!0,U=[],N=!1,H=!0,z=[],q=[],V={},G={},W={},J="",Z="",X=[],Q=!1;x.random.startCollectors();var $=99999999999,Y={symKey:{loaded:3,unloaded:50},cryptKey:{loaded:100,unloaded:150},pw:3};try{if(localStorage){var ee=localStorage.getItem("whispeer.session.password");ee&&"string"==typeof ee&&(J=ee)}}catch(e){K(e)}I=function(e,t,n,r){function i(){var e;return o||(o=L.try(function(){if(!(e=u.getFastestDecryptor())||!e.decryptor)throw new j.DecryptionError("Could not Decrypt key!");var t=e.decryptor;return function(e,t,n,r,i){return L.try(function(){if("symKey"===t||"backup"===t)return L.try(function(){return k.get(e)}).then(function(e){return e.decryptKey().thenReturn(e)}).then(function(e){return e.decrypt(n,r)}).then(function(e){return f(e,"key::")});if("cryptKey"===t)return L.try(function(){return S.get(e)}).then(function(e){return e.decryptKey().thenReturn(e)}).then(function(e){return e.unkem(O.hex2bits(n))});if("pw"===t)return L.try(function(){var e,t=O.Object2sjclPacket({ct:n,iv:r,salt:i});if(""!==J)return e=x.decrypt(J,t,{raw:1}),f(e,"key::");throw new j.DecryptionError("no pw")});throw new j.InvalidDataError("invalid decryptortype")})}(t.decryptorid,t.type,t.ct,t.iv,t.salt)}).then(function(t){if(!1===t)throw new Error("Could not decrypt");return"cryptKey"===e.decryptor.type&&C.callEach(U,[u.getRealID()]),l(t)}).then(function(e){s=a,a=e}).catch(function(r){if(F.captureException(r||{err:"internaldecryptor returned false for realid: "+t}),K(r),K("decryptor failed for key: "+t),0===(n=n.filter(function(t){return t!==e.decryptor})).length)throw new j.DecryptionError("Could finally not decrypt key!");return o=void 0,i()})),o}var o,a,s,u=this,c=[];n||(n=[]);var l=function(e){return e};"function"==typeof(r=r||{}).pastProcessor&&(l=r.pastProcessor),r.secret&&(s=r.secret,a=l(r.secret),o=L.resolve()),this.decrypted=function(){return o&&o.isFulfilled()},this.decryptKey=i,this.getRealID=function(){return h(t)},this.getRealidFingerPrint=function(){return t.split(":")[1]},this.getDecryptors=function(){var e,t,r,i=[];for(e=0;e<n.length;e+=1){t={};for(r in n[e])n[e].hasOwnProperty(r)&&(t[r]=n[e][r]);i.push(t)}return i},this.getFastestDecryptor=function(e){if(e||(e=0),e>100)return K("dafuq, deeply nested keys"),$;var t,r,i,o,a,s,u=0,c=$;for(t=0;t<n.length;t+=1)(s=Y[(r=n[t]).type])?"number"==typeof s?a=s:(i=p(r))?i.decrypted()?a=s.loaded:(o=i.getFastestDecryptor(e+1),a=s.loaded+o.speed):a=s.unloaded:a=$,a<c&&(c=a,u=t);return{speed:c,decryptor:n[u]}},this.addAsymDecryptor=function(t,r){return L.try(function(){var i={decryptorid:t,type:"cryptKey",ct:O.bits2hex(r),dirty:!0};n.push(i),z.push(e),c.push(i)})},this.addSymDecryptor=function(t){return L.try(function(){return t instanceof k?t:k.get(t)}).then(function(e){return u.decryptKey().thenReturn(e)}).then(function(t){return t.encryptWithPrefix("key::",s||a).then(function(r){var i={decryptorid:t.getRealID(),type:"symKey",ct:O.bits2hex(r.ct),iv:O.bits2hex(r.iv),dirty:!0};return n.push(i),z.push(e),c.push(i),t.getRealID()})})},this.addPWDecryptor=function(t){return u.decryptKey().then(function(){var e=x.codec.utf8String.toBits("key::"),n=x.bitArray.concat(e,s||a);return O.sjclPacket2Object(x.json._encrypt(t,n))}).then(function(t){var r={type:"pw",ct:O.bits2hex(t.ct),iv:O.bits2hex(t.iv),salt:O.bits2hex(t.salt),dirty:!0};return n.push(r),z.push(e),c.push(r),r})},this.getDecryptorData=function(e){var t=c;return e&&(t=n),t.map(function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n.decryptorid&&(n.decryptorid=h(n.decryptorid)),n})},this.isDirty=function(){return 0!==u.dirtyDecryptors.length},this.removeDirty=function(e){var t,n,r,i,o,a=[];for(t=0;t<c.length;t+=1){for(i=c[t],r=!0,n=0;n<e.length;n+=1)if(o=e[n],i.type===o.type&&i.ct===o.ct&&i.decryptorid===o.decryptorid){e.splice(n,1),r=!1;break}r&&a.push(i)}c=a},this.getSecret=function(){return!!this.decrypted()&&a}},(k=function(e){var t,n="";e||(e=x.random.randomWords(8)),"string"==typeof e&&(e=O.hex2bits(e)),t=e instanceof Array?new I(this,d(o(e)),[],{secret:e}):new I(this,e.realid,e.decryptors,{pastProcessor:function(e){if(o(e)!==t.getRealidFingerPrint())throw new j.ValidationError("Fingerprint and Key id do not match");return e}}),this.getAccessCount=function(){return e.accessCount},this.getUploadData=function(e){return{realid:t.getRealID(),type:"sym",decryptors:this.getDecryptorData(e),comment:n}},this.getDecryptorData=t.getDecryptorData,this.getRealID=t.getRealID,this.getDecryptors=t.getDecryptors,this.decrypted=t.decrypted,this.addAsymDecryptor=t.addAsymDecryptor,this.addSymDecryptor=t.addSymDecryptor,this.addPWDecryptor=t.addPWDecryptor,this.decryptKey=t.decryptKey,this.getFastestDecryptor=t.getFastestDecryptor,this.setComment=function(e){e&&(n=e)},this.encryptWithPrefix=function(e,n,r,i){if(Q)throw new j.SecurityError("Private Actions are blocked (encryptWithPrefix)");if(!u(t.getRealID()))throw new j.SecurityError("Key not usable for encryption: "+t.getRealID());return t.decryptKey().then(function(){if("string"==typeof n&&(n=x.codec.utf8String.toBits(n)),e=x.codec.utf8String.toBits(e),n instanceof ArrayBuffer){var i=(e=x.codec.arrayBuffer.fromBits(e,!1)).byteLength+n.byteLength,o=new ArrayBuffer(16-i%16);n=C.concatBuffers(e,n,o)}else n=x.bitArray.concat(e,n);return M.sym.encrypt(t.getSecret(),n,r)}).then(function(e){return i?e:O.sjclPacket2Object(e)})},this.decrypt=function(e,n,r){return t.decryptKey().then(function(){return"object"!==(void 0===e?"undefined":P(e))?(C.isHex(e)&&(e=O.hex2bits(e)),e={ct:e}):(C.isHex(e.iv)&&(e.iv=O.hex2bits(e.iv)),C.isHex(e.ct)&&(e.ct=O.hex2bits(e.ct))),n&&(C.isHex(n)&&(n=O.hex2bits(n)),e.iv=n),e.ct.length<500?x.json._decrypt(t.getSecret(),e,{raw:1}):M.sym.decrypt(t.getSecret(),e,r)})}}).get=function(e){return L.try(function(){if(!V[e])return g(e)}).then(function(){if(V[e])return V[e];throw new j.InvalidDataError("keychain not found (sym) "+e)})},k.generate=y,(S=function(e){var t,n,r,o,a,l,f,d=!1,h="";if(!(e&&e.point&&e.point.x&&e.point.y&&e.curve&&e.realid))throw new j.InvalidDataError("invalid data");if(a=O.getCurve(e.curve),r=a.field.fromBits(O.hex2bits(e.point.x)),o=a.field.fromBits(O.hex2bits(e.point.y)),l=new x.ecc.point(a,r,o),t=new x.ecc.elGamal.publicKey(a,l),f=e.realid,e.exponent?(d=!0,n=new I(this,f,e.decryptors,{secret:e.exponent,pastProcessor:c(x.ecc.elGamal,a)})):e.decryptors?(d=!0,n=new I(this,f,e.decryptors,{pastProcessor:c(x.ecc.elGamal,a)})):n=new I(this,f,[]),i(t)!==n.getRealidFingerPrint())throw new j.ValidationError("Fingerprint and Key id do not match");this.getRealID=n.getRealID,d&&(this.decrypted=n.decrypted,this.decryptKey=n.decryptKey,this.getFastestDecryptor=n.getFastestDecryptor,this.getDecryptorsF=n.getDecryptors,this.addAsymDecryptor=n.addAsymDecryptor,this.addSymDecryptor=n.addSymDecryptor,this.addPWDecryptor=n.addPWDecryptor,this.getUploadData=function(e){var r=t._point;return{realid:n.getRealID(),point:{x:O.bits2hex(r.x.toBits()),y:O.bits2hex(r.y.toBits())},curve:O.getCurveName(t._curve),type:"crypt",decryptors:this.getDecryptorData(e),comment:h}},this.setComment=function(e){e&&(h=e)},this.getDecryptorData=n.getDecryptorData),this.getFingerPrint=function(){return i(t)},this.kem=function(){if(Q)throw new j.SecurityError("Private Actions are blocked (kem)");if(!u(n.getRealID()))throw new j.SecurityError("Key not usable for encryption: "+n.getRealID());return L.try(function(){return t.kem()}).then(function(e){var t=new k(e.key);return V[t.getRealID()]=t,q.push(t),s(t.getRealID()),t.addAsymDecryptor(f,e.tag).thenReturn(t.getRealID())})},d&&(this.unkem=function(e){return L.try(function(){if(!d)throw new Error("not a private key");return n.decryptKey()}).then(function(){return K("slow decrypt"),n.getSecret().unkem(e)})})}).get=function(e){return L.try(function(){if(!G[e])return g(e)}).then(function(){if(G[e])return G[e];throw new j.InvalidDataError("keychain not found")})},S.generate=function(e,t){return A.async().then(function(){var n=O.getCurve(e),r=x.ecc.elGamal.generateKeys(n),o=r.pub._point,a=m({point:{x:O.bits2hex(o.x.toBits()),y:O.bits2hex(o.y.toBits())},exponent:r.sec._exponent.toBits(),realid:d(i(r.pub)),curve:O.getCurveName(r.pub._curve),comment:t});return q.push(a),a.setComment(t),s(a.getRealID()),a})},(E=function(e){function t(e,t){return H&&(K("Verifying with sjcl"),H=!1),B?(B=!1,L.resolve(s.verify(t,e))):M.asym.verify(s,e,t)}function r(e,t){return L.try(function(){return m.getSubtlePublicKey()}).then(function(n){return function(e,t,n){return a().verify({name:"ECDSA",namedCurve:"P-256",hash:"SHA-256"},e.publicKey,t,n)}({publicKey:n},x.codec.arrayBuffer.fromBits(e),new TextEncoder("utf-8").encode(t))})}function o(e){return L.resolve(e).then(function(){if(!a())throw new Error("subtle not available");var t=new TextEncoder("utf-8").encode(e);return a().digest("SHA-256",t)}).then(function(e){return function(e){for(var t=[],n=new DataView(e),r=0;r<n.byteLength;r+=4){var i=("00000000"+n.getUint32(r).toString(16)).slice(-"00000000".length);t.push(i)}return t.join("")}(e)}).catch(function(){return K("Subtle hashing failed falling back to sjcl"),x.hash.sha256.hash(e)})}var s,u,l,f,d,h,p,g=!1,y="";if(!(e&&e.point&&e.point.x&&e.point.y&&e.curve&&e.realid))throw new j.InvalidDataError("invalid sign key data");if(d=O.getCurve(e.curve),l=d.field.fromBits(O.hex2bits(e.point.x)),f=d.field.fromBits(O.hex2bits(e.point.y)),h=new x.ecc.point(d,l,f),s=new x.ecc.ecdsa.publicKey(d,h),p=e.realid,e.exponent?(g=!0,u=new I(this,p,e.decryptors,{secret:e.exponent,pastProcessor:c(x.ecc.ecdsa,d)})):e.decryptors?(g=!0,u=new I(this,p,e.decryptors,{pastProcessor:c(x.ecc.ecdsa,d)})):u=new I(this,p,[]),i(s)!==u.getRealidFingerPrint())throw new j.ValidationError("Fingerprint and Key id do not match");this.getRealID=u.getRealID,this.getJWKPublicKey=function(){var e=s._point;return{crv:"P-256",ext:!0,key_ops:["verify"],kty:"EC",x:D.format.base64ToUrl(x.codec.base64.fromBits(e.x.toBits())),y:D.format.base64ToUrl(x.codec.base64.fromBits(e.y.toBits()))}},this.getSubtlePublicKey=function(){return this._getSubtlePublicKeyPromise||(this._getSubtlePublicKeyPromise=a().importKey("jwk",this.getJWKPublicKey(),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])),this._getSubtlePublicKeyPromise},g&&(this.decrypted=u.decrypted,this.decryptKey=u.decryptKey,this.getRealID=u.getRealID,this.getDecryptorsF=u.getDecryptors,this.addAsymDecryptor=u.addAsymDecryptor,this.addSymDecryptor=u.addSymDecryptor,this.addPWDecryptor=u.addPWDecryptor,this.getUploadData=function(e){var t=s._point;return{realid:u.getRealID(),point:{x:O.bits2hex(t.x.toBits()),y:O.bits2hex(t.y.toBits())},curve:O.getCurveName(s._curve),type:"sign",decryptors:this.getDecryptorData(e),comment:y}},this.getDecryptorData=u.getDecryptorData,this.setComment=function(e){e&&(y=e)});var m=this;g&&(this.sign=function(e,t){if(Q)throw new j.SecurityError("Private Actions are blocked (sign)");var r=n(91).default,i=n(150);return L.try(function(){if(!r.isLoaded)return r.listenPromise("loaded")}).then(function(){if(!r.hasKeyData(u.getRealID()))throw K("key not in key database"),alert("key not in key database: "+u.getRealID()+" - please report this issue to feedback@whispeer.de!"),new j.SecurityError("key not in key database");return u.decryptKey()}).then(function(){return u.getSecret().sign(e)}).then(function(n){return i.isLoaded()&&i.addValidSignature(n,e,p,t),n})}),this.getFingerPrint=function(){return i(s)},this.verify=function(e,i,s,c){var l=n(91).default,f=n(150),d=O.bits2hex(e).substr(0,10);return T.enabled("whispeer:keyStore")&&console.time("verify-"+d+"-"+s),o(i).then(function(n){if(n=O.hex2bits(n),!l.hasKeyData(u.getRealID()))throw new j.SecurityError("key not in key database");return f.isValidSignatureInCache(e,n,p)?(f.addValidSignature(e,n,p,s,c),L.resolve(!0)):(K("Slow verify of type: "+s),function(e,n,i){return a()?r(e,n).then(function(n){return n||t(e,i)}).catch(function(n){return H&&console.error(n),t(e,i)}):t(e,i)}(e,i,n).then(function(t){return t&&f.addValidSignature(e,n,p,s,c),t}).catch(function(e){return console.error(e),!1}))}).finally(function(){T.enabled("whispeer:keyStore")&&console.timeEnd("verify-"+d+"-"+s)})}}).get=function(e){return W[e]?L.resolve(W[e]):g(e).then(function(){if(W[e])return W[e];throw new j.InvalidDataError("keychain not found (sign)")})},E.generate=function(e,t){return A.async().then(function(){var n=O.getCurve(e),r=x.ecc.ecdsa.generateKeys(n),o=r.pub._point,a=v({point:{x:O.bits2hex(o.x.toBits()),y:O.bits2hex(o.y.toBits())},exponent:r.sec._exponent.toBits(),realid:d(i(r.pub)),curve:O.getCurveName(r.pub._curve)});return q.push(a),a.setComment(t),a})},w=function(e){if("sym"===e.type)!function(e){if(e&&e.realid){if(!V[e.realid]){var t=new k(e);V[e.realid]=t}}}(e);else if("crypt"===e.type)m(e);else{if("sign"!==e.type)throw new j.InvalidDataError("unknown key type");v(e)}};var te=function(e,t){this._obj=e,this._minLength=t};te.prototype._padObject=function(e){return L.props(C.objectMap(e,function(e){return new te(e,this._minLength).pad()},this))},te.prototype._padArray=function(e){return L.resolve(e).bind(this).map(function(e){return new te(e,this._minLength).pad()})},te.prototype._padString=function(e){var t=this._minLength-e.length%this._minLength+this._minLength;return L.try(function(){return D.random.hex(t)}).then(function(t){return t+"::"+e})},te.prototype._padNumber=function(e){return this._padString(e.toString()).then(function(e){return"num::"+e})},te.prototype._padAttribute=function(e){var t=void 0===e?"undefined":P(e);if("object"===t)return e instanceof Array?this._padArray(e):this._padObject(e);if("string"===t)return this._padString(e);if("number"===t)return this._padNumber(e);if("boolean"===t)return this._padNumber(e?1:0);throw new j.InvalidDataError("could not pad value of type "+t)},te.prototype.pad=function(){return this._padAttribute(this._obj)},te.prototype._unpadObject=function(e){var t,n={};for(t in e)if(e.hasOwnProperty(t)){var r=new te(e[t],this._minLength);n[t]=r.unpad()}return n},te.prototype._unpadString=function(e){var t=!1;if(0===e.indexOf("num::")&&(t=!0,e=e.substr(5)),e.length%this._minLength!=2)throw new j.InvalidDataError("padding size invalid");var n=e.indexOf("::");if(-1===n)throw new j.InvalidDataError("no padding seperator found");var r=e.substr(n+2);return t?parseFloat(r):r},te.prototype._unpadArray=function(e){var t,n=[];for(t=0;t<e.length;t+=1){var r=new te(e[t],this._minLength);n[t]=r.unpad()}return n},te.prototype._unpadAttribute=function(e){var t=void 0===e?"undefined":P(e);if("object"===t)return e instanceof Array?this._unpadArray(e):this._unpadObject(e);if("string"===t)return this._unpadString(e);throw new j.InvalidDataError("could not pad value of type "+t)},te.prototype.unpad=function(){return this._unpadAttribute(this._obj)};var ne=function(e,t,n){this._key=e,this._depth=t,this._object=n};ne.prototype._encryptAttr=function(e){if("object"===(void 0===e?"undefined":P(e)))return new ne(this._key,this._depth-1,e).encrypt();if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return this._key.encryptWithPrefix("data::",e.toString());throw new j.InvalidDataError("Invalid encrypt!")},ne.prototype._encryptObject=function(){return L.props(C.objectMap(this._object,function(e,t){if("key"!==t)return this._encryptAttr(e)},this))},ne.prototype._encryptJSON=function(){return this._key.encryptWithPrefix("json::",JSON.stringify(this._object))},ne.prototype.encrypt=function(){return this._depth>0?this._encryptObject():this._encryptJSON()},ne.prototype.decryptCorrectObject=function(e){if("object"!==(void 0===e?"undefined":P(e))||e instanceof Array){var t=(e=x.codec.utf8String.fromBits(e)).substr(0,6),n=e.substr(6);if("data::"===t)return n;if("json::"===t)return JSON.parse(n);throw new j.ValidationError}return e},ne.prototype._decryptEndAttribute=function(){return this._key.decrypt(this._object).bind(this).then(function(e){return this.decryptCorrectObject(e)})},ne.prototype._decryptPartialObjects=function(){return L.props(C.objectMap(this._object,function(e,t){if("key"!==t)return new ne(this._key,this._depth-1,e).decrypt()},this))},ne.prototype.decrypt=function(){if(this._depth<0)throw new j.DecryptionError("invalid decryption depth!");return this._object.iv&&this._object.ct?this._decryptEndAttribute():this._decryptPartialObjects()},e.exports=D={reset:function(){N=!1,z=[],q=[],Z="",V={},G={},W={},_=void 0,J="",X=[],B=!0},setKeyGenIdentifier:function(e){Z=e},getKeyGenIdentifier:function(){return Z},correctKeyIdentifier:function(e){return h(e)},addImprovementListener:function(e){U.push(e)},security:{blockPrivateActions:function(){Q=!0},allowPrivateActions:function(){Q=!1},arePrivateActionsBlocked:function(){return Q},addEncryptionIdentifier:function(e){s(e)},setPassword:function(e){N=!1,J=e},verifyWithPW:function(e,t){if(!N){var n=x.decrypt(J,O.Object2sjclPacket(e));if(n=new te(JSON.parse(n),128).unpad(),!C.deepEqual(t,n))throw new j.SecurityError("verify with pw failed")}},makePWVerifiable:function(e,t,n){return new te(e,128).pad().then(function(e){return function(e,t){return L.try(function(){var n=x.json._encrypt(e,t);return O.sjclPacket2Object(n)})}(t,JSON.stringify(e))}).nodeify(n)}},format:{urlToBase64:function(e){return e.replace(/-/g,"+").replace(/_/g,"/")},base64ToUrl:function(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},base64ToBits:function(e){return x.codec.base64.toBits(e)},bitsToBase64:function(e){return x.codec.base64.fromBits(e)},fingerPrint:function(e){var t=e.split(":")[1];return x.codec.base32.fromBits(x.codec.hex.toBits(t)).toUpperCase()},base32:function(e){return x.codec.base32.fromBits(e)},unBase32:function(e){return x.codec.base32.toBits(e)},unformat:function(e,t){if(0!==e.indexOf(t+"::"))throw new j.InvalidDataError("format invalid");return e.substr(t.length+2)}},hash:{addPaddingToObject:function(e,t){return t=t||128,new te(e,t).pad()},removePaddingFromObject:function(e,t){return t=t||128,new te(e,t).unpad()},hash:function(e){return O.hash(e)},hashArrayBuffer:function(e){return L.try(function(){return a().digest("SHA-256",e)}).then(function(e){return function(e){for(var t=[],n=new DataView(e),r=0;r<n.byteLength;r+=4){var i=("00000000"+n.getUint32(r).toString(16)).slice(-"00000000".length);t.push(i)}return t.join("")}(e)}).catch(function(){return M.hash(e)})},hashPW:function(e,t){return O.hashPW(e,t)},hashObjectOrValueHexAsync:function(e,t){return L.try(function(){return"object"===(void 0===e?"undefined":P(e))?M.stringify(e,t,!0):x.hash.sha256.hash("data::"+e)}).then(function(e){return O.bits2hex(e)}).then(function(e){return"hash::"+e})},hashObjectOrValueHex:function(e,t){return"object"===(void 0===e?"undefined":P(e))?"hash::"+new R(e,t).hash():"hash::"+O.bits2hex(x.hash.sha256.hash("data::"+e))}},upload:{preLoadMultiple:function(e,t){return L.resolve(e).map(function(e){return g(e)}).nodeify(t)},isKeyLoaded:function(e){return V.hasOwnProperty(e)||G.hasOwnProperty(e)||W.hasOwnProperty(e)},addKey:function(e){return C.isRealID(e.realid)&&w(e),e.realid},getKeyAccessCount:function(e){var t=V[e];return t?t.getAccessCount():-1},setKeyGet:function(e){b=e},getExistingKey:function(e){if(D.upload.isKeyLoaded(e)){return(V[e]||G[e]||W[e]).getUploadData(!0)}},getKey:function(e){var t;for(t=0;t<q.length;t+=1)if(e===q[t].getRealID())return q[t].getUploadData()},getKeys:function(e){var t,n=[];for(t=0;t<q.length;t+=1)e.indexOf(q[t].getRealID())>-1&&n.push(q[t].getUploadData());return n},getDecryptors:function(e,t){var n={};return z.filter(function(t){return-1!==e.indexOf(t.getRealID())}).forEach(function(e){var r=e.getDecryptorData();t&&(r=r.filter(function(e){return-1!==t.indexOf(e.decryptorid)})),n[e.getRealID()]=r}),n},uploaded:function(e){var t;for(t in e.decryptors)e.decryptors.hasOwnProperty(t)&&g(t).removeDirty(e.decryptors[t]);var n,r=[];for(n=0;n<q.length;n+=1)t=q[n].getRealID(),e.keys[t]||r.push(q[n]);q=r}},random:{hex:function(e,t){return A.async().then(function(){return O.bits2hex(x.random.randomWords(Math.ceil(e/8))).substr(0,e)}).nodeify(t)},words:function(e,t){return A.async().then(function(){return x.random.randomWords(e)}).nodeify(t)}},sym:{registerMainKey:function(e){_=e},generateKey:function(e,t){return A.async().then(function(){return k.generate(t)}).then(function(e){return e.getRealID()}).nodeify(e)},createBackupKey:function(e,t){var n,r,i;return A.async().then(function(){return k.get(e)}).then(function(e){return i=e,r=x.random.randomWords(8),n=new k(x.random.randomWords(8)),s(n.getRealID()),s(new k(r).getRealID()),L.all([i.addSymDecryptor(n),n.addSymDecryptor(new k(r))])}).then(function(){var e=D.upload.getDecryptors([i.getRealID()],[n.getRealID()]),t=n.getUploadData();return t.decryptors[0].type="backup",{decryptors:e,innerKey:t,outerKey:r}}).nodeify(t)},loadBackupKey:function(e){var t=new k(e);if(V[t.getRealID()])throw new j.SecurityError("Key already exists in symKey database (double add?)");return V[t.getRealID()]=t,N=!0,t.getRealID()},symEncryptKey:function(e,t,n){return k.get(e).then(function(e){return e.addSymDecryptor(t)}).nodeify(n)},asymEncryptKey:function(e,t,n){return k.get(e).then(function(){return S.get(t)}).then(function(e){return e.kem()}).then(function(t){return D.sym.symEncryptKey(e,t)}).nodeify(n)},pwEncryptKey:function(e,t,n){return k.get(e).then(function(e){return e.addPWDecryptor(t)}).nodeify(n)},encryptText:function(e,t,n){return k.get(t).then(function(t){return t.encryptWithPrefix("data::",e)}).nodeify(n)},encryptObject:function(e,t,n,r){if(e.iv)throw new j.InvalidDataError("IV already set.");return k.get(t).then(function(t){return new ne(t,n,e).encrypt()}).nodeify(r)},decryptObject:function(e,t,n,r){return k.get(r||_).then(function(n){return new ne(n,t,e).decrypt()}).nodeify(n)},decryptText:function(e,t,n){return k.get(t).then(function(t){return t.decrypt(e)}).then(function(e){return x.codec.utf8String.fromBits(f(e,"data::"))}).nodeify(n)},encryptArrayBuffer:function(e,t,n){return k.get(t).then(function(t){return t.encryptWithPrefix("buf::",e,n,!0)}).then(function(e){return e.iv=x.codec.arrayBuffer.fromBits(e.iv,!1),e.ct.tag=x.codec.arrayBuffer.fromBits(e.ct.tag,!1),C.concatBuffers(e.iv,e.ct.ciphertext_buffer,e.ct.tag)})},decryptArrayBuffer:function(e,t,n){return k.get(t).then(function(t){var r=new Uint32Array(e),i={iv:x.codec.arrayBuffer.toBits(new Uint32Array(r.subarray(0,4)).buffer),ct:new Uint32Array(r.subarray(4,r.byteLength/4-2)).buffer,tag:x.codec.arrayBuffer.toBits(new Uint32Array(r.subarray(r.byteLength/4-2)).buffer)};return t.decrypt(i,null,n)}).then(function(e){return f(e,"buf::")})},decryptBigBase64:function(e,t,n){return k.get(t).then(function(t){e=x.codec.base64.toBits(e);var n={iv:x.bitArray.bitSlice(e,0,128),ct:x.bitArray.bitSlice(e,128)};return t.decrypt(n)}).then(function(e){return x.codec.base64.fromBits(f(e,"bin::"))}).nodeify(n)}},asym:{generateKey:function(e,t){return S.generate("256",t).then(function(e){return e.getRealID()}).nodeify(e)},symEncryptKey:function(e,t,n){return S.get(e).then(function(e){return e.addSymDecryptor(t)}).nodeify(n)},pwEncryptKey:function(e,t,n){return S.get(e).then(function(e){return e.addPWDecryptor(t)}).nodeify(n)},fingerPrintKey:function(e,t){return S.get(e).then(function(e){return e.getFingerPrint()}).nodeify(t)}},sign:{generateKey:function(e,t){return E.generate("256",t).then(function(e){return e.getRealID()}).nodeify(e)},symEncryptKey:function(e,t,n){return E.get(e).then(function(e){return e.addSymDecryptor(t)}).nodeify(n)},pwEncryptKey:function(e,t,n){return E.get(e).then(function(e){return e.addPWDecryptor(t)}).nodeify(n)},signObject:function(e,t,n,r){return L.all([E.get(t),M.stringify(e,n,!0)]).spread(function(t,n){return t.sign(n,e._type)}).then(function(e){return O.bits2hex(e)}).nodeify(r)},verifyObject:function(e,t,n,r,i){return e=O.hex2bits(e),L.all([function(e,t){var n=l(e);return n<50?new R(e,t).stringify():(console.warn("Length too long for stringify ",e._type,t,n),M.stringify(e,t))}(t,r),E.get(n)]).spread(function(n,r){return r.verify(e,n,t._type,i)}).catch(function(e){return console.error(e),!1})},fingerPrintKey:function(e,t){return S.get(e).then(function(e){return e.getFingerPrint()}).nodeify(t)}}}},334:function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.AppModuleNgFactory=void 0;var i=r(n(0)),o=r(n(335)),a=r(n(73)),s=r(n(298)),u=r(n(299)),c=r(n(300)),l=r(n(301)),f=r(n(303)),d=r(n(304)),h=r(n(305)),p=r(n(306)),g=r(n(307)),y=r(n(434)),m=r(n(19)),v=r(n(23)),b=r(n(40)),w=r(n(161)),D=r(n(132)),_=r(n(10)),I=r(n(1)),k=r(n(125)),S=r(n(160)),E=r(n(21)),P=r(n(41)),C=r(n(4)),O=r(n(55)),x=r(n(11)),A=r(n(157)),M=r(n(180)),R=r(n(75)),j=r(n(20)),L=r(n(56)),T=r(n(165)),F=r(n(102)),K=r(n(169)),B=r(n(163)),U=r(n(9)),N=r(n(176)),H=r(n(45)),z=r(n(194)),q=r(n(113)),V=r(n(89)),G=r(n(115)),W=r(n(183)),J=r(n(129)),Z=r(n(90)),X=r(n(130)),Q=r(n(195)),$=r(n(135)),Y=r(n(116)),ee=r(n(136)),te=r(n(117)),ne=r(n(162)),re=r(n(43)),ie=r(n(158)),oe=r(n(164)),ae=r(n(296)),se=r(n(118)),ue=r(n(81)),ce=r(n(82)),le=r(n(84)),fe=r(n(83)),de=r(n(47)),he=r(n(114)),pe=r(n(177)),ge=i.ɵcmf(o.AppModule,[a.IonicApp],function(e){return i.ɵmod([i.ɵmpd(512,i.ComponentFactoryResolver,i.ɵCodegenComponentFactoryResolver,[[8,[s.ActionSheetCmpNgFactory,u.AlertCmpNgFactory,c.IonicAppNgFactory,l.LoadingCmpNgFactory,f.ModalCmpNgFactory,d.PickerCmpNgFactory,h.PopoverCmpNgFactory,p.SelectPopoverNgFactory,g.ToastCmpNgFactory,y.MyAppNgFactory]],[3,i.ComponentFactoryResolver],i.NgModuleRef]),i.ɵmpd(5120,i.LOCALE_ID,i.ɵm,[[3,i.LOCALE_ID]]),i.ɵmpd(4608,m.NgLocalization,m.NgLocaleLocalization,[i.LOCALE_ID,[2,m.ɵa]]),i.ɵmpd(4608,v.ɵi,v.ɵi,[]),i.ɵmpd(4608,v.FormBuilder,v.FormBuilder,[]),i.ɵmpd(5120,i.APP_ID,i.ɵf,[]),i.ɵmpd(5120,i.IterableDiffers,i.ɵk,[]),i.ɵmpd(5120,i.KeyValueDiffers,i.ɵl,[]),i.ɵmpd(4608,b.DomSanitizer,b.ɵe,[m.DOCUMENT]),i.ɵmpd(6144,i.Sanitizer,null,[b.DomSanitizer]),i.ɵmpd(4608,b.HAMMER_GESTURE_CONFIG,w.IonicGestureConfig,[]),i.ɵmpd(5120,b.EVENT_MANAGER_PLUGINS,function(e,t,n,r,i){return[new b.ɵDomEventsPlugin(e,t),new b.ɵKeyEventsPlugin(n),new b.ɵHammerGesturesPlugin(r,i)]},[m.DOCUMENT,i.NgZone,m.DOCUMENT,m.DOCUMENT,b.HAMMER_GESTURE_CONFIG]),i.ɵmpd(4608,b.EventManager,b.EventManager,[b.EVENT_MANAGER_PLUGINS,i.NgZone]),i.ɵmpd(135680,b.ɵDomSharedStylesHost,b.ɵDomSharedStylesHost,[m.DOCUMENT]),i.ɵmpd(4608,b.ɵDomRendererFactory2,b.ɵDomRendererFactory2,[b.EventManager,b.ɵDomSharedStylesHost]),i.ɵmpd(6144,i.RendererFactory2,null,[b.ɵDomRendererFactory2]),i.ɵmpd(6144,b.ɵSharedStylesHost,null,[b.ɵDomSharedStylesHost]),i.ɵmpd(4608,i.Testability,i.Testability,[i.NgZone]),i.ɵmpd(4608,b.Meta,b.Meta,[m.DOCUMENT]),i.ɵmpd(4608,b.Title,b.Title,[m.DOCUMENT]),i.ɵmpd(4608,D.ActionSheetController,D.ActionSheetController,[_.App,I.Config]),i.ɵmpd(4608,k.AlertController,k.AlertController,[_.App,I.Config]),i.ɵmpd(4608,S.Events,S.Events,[]),i.ɵmpd(4608,E.Form,E.Form,[]),i.ɵmpd(4608,P.Haptic,P.Haptic,[C.Platform]),i.ɵmpd(4608,O.Keyboard,O.Keyboard,[I.Config,C.Platform,i.NgZone,x.DomController]),i.ɵmpd(4608,A.LoadingController,A.LoadingController,[_.App,I.Config]),i.ɵmpd(5120,m.LocationStrategy,M.provideLocationStrategy,[m.PlatformLocation,[2,m.APP_BASE_HREF],I.Config]),i.ɵmpd(4608,m.Location,m.Location,[m.LocationStrategy]),i.ɵmpd(5120,R.UrlSerializer,R.setupUrlSerializer,[_.App,R.DeepLinkConfigToken]),i.ɵmpd(5120,j.DeepLinker,j.setupDeepLinker,[_.App,R.UrlSerializer,m.Location,L.ModuleLoader,i.ComponentFactoryResolver]),i.ɵmpd(4608,T.ModalController,T.ModalController,[_.App,I.Config,j.DeepLinker]),i.ɵmpd(4608,F.PickerController,F.PickerController,[_.App,I.Config]),i.ɵmpd(4608,K.PopoverController,K.PopoverController,[_.App,I.Config,j.DeepLinker]),i.ɵmpd(4608,B.TapClick,B.TapClick,[I.Config,C.Platform,x.DomController,_.App,U.GestureController]),i.ɵmpd(4608,N.ToastController,N.ToastController,[_.App,I.Config]),i.ɵmpd(4608,H.TransitionController,H.TransitionController,[C.Platform,I.Config]),i.ɵmpd(4608,m.DatePipe,m.DatePipe,[i.LOCALE_ID]),i.ɵmpd(4608,z.BarcodeScanner,z.BarcodeScanner,[]),i.ɵmpd(4608,q.SplashScreen,q.SplashScreen,[]),i.ɵmpd(4608,V.StatusBar,V.StatusBar,[]),i.ɵmpd(4608,G.Push,G.Push,[]),i.ɵmpd(4608,W.PhotoViewer,W.PhotoViewer,[]),i.ɵmpd(4608,J.ImagePicker,J.ImagePicker,[]),i.ɵmpd(4608,Z.File,Z.File,[]),i.ɵmpd(4608,X.Camera,X.Camera,[]),i.ɵmpd(4608,Q.InAppBrowser,Q.InAppBrowser,[]),i.ɵmpd(4608,$.Media,$.Media,[]),i.ɵmpd(4608,Y.Keyboard,Y.Keyboard,[]),i.ɵmpd(4608,ee.AndroidPermissions,ee.AndroidPermissions,[]),i.ɵmpd(512,m.CommonModule,m.CommonModule,[]),i.ɵmpd(512,v.ɵba,v.ɵba,[]),i.ɵmpd(512,v.FormsModule,v.FormsModule,[]),i.ɵmpd(512,v.ReactiveFormsModule,v.ReactiveFormsModule,[]),i.ɵmpd(512,M.IonicModule,M.IonicModule,[]),i.ɵmpd(512,te.TranslateModule,te.TranslateModule,[]),i.ɵmpd(512,i.ErrorHandler,o.MyErrorHandler,[]),i.ɵmpd(256,I.ConfigToken,{scrollPadding:!1,scrollAssist:!0,autoFocusAssist:!1},[]),i.ɵmpd(1024,ne.PlatformConfigToken,ne.providePlatformConfigs,[]),i.ɵmpd(1024,C.Platform,C.setupPlatform,[b.DOCUMENT,ne.PlatformConfigToken,i.NgZone]),i.ɵmpd(1024,I.Config,I.setupConfig,[I.ConfigToken,C.Platform]),i.ɵmpd(512,x.DomController,x.DomController,[C.Platform]),i.ɵmpd(512,re.MenuController,re.MenuController,[]),i.ɵmpd(512,_.App,_.App,[I.Config,C.Platform,[2,re.MenuController]]),i.ɵmpd(512,U.GestureController,U.GestureController,[_.App]),i.ɵmpd(256,R.DeepLinkConfigToken,{links:[{loadChildren:"../pages/blocked-users/blockedUsers.module.ngfactory#ContactsPageModuleNgFactory",name:"Blocked Users",segment:"blockedusers",priority:"low",defaultHistory:[]},{loadChildren:"../pages/contact-requests/contact-requests.module.ngfactory#ContactRequestPageModuleNgFactory",name:"Requests",segment:"requests",priority:"low",defaultHistory:[]},{loadChildren:"../pages/contacts/contacts.module.ngfactory#ContactsPageModuleNgFactory",name:"Contacts",segment:"contacts",priority:"low",defaultHistory:[]},{loadChildren:"../pages/home/home.module.ngfactory#HomePageModuleNgFactory",name:"Home",segment:"home",priority:"low",defaultHistory:[]},{loadChildren:"../pages/login/login.module.ngfactory#LoginPageModuleNgFactory",name:"Login",segment:"login",priority:"low",defaultHistory:[]},{loadChildren:"../pages/messages/add/add.module.ngfactory#AddPageModuleNgFactory",name:"Select User",segment:"messages/:chatID/add",priority:"low",defaultHistory:[]},{loadChildren:"../pages/messages/details/details.module.ngfactory#DetailsPageModuleNgFactory",name:"Chat Details",segment:"messages/:chatID/details",priority:"low",defaultHistory:[]},{loadChildren:"../pages/messages/messages.module.ngfactory#MessagesPageModuleNgFactory",name:"Messages",segment:"messages/:chatID",priority:"low",defaultHistory:["Home"]},{loadChildren:"../pages/new-message/new-message.module.ngfactory#NewMessagePageModuleNgFactory",name:"New Message",segment:"newMessage/:receiverIds",priority:"low",defaultHistory:[]},{loadChildren:"../pages/profile/profile.module.ngfactory#ProfilePageModuleNgFactory",name:"Profile",segment:"profile/:userId",priority:"low",defaultHistory:[]},{loadChildren:"../pages/sales/sales.module.ngfactory#SalesPageModuleNgFactory",name:"Sales",segment:"sales",priority:"low",defaultHistory:[]},{loadChildren:"../pages/settings/settings.module.ngfactory#SettingsPageModuleNgFactory",name:"Settings",segment:"settings",priority:"low",defaultHistory:[]}]},[]),i.ɵmpd(512,i.Compiler,i.Compiler,[]),i.ɵmpd(512,ie.NgModuleLoader,ie.NgModuleLoader,[i.Compiler]),i.ɵmpd(1024,L.ModuleLoader,L.provideModuleLoader,[ie.NgModuleLoader,i.Injector]),i.ɵmpd(1024,i.APP_INITIALIZER,function(e,t,n,r,i,o,a,s,u,c,l,f,d){return[b.ɵh(e),oe.registerModeConfigs(t),S.setupProvideEvents(n,r),B.setupTapClick(i,o,a,s,u),L.setupPreloading(c,l,f,d)]},[[2,i.NgProbeToken],I.Config,C.Platform,x.DomController,I.Config,C.Platform,x.DomController,_.App,U.GestureController,I.Config,R.DeepLinkConfigToken,L.ModuleLoader,i.NgZone]),i.ɵmpd(512,i.ApplicationInitStatus,i.ApplicationInitStatus,[[2,i.APP_INITIALIZER]]),i.ɵmpd(131584,i.ApplicationRef,i.ApplicationRef,[i.NgZone,i.ɵConsole,i.Injector,i.ErrorHandler,i.ComponentFactoryResolver,i.ApplicationInitStatus]),i.ɵmpd(512,i.ApplicationModule,i.ApplicationModule,[i.ApplicationRef]),i.ɵmpd(512,b.BrowserModule,b.BrowserModule,[[3,b.BrowserModule]]),i.ɵmpd(512,ae.HttpModule,ae.HttpModule,[]),i.ɵmpd(512,se.TranslateStore,se.TranslateStore,[]),i.ɵmpd(512,ae.BrowserXhr,ae.BrowserXhr,[]),i.ɵmpd(512,ae.ResponseOptions,ae.BaseResponseOptions,[]),i.ɵmpd(1024,ae.XSRFStrategy,ae.ɵa,[]),i.ɵmpd(512,ae.XHRBackend,ae.XHRBackend,[ae.BrowserXhr,ae.ResponseOptions,ae.XSRFStrategy]),i.ɵmpd(512,ae.RequestOptions,ae.BaseRequestOptions,[]),i.ɵmpd(1024,ae.Http,ae.ɵb,[ae.XHRBackend,ae.RequestOptions]),i.ɵmpd(1024,ue.TranslateLoader,o.createTranslateLoader,[ae.Http]),i.ɵmpd(512,ce.TranslateCompiler,ce.TranslateFakeCompiler,[]),i.ɵmpd(512,le.TranslateParser,le.TranslateDefaultParser,[]),i.ɵmpd(512,fe.MissingTranslationHandler,fe.FakeMissingTranslationHandler,[]),i.ɵmpd(256,de.USE_DEFAULT_LANG,void 0,[]),i.ɵmpd(256,de.USE_STORE,void 0,[]),i.ɵmpd(512,de.TranslateService,de.TranslateService,[se.TranslateStore,ue.TranslateLoader,ce.TranslateCompiler,le.TranslateParser,fe.MissingTranslationHandler,de.USE_DEFAULT_LANG,de.USE_STORE]),i.ɵmpd(512,he.Globalization,he.Globalization,[]),i.ɵmpd(512,o.AppModule,o.AppModule,[i.NgZone,de.TranslateService,he.Globalization,I.Config,C.Platform]),i.ɵmpd(256,a.AppRootToken,pe.MyApp,[]),i.ɵmpd(256,m.APP_BASE_HREF,"/",[])])});t.AppModuleNgFactory=ge},335:function(e,t,n){"use strict";function r(e){return new S.a(e,"./assets/i18n/",".json")}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"RavenErrorHandler",function(){return j}),t.createTranslateLoader=r,n.d(t,"MyErrorHandler",function(){return T}),n.d(t,"AppModule",function(){return F});var i=n(35),o=n.n(i),a=n(0),s=n(19),u=n(79),c=n(3),l=(n.n(c),n(40)),f=n(113),d=n(89),h=n(114),p=n(115),g=n(183),y=n(129),m=n(90),v=n(130),b=n(194),w=n(195),D=n(135),_=n(116),I=n(136),k=n(117),S=n(433),E=n(296),P=n(49),C=n(177),O=n(87),x=(n(205),n(48),n(149)),A=(n.n(x),n(151)),M=(n.n(A),this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}),R=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};n(336),n(391),n(392),n(393),x.config("https://5efbdc23f6a749f79b9efb0231bcbb50@errors.whispeer.de/6",{release:"0.3.12",autoBreadcrumbs:!1,tags:{git_commit:"91a8714\n"},environment:"prod-production"}).install();var j=function(){function e(){}return e.prototype.handleError=function(e){x.captureException(e)},e}();window.startup=(new Date).getTime();var L=Object(P.c)()?"de":"en",T=function(){return function(){var e=this;this.handleError=function(t){e.ionicHandler.handleError(t),e.ravenHandler.handleError(t)},this.ionicHandler=new u.f,this.ravenHandler=new j}}(),F=function(){function e(e,t,n,r,i){var o=this;this.zone=e,this.translate=t,this.globalization=n,this.config=r,this.platform=i,this.tasks=[],this.taskRunnerStarted=!1,this.startTaskRunner=function(){o.taskRunnerStarted||0===o.tasks.length||(o.taskRunnerStarted=!0,setTimeout(o.runTasks,0))},this.runTasks=function(){o.taskRunnerStarted=!1;for(var e=Date.now(),t=o.tasks.length,n=0;n<t;n+=1){o.tasks.shift()();var r=Date.now()-e;if(n+1!==t&&r>20)break}o.startTaskRunner()},this.disableContextMenues=function(){window.addEventListener("contextmenu",function(e){return e.preventDefault()})},this.determineLanguage(),c.config({warnings:!1,longStackTraces:!1,cancellation:!1,monitoring:!1}),c.setScheduler(function(e){o.tasks.push(e),o.runInAngularZone(o.startTaskRunner)})}return e.prototype.runInAngularZone=function(e){this.zone.inner===window.Zone.current?e():this.zone.run(e)},e.prototype.setLanguage=function(e){var t=this;return c.try(function(){return o.a.locale(e),Object(P.c)()?t.translate.use(e+"_business").toPromise():t.translate.use(e).toPromise()})},e.prototype.determineLanguage=function(){var e=this;this.translate.setDefaultLang("en"),this.translate.get("general.backButtonText").subscribe(function(t){return e.config.set("ios","backButtonText",t)});var t=Object(O.a)("whispeer.session");if(t.get("language"))return this.setLanguage(t.get("language"));this.platform.ready().then(function(){return e.globalization.getPreferredLanguage()}).then(function(e){return e.value.split("-")[0].toLowerCase()}).catch(function(){return console.warn("Cannot get language from device, remaining with default language"),L}).then(function(t){return e.setLanguage(t)})},e=M([Object(a.NgModule)({declarations:[C.MyApp],imports:[u.g.forRoot(C.MyApp,{scrollPadding:!1,scrollAssist:!0,autoFocusAssist:!1},{links:[{loadChildren:"../pages/blocked-users/blockedUsers.module.ngfactory#ContactsPageModuleNgFactory",name:"Blocked Users",segment:"blockedusers",priority:"low",defaultHistory:[]},{loadChildren:"../pages/contact-requests/contact-requests.module.ngfactory#ContactRequestPageModuleNgFactory",name:"Requests",segment:"requests",priority:"low",defaultHistory:[]},{loadChildren:"../pages/contacts/contacts.module.ngfactory#ContactsPageModuleNgFactory",name:"Contacts",segment:"contacts",priority:"low",defaultHistory:[]},{loadChildren:"../pages/home/home.module.ngfactory#HomePageModuleNgFactory",name:"Home",segment:"home",priority:"low",defaultHistory:[]},{loadChildren:"../pages/login/login.module.ngfactory#LoginPageModuleNgFactory",name:"Login",segment:"login",priority:"low",defaultHistory:[]},{loadChildren:"../pages/messages/add/add.module.ngfactory#AddPageModuleNgFactory",name:"Select User",segment:"messages/:chatID/add",priority:"low",defaultHistory:[]},{loadChildren:"../pages/messages/details/details.module.ngfactory#DetailsPageModuleNgFactory",name:"Chat Details",segment:"messages/:chatID/details",priority:"low",defaultHistory:[]},{loadChildren:"../pages/messages/messages.module.ngfactory#MessagesPageModuleNgFactory",name:"Messages",segment:"messages/:chatID",priority:"low",defaultHistory:["Home"]},{loadChildren:"../pages/new-message/new-message.module.ngfactory#NewMessagePageModuleNgFactory",name:"New Message",segment:"newMessage/:receiverIds",priority:"low",defaultHistory:[]},{loadChildren:"../pages/profile/profile.module.ngfactory#ProfilePageModuleNgFactory",name:"Profile",segment:"profile/:userId",priority:"low",defaultHistory:[]},{loadChildren:"../pages/sales/sales.module.ngfactory#SalesPageModuleNgFactory",name:"Sales",segment:"sales",priority:"low",defaultHistory:[]},{loadChildren:"../pages/settings/settings.module.ngfactory#SettingsPageModuleNgFactory",name:"Settings",segment:"settings",priority:"low",defaultHistory:[]}]}),k.TranslateModule.forRoot({loader:{provide:k.TranslateLoader,useFactory:r,deps:[E.Http]}}),l.BrowserModule,E.HttpModule],bootstrap:[u.e],entryComponents:[C.MyApp],providers:[{provide:a.ErrorHandler,useClass:T},s.DatePipe,b.BarcodeScanner,f.SplashScreen,d.StatusBar,h.Globalization,p.Push,g.PhotoViewer,y.ImagePicker,m.File,v.Camera,w.InAppBrowser,D.Media,_.Keyboard,I.AndroidPermissions]}),R("design:paramtypes",[a.NgZone,k.TranslateService,h.Globalization,u.c,u.k])],e)}()},336:function(e,t,n){"use strict";var r=n(36).default;n(14).default.addInterceptor({transformResponse:function(e){return e.keys?(e.keys.forEach(function(e){r.upload.addKey(e)}),e):e}})},34:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"errorServiceInstance",function(){return o});var r=n(149),i=(n.n(r),n(368)),o=(n.n(i),new(function(){function e(){var e=this;this.criticalError=function(t){return e.logError(t)},this.logError=function(e){e&&(console.error(e),r.captureException(e))}}return e.prototype.failOnErrorPromise=function(e,t){var n=this;return t.then(function(){e.success()}).catch(function(t){e.failed(),n.criticalError(t)})},e.prototype.failOnError=function(e){var t=this;return function(n){n?(e.failed(),t.criticalError(n)):e.success()}},e}()));t.default=o},357:function(e,t){},36:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(220),i=n(32);i.upload.setKeyGet(r.a.getKey),t.default=i},361:function(e,t){e.exports={hashVersion:3,socket:{autoConnect:!0,autoReconnect:!0},serviceWorker:{enabled:!1}}},362:function(e,t){e.exports={https:!0,ws:"data.whispeer.de",wsPort:443,debug:!1,production:!0,workerScript:"build/worker.bundle.js",serviceWorker:{enabled:!0}}},37:function(e,t,n){"use strict";var r=n(34),i=n(3),o=(n.n(i),n(7)),a=n(369),s=n.n(a),u=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},l=this,f=!1,d=function(){return s.a.open("whispeerCache",10,function(e){var t=e.createObjectStore("cache",{keyPath:"id"});t.createIndex("created","created",{unique:!1}),t.createIndex("used","used",{unique:!1}),t.createIndex("type","type",{unique:!1}),t.createIndex("size","size",{unique:!1})}).catch(function(e){return console.warn("Disabling indexedDB caching due to error",e),f=!0,Promise.reject(e)})},h=function(){return f=!1};try{indexedDB.deleteDatabase("whispeer")}catch(e){}var p=function(e,t){return i.try(function(){return u(l,void 0,void 0,function(){var n;return c(this,function(r){switch(r.label){case 0:return[4,e];case 1:n=r.sent(),r.label=2;case 2:return n?(t(n),[4,n.continue()]):[3,4];case 3:return n=r.sent(),[3,2];case 4:return[2]}})})})},g=function(){function e(e,t){this.name=e,this.cacheDisabled=!1,this.options=t||{},this.options.maxEntries=this.options.maxEntries||100,this.options.maxBlobSize=this.options.maxBlobSize||1048576}return e.deleteDatabase=function(){return f=!0,s.a.delete("whispeerCache").then(function(){setTimeout(function(){h()},2e3)})},e.sumSize=function(e){return e.reduce(function(e,t){return e+t.size},0)},e.prototype.store=function(t,n,a){var s=this;if(this.isDisabled())return i.resolve();if(a&&!o.default.array.isArray(a)&&(a=[a]),a&&-1!==this.options.maxBlobSize&&e.sumSize(a)>this.options.maxBlobSize)return i.resolve();var l={data:JSON.stringify(n),created:(new Date).getTime(),used:(new Date).getTime(),id:this.getID(t),type:this.name,size:0,blobs:[]};return a&&(l.blobs=a,l.size=e.sumSize(a)),i.try(function(){return u(s,void 0,void 0,function(){var e,n;return c(this,function(r){switch(r.label){case 0:return[4,d()];case 1:return e=r.sent(),console.info("Storing in indexeddb "+this.getID(t)),(n=e.transaction("cache","readwrite")).objectStore("cache").put(l),[4,n.complete];case 2:return r.sent(),e.close(),[2]}})})}).catch(r.errorServiceInstance.criticalError)},e.prototype.contains=function(e){var t=this;return this.isDisabled()?i.resolve(!1):i.try(function(){return u(t,void 0,void 0,function(){var t,n,r;return c(this,function(i){switch(i.label){case 0:return[4,d()];case 1:return t=i.sent(),n=t.transaction("cache","readonly"),[4,n.objectStore("cache").count(this.name+"/"+e)];case 2:return r=i.sent(),t.close(),[2,r>0]}})})})},e.prototype.get=function(e){var t=this;return this.isDisabled()?i.reject(new Error("Cache is disabled "+this.name)):i.try(function(){return u(t,void 0,void 0,function(){var t,n,r;return c(this,function(i){switch(i.label){case 0:return[4,d()];case 1:return t=i.sent(),n=t.transaction("cache","readonly"),[4,n.objectStore("cache").get(this.name+"/"+e)];case 2:if(void 0===(r=i.sent()))throw new Error("cache miss for "+this.getID(e));return r.data=JSON.parse(r.data),r.blobs=r.blobs||[],r.blobs=r.blobs.map(function(e){return"string"==typeof e?o.default.dataURItoBlob(e):e}),1===r.blobs.length&&(r.blob=r.blobs[0]),t.close(),[2,r]}})})})},e.prototype.all=function(){if(this.isDisabled())return i.resolve([]);var e=[];return this.cursorEach(function(t){return e.push(t.value)},"readonly").then(function(){return e})},e.prototype.getID=function(e){return this.name+"/"+e},e.prototype.delete=function(e){var t=this;return this.isDisabled()?i.resolve():i.try(function(){return u(t,void 0,void 0,function(){var t,n;return c(this,function(r){switch(r.label){case 0:return[4,d()];case 1:return t=r.sent(),n=t.transaction("cache","readwrite"),[4,n.objectStore("cache").delete(this.getID(e))];case 2:return r.sent(),t.close(),[2]}})})})},e.prototype.deleteAll=function(){if(this.isDisabled())return i.resolve();var e=[];return this.cursorEach(function(t){return e.push(t.delete())},"readwrite").then(function(){return i.all(e)})},e.prototype.cursorEach=function(e,t){var n=this;return i.try(function(){return u(n,void 0,void 0,function(){var n,r,i;return c(this,function(o){switch(o.label){case 0:return[4,d()];case 1:return n=o.sent(),r=n.transaction("cache",t),i=r.objectStore("cache").index("type").openCursor(this.name),[4,p(i,e)];case 2:return o.sent(),n.close(),[2]}})})})},e.prototype.isDisabled=function(){return f||this.cacheDisabled},e.disable=function(){f=!0},e.prototype.disable=function(){this.cacheDisabled=!0},e}();t.a=g},370:function(e,t,n){"use strict";var r=n(52),i=n(3),o=function e(t){return r.random.isReady()?(t(),!0):(e.waiting=!0,r.random.addEventListener("seeded",function(){e.waiting=!1,e.ready=!0,t()}),!1)};o.async=i.promisify(o),o.ready=!1,o.waiting=!1,e.exports=o},371:function(e,t,n){"use strict";var r=n(372),i=n(3),o=n(235),a=n(95),s=4;navigator.hardwareConcurrency&&(s=Math.max(navigator.hardwareConcurrency-1,s));var u=new r(i,s,{setupMethod:function(e,t){var n=function(){try{var e;if(window&&Uint32Array){if(e=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(e);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)return!1;window.msCrypto.getRandomValues(e)}return e}}catch(e){console.error(e)}return!1}();if(!n)throw new Error("no entropy from browser ... browser too old");e.runTask({randomNumber:n,entropy:1024}).then(t)},workerScriptOverride:a.workerScript||!1});e.exports={hash:function(e){return u.schedule({isHash:!0,toHash:e})},stringify:function(e,t,n){return u.schedule({stringify:!0,content:e,version:t,hash:n})},asym:{generateCryptKey:function(e){var t={asym:!0,generate:!0,crypt:!0};return e&&(t.curve=e),u.schedule(t)},generateSignKey:function(e){return u.schedule({asym:!0,generate:!0,crypt:!1,curve:e})},kem:function(e){var t={asym:!0,generate:!1,action:"kem",curve:o.getCurveName(e._curve),x:e._point.x.toString(),y:e._point.y.toString()};return u.schedule(t)},unkem:function(e,t){var n={asym:!0,generate:!1,action:"unkem",curve:o.getCurveName(e._curve),exponent:e._exponent.toString(),tag:o.bits2hex(t)};return u.schedule(n)},sign:function(e,t){var n={asym:!0,generate:!1,action:"sign",curve:o.getCurveName(e._curve),exponent:e._exponent.toString(),toSign:o.bits2hex(t)};return u.schedule(n)},verify:function(e,t,n){var r={asym:!0,generate:!1,action:"verify",curve:o.getCurveName(e._curve),point:{x:e._point.x.toString(),y:e._point.y.toString()},signature:o.bits2hex(t),hash:o.bits2hex(n)};return u.schedule(r)}},sym:{encrypt:function(e,t,n){return u.schedule({key:e,message:t,asym:!1,encrypt:!0},n)},decrypt:function(e,t,n){return u.schedule({key:e,message:t,asym:!1,encrypt:!1},n)}}}},372:function(e,t,n){"use strict";var r=n(373),i=function(e,t,n){this._Promise=e,this._numberOfWorkers=t,this._numberOfRunningWorkers=0,this._options=n||{},this._queue=[],this._workers=[],this._setupMethod=this._options.setupMethod,this._setupDone="function"!=typeof this._setupMethod,this._setupRunning=!1,this._createNewWorker()};i.prototype._createNewWorker=function(){if(this._workers.length<this._numberOfWorkers){var e=new r(this._Promise,this._options.workerScriptOverride);e.onFree(this._onFree.bind(this,e)),this._workers.push(e)}},i.prototype._onFree=function(e){if(!(this._workers.length>this._numberOfWorkers||this._setupRunning)){if(!this._setupDone){var t=this;return this._setupRunning=!0,void this._setupMethod(e,function(){t._setupRunning=!1,t._setupDone=!0,t._onFree(e)})}this._runFromQueue()}},i.prototype._runFromQueue=function(){this._workers.forEach(function(e){if(!e.isBusy()&&this._queue.length>0){var t=this._queue.shift();e.runIfFree(t.task,t.metaListener).then(t.resolve,t.reject)}},this)},i.prototype._saveCallBack=function(e,t,n,r){this._queue.push({task:e,metaListener:t,resolve:n,reject:r})},i.prototype.schedule=function(e,t){this._createNewWorker();var n=new this._Promise(this._saveCallBack.bind(this,e,t));return this._runFromQueue(),n},i.prototype.drain=function(){this.setNumberOfWorkers(0)},i.prototype.setNumberOfWorkers=function(e){if(this._numberOfWorkers=e,e>this._numberOfWorkers)for(var t=0;t<this._queue.length;t+=1)this._createNewWorker()},e.exports=i},373:function(e,t,n){"use strict";var r=function(e,t){this._Promise=e,this._busy=!0,this._worker=t?new Worker(t):new Worker("./build/worker.bundle.js"),this._taskQueue=[],this._freeListener=[],this._taskCallback=null,this._metaListener=null,this._worker.onmessage=this._workerMessage.bind(this),this._worker.postMessage({action:"setup"})};r.prototype._workerMessage=function(e){var t=e.data.data,n=e.data.type;"meta"===n&&this._metaListener?this._metaListener(t):"resultTask"===n?(this._taskCallback.resolve(t),this._free()):"setup"===n?this._free():"error"===n&&(this._taskCallback.reject(t),this._free())},r.prototype.isBusy=function(){return this._busy},r.prototype._lockFree=function(){var e=this;return new this._Promise(function(t){e._taskQueue.push(t),e._checkQueues()})},r.prototype.runIfFree=function(e,t){return!this._busy&&this._run(e,t)},r.prototype.onFree=function(e){this._freeListener.push(e)},r.prototype._free=function(){this._busy=!1,this._taskCallback=null,this._metaListener=null,this._checkQueues()},r.prototype._checkQueues=function(){if(!this._busy)return this._taskQueue.length>0?(this._busy=!0,void this._taskQueue.shift()()):void this._freeListener.forEach(function(e){try{e()}catch(e){console.error(e)}})},r.prototype._saveCallbacks=function(e,t){this._taskCallback={resolve:e,reject:t}},r.prototype._run=function(e,t){this._busy=!0,this._metaListener=t;var n=new this._Promise(this._saveCallbacks.bind(this));return this._worker.postMessage({action:"runTask",data:e}),n},r.prototype.runTask=function(e,t){return this._lockFree().then(this._run.bind(this,e,t))},e.exports=r},374:function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(235),o=n(52),a=function(e,t){this._data=e,this._version=parseInt(t,10)};a.prototype.sjclHash=function(e){return"hash::"+i.bits2hex(o.hash.sha256.hash(e))},a.prototype._hashProperty=function(e){return this._version>=2?e.toString():this.sjclHash("data::"+e.toString())},a.prototype._doHashNewObject=function(e){var t=new a(e,this._version);return 3===this._version?t.stringify():this.sjclHash(t.stringify())},a.prototype._doHash=function(e,t){if("hash"===t)throw new Error("object can not have hash attributes");var n=void 0===e?"undefined":r(e);if("object"===n)return this._doHashNewObject(e);if(["number","string","boolean"].indexOf(n)>-1)return this._hashProperty(e);throw new Error("can not hash objects with "+n)},a.prototype._stringifyArray=function(){var e,t=[];for(e=0;e<this._data.length;e+=1)t.push(this._doHash(this._data[e]),e);return JSON.stringify(t)},a.prototype._jsonifyUnique=function(e){var t=Object.keys(e).sort();return JSON.stringify(e,t)},a.prototype._stringifyObject=function(){var e,t={};for(e in this._data)this._data.hasOwnProperty(e)&&(t[e]=this._doHash(this._data[e],e));return this._jsonifyUnique(t)},a.prototype._stringifyObjectOrArray=function(){return this._data instanceof Array?this._stringifyArray():this._stringifyObject()},a.prototype.stringify=function(){if("object"!==r(this._data))throw new Error("this is not an object!");return 4===this._version?JSON.stringify(a.handleVal(this._data)):this._stringifyObjectOrArray()},a.prototype.hash=function(){return i.bits2hex(this.hashBits())},a.prototype.hashBits=function(){return o.hash.sha256.hash(this.stringify())},a.getType=function(e){return"object"===(void 0===e?"undefined":r(e))?e instanceof Array?"arr":"obj":"val"},a.transformVal=function(e){return"object"===(void 0===e?"undefined":r(e))?e instanceof Array?e.map(a.handleVal):a.mapToArray(e):e.toString()},a.handleVal=function(e,t){return t?[a.getType(e),t,a.transformVal(e)]:[a.getType(e),a.transformVal(e)]},a.mapToArray=function(e){return Object.keys(e).sort().map(function(t){return a.handleVal(e[t],t)})},e.exports=a},379:function(e,t,n){"use strict";var r=n(3),i=n(7).default,o=n(34).errorServiceInstance,a=["regenerateFriendsKeys","fixBrokenSettings"];e.exports=function(){var e,t=n(12).default.getOwn();t&&t.getMigrationState().then(function(o){if((e=i.parseDecimal(o)||0)<a.length)return function(e,t){return r.try(function(){return n(380)("./"+i.pad(""+(t+1),5)+"-"+a[t])()}).then(function(n){if(n)return e.setMigrationState(t+1);console.error("Migration failed "+t,n)})}(t,e)}).catch(o.criticalError)}},380:function(e,t,n){function r(e){return n(i(e))}function i(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./00001-regenerateFriendsKeys":238,"./00001-regenerateFriendsKeys.js":238,"./00002-fixBrokenSettings":241,"./00002-fixBrokenSettings.js":241,"./migrationExample":242,"./migrationExample.js":242};r.keys=function(){return Object.keys(o)},r.resolve=i,e.exports=r,r.id=380},381:function(e,t,n){"use strict";var r=n(3),i=n(32);e.exports=function(e){var t,n=e;this.decrypt=function(e){return t?r.resolve(t).nodeify(e):i.sym.decryptObject(n,0).then(function(e){if(e)return t=e;throw new Error("could not decrypt")}).nodeify(e)}}},383:function(e,t,n){"use strict";var r;!function(){var i={type:"object",properties:{basic:{type:"object",properties:{firstname:{type:"string"},lastname:{type:"string"}}},image:{type:"string",pattern:/^(|data:image\/\w+;base64,[A-Za-z0-9+\/=]*)$/},imageBlob:{type:"object",additionalProperties:!1,properties:{imageHash:{type:"string",pattern:/^[A-Fa-f0-9]*$/},blobid:{type:"string",pattern:/^[A-z0-9]*$/}}},location:{type:"object",properties:{road:{type:"string"},number:{type:"string"},town:{type:"string"},state:{type:"string"},country:{type:"string"}}},contact:{type:"object",properties:{im:{type:"Array",items:{type:"object",properties:{messenger:{required:!0,type:"string",enum:["icq","skype","jabber"]},address:{type:"string"}}}},mail:{type:"Array",items:{type:"string",format:"email"}},telephone:{type:"Array",items:{type:"object",properties:{where:{type:"string"},number:{required:!0,type:"string",format:"phone"}}}},mobile:{type:"Array",items:{type:"object",properties:{where:{type:"string"},number:{required:!0,type:"string",format:"phone"}}}},website:{type:"Array",items:{type:"string",format:"url"}}}},relationship:{type:"object",properties:{partner:{type:"object",properties:{user:{type:"integer",minimum:1},partnerSignature:{type:"string",hex:!0}}},since:{type:"string",format:"date",after:"1900-01-01"},status:{type:"string",enum:["single","relationship","engaged","married","divorced","widowed","complicated","open","inlove"]}}},relatives:{type:"array",items:{type:"object",properties:{user:{type:"integer"},status:{type:"string",enum:["sister","brother","mother","father","daughter","son","aunt","uncle","niece","nephew","femalecousin","malecousin","grandmother","grandfather","granddaughter","grandson","stepsister","stepbrother","stepmother","stepfather","stepdaughter","stepson","sister-in-law","brother-in-law","mother-in-law","father-in-law","daughter-in-law","son-in-law"]}}}},extended:{type:"object",properties:{sex:{type:"string",enum:["f","m"]},birthday:{type:"string",format:"date",after:"1900-01-01"},religion:{type:"string"},political:{type:"string"}}},knowledge:{type:"object",properties:{education:{type:"array",items:{type:"object",properties:{name:{type:"string"},startDate:{type:"string",format:"date"},endDate:{type:"string",format:"date"},edutype:{type:"string"},titles:{type:"Array",items:{type:"object",properties:{name:{required:!0,type:"string"},date:{type:"string",format:"date"}}}}}}},knowledge:{type:"string"},languages:{type:"array",items:{type:"string"}}}},jobs:{type:"array",items:{type:"object",properties:{title:{type:"string"},company:{type:"string"},startDate:{type:"string",format:"date"},endDate:{type:"string",format:"date"}}}}}};void 0!==e&&e.exports?e.exports=i:void 0!==(r=function(){return i}.call(t,n,t,e))&&(e.exports=r)}()},384:function(e,t,n){"use strict";var r;!function(){var i={type:"object",properties:{basic:{type:"object",properties:{iv:{type:"string",hex:!0},ct:{type:"string",hex:!0}}},image:{type:"object",properties:{iv:{type:"string",hex:!0},ct:{type:"string",hex:!0}}},location:{type:"object",properties:{iv:{type:"string",hex:!0},ct:{type:"string",hex:!0}}},contact:{type:"object",properties:{iv:{type:"string",hex:!0},ct:{type:"string",hex:!0}}},relationship:{type:"object",properties:{iv:{type:"string",hex:!0},ct:{type:"string",hex:!0}}},relatives:{type:"object",properties:{iv:{type:"string",hex:!0},ct:{type:"string",hex:!0}}},extended:{type:"object",properties:{iv:{type:"string",hex:!0},ct:{type:"string",hex:!0}}},knowledge:{type:"object",properties:{iv:{type:"string",hex:!0},ct:{type:"string",hex:!0}}},jobs:{type:"object",properties:{iv:{type:"string",hex:!0},ct:{type:"string",hex:!0}}},key:{type:"string"}}};void 0!==e&&e.exports?e.exports=i:void 0!==(r=function(){return i}.call(t,n,t,e))&&(e.exports=r)}()},385:function(e,t,n){"use strict";var r;!function(){var i={name:"Post",type:"object",properties:{meta:{required:!0,type:"object",extends:"securedDataContent",properties:{sender:{required:!0,type:"integer"},time:{required:!0,type:"integer",min:1388714536420},key:{type:"object"},walluser:{type:"integer",min:1}}},content:{type:"object",required:!0,extends:"encryptedData",properties:{}}}};void 0!==e&&e.exports?e.exports=i:void 0!==(r=function(){return i}.call(t,n,t,e))&&(e.exports=r)}()},386:function(e,t,n){"use strict";var r;!function(){var i={type:"object",properties:{meta:{type:"object",properties:{createTime:{required:!0,type:"integer",min:1388718525297},_parent:{required:!0,type:"string"},_sortCounter:{type:"integer"},_ownHash:{required:!0,type:"string"},_signature:{required:!0,type:"string",hex:!0},encrSignature:{type:"string",hex:!0},sender:{type:"integer",min:1},topicid:{type:"integer",min:1},read:{type:"boolean"}}},content:{type:"object",properties:{iv:{required:!0,type:"string",hex:!0},ct:{type:"string"},text:{type:"string"}}}}};void 0!==e&&e.exports?e.exports=i:void 0!==(r=function(){return i}.call(t,n,t,e))&&(e.exports=r)}()},387:function(e,t,n){"use strict";var r;!function(){var i={name:"Topic",type:"object",properties:{createTime:{required:!0,type:"number",min:1376244464102},_key:{required:!0,type:"string"},receiver:{required:!0,type:"array",items:{type:"int"}},creator:{type:"number",min:1},unread:{type:"array",items:{type:"int"}}}};void 0!==e&&e.exports?e.exports=i:void 0!==(r=function(){return i}.call(t,n,t,e))&&(e.exports=r)}()},388:function(e,t,n){"use strict";var r;!function(){var i={name:"Topic",type:"object",extends:"securedData",properties:{createTime:{required:!0,type:"number",min:1376244464102},_key:{required:!0,type:"string"},receiver:{required:!0,type:"array",items:{type:"integer",min:1}},creator:{required:!0,type:"number",min:1}}};void 0!==e&&e.exports?e.exports=i:void 0!==(r=function(){return i}.call(t,n,t,e))&&(e.exports=r)}()},389:function(e,t,n){"use strict";var r;!function(){var i={type:"object",properties:{meta:{type:"object",required:!0,properties:{users:{type:"array",items:{type:"integer"}},circleKey:{required:!0,type:"string"}}},content:{type:"object",required:!0,extends:"encryptedData",properties:{}}}};void 0!==e&&e.exports?e.exports=i:void 0!==(r=function(){return i}.call(t,n,t,e))&&(e.exports=r)}()},390:function(e,t,n){"use strict";e.exports={getLocalizedString:function(){return"Translation missing"}}},391:function(e,t,n){"use strict";var r=n(26).default;n(14).default.addInterceptor({transformResponse:function(e,t){return t.sid&&!e.logedin&&r.logout(),e},transformRequest:function(e){return e.sid=r.getSID(),e}})},392:function(e,t,n){"use strict";function r(e){m.enabled(b)&&console.time(e)}function i(e){m.enabled(b)&&console.timeEnd(e)}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"ɵ0",function(){return _});var o=n(3),a=(n.n(o),n(37)),s=n(31),u=n(26),c=n(91),l=n(65),f=n(14),d=n(12),h=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),p=n(50),g=n(27),y=n(150),m=n(16),v=3e4,b="whispeer:trustService",w=m(b),D=function(e){return d.default.getOwnAsync().then(function(t){var n=t.getSignKey();if(!e){var r=t.getID(),i=t.getNickname();return{nicknames:(a={},a[i]=n,a),ids:(u={},u[r]=n,u),me:n,keys:(l={},l[n]=Object(c.userToDataSet)({key:n,userid:r,nickname:i},c.trustStates.OWN),l),signature:""}}if(e.me!==n)throw new p.SecurityError("not my trust database");var o=s.default.load(void 0,e,c.TRUST_SECURED_OPTIONS);return o.verifyAsync(n,"user").then(function(){return Object(c.transformLegacy)(o.metaGet())});var a,u,l})},_=D,I=new a.a("signatureCache"),k=function(){function e(){this.storeSignatureCache=function(){y.isChanged()&&(w("Storing signature cache!"),r("storedSignatureCache"),y.resetChanged(),y.getUpdatedVersion().then(function(e){return I.store(u.default.getUserID().toString(),e)}).then(function(){i("storedSignatureCache")}))},window.setInterval(this.storeSignatureCache,v),this.waitForLogin()}return e.prototype.waitForLogin=function(){u.default.awaitLogin().then(function(){return r("getSignatureCache"),I.get(u.default.getUserID().toString()).catch(function(){})}).then(function(e){i("getSignatureCache"),e?y.load(e.data):y.initialize()})},e}(),S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return h(t,e),t}(Object(l.c)({download:function(e,t){return f.default.awaitConnection().then(function(){return f.default.definitlyEmit("trustManager.get",{responseKey:"content",cacheSignature:t&&t.getSignature()})}).then(function(e){return e.content})},load:function(e,t){return t&&e.unChanged?o.resolve(l.a):D(e.content)},restore:function(e,t){return t?(t.update(e),t):new c.TrustStore(e)},shouldUpdate:function(){return o.resolve(!0)},getID:function(){return u.default.getUserID()},cacheName:"trustStore"}));g.registerCallback(function(){return S.get(u.default.getUserID()).then(function(e){return c.default.setTrustStore(e)})}),new k},394:function(e,t,n){function r(e){return n(i(e))}function i(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./de":151,"./de-at":243,"./de-at.js":243,"./de-ch":244,"./de-ch.js":244,"./de.js":151,"./en-au":245,"./en-au.js":245,"./en-ca":246,"./en-ca.js":246,"./en-gb":247,"./en-gb.js":247,"./en-ie":248,"./en-ie.js":248,"./en-nz":249,"./en-nz.js":249};r.keys=function(){return Object.keys(o)},r.resolve=i,e.exports=r,r.id=394},434:function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return s.ɵvid(0,[(e()(),s.ɵeld(0,0,null,null,3,"div",[["class","tutorial"]],null,[[null,"click"]],function(e,t,n){var r=!0;if("click"===t){r=!1!==e.component.tutorialClicked(n)&&r}return r},null,null)),(e()(),s.ɵted(-1,null,["\n\t"])),(e()(),s.ɵeld(2,0,null,null,0,"img",[["alt",""]],[[8,"src",4]],null,null,null,null)),(e()(),s.ɵted(-1,null,["\n"]))],null,function(e,t){e(t,2,0,t.component.currentSlide())})}function o(e){return s.ɵvid(0,[s.ɵqud(402653184,1,{nav:0}),(e()(),s.ɵeld(1,0,null,null,2,"ion-nav",[],null,null,null,u.View_Nav_0,u.RenderType_Nav)),s.ɵprd(6144,null,c.RootNode,null,[l.Nav]),s.ɵdid(3,4374528,[[1,4],["navigation",4]],0,l.Nav,[[2,f.ViewController],[2,d.NavController],h.App,p.Config,g.Platform,s.ElementRef,s.NgZone,s.Renderer,s.ComponentFactoryResolver,y.GestureController,m.TransitionController,[2,v.DeepLinker],b.DomController,s.ErrorHandler],{root:[0,"root"]},null),(e()(),s.ɵted(-1,null,["\n\n"])),(e()(),s.ɵand(16777216,null,null,1,null,i)),s.ɵdid(6,16384,null,0,w.NgIf,[s.ViewContainerRef,s.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),s.ɵted(-1,null,["\n"]))],function(e,t){var n=t.component;e(t,3,0,n.rootPage);e(t,6,0,n.showTutorial())},null)}function a(e){return s.ɵvid(0,[(e()(),s.ɵeld(0,0,null,null,1,"ng-component",[],null,null,null,o,P)),s.ɵdid(1,49152,null,0,D.MyApp,[g.Platform,_.SplashScreen,I.StatusBar,k.Globalization,S.Push,E.Keyboard],null,null)],null,null)}Object.defineProperty(t,"__esModule",{value:!0}),t.MyAppNgFactory=t.RenderType_MyApp=void 0,t.View_MyApp_0=o,t.View_MyApp_Host_0=a;var s=r(n(0)),u=r(n(435)),c=r(n(54)),l=r(n(77)),f=r(n(5)),d=r(n(30)),h=r(n(10)),p=r(n(1)),g=r(n(4)),y=r(n(9)),m=r(n(45)),v=r(n(20)),b=r(n(11)),w=r(n(19)),D=r(n(177)),_=r(n(113)),I=r(n(89)),k=r(n(114)),S=r(n(115)),E=r(n(116)),P=s.ɵcrt({encapsulation:2,styles:[],data:{}});t.RenderType_MyApp=P;var C=s.ɵccf("ng-component",D.MyApp,a,{},{},[]);t.MyAppNgFactory=C},48:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"ɵ0",function(){return k}),n.d(t,"ɵ1",function(){return E}),n.d(t,"ɵ2",function(){return O}),n.d(t,"ɵ3",function(){return A}),n.d(t,"ɵ4",function(){return j});var r,i=n(3),o=(n.n(i),n(14)),a=n(17),s=n(26),u=n(65),c=n(31),l=n(7),f=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),d=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},h=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},g=n(32),y=n(27),m=n(381),v={encrypt:!0,visibility:[]},b=["birthday","location","relationship","education","work","gender","languages"],w=["uiLanguage","sound","donate","safety"],D=["mailsEnabled"],_={privacy:{basic:{firstname:{encrypt:!1,visibility:["always:allfriends"]},lastname:{encrypt:!1,visibility:["always:allfriends"]}},imageBlob:{encrypt:!1,visibility:[]},location:v,birthday:v,relationship:v,education:v,work:v,gender:v,languages:v},donate:{refused:!1,later:0},sharePosts:["always:allfriends"],filterSelection:[],sound:{enabled:!0},messages:{sendShortCut:"enter"},safety:{blockedUsers:[]},uiLanguage:"en"},I=function(e){return w.indexOf(e)>-1},k=I,S=function(e){return D.indexOf(e)>-1},E=S,P={type:"settings",removeEmpty:!0},C=function(e){var t={meta:{initialLanguage:void 0},content:{}};return l.default.objectEach(e,function(e,n){I(e)?t.meta[e]=n:t.content[e]=n}),t},O=C,x=function(e){return console.warn("migrating settings to format 2"),e.ct?i.try(function(){g.security.allowPrivateActions();return new m(e).decrypt()}).then(function(e){var t=C(e),r=t.meta,i=t.content;r.initialLanguage=l.default.getLanguageFromPath();var o=n(12).default.getOwn();return new M(i,r).getUpdatedData(o.getSignKey(),o.getMainKey())}).then(function(e){var t=new c.SecuredData(e.content,e.meta,P,!1);return o.default.emit("settings.setSettings",{settings:e}).thenReturn(t)}):i.resolve(new c.SecuredData(e.content,e.meta,P,!1))},A=x,M=function(){return function(e,t,n){void 0===n&&(n={});var r=this;this.content=e,this.meta=t,this.server=n,this.changed=!1,this.getContent=function(){return r.content},this.getMeta=function(){return r.meta},this.getServer=function(){return r.server},this.getBranch=function(e){return S(e)?r.server[e]:I(e)?r.meta[e]:r.content[e]},this.isChanged=function(){return r.changed},this.setBranch=function(e,t){S(e)?r.server[e]=t:I(e)?r.meta[e]=t:r.content[e]=t,r.changed=!0},this.update=function(e,t,n){r.content=e,r.meta=t,r.server=n,r.changed=!1},this.getUpdatedData=function(e,t){return c.default.createAsync(r.content,r.meta,P,e,t).then(function(e){return d({},e,{server:r.server})})}}}(),R=function(e){return i.try(function(){return h(this,void 0,void 0,function(){var t,r;return p(this,function(o){switch(o.label){case 0:return[4,x(e)];case 1:return t=o.sent(),[4,n(12).default.getOwnAsync()];case 2:return r=o.sent(),[4,i.all([t.decrypt(),t.verifyAsync(r.getSignKey(),"settings")])];case 3:return o.sent(),[2,{content:t.contentGet(),meta:t.metaGet(),server:e.server}]}})})})},j=R,L=new(function(e){function t(){var t=e.call(this)||this;return t.setDefaultLanguage=function(e){return _.uiLanguage=e},t.getContent=function(){return r.getContent()},t.getBranchContent=function(e){return r.getBranch(e)},t.getBranch=function(e){if(!r)return _[e];var n=t.getBranchContent(e);return void 0===n?_[e]:n},t.updateBranch=function(e,n){r.setBranch(e,n),t.notify("","updated")},t.setPrivacy=function(e){return i.try(function(){return t.updateBranch("privacy",e),t.uploadChangedData()}).then(function(){return n(12).default.getOwn().uploadChangedProfile()})},t.removeCircle=function(e){return i.try(function(){var n=t.getBranch("privacy");return b.forEach(function(t){l.default.removeArray(n[t].visibility,"circle:"+e)}),l.default.removeArray(n.basic.firstname.visibility,"circle:"+e),l.default.removeArray(n.basic.lastname.visibility,"circle:"+e),t.setPrivacy(n)})},t.uploadChangedData=function(){if(!r.isChanged())return i.resolve(!0);var e=n(12).default.getOwn();return r.getUpdatedData(e.getSignKey(),e.getMainKey()).then(function(e){return o.default.emit("settings.setSettings",{settings:e})}).then(function(e){return e.success})},t.getBlockedUsers=function(){return t.getBranch("safety").blockedUsers},t.setBlockedUsers=function(e){var n=t.getBranch("safety");return t.updateBranch("safety",d({},n,{blockedUsers:e})),t.uploadChangedData()},t.isBlockedSince=function(e,n){return!!t.getBlockedUsers().find(function(t){return e===t.id&&t.since<n})},t.isBlocked=function(e){return!!t.getBlockedUsers().find(function(t){return e===t.id})},t.getPrivacyAttribute=function(e){var n,r=t.getBranch("privacy"),i=e.split("."),o=r;for(n=0;n<i.length;n+=1)if(o[i[n]]){if(void 0!==o[i[n]].encrypt)return o[i[n]];o=o[i[n]]}throw new Error("could not find attribute settings")},t.getPrivacyEncryptionStatus=function(e){return t.getPrivacyAttribute(e).encrypt},t.getPrivacyVisibility=function(e){var n=t.getPrivacyAttribute(e);return!!n.encrypt&&n.visibility},t}return f(t,e),t}(a.default));t.default=L;var T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return f(t,e),t}(Object(u.c)({download:function(e,t){return o.default.awaitConnection().then(function(){return o.default.definitlyEmit("settings.get",{responseKey:"content",cacheSignature:t&&t.getMeta()._signature})}).then(function(e){return e.content})},load:function(e,t){return t&&e.unChanged?i.resolve({content:t.getContent(),meta:t.getMeta(),server:e.content.server}):R(e.content)},restore:function(e,t){var n=e.content,r=e.meta,i=e.server;return t?(t.update(n,r,i),L.notify("","updated"),t):new M(n,r,i)},shouldUpdate:function(e){return e===u.b.wake?i.delay(1e4).thenReturn(!0):i.resolve(!1)},getID:function(){return s.default.getUserID()},cacheName:"settings"}));y.registerCallback(function(){return T.get(s.default.getUserID()).then(function(e){r=e,L.notify("","updated")})})},49:function(e,t,n){"use strict";n.d(t,"f",function(){return c}),n.d(t,"d",function(){return l}),n.d(t,"e",function(){return f}),n.d(t,"c",function(){return d}),n.d(t,"b",function(){return h}),n.d(t,"g",function(){return p}),n.d(t,"a",function(){return g}),n.d(t,"h",function(){return y});var r=n(87),i=(n(7),r.a("whispeer.login"),r.a("whispeer.session")),o=window.top.location.href.match(/([^?#]*)/)[0],a=o.match(/(.*)\/.*/)[1],s=function(e){console.warn("set top location",e,o+e),window.top.location.href=o+e},u=function(e){console.warn("set top path",e,a+e),window.top.location.href=a+e},c=function(){s("#/nav/n4/login"),window.top.location.reload()},l=function(){return window.device&&"iOS"===window.device.platform},f=function(){return-1!==window.top.location.pathname.indexOf("/login")},d=function(){return-1!==window.top.location.pathname.indexOf("business.html")},h=function(){i.remove("business"),u("/index.html")},p=function(){s("#/nav/n4/login")},g=function(){i.set("business","true"),u("/business.html")},y=function(){d()?g():h()}},50:function(e,t,n){"use strict";function r(e,t){if(e.prototype instanceof Error||e===Error){var n=function(n,r){var i=new e(n);return i.name=this.name=t||"Error",this.data=r,this.stack=i.stack,this.message=i.message,this.name=t,this},r=function(){};return r.prototype=e.prototype,function(){}.prototype=n.prototype=new r,n.prototype.constructor=n,n}throw new Error("our error should inherit from error!")}var i=r(Error,"InvalidDataError"),o=r(i,"InvalidHexError"),a=r(i,"InvalidFilter"),s=r(Error,"SecurityError"),u=r(s,"AccessViolation"),c=r(s,"DecryptionError"),l=r(s,"ValidationError"),f=r(Error,"LoginError");e.exports={SecurityError:s,AccessViolation:u,DecryptionError:c,ValidationError:l,InvalidDataError:i,InvalidHexError:o,InvalidFilter:a,LoginError:f}},64:function(e,t,n){"use strict";var r=n(3),i=n(7),o=n(88),a=n(131),s=n(14),u=n(17),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),l=5e3,f=function(e){function t(t,n,r,i){var a=e.call(this)||this;return a.socket=t,a.blobid=n,a.type=r,a.blobParts=[],a.partSize=l,a.doneBytes=0,a.done=!1,a.download=function(){return a.downloadPromise||(a.downloadPromise=a.downloadPartsUntilDone()),a.downloadPromise},a.downloadPartsUntilDone=function(){return a.done?(a.progress.setTotal(a.doneBytes),a.progress.progress(a.doneBytes),a.concatParts()):a.downloadPart().then(function(){return a.downloadPartsUntilDone()})},a.progress=i||new o.a,a}return c(t,e),t.prototype.halfSize=function(){this.partSize=Math.max(this.partSize/2,1e3)},t.prototype.doubleSize=function(){this.partSize=Math.min(2*this.partSize,1e6)},t.prototype.concatParts=function(){return r.resolve({blob:new Blob(this.blobParts,{type:this.type}),meta:this.meta})},t.prototype.downloadPart=function(){var e=this,t=(new Date).getTime();return this.socket.awaitConnection().then(function(){return e.socket.emit("blob.getBlobPart",{blobid:e.blobid,start:e.doneBytes,size:e.partSize})}).then(function(n){var r=(new Date).getTime()-t;e.blobParts.push(n.part),e.doneBytes+=n.part.byteLength,e.progress.progress(e.doneBytes),r>2e3?e.halfSize():e.doubleSize(),e.done=n.last,e.meta=n.meta,e.notify(e.doneBytes,"progress")}).catch(function(t){if(t instanceof s.ServerError){if(i.default.hasErrorId(t.extra.response,71))return r.reject(t)}return console.error(t),e.halfSize(),r.delay(5e3)})},t}(u.default),d=n(96);n.d(t,"b",function(){return S});var h=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},g=this,y=n(16),m=n(27),v=n(32),b={},w=new d.a(5);w.start();var D="whispeer:blobService",_=y(D),I=function(e){y.enabled(D)&&console.time(e)},k=function(e){y.enabled(D)&&console.timeEnd(e)},S=function(e){var t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"))+1;return{directory:e.substr(0,t),name:e.substr(t)}},E=function(){function e(e,t,n){this.blobData=e,n=n||{},t?(this.blobID=t,this.uploaded=!0):this.uploaded=!1,this.meta=n.meta||{},this.key=this.meta._key||this.meta.key,this.decrypted=n.decrypted||!this.key,this.uploadProgress=new o.a({total:this.getSize()}),this.encryptProgress=new o.a({total:this.getSize()}),this.decryptProgress=new o.a({total:this.getSize()})}return e.prototype.isDecrypted=function(){return this.decrypted},e.prototype.isUploaded=function(){return this.uploaded},e.prototype.getSize=function(){return this.blobData.size},e.prototype.getMeta=function(){return this.meta},e.prototype.getArrayBuffer=function(){var e=this;if(Object(a.b)(),this.blobData.originalUrl){var t=S(this.blobData.originalUrl);return a.a.readFileAsArrayBuffer(t.directory,t.name)}return new r(function(t){var n=new FileReader;n.addEventListener?n.addEventListener("loadend",t):n.onloadend=t,n.readAsArrayBuffer(e.blobData)}).then(function(e){var t=e.currentTarget||e.target;return t.error?r.reject(t.error):t.result})},e.prototype.encryptAndUpload=function(e){var t=this;return r.try(function(){return h(t,void 0,void 0,function(){var t;return p(this,function(n){switch(n.label){case 0:return[4,this.encrypt()];case 1:return t=n.sent(),[4,v.sym.symEncryptKey(t,e)];case 2:return n.sent(),[4,this.upload()];case 3:return n.sent(),[2,t]}})})})},e.prototype.encrypt=function(){var e=this;return r.resolve().then(function(){if(e.uploaded||!e.decrypted)throw new Error("trying to encrypt an already encrypted or public blob. add a key decryptor if you want to give users access");return r.all([v.sym.generateKey(null,"blob key"),e.getArrayBuffer()])}).spread(function(t,n){return e.key=t,I("blobencrypt"+(e.blobID||e.preReservedID)),v.sym.encryptArrayBuffer(n,e.key,function(t){e.encryptProgress.progress(e.getSize()*t)})}).then(function(t){return e.encryptProgress.progress(e.getSize()),k("blobencrypt"+(e.blobID||e.preReservedID)),_(t.byteLength),e.decrypted=!1,e.blobData=new Blob([t],{type:e.blobData.type}),e.key})},e.prototype.decrypt=function(e){var t=this;return this.decrypted?r.resolve():r.try(function(){return t.getArrayBuffer()}).then(function(e){return I("blobdecrypt"+t.blobID),v.sym.decryptArrayBuffer(e,t.key,function(e){t.decryptProgress.progress(t.getSize()*e)})}).then(function(n){t.decryptProgress.progress(t.getSize()),k("blobdecrypt"+t.blobID);var r=e>0?n.slice(0,e):n;return t.decrypted=!0,t.blobData=new Blob([r],{type:t.blobData.type}),a.a.store(t).catch(function(e){return console.log("Could not store blob",e),t.toURL()})})},e.prototype.toURL=function(){var e=this;return r.try(function(){return e.blobData.localURL?e.blobData.localURL:void 0!==window.URL?window.URL.createObjectURL(e.blobData):"undefined"!=typeof webkitURL?window.webkitURL.createObjectURL(e.blobData):r.fromCallback(function(t){i.default.blobToDataURI(e.blobData,t)})}).catch(function(){return""})},e.prototype.upload=function(){var e=this;return r.try(function(){return e.uploaded?e.blobID:e.reserveID()}).then(function(t){return s.default.uploadBlob(e.blobData,t,e.uploadProgress)}).then(function(){return e.uploaded=!0,e.blobID})},e.prototype.getBlobID=function(){return this.blobID},e.prototype.getBlobData=function(){return this.blobData},e.prototype.reserveID=function(){var e=this;return r.try(function(){var t=e.meta;return t._key=e.key,t.one=1,e.preReservedID?s.default.definitlyEmit("blob.fullyReserveID",{blobid:e.preReservedID,meta:t}):s.default.definitlyEmit("blob.reserveBlobID",{meta:t})}).then(function(t){if(t.blobid)return e.blobID=t.blobid,e.blobID})},e.prototype.preReserveID=function(){var e=this;return r.try(function(){return s.default.definitlyEmit("blob.preReserveID",{})}).then(function(t){if(t.blobid)return e.preReservedID=t.blobid,t.blobid;throw new Error("got no blobid")})},e.prototype.getHash=function(){return this.getArrayBuffer().then(function(e){return v.hash.hashArrayBuffer(e)})},e}(),P=function(e,t,n,i){var u=new o.a({total:i}),c=new o.a({total:i});return n.addDepend(c),n.addDepend(u),w.enqueue(1,function(){return r.try(function(){return h(g,void 0,void 0,function(){var r,o;return p(this,function(l){switch(l.label){case 0:return[4,m.awaitLoading()];case 1:return l.sent(),[4,new f(s.default,e,t,c).download()];case 2:return r=l.sent(),(o=new E(r.blob,e,{meta:r.meta})).isDecrypted()?[2,a.a.store(o).catch(function(){return o.toURL()})]:(c.progress(c.getTotal()),n.removeDepend(u),n.addDepend(o.decryptProgress),[2,o.decrypt(i)])}})})})})},C=function(e,t,n,r){return b[e]||(b[e]=P(e,t,n,r)),b[e]};t.a={createBlob:function(e){return new E(e)},isBlobLoaded:function(e){return a.a.isLoaded(e)},getBlobUrl:function(e,t,n,r){return void 0===r&&(r=new o.a),a.a.getBlobUrl(e).catch(function(){return C(e,t,r,n)})}}},65:function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return f});var r,i=n(3),o=(n.n(i),n(14)),a=n(37),s=n(34),u=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};!function(e){e[e.wake=0]="wake",e[e.blink=1]="blink"}(r||(r={}));var f=Symbol("UNCHANGED"),d=12e4,h=6e4;t.c=function(e){var t=e.download,n=e.load,p=e.restore,g=e.getID,y=e.cacheName,m=e.shouldUpdate,v={},b={},w=new a.a(y),D=function(e){delete(v=u({},v))[e]},_=function(e,t,n){b=u({},b,(r={},r[e]={instance:t,lastUpdated:n,updating:!1},r));var r},I=function(e){var t=Date.now();return w.get(e).then(function(e){return t=e.created,e.data}).then(function(e){return p(e,null)}).then(function(n){return _(e,n,t),D(e),S(r.wake,e),n})},k=function(e,t,r){return i.try(function(){return c(this,void 0,void 0,function(){var i,o;return l(this,function(a){switch(a.label){case 0:return[4,n(e,r)];case 1:if((i=a.sent())===f)return[2,r];if(i instanceof Symbol)throw new Error("invalid symbol returned by load "+y);return[4,w.store(t,i)];case 2:return a.sent(),[4,p(i,r)];case 3:return o=a.sent(),r&&r!==o&&console.warn("Restore should update active instance"),_(t,o,Date.now()),[2,o]}})})}).finally(function(){return D(t)})},S=function(e,n){var i=b[n],o=i.instance,a=i.lastUpdated;i.updating?console.info("Not updating instance because update is already running "+y+"/"+n):(b[n].updating=!0,m(e,o,a).then(function(i){if(i)return console.info("Schedule "+y+" instance "+n+" update with event "+r[e]),function(e,n){return t(e,n).then(function(t){return k(t,e,n)})}(n,o).then(function(){return b[n].lastUpdated=Date.now()})}).catch(s.default.criticalError).finally(function(){return b[n].updating=!1}))},E=function(e){console.info("Schedule "+y+" instances update with event "+r[e]),Object.keys(b).forEach(function(t){return S(e,t)})},P=Date.now();o.default.listen(function(){return P=Date.now()},"heartbeat"),o.default.on("connect",function(){console.info("connect at "+Date.now()+" after "+(Date.now()-P)),E(Date.now()-P>h?r.wake:r.blink),P=Date.now()});var C=0;return document.addEventListener("pause",function(){return C=Date.now()},!1),document.addEventListener("resume",function(){console.info("ended pause at "+Date.now()+" after "+(Date.now()-C)),E(Date.now()-C>d?r.wake:r.blink)},!1),O=function(){function e(){}return e.getLoaded=function(t){if(!e.isLoaded(t))throw new Error("Not yet loaded: "+t);return b[t].instance},e.isLoaded=function(e){return b.hasOwnProperty(e)},e.load=function(e){var t=g(e);return b[t]?(k(e,t,b[t].instance),i.resolve(b[t].instance)):(v[t]||(v=u({},v,(n={},n[t]=I(t).catch(function(){return k(e,t,null)}),n))),v[t]);var n},e.updateCache=function(e,t){return w.store(e,t)},e.getFromCache=function(e){return b[e]?i.resolve(b[e].instance):I(e)},e.get=function(e){if(void 0===e||null===e)throw new Error("Can't get object with id "+e+" - "+y);if(b[e])return i.resolve(b[e].instance);if(!v[e]){var n=I(e).catch(function(){return t(e,null).then(function(t){return k(t,e,null)})});v=u({},v,(r={},r[e]=n,r))}return v[e];var r},e}(),O.getAll=function(){return b},O.removeLoaded=function(e){return delete b[e]},O.addLoaded=function(e,t){b[e]={instance:t,lastUpdated:Date.now(),updating:!1}},O;var O}},7:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,r){n.d(t,"ɵ0",function(){return u}),n.d(t,"ɵ1",function(){return c}),n.d(t,"ɵ2",function(){return l}),n.d(t,"ɵ3",function(){return f}),n.d(t,"ɵ4",function(){return d}),n.d(t,"ɵ5",function(){return h}),n.d(t,"ɵ6",function(){return p}),n.d(t,"ɵ7",function(){return g}),n.d(t,"ɵ8",function(){return y}),n.d(t,"ɵ9",function(){return m}),n.d(t,"ɵ10",function(){return v}),n.d(t,"ɵ11",function(){return b}),n.d(t,"ɵ12",function(){return w}),n.d(t,"ɵ13",function(){return D}),n.d(t,"ɵ14",function(){return _}),n.d(t,"ɵ15",function(){return I}),n.d(t,"ɵ16",function(){return k}),n.d(t,"ɵ17",function(){return S}),n.d(t,"ɵ18",function(){return E}),n.d(t,"ɵ19",function(){return P}),n.d(t,"ɵ20",function(){return C}),n.d(t,"ɵ21",function(){return O}),n.d(t,"ɵ22",function(){return x}),n.d(t,"ɵ23",function(){return A}),n.d(t,"ɵ24",function(){return M}),n.d(t,"ɵ25",function(){return R}),n.d(t,"ɵ26",function(){return j}),n.d(t,"ɵ27",function(){return L}),n.d(t,"ɵ28",function(){return T}),n.d(t,"ɵ29",function(){return F}),n.d(t,"ɵ30",function(){return K}),n.d(t,"ɵ31",function(){return B}),n.d(t,"ɵ32",function(){return U}),n.d(t,"ɵ33",function(){return N}),n.d(t,"ɵ34",function(){return H}),n.d(t,"ɵ35",function(){return z}),n.d(t,"ɵ36",function(){return q}),n.d(t,"ɵ37",function(){return V}),n.d(t,"ɵ38",function(){return G}),n.d(t,"ɵ39",function(){return W}),n.d(t,"ɵ40",function(){return J}),n.d(t,"ɵ41",function(){return Z}),n.d(t,"ɵ42",function(){return X}),n.d(t,"ɵ43",function(){return Q}),n.d(t,"ɵ44",function(){return $}),n.d(t,"ɵ45",function(){return Y}),n.d(t,"ɵ46",function(){return ee}),n.d(t,"ɵ47",function(){return te}),n.d(t,"ɵ48",function(){return ne}),n.d(t,"ɵ49",function(){return re}),n.d(t,"ɵ50",function(){return ie}),n.d(t,"ɵ51",function(){return oe}),n.d(t,"ɵ52",function(){return ae}),n.d(t,"ɵ53",function(){return se}),n.d(t,"ɵ54",function(){return ue}),n.d(t,"ɵ55",function(){return ce}),n.d(t,"ɵ56",function(){return le}),n.d(t,"ɵ57",function(){return fe}),n.d(t,"ɵ58",function(){return de}),n.d(t,"ɵ59",function(){return he}),n.d(t,"ɵ60",function(){return pe}),n.d(t,"ɵ61",function(){return ge}),n.d(t,"ɵ62",function(){return ye}),n.d(t,"ɵ63",function(){return me}),n.d(t,"ɵ64",function(){return ve}),n.d(t,"ɵ65",function(){return be}),n.d(t,"ɵ66",function(){return we}),n.d(t,"ɵ67",function(){return De}),n.d(t,"ɵ68",function(){return _e}),n.d(t,"ɵ69",function(){return Ie}),n.d(t,"ɵ70",function(){return ke}),n.d(t,"ɵ71",function(){return Se}),n.d(t,"ɵ72",function(){return Ee}),n.d(t,"ɵ73",function(){return Pe}),n.d(t,"ɵ74",function(){return Ce}),n.d(t,"ɵ75",function(){return Oe}),n.d(t,"ɵ76",function(){return xe}),n.d(t,"ɵ77",function(){return Ae}),n.d(t,"ɵ78",function(){return Me}),n.d(t,"ɵ79",function(){return Re}),n.d(t,"ɵ80",function(){return je}),n.d(t,"ɵ81",function(){return Le}),n.d(t,"ɵ82",function(){return Te}),n.d(t,"ɵ83",function(){return Fe}),n.d(t,"ɵ84",function(){return Ke}),n.d(t,"ɵ85",function(){return Be}),n.d(t,"ɵ86",function(){return Ue}),n.d(t,"ɵ87",function(){return Ne}),n.d(t,"ɵ88",function(){return He}),n.d(t,"ɵ89",function(){return ze}),n.d(t,"ɵ90",function(){return qe}),n.d(t,"ɵ91",function(){return Ve}),n.d(t,"ɵ92",function(){return Ge}),n.d(t,"ɵ93",function(){return We}),n.d(t,"ɵ94",function(){return Je}),n.d(t,"ɵ95",function(){return Ze}),n.d(t,"ɵ96",function(){return Xe}),n.d(t,"ɵ97",function(){return Qe}),n.d(t,"ɵ98",function(){return $e}),n.d(t,"ɵ99",function(){return Ye});var i="undefined"!=typeof window?window:void 0!==e?e:void 0,o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",a=o.replace(/x/g,"[a-fA-F0-9]").replace(/y/g,"[89abAB]"),s=new RegExp(a),u=function(e){var t;return function(){return t||(t=e()),t}},c=function(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e.resolve(t.apply(void 0,n))}},l=function(e,t){var n=e.errorData;return Object.keys(n).some(function(e){return n[e].id===t})},f=function(e){function t(t,n){var r=Error.call(this,t);this.name=e,this.extra=n,this.message=r.message,this.stack=r.stack}return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t},d=function(e){var t;return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t||(t=e.apply(this,n)),t}},h=function(e){var t;return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t||(t=e.apply(this,n)),t.finally(function(){t=null}),t}},p=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},g=function(){var e=(new Date).getTime();return o.replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})},y=function(e,t,n){function r(){return t().then(function(t){if(!t)return e.delay(n).then(function(){return r()})})}return r()},m=function(e){var t=Object.keys(e);if(0===t.length)return"";var n="?";return t.forEach(function(t){n+=t,null!==e[t]&&(n+="="+e[t]),n+="&"}),n=n.substr(0,n.length-1)},v=function(e){(e=new Date(+e)).setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var t=new Date(e.getFullYear(),0,1).getTime();return Math.ceil(((e-t)/864e5+1)/7)},b=function(){return window.top.location.pathname.split("/")[1]},w=function(e,t){return e||t},D=function(e,t){return e&&t},_=function(e){return function(){return!e.apply(this,arguments)}},I=function(e,t,n){return function(){e.apply(n,arguments),t.apply(n,arguments)}},k=function(){var e=Array.prototype.slice.call(arguments),t=0,n=0;e.forEach(function(e){t+=e.byteLength});var r=new Uint8Array(t);return e.forEach(function(e){r.set(new Uint8Array(e),n),n+=e.byteLength}),r.buffer},S=function(e,t,n){var r=null;return function(){var i=arguments;r&&clearTimeout(r);return new e(function(e){r=setTimeout(function(){e()},n)}).then(function(){return t.apply(null,i)})}},E=function(e,t){var n,r;return function(){r=arguments,n&&clearTimeout(n),n=setTimeout(function(){e.apply(null,r)},t)}},P=function(e,t){return new e(function(e,n){try{t(function(t,r){t?n(t):e(r)})}catch(e){n(e)}})},C=function(e){var t=[],n=e[Object.keys(e)[0]].length;if(0===n)return t;var r;for(r=0;r<n;r+=1)t.push({});return et.objectEach(e,function(e,r){if(r.length!==n)throw new Error("arrays need to have the same length");r.forEach(function(n,r){t[r][e]=n})}),t},O=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},x=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},A=function(e,t){return function(n,r){var i={};n?t(n):(i[e]=r,t(null,i))}},M=function(e){return"[object Array]"===Object.prototype.toString.call(e)},R=function(e){return e[0]},j=function(e){return e[e.length-1]},L=function(e,t){var n=e.filter(t);if(1===n.length)return n[0]},T=function(e,t){var n={};return e.forEach(function(e,r){n[t[r]]=e}),n},F=function(e,t){return e.indexOf(t)>-1},K=function(e){var t,n=[];for(t=0;t<e.length;t+=1)e[t]instanceof Array?n=n.concat(et.array.flatten(e[t])):n.push(e[t]);return n},B=function(e,t,n){if(e=e||{},0===t.length)return n;var r=e;return t.forEach(function(e,i){i===t.length-1&&(r[e]=n),r[e]||(r[e]={})}),e},U=function(e,t){var n=!0,r=e;return t.forEach(function(e){r.hasOwnProperty(e)?r=r[e]:n=!1}),n},N=function(e,t){var n,r=e,i=0;return 0===t.length?{depth:0,value:e}:(t.forEach(function(e){void 0!==r[e]&&(n=r,r=r[e],i+=1)}),{depth:i,value:r,parentValue:n})},H=function(e){var t={};return e.map(function(e){!function(e,n){et.objectEach(n,function(n,r){if(e.hasOwnProperty(n)&&r!==e[n])throw new Error("attribute already set!");t[n]=r})}(t,e)}),t},z=function(e,t){return(e=e.toString()).length<t?et.pad("0"+e,t):e},q=function(e,t,n){e.toBlob(function(e){n(null,e)},t)},V=function(e,t){var n=new FileReader;n.onload=function(){t(null,n.result)},n.readAsDataURL(e)},G=function(e){if(!(i.atob&&i.Blob&&i.ArrayBuffer&&i.Uint8Array))return!1;try{for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),o=new Uint8Array(r),a=0;a<t.length;a++)o[a]=t.charCodeAt(a);try{return new Blob([r],{type:n})}catch(e){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"===e.name&&window.BlobBuilder){var s=new window.BlobBuilder;return s.append([r]),s.getBlob(n)}return!1}}catch(e){return!1}},W=function(e,t){var n;for(n=0;n<e.length;n+=1)try{e[n](null,t)}catch(e){console.log(e)}},J=function(e,t){function n(){r=!1,t()}var r=!1;return function(){r||(r=!0,window.setTimeout(n,e))}},Z=function(){var e,t=!1,n=[],r=!1,i=!1;this.finish=function(t){i=!!t,r=!t,et.callEach(n,[e=t])},this.success=function(){r||i||(r=!0,et.callEach(n))},this.fail=function(t){r||i||(i=!0,et.callEach(n,[e=t]))},this.isSuccess=function(){return r},this.start=function(e){t||r||i||(t=!0,e())},this.await=function(t){r||i?t(e):n.push(t)}},X=function(e,t,n,r){function i(){return a||(a=e.delay(t).then(function(){return function(){var e=s.splice(0,r||s.length);return n(e).then(function(e){return a=null,e}).map(function(t,n){var r=e[n];return delete u[r],{id:r,result:t}})}()})),a}function o(e){return i().filter(function(t){return t.id===e}).then(function(t){return 0===t.length?o(e):t[0].result})}var a,s=[],u={};return function(e){return u[e]||(s.push(e),u[e]=o(e)),u[e]}},Q=function(e,t,n){function r(){var s=o.splice(0,n||o.length);t(s,function(t,n){if(t)throw t;var u,c;for(u=0;u<n.length;u+=1)et.callListener(a[c=s[u]],n[u]),delete a[c];0===o.length?i=!1:window.setTimeout(r,e)})}var i=!1,o=[],a={};return function(t,n){a[t]?a[t].push(n):(a[t]=[n],o.push(t),i||(i=!0,window.setTimeout(r,e)))}},$=function(e,t){switch(t.saving=!1,t.success=!1,t.failure=!1,e){case"saving":t.saving=!0;break;case"success":t.success=!0;break;case"failure":default:t.failure=!0}},Y=function(e,t){var n,r={};for(n in e)if(e.hasOwnProperty(n))if(t.indexOf(n)>-1)r[n]=JSON.stringify(e[n]);else{if("object"==typeof e[n])throw new Error("value should not be stringified but is object");r[n]=e[n]}return r},ee=function(e,t){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=t.indexOf(n)>-1?JSON.parse(e[n]):e[n]);return r},te=function(e){return function(t){return new e(t)}},ne=function(e,t){var n,r=[];for(n=0;n<e.length;n+=1)-1===t.indexOf(e[n])&&r.push(e[n]);return r},re=function(e){var t,n,r={},i=e.length,o=[];for(t=0;t<i;t+=1)e[t]&&(r[e[t]]=e[t]);for(n in r)r.hasOwnProperty(n)&&o.push(r[n]);return o},ie=function(e,t){return e.length===t.length&&0===et.arraySubtract(e,t).length&&0===et.arraySubtract(t,e).length},oe=function(e,t){if(e===t)return!0;if("object"!=typeof e||"object"!=typeof t)return!1;var n=Object.keys(e),r=Object.keys(t);if(!et.arrayEqual(n,r))return!1;var i,o;for(i=0;i<n.length;i+=1)if(o=n[i],!et.deepEqual(e[o],t[o]))return!1;return!0},ae=function(e,t){var n,r=[];for(n=0;n<e.length;n+=1)r[n]=et.deepCopyObj(e[n],t-1);return r},se=function(e,t){if("object"!=typeof e)return e;if(t<0)throw new Error("too deep");if(e instanceof Array)return et.deepCopyArray(e,t);var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=et.deepCopyObj(e[n],t-1));return r},ue=function(e,t,n,r){function i(e){return!!r&&(""===e||null===e||"object"==typeof e&&0===Object.keys(e).length)}if(!e)return t;if(n<0)throw new Error("too deep");var o,a,s;for(o in t)t.hasOwnProperty(o)&&(e[o]=e[o]||{},a=e[o],void 0!==(s=t[o])&&("object"!=typeof a||"object"!=typeof s||s instanceof Array?e[o]=s:et.extend(a,s,n-1,r),i(e[o])&&delete e[o]));return e},ce=function(e,t){et.objectEach(t,function(t,n){void 0===e[t]?e[t]=et.deepCopyObj(n):"object"==typeof e[t]&&et.extendNoOverwrite(e[t],n)})},le=function(e){return parseInt(e,10)},fe=function(e){if(!e)throw new Error("assertion not met!")},de=function(e){return function(t){return t[e]}},he=function(){},pe=function(e,t){var n={};return et.objectEach(e,function(e,r){if(t.hasOwnProperty(e)&&r!==t[e]){if("object"!=typeof r||"object"!=typeof t[e])throw new Error("attribute set in both!");n[e]=et.objectJoin(r,t[e])}else n[e]=r}),et.objectEach(t,function(t,r){e.hasOwnProperty(t)||(n[t]=r)}),n},ge=function(e,t,n){var r;for(r in e)e.hasOwnProperty(r)&&t.call(n,r,e[r])},ye=function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},me=function(e){var t;for(t=1;t<arguments.length;t+=1)if(arguments[t].indexOf(e)>-1)return!0;return!1},ve=function(e,t){var n,r={};for(n=0;n<e.length;n+=1)r[t(e[n],n)]=e[n];return r},be=function(e,t){if(!e)return[];for(var n;-1!==(n=e.indexOf(t));)e.splice(n,1);return e},we=function(e,t,n){void 0===n&&(n=function(){});var r;return e.forEach(function(e){try{var i=e.apply(null,t);r=r?n(r,i):i}catch(e){console.log(e)}}),r},De=function(e,t,n){var r,i,o={};for(r in e)e.hasOwnProperty(r)&&(i=t.call(n,e[r],r))&&(o[r]=i);return o},_e=function(e,t){var n;for(n in e)e.hasOwnProperty(n)&&("object"==typeof e[n]?et.setAll(e,t):e[n]=t)},Ie=function(e,t){var n,r=e;if("string"==typeof t&&(t=[t]),r){for(n=0;n<t.length;n+=1){if(!r[t[n]])return;r=r[t[n]]}return r}},ke=function(e,t,n){var r=t.pop(),i=et.deepGet(e,t);if(!i)return!1;i[r]=n},Se=function(e){var t;return e.localURL?e.localURL:("undefined"!=typeof URL?t=URL.createObjectURL(e):"undefined"!=typeof webkitURL&&(t=webkitURL.createObjectURL(e)),t)},Ee=function(e,t,n){var r=!1,i=e;return t.forEach(function(e,o){o+1<t.length?(i[e]||(i[e]={}),i=i[e]):i[e]!==n&&(i[e]=et.deepCopyObj(n),r=!0)}),r},Pe=function(e,t,n){var r;for(r in t)if(t.hasOwnProperty(r)){if(!e[r])return!1;if(!n)if("object"==typeof e[r]){if(!et.validateObjects(e[r],t[r]))return!1}else if("function"==typeof e[r]){if(!e[r](t[r]))return!1}else if(!0!==e[r])return!1}return!0},Ce=function(e){var t=e.lastIndexOf(".");return t<0?"":e.substr(t)},Oe=function(e){var t=e.lastIndexOf(".");return t<0?e:e.substr(0,t)},xe=function(){this.apply(null,arguments)},Ae=function(e,t,n){var r,i,o=[];for(r=0;r<t.length;r+=1)for(i=0;i<e.length;i+=1)if(e[i][n]()===t[r]){o.push(e[i]),e.splice(i,1);break}return o},Me=function(e){return et.isString(e)&&e.match(s)},Re=function(e){var t=parseInt(e,10);return!isNaN(t)&&t.toString()===e.toString()},je=function(e){return!!et.isInt(e)&&(e=parseInt(e,10))>0},Le=function(e){if("string"!=typeof e)return!1;var t=e.split(":");return 2===t.length&&(64===t[1].length&&!(!et.isNickname(t[0])&&!et.isMail(t[0])))},Te=function(e){return et.isString(e)&&0!==e.length&&!!e.match(/^[A-z][A-z0-9]*$/)},Fe=function(e){return et.isString(e)&&0!==e.length&&/^.+@.+$/.test(e)},Ke=function(e){return et.isset(e)&&(64===e.length||32===e.length)&&et.isHex(e)},Be=function(e){return et.isHex(e)&&64===e.length},Ue=function(e){return"c256"===e||"256"===e},Ne=function(e){return et.isset(e)&&"string"==typeof e&&!!e.match(/^[A-Za-z0-9\+\/=]|=[^=]|={3,}$/)},He=function(e){return et.isHex(e)},ze=function(e){return et.isset(e)&&"string"==typeof e&&!!e.match(/^[A-Fa-f0-9]*$/)},qe=function(e){return"object"==typeof e},Ve=function(e){return void 0!==e&&null!==e&&"string"==typeof e},Ge=function(e){return void 0!==e&&null!==e},We=function(e){var t,n=1;if(!et.isset(e))return!1;for(t=e,n=1;n<arguments.length;n+=1){if(!et.isset(t[arguments[n]]))return!1;t=t[arguments[n]]}return!0},Je=function(e){return function(){var t=arguments;void 0!==r?r.nextTick(function(){e.apply(this,t)}):e.apply(this,t)}},Ze=function(e){var t=function(t){if(t)return console.log(t.stack),void this(t);var n,r=[];for(n=1;n<arguments.length;n+=1)r.push(arguments[n]);return e.apply(this,r)};return t.getRealFunction=function(){return e},t},Xe=function(e,t){return function(n){if(n){console.log(n);var r=!1;if(t instanceof Array){var i;for(i=0;i<t.length;i+=1)n instanceof t[i]&&(r=!0)}else r=n instanceof t;if(!r)return void this(n)}return e.apply(this,arguments)}},Qe=function(e,t){return et.arraySubtract(e,t).length===e.length&&et.arraySubtract(t,e).length===t.length},$e=function(e,t){var n=0;for(n=0;n<e.length;n+=1)if(e[n]===t)return!0;return!1},Ye=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},et={executeOnce:u,ensurePromise:c,hasErrorId:l,createErrorType:f,cacheResult:d,cacheUntilSettled:h,randomIntFromInterval:p,generateUUID:g,repeatUntilTrue:y,encodeParameters:m,getWeekNumber:v,getLanguageFromPath:b,or:w,and:D,not:_,addAfterHook:I,concatBuffers:k,debouncePromise:S,debounce:E,promisify:P,joinArraysToObject:C,capitaliseFirstLetter:O,lowercaseFirstLetter:x,objectifyResult:A,array:{isArray:M,first:R,last:j,find:L,spreadByArray:T,contains:F,flatten:K},object:{deepSet:B,deepHas:U,deepGet:N,multipleFlatJoin:H},pad:z,canvasToBlob:q,blobToDataURI:V,dataURItoBlob:G,callListener:W,aggregateOnce:J,FullFiller:Z,delayMultiplePromise:X,delayMultiple:Q,setGeneralState:$,stringifyCertainAttributes:Y,unStringifyCertainAttributes:ee,newElement:te,arraySubtract:ne,arrayUnique:re,arrayEqual:ie,deepEqual:oe,deepCopyArray:ae,deepCopyObj:se,extend:ue,extendNoOverwrite:ce,parseDecimal:le,assert:fe,qm:de,nop:he,objectJoin:pe,objectEach:ge,copyObj:ye,containsOr:me,arrayToObject:ve,removeArray:be,callEach:we,objectMap:De,setAll:_e,deepGet:Ie,deepSet:ke,toUrl:Se,deepSetCreate:Ee,validateObjects:Pe,codeChars:["Q","W","E","R","T","Z","U","I","O","P","A","S","D","F","G","H","J","K","L","Y","X","C","V","B","N","M","q","w","e","r","t","z","u","i","o","p","a","s","d","f","g","h","j","k","l","y","x","c","v","b","n","m","1","2","3","4","5","6","7","8","9","0"],getExtension:Ce,getName:Oe,passFunction:xe,orderCorrectly:Ae,isUUID:Me,isInt:Re,isID:je,isRealID:Le,isNickname:Te,isMail:Fe,isSessionKey:Ke,isPassword:Be,isCurve:Ue,isBase64:Ne,isSignature:He,isHex:ze,isObject:qe,isString:Ve,isset:Ge,arraySet:We,nT:Je,sF:Ze,hE:Xe,emptyUnion:Qe,inArray:$e,firstCapital:Ye};t.default=et}.call(t,n(13),n(92))},87:function(e,t,n){"use strict";var r=n(37),i=n(3),o=n(7),a=function(){var e=Math.random();try{return localStorage.setItem("check-"+e,"check-"+e),localStorage.getItem("check-"+e)==="check-"+e&&(localStorage.removeItem("check-"+e),!0)}catch(e){return!1}};a||("de"===o.default.getLanguageFromPath()?alert("Fehler!\n Kann Daten nicht lokal speichern!\n whispeer funktioniert ohne lokale Datenspeicherung (localstorage) nicht.\n Bitte aktivier es oder bitte uns um Hilfe: feedback@whispeer.de"):alert("Error!\n Can't store data locally!\n whispeer does not work without localstorage.\n Please enable it or ask us for help: feedback@whispeer.de"));var s=function(){return function(e){var t=this;this.get=function(e){return localStorage.getItem(t.calculateKey(e))},this.set=function(e,n){return localStorage.setItem(t.calculateKey(e),n)},this.remove=function(e){return localStorage.removeItem(t.calculateKey(e))},this.clear=function(){return Object.keys(localStorage).filter(function(e){return 0===e.indexOf(this._prefix)},t).forEach(function(e){localStorage.setItem(e,"")}),i.resolve()},this.save=function(){return i.resolve()},this.calculateKey=function(e){return t._prefix+"."+e},this.awaitLoading=function(){return i.resolve()},this._prefix=e}}();t.a=function(e){if(!u[e])try{u[e]=new s(e)}catch(e){c.broken=!0}return u[e]};var u=[],c={Cache:new r.a("localStorage"),hasLocalStorage:function(){try{return localStorage.setItem("localStorageTest","localStorageTest"),localStorage.removeItem("localStorageTest"),!0}catch(e){return!1}}(),broken:!1}},88:function(e,t,n){"use strict";var r=n(17),i=n(7),o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=function(e){function t(t){var n=e.call(this)||this;return n.done=0,n.donePercentage=0,n.data={progress:0},n._parseOptions=function(){n.options&&(n.total=n.options.total,n.options.depends&&n._listenDepends(n.options.depends))},n._listenDepends=function(e){n.depends=e,e.forEach(function(e){e.listen(n.recalculate.bind(n),"progress")})},n.removeDepend=function(e){if(!n.depends&&n.total)throw new Error("trying to mix depending progress and manual progress");i.default.removeArray(n.depends,e),n.recalculate()},n.addDepend=function(e){if(!n.depends&&n.total)throw new Error("trying to mix depending progress and manual progress");n.depends=n.depends||[],n.depends.push(e),e.listen(n.recalculate.bind(n),"progress"),n.recalculate()},n.progressDelta=function(e){if(n.depends)throw new Error("trying to mix depending progress and manual progress");n.done+=e,n.recalculate()},n.progress=function(e){if(n.depends)throw new Error("trying to mix depending progress and manual progress");n.done=e,n.recalculate()},n.setTotal=function(e){if(n.depends)throw new Error("trying to mix depending progress and manual progress");n.total=e,n.recalculate()},n.reset=function(){n.done=0,n.recalculate()},n.joinDepends=function(){var e=0,t=0;n.depends.forEach(function(n){e+=n.getDone(),t+=n.getTotal()||0}),n.done=e,n.total=t},n.getDone=function(){return n.done},n.getTotal=function(){return n.total},n.getProgress=function(){return n.donePercentage},n.recalculate=function(){n.depends&&n.joinDepends(),n.total&&(n.donePercentage=n.done/n.total,n.donePercentage=Math.min(n.donePercentage,1),n.data.progress=n.donePercentage,n.notify(n.donePercentage,"progress"))},n.options=t,n._parseOptions(),n}return o(t,e),t}(r.default);t.a=a},91:function(e,t,n){"use strict";function r(e){return I.toString(e)}function i(e){return I.fromString(e)}function o(e,t){var n=e.key,i=e.userid,o=e.nickname;return void 0===t&&(t=I.UNTRUSTED),{added:(new Date).getTime(),trust:r(t),key:n,userid:i,nickname:o}}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"TRUST_SECURED_OPTIONS",function(){return v}),n.d(t,"TrustStore",function(){return b}),n.d(t,"trustStates",function(){return I}),n.d(t,"transformLegacy",function(){return k}),t.userToDataSet=o,n.d(t,"ɵ0",function(){return S}),n.d(t,"ɵ1",function(){return O}),n.d(t,"ɵ2",function(){return A}),n.d(t,"ɵ3",function(){return M}),n.d(t,"ɵ4",function(){return R}),n.d(t,"ɵ5",function(){return j}),n.d(t,"ɵ6",function(){return L}),n.d(t,"ɵ7",function(){return T}),n.d(t,"ɵ8",function(){return F}),n.d(t,"ɵ9",function(){return K}),n.d(t,"ɵ10",function(){return B}),n.d(t,"ɵ11",function(){return U}),n.d(t,"ɵ12",function(){return N});var a,s,u=n(7),c=n(14),l=n(17),f=n(31),d=n(236),h=n(3),p=(n.n(h),n(34)),g=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]]);return n},y=n(50),m=n(27),v={type:"trustManager"},b=function(){return function(e){var t=e.nicknames,n=e.ids,r=e.me,o=e.keys,a=e.signature,u=this;this.getSignature=function(){return u.signature},this.update=function(e){var t=e.keys,n=Object.keys(t).filter(function(e){return!u.keys.hasOwnProperty(e)}),r=Object.keys(t).filter(function(e){return u.keys.hasOwnProperty(e)}).filter(function(e){var n=i(u.keys[e].trust),r=i(t[e].trust);return E.indexOf(n)<E.indexOf(r)});n.forEach(function(e){return u.add(t[e])}),r.forEach(function(e){return u.keys[e].trust=t[e].trust}),(n.length>0||r.length>0)&&x()},this.add=function(e){var t=e.key,n=e.userid,r=e.nickname,i=u.ids[n],o=u.nicknames[r];if(i&&i!==t)throw new y.SecurityError("we already have got a key for this users id");if(o&&o!==t)throw new y.SecurityError("we already have got a key for this users nickname");u.keys[t]=e,r&&(u.nicknames[r]=t),u.ids[n]=t},this.get=function(e){return u.keys[e]},this.setKeyTrustLevel=function(e,t){u.keys[e].trust=t},this.getUpdatedVersion=function(){var e={nicknames:u.nicknames,ids:u.ids,me:u.me};return Object.keys(u.keys).forEach(function(t){e[t]=u.keys[t]}),new f.SecuredData(null,e,v,!0).sign(s)},this.getTrustSet=function(){return{nicknames:u.nicknames,keys:u.keys,ids:u.ids,me:u.me,signature:u.signature}},this.hasKeyData=function(e){return u.keys.hasOwnProperty(e)},this.nicknames=t,this.ids=n,this.me=r,this.keys=o,this.signature=a}}(),w=!1,D=0,_=["BROKEN","UNTRUSTED","TIMETRUSTED","WHISPEERVERIFIED","NETWORKVERIFIED","VERIFIED","OWN"],I=new d.a(_),k=function(e){var t=e.nicknames,n=e.ids,r=e.me,i=e._signature,o=g(e,["nicknames","ids","me","_signature"]),a={};return Object.keys(o).filter(function(e){return u.default.isRealID(e)}).forEach(function(e){a[e]=o[e]}),{nicknames:t,ids:n,me:r,keys:a,signature:i}},S=function(e){return I.fromString("|"+e+"|")},E=_.map(S),P=function(){return function(e){var t=this;this.data=e,this.getAddedTime=function(){return t.data.added},this.getKey=function(){return t.data.key},this.getUserID=function(){return t.data.userid},this.getNickname=function(){return t.data.nickname},this.getTrust=function(){return t.trustSymbol},this.isUntrusted=function(){return t.trustSymbol===I.UNTRUSTED},this.isTimeTrusted=function(){return t.trustSymbol===I.TIMETRUSTED},this.isWhispeerVerified=function(){return t.trustSymbol===I.WHISPEERVERIFIED},this.isNetworkVerified=function(){return t.trustSymbol===I.NETWORKVERIFIED},this.isVerified=function(){return t.trustSymbol===I.VERIFIED},this.isOwn=function(){return t.trustSymbol===I.OWN},this.trustSymbol=i(e.trust)}}(),C=function(){return m.awaitLoading().then(function(){return a.getUpdatedVersion()}).then(function(e){return c.default.emit("trustManager.set",{content:e})}).then(function(e){return e.success?null:p.default.criticalError(e)})},O=C,x=u.default.aggregateOnce(50,C),A=function(e){w||(D=e)},M=function(){D=0},R=function(){return w},j=function(e){s=e},L=function(e){a.add(e)},T=function(e,t){if(!w)throw new Error("cant update database: not loaded");var n=f.default.load(void 0,e,v);return h.try(function(){if(e.me===s)return n.verifyAsync(s,"user");throw new y.SecurityError("not my trust database")}).then(function(){return a.update(k(n.metaGet()))}).nodeify(t)},F=function(e){if(!w){if(e===s)return!0;if(D>0)return D-=1,!0;throw new Error("trust manager not yet loaded")}return a.hasKeyData(e)},K=function(e){var t=a.get(e);if(t)return new P(t);throw new Error("key not in trust database "+e)},B=function(e){var t=e.getSignKey();if(t===s)throw new Error("Tried to verify own user.");return a.hasKeyData(t)&&a.setKeyTrustLevel(t,r(I.VERIFIED)),C()},U=function(e){H.isLoaded()&&!H.hasKeyData(e.key)&&(H.addDataSet(o(e)),x())},N=function(e){if(a)throw new Error("trying to overwrite trust store. Please update instance");H.disallow(),a=e,w=!0,H.notify("","loaded")},H={notify:null,allow:A,disallow:M,isLoaded:R,setOwnSignKey:j,addDataSet:L,updateDatabase:T,hasKeyData:F,getKeyData:K,uploadDatabase:C,verifyUser:B,addNewUsers:U,setTrustStore:N};l.default.extend(H),c.default.channel("notify.trustManager",function(e,t){H.updateDatabase(t).catch(p.default.criticalError)}),t.default=H},95:function(e,t,n){"use strict";var r=n(7).default,i=n(361),o=n(362);e.exports=r.extend(r.extend({},i),o)},96:function(e,t,n){"use strict";var r=n(3),i=(n.n(r),function(){function e(e){this.maxWeight=e,this.queue=[],this.run=!1,this.runningWeight=0}return e.prototype.enqueue=function(e,t){var n=this;return new r(function(r,i){n.queue.push({task:t,weight:e,resolve:r,reject:i}),n.runTasks()})},e.prototype.runTasks=function(){if(this.run)for(var e;this.queue.length>0&&this.runningWeight<this.maxWeight;)e=this.queue.shift(),this.runTask(e)},e.prototype.runTask=function(e){var t=this;this.runningWeight+=e.weight,e.task().then(function(t){e.resolve(t)},function(t){e.reject(t)}).finally(function(){t.runningWeight-=e.weight,t.runTasks()})},e.prototype.start=function(){this.run=!0,this.runTasks()},e}());t.a=i},97:function(e,t,n){"use strict";var r=n(3),i=(n.n(r),n(37)),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};t.a=function(e){var t=e.download,n=e.load,a=e.restore,s=e.getID,u=e.cacheName,c={},l={},f=new i.a(u),d=function(e){delete(c=o({},c))[e]},h=function(e,t){return l=o({},l,(n={},n[e]=t,n)),t;var n},p=function(e){return f.get(e).then(function(e){return e.data}).then(a).then(function(t){return h(e,t),d(e),t})},g=function(e,t){return n(e).then(function(e){return f.store(t,e).thenReturn(e)}).then(a).then(function(e){return h(t,e)}).finally(function(){return d(t)})};return y=function(){function e(){}return e.getLoaded=function(t){if(!e.isLoaded(t))throw new Error("Not yet loaded: "+t);return l[t]},e.isLoaded=function(e){return l.hasOwnProperty(e)},e.getFromCache=function(e){return l[e]?r.resolve(l[e]):p(e)},e.load=function(e){var t=s(e);return l[t]?r.resolve(l[t]):(c[t]||(c=o({},c,(n={},n[t]=p(t).catch(function(){return g(e,t)}),n))),c[t]);var n},e.get=function(e){if(void 0===e||null===e)throw new Error("Can't get object with id "+e+" - "+u);if(l[e])return r.resolve(l[e]);if(!c[e]){var n=p(e).catch(function(){return t(e).then(function(t){return g(t,e)})});c=o({},c,(i={},i[e]=n,i))}return c[e];var i},e.updateCache=function(e,t){return f.store(e,t)},e}(),y.getAll=function(){return l},y.removeLoaded=function(e){return delete l[e]},y.addLoaded=function(e,t){l[e]=t},y;var y}}},[316]);