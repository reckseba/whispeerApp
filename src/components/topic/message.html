<div attr.data-messageid="{{message.data.id}}" class="messages__wrap" *ngIf="message.isBlockedSince()">
	<div class="messages__message messages__message-blocked">
		<span>{{ 'blocked.messageReplacement' | translate }}</span>
	</div>
	<span class="messages__time"></span>
</div>
<div *ngIf="!message.isBlockedSince()">
	<div attr.data-messageid="{{message.data.id}}" class="messages__wrap" *ngIf="message.data.text.length > 0 || message.data.images.length > 0">
		<div class="messages__message" [ngClass]="{'messages__message--emoji-only': message.data.emojiOnly}">
			<span whispeerSyntaxify content="{{message.data.text}}"></span>
			<gallery *ngIf="message.data.images && message.data.images.length > 0" [images]="message.data.images"></gallery>
		</div>
		<span class="messages__time">{{ message.data.date | date: "shortTime" }}</span>
	</div>
	<div *ngFor="let file of message.data.files" class="messages__wrap messages__wrap--file">
		<div class="messages__message message__file" [ngClass]="{'message__file--sending': voicemailSending()}">
			<div class="message__file__hexagon-wrap">
				<hexagon class="message__file__hexagon"></hexagon>
				<!-- TODO: icon states.
					maybe we should use different svgs with
					icons built in them... -->
				<ion-icon name="md-download" class="message__file__hexagon-icon" *ngIf="!file.loaded && !file.getProgress" (click)="downloadFile(file)"></ion-icon>
				<loading-progress *ngIf="(!file.loaded && file.getProgress) || voicemailSending()" [progress]="file.getProgress" [inverse]="voicemailSending()"></loading-progress>
			</div>
			<span class="message__file__info">
				<span class="message__file__name">{{ file.name | filenameLimit: 25 }}</span>
				<span class="message__file__size" *ngIf="!file.loaded">[{{ formatSize(file.size) }}]</span>
			</span>
		</div>
		<span class="messages__time">{{ message.data.date | date: "shortTime" }}</span>
	</div>
	<div *ngIf="message.data.voicemails && message.data.voicemails.length > 0" class="messages__wrap messages__wrap--file">
		<div class="messages__message message__file" [ngClass]="{'message__file--sending': voicemailSending()}">
			<div class="message__file__hexagon-wrap">
				<hexagon class="message__file__hexagon"></hexagon>
				<ion-icon name="md-download" class="message__file__hexagon-icon" *ngIf="!voicemailLoaded() && !voicemailDownloadProgress && !voicemailSending()" (click)="downloadVoicemail()"></ion-icon>
				<ion-icon name="md-play" class="message__file__hexagon-icon" *ngIf="voicemailLoaded() && voicemailPaused() && !voicemailSending()" (click)="playVoicemail()"></ion-icon>
				<loading-progress *ngIf="(!voicemailLoaded() && voicemailDownloadProgress) || voicemailSending()" [progress]="voicemailProgress" [inverse]="voicemailSending()"></loading-progress>
				<ion-icon name="md-pause" class="message__file__hexagon-icon" *ngIf="voicemailLoaded() && voicemailPlaying()" (click)="pauseVoicemail()"></ion-icon>
			</div>
			<span class="message__file__info">
				<ion-icon icon name="stats" class="message__file__memo-play-icon" [ngClass]="{'message__file__memo-play-icon--active': voicemailPlaying()}"></ion-icon>&nbsp;
				<span><span *ngIf="voicemailLoaded()">{{ voicemailPosition() * 1000 | date: 'mm:ss' }} /&nbsp;</span>{{ voicemailDuration() * 1000 | date: 'mm:ss' }}&nbsp;</span>
				<span *ngIf="!voicemailLoaded()" class="message__file__info__size">[{{formatSize(voicemailSize())}}]</span>
			</span>
			<div class="message__file__progress" *ngIf="voicemailLoaded() && voicemailPosition() > 0">
				<div class="message__file__progress__bar" [ngStyle]="{'width.%': voicemailPosition() * 100 / voicemailDuration()}"></div>
				<div class="message__file__progress__icon" [ngStyle]="{'margin-left.%': voicemailPosition() * 100 / voicemailDuration()}">
					<hexagon class="message__file__progress__icon__hex"></hexagon>
				</div>
			</div>
		</div>
		<span class="messages__time">{{ message.data.date | date: "shortTime" }}</span>
	</div>
</div>
